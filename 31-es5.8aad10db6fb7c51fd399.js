function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{"D+SI":function(e,t,n){"use strict";n.r(t);var o,r=n("ofXK"),i=n("3Pt+"),s=n("tyNb"),c=n("c7TG"),a=n("mrSG"),u=n("L99X"),d=n("LTmD"),l=n("lEof"),b=n("fXoL"),h=((o=function(){function e(t,n){_classCallCheck(this,e),this.modalCtrl=t,this.toastCtrl=n,this.name="",this.nodetype=32,this.edit=!1,this.path=[]}return _createClass(e,[{key:"ngOnInit",value:function(){}},{key:"onclose",value:function(e){return Object(a.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.name=(this.name||"").trim(),!e||!this.name.IsNullOrEmpty()){t.next=4;break}return t.next=3,this.toastCtrl.create({message:"\u6587\u4ef6\u5939\u7684\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a",duration:2e3});case 3:return t.abrupt("return",void t.sent.present());case 4:n={},e&&(n={name:this.name,type:this.nodetype}),this.modalCtrl.dismiss(n);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"NodeName",set:function(e){this.name=e},get:function(){return this.name}},{key:"NodeType",get:function(){return this.nodetype.toString()},set:function(e){this.nodetype=parseInt(e)}},{key:"Edit",get:function(){return this.edit},set:function(e){this.edit=!0===e}},{key:"Path",set:function(e){console.log("path = ",e),this.path=e}},{key:"PathT",get:function(){return this.path.join(" / ")}}]),e}()).\u0275fac=function(e){return new(e||o)(b.Wb(c.cb),b.Wb(c.jb))},o.\u0275cmp=b.Qb({type:o,selectors:[["app-nodeeditor"]],inputs:{NodeName:"NodeName",NodeType:"NodeType",Edit:"Edit",Path:"Path"},decls:44,vars:4,consts:[["color","secondary"],["slot","end"],[3,"click"],["color","medium"],["position","floating"],["placeholder","\u6587\u4ef6\u5939\u6216\u5ba2\u6237\u540d\u79f0",3,"ngModel","ngModelChange"],["position","stacked"],[3,"ngModel","disabled","ngModelChange"],["value","1"],["name","folder"],["value","2"],["name","person"],["value","32","checked",""],["name","document"],["margin-top","10"]],template:function(e,t){1&e&&(b.Zb(0,"ion-header"),b.Zb(1,"ion-toolbar",0),b.Zb(2,"ion-title"),b.xc(3,"\u521b\u5efa\u8282\u70b9"),b.Yb(),b.Zb(4,"ion-buttons",1),b.Zb(5,"ion-button",2),b.hc("click",(function(){return t.onclose(!1)})),b.xc(6," \u53d6\u6d88 "),b.Yb(),b.Zb(7,"ion-button",2),b.hc("click",(function(){return t.onclose(!0)})),b.xc(8," \u786e\u5b9a "),b.Yb(),b.Yb(),b.Yb(),b.Yb(),b.Zb(9,"ion-content"),b.Zb(10,"ion-item"),b.Zb(11,"ion-text"),b.xc(12,"\u8def\u5f84\uff1a"),b.Yb(),b.Zb(13,"ion-text",3),b.xc(14),b.Yb(),b.Yb(),b.Zb(15,"ion-item"),b.Zb(16,"ion-label",4),b.xc(17,"\u76ee\u5f55\u540d\u79f0"),b.Yb(),b.Zb(18,"ion-input",5),b.hc("ngModelChange",(function(e){return t.NodeName=e})),b.Yb(),b.Yb(),b.Zb(19,"ion-item"),b.Zb(20,"ion-label",6),b.xc(21,"\u76ee\u5f55\u7c7b\u578b"),b.Yb(),b.Zb(22,"ion-segment",7),b.hc("ngModelChange",(function(e){return t.NodeType=e})),b.Zb(23,"ion-segment-button",8),b.Xb(24,"ion-icon",9),b.Zb(25,"ion-text"),b.xc(26,"\u5f52\u6863\u7bb1"),b.Yb(),b.Yb(),b.Zb(27,"ion-segment-button",10),b.Xb(28,"ion-icon",11),b.Zb(29,"ion-text"),b.xc(30,"\u5ba2\u6237\u5939"),b.Yb(),b.Yb(),b.Zb(31,"ion-segment-button",12),b.Xb(32,"ion-icon",13),b.Zb(33,"ion-text"),b.xc(34,"\u6587\u4ef6\u5939"),b.Yb(),b.Yb(),b.Yb(),b.Yb(),b.Zb(35,"ion-item",14),b.Zb(36,"ion-text",3),b.xc(37,"\u6587\u4ef6\u5939\uff1a\u53ea\u53ef\u5b58\u653e\u516d\u723b\u548c\u516b\u5b57\u6848\u4f8b\u3002\u6587\u4ef6\u5939\u4e0b\u9762\u4e0d\u80fd\u518d\u5305\u542b\u5f52\u6863\u7bb1\u3001\u5ba2\u6237\u5939\u3001\u6587\u4ef6\u5939\u3002"),b.Yb(),b.Yb(),b.Zb(38,"ion-item",14),b.Zb(39,"ion-text",3),b.xc(40,"\u5f52\u6863\u7bb1\uff1a\u4e0d\u53ef\u5b58\u653e\u6848\u4f8b\uff0c\u4f46\u53ef\u4ee5\u5d4c\u5957\u5305\u542b\u5f52\u6863\u7bb1\u3001\u5ba2\u6237\u5939\u3001\u6587\u4ef6\u5939\u3002"),b.Yb(),b.Yb(),b.Zb(41,"ion-item",14),b.Zb(42,"ion-text",3),b.xc(43,"\u5ba2\u6237\u5939\uff1a\u4e0d\u53ef\u5b58\u653e\u6848\u4f8b\uff0c\u4f46\u53ef\u4ee5\u5d4c\u5957\u5305\u542b\u5f52\u6863\u7bb1\u3001\u5ba2\u6237\u5939\u3001\u6587\u4ef6\u5939\u3002"),b.Yb(),b.Yb(),b.Yb()),2&e&&(b.Mb(14),b.yc(t.PathT),b.Mb(4),b.oc("ngModel",t.NodeName),b.Mb(4),b.oc("ngModel",t.NodeType)("disabled",t.Edit))},directives:[c.s,c.Y,c.W,c.k,c.j,c.o,c.w,c.T,c.C,c.v,c.ib,i.c,i.d,c.N,c.hb,c.O,c.t,c.d],styles:[""]}),o),f=n("HQI1"),p=n("mo90");function m(e,t){1&e&&(b.Zb(0,"div",5),b.Xb(1,"ion-spinner",6),b.Yb())}function v(e,t){if(1&e&&b.Xb(0,"ion-icon",7),2&e){var n=b.jc();b.oc("name",1===n.SyncNodesFinished?"md-checkmark":"md-close")}}function y(e,t){1&e&&(b.Zb(0,"div",5),b.Xb(1,"ion-spinner",6),b.Yb())}function N(e,t){if(1&e&&b.Xb(0,"ion-icon",7),2&e){var n=b.jc().$implicit;b.oc("name",1===n.statue?"md-checkmark":"md-close")}}function g(e,t){if(1&e&&(b.Zb(0,"ion-item"),b.Zb(1,"ion-text",8),b.xc(2),b.Yb(),b.Zb(3,"ion-text"),b.xc(4),b.Yb(),b.wc(5,y,2,0,"div",1),b.wc(6,N,1,1,"ion-icon",2),b.Yb()),2&e){var n=t.$implicit;b.Mb(2),b.yc(n.type),b.Mb(2),b.yc(n.path),b.Mb(1),b.oc("ngIf",0===n.statue),b.Mb(1),b.oc("ngIf",0!==n.statue)}}var x,k=n("NFKh"),S=((x=function(){function e(t,n,o,r,i){_classCallCheck(this,e),this.modalCtrl=t,this.alertController=n,this.dbservice=o,this.settings=r,this.host=i,this.Items=[],this.changed=!1,this.encrypKey="",this.usingencry=!1,this.Finished=!1,this.SyncNodesFinished=0}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this.settings.User;this.encrypKey=e.encryp,this.usingencry=!0===this.settings.Encryp,console.log("encrypKey",this.encrypKey,this.settings.Encryp),this.SyncNodes(e.id,e.password)}},{key:"SyncNodes",value:function(e,t){return Object(a.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,o,r,i,s,c=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.LoadTreeFromCloud().catch((function(){return[]}));case 2:if(t=e.sent,Array.isArray(t)){e.next=5;break}return e.abrupt("return",(console.log(t),void this.modalCtrl.dismiss()));case 5:if(n=!1,this.SyncNodesFinished=1,t.length>0&&(o=this.dbservice.SaveNodesFromCloud(t)).length>0&&(n=!0,r=o.map((function(e){return{type:"\u4e0b\u8f7d <= :",path:e[1],statue:0,id:e[0]}})),this.Items=this.Items.concat(r),this.LoadRecordesFromCloud(r)),!((i=this.dbservice.NewNodesToCloud(t)).length>0)){e.next=16;break}return n=!0,s=i.map((function(e){return{type:"\u4e0a\u4f20 => :",path:e[1],statue:0,id:e[0]}})),this.Items=this.Items.concat(s),e.next=14,this.UploadRecordes(s);case 14:return e.next=16,this.UploadNodes().catch((function(){c.SyncNodesFinished=-1}));case 16:!1===n?this.Items.push({type:"",path:"\u6ca1\u6709\u53ef\u66f4\u65b0\u7684\u6570\u636e\uff0c\u5df2\u7ecf\u4fdd\u5b58\u540c\u6b65\uff01",statue:1,id:""}):this.dbservice.SaveNodes(),this.dbservice.CleanNodes(),this.Finished=!0;case 17:case"end":return e.stop()}}),e,this)})))}},{key:"DecrypData",value:function(e){try{var t=k.AES.decrypt(e,this.encrypKey).toString(k.enc.Utf8);return JSON.parse(t)}catch(n){throw this.presentAlert("\u89e3\u5bc6\u51fa\u9519",null,"\u65e0\u6cd5\u89e3\u5bc6\u4e91\u7aef\u6848\u4f8b\u6587\u4ef6\u3002\u6587\u4ef6\u5df2\u635f\u574f\u6216\u52a0\u5bc6\u53e3\u4ee4\u4e0d\u6b63\u786e\u3002"),new Error("\u6587\u4ef6\u5df2\u635f\u574f\uff0c\u6216\u52a0\u5bc6\u53e3\u4ee4\u4e0d\u6b63\u786e\uff0c\u65e0\u6cd5\u6253\u5f00\u6587\u4ef6\u3002")}}},{key:"LoadTreeFromCloud",value:function(){var e=this,t=this.settings.User;return this.host.GetBookTree(t.id,t.password).then((function(n){return n&&n.id===t.id?!0===n.encryp?e.DecrypData(n.content):n.content:Promise.reject("\u670d\u52a1\u5668\u6587\u4ef6\u51fa\u9519\u3002")})).catch((function(e){return Promise.reject(e)}))}},{key:"UploadNodes",value:function(){var e=this,t=this.settings.User,n={id:t.id,modified:Date.now(),version:0,encryp:!1,content:this.dbservice.NodesAlle};return this.usingencry&&(n.content=k.AES.encrypt(JSON.stringify(this.dbservice.NodesAlle),this.encrypKey).toString(),n.encryp=!0),this.host.SaveBookTree(t.id,t.password,n).then((function(){return e.dbservice.Nodes.forEach((function(e){32!==e.type&&(e.dirty=!1)})),e.dbservice.SaveNodes(),!0})).catch((function(e){return!1}))}},{key:"LoadRecordesFromCloud",value:function(e){var t=this,n=this.settings.User,o=[];return e.forEach((function(e){var r=t.host.LoadRecord(n.id,n.password,e.id).then((function(n){if(n&&n.id===e.id){var o=n.content;return!0===n.encryp&&(o=t.DecrypData(n.content)),t.dbservice.SaveRecordes(e.id,o,!1),e.statue=1,!0}return e.statue=-1,!1})).catch((function(t){return console.error(t),e.statue=-1,!1}));o.push(r)})),Promise.all(o).then((function(t){return console.log("LoadRecordesFromCloud promises",t),e.filter((function(e){return 1===e.statue})).length===e.length}))}},{key:"UploadRecordes",value:function(e){return Object(a.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,o,r,i,s,c,a,u=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=this.settings.User,o=!0,r=!1,i=void 0,t.prev=4,s=regeneratorRuntime.mark((function e(){var t,o,r,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.value,e.next=3,u.dbservice.GetRecordes(t.id).catch((function(){return null}));case 3:if(o=e.sent,r=u.dbservice.Nodes.find((function(e){return e.id===t.id})),!(o&&o.length>0)){e.next=14;break}return i={id:t.id,modified:Date.now(),version:r.version,encryp:!1,content:o},u.usingencry&&(i.content=k.AES.encrypt(JSON.stringify(o),u.encrypKey).toString(),i.encryp=!0),e.next=10,u.host.UploadRecord(n.id,n.password,i).then((function(){console.log("upload ".concat(t.id," finished. set dirty false")),r.dirty=!1})).catch((function(){return!1}));case 10:s=e.sent,t.statue=!1===s?-1:1,e.next=15;break;case 14:t.statue=1;case 15:case"end":return e.stop()}}),e)})),c=e[Symbol.iterator]();case 7:if(o=(a=c.next()).done){t.next=12;break}return t.delegateYield(s(),"t0",9);case 9:o=!0,t.next=7;break;case 12:t.next=18;break;case 14:t.prev=14,t.t1=t.catch(4),r=!0,i=t.t1;case 18:t.prev=18,t.prev=19,o||null==c.return||c.return();case 21:if(t.prev=21,!r){t.next=24;break}throw i;case 24:return t.finish(21);case 25:return t.finish(18);case 26:return t.abrupt("return",Promise.resolve(!0));case 27:case"end":return t.stop()}}),t,this,[[4,14,18,26],[19,,21,25]])})))}},{key:"Stop",value:function(){this.modalCtrl.dismiss(this.changed)}},{key:"presentAlert",value:function(e,t,n){return Object(a.b)(this,void 0,void 0,regeneratorRuntime.mark((function o(){var r;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.alertController.create({header:e||"\u9519\u8bef",subHeader:t||"",message:n,buttons:["\u786e\u5b9a"]});case 2:return r=o.sent,o.next=5,r.present();case 5:case"end":return o.stop()}}),o,this)})))}}]),e}()).\u0275fac=function(e){return new(e||x)(b.Wb(c.cb),b.Wb(c.b),b.Wb(u.a),b.Wb(d.a),b.Wb(l.a))},x.\u0275cmp=b.Qb({type:x,selectors:[["app-syncindicator"]],inputs:{Items:"Items"},decls:16,vars:4,consts:[["color","secondary"],["class","spin","slot","end",4,"ngIf"],["slot","end",3,"name",4,"ngIf"],[4,"ngFor","ngForOf"],["slot","end",3,"disabled","click"],["slot","end",1,"spin"],["name","bubbles"],["slot","end",3,"name"],["color","medium"]],template:function(e,t){1&e&&(b.Zb(0,"ion-header"),b.Zb(1,"ion-toolbar",0),b.Zb(2,"ion-title"),b.xc(3,"\u540c\u6b65\u6570\u636e\u5230\u670d\u52a1\u5668"),b.Yb(),b.Yb(),b.Yb(),b.Zb(4,"ion-content"),b.Zb(5,"ion-list"),b.Zb(6,"ion-item"),b.Zb(7,"ion-text"),b.xc(8,"\u540c\u6b65\u76ee\u5f55\u7ed3\u6784"),b.Yb(),b.wc(9,m,2,0,"div",1),b.wc(10,v,1,1,"ion-icon",2),b.Yb(),b.wc(11,g,7,4,"ion-item",3),b.Yb(),b.Yb(),b.Zb(12,"ion-footer"),b.Zb(13,"ion-toolbar"),b.Zb(14,"ion-button",4),b.hc("click",(function(){return t.Stop()})),b.xc(15,"\u786e\u5b9a"),b.Yb(),b.Yb(),b.Yb()),2&e&&(b.Mb(9),b.oc("ngIf",0===t.SyncNodesFinished),b.Mb(1),b.oc("ngIf",0!==t.SyncNodesFinished),b.Mb(1),b.oc("ngForOf",t.Items),b.Mb(3),b.oc("disabled",!t.Finished))},directives:[c.s,c.Y,c.W,c.o,c.D,c.w,c.T,r.j,r.i,c.q,c.j,c.R,c.t],styles:[""]}),x),w=n("xPBH"),Y=(n("Y6BA"),n("vBXD"));function Z(e,t){1&e&&(b.Zb(0,"div",12),b.Xb(1,"ion-spinner",13),b.Yb())}var C,I=((C=function(){function e(t,n,o,r,i,s,c,a,u){_classCallCheck(this,e),this.dbservice=t,this.settings=n,this.host=o,this.actionsheetctrl=r,this.alertCtrl=i,this.popoverCtrl=s,this.modalController=c,this.route=a,this.router=u,this.selectedtNodeId=15,this.SortKey="created",this.SortName="\u521b\u5efa\u65e5\u671f",this.HasUser=!1,this.spinner=!1}return _createClass(e,[{key:"ngOnInit",value:function(){return Object(a.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.settings.WaitInit();case 2:return e.next=4,this.dbservice.GetAllNodes().then((function(e){t.Nodes=t.buildNodeTree(e,null)}));case 4:this.HasUser=this.settings.HasUser;case 5:case"end":return e.stop()}}),e,this)})))}},{key:"onNodeSelecte",value:function(e){this.SelectedNode&&(this.SelectedNode.IsSelected=!1),this.SelectedNode=e,this.SelectedNode.IsSelected=!0}},{key:"sortOptions",value:function(e){return Object(a.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,o,r,i=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.popoverCtrl.create({component:f.a,event:e,componentProps:{items:[{name:"\u76ee\u5f55\u540d\u79f0",value:"name"},{name:"\u521b\u5efa\u65f6\u95f4",value:"created"},{name:"\u4fee\u6539\u65f6\u95f4",value:"modified"}],currentOption:this.SortKey},translucent:!0});case 2:return n=t.sent,t.next=5,n.present();case 5:return t.next=7,n.onDidDismiss();case 7:if(o=t.sent,((r=o.data)||this.SortKey)===this.SortKey){t.next=21;break}t.t0=(this.SortKey=r.toString(),this.SortKey),t.next="name"===t.t0?13:"created"===t.t0?15:"modified"===t.t0?17:19;break;case 13:return this.SortName="\u76ee\u5f55\u540d\u79f0",t.abrupt("break",20);case 15:return this.SortName="\u521b\u5efa\u65f6\u95f4",t.abrupt("break",20);case 17:return this.SortName="\u4fee\u6539\u65f6\u95f4",t.abrupt("break",20);case 19:this.SortName="\u9ed8\u8ba4";case 20:this.dbservice.GetAllNodes().then((function(e){i.Nodes=i.buildNodeTree(e,null)}));case 21:case"end":return t.stop()}}),t,this)})))}},{key:"onNodeAdd",value:function(e){return Object(a.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,o,r,i=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.modalController.create({component:h,componentProps:{NodeName:null,NodeType:1,Edit:!1,Path:w.a.getNodePath(null,e?e.ID:null,this.Nodes)}});case 2:return n=t.sent,t.next=5,n.present();case 5:return t.next=7,n.onWillDismiss();case 7:o=t.sent,(r=o.data).name&&!r.name.IsNullOrEmpty()&&(r.parent=e?e.ID:"",this.dbservice.CreateNode(r.parent,r.name,r.type).then((function(e){i.Nodes=i.buildNodeTree(e,null)})));case 10:case"end":return t.stop()}}),t,this)})))}},{key:"EditNode",value:function(){return Object(a.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,o,r,i=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=w.a.getNodePath(null,this.SelectedNode.ID,this.Nodes),e.next=3,this.modalController.create({component:h,componentProps:{NodeName:this.SelectedNode.Title,NodeType:this.SelectedNode.Type,Edit:!0,Path:t}});case 3:return n=e.sent,e.next=6,n.present();case 6:return e.next=8,n.onWillDismiss();case 8:o=e.sent,(r=o.data).name&&!r.name.IsNullOrEmpty()&&this.dbservice.ChangeNode(this.SelectedNode.ID,r.name).then((function(e){i.Nodes=i.buildNodeTree(e,null)}));case 11:case"end":return e.stop()}}),e,this)})))}},{key:"DeleteNode",value:function(){return Object(a.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,o=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=w.a.getNodePath(null,this.SelectedNode?this.SelectedNode.ID:null,this.Nodes),e.next=3,this.alertCtrl.create({header:"".concat(t.join("/")),subHeader:'\u5220\u9664 "'.concat(this.SelectedNode.Title,'"'),message:"\u6b64\u76ee\u5f55\u4ee5\u53ca\u5176\u5305\u542b\u7684\u5b50\u76ee\u5f55\u548c\u76ee\u5f55\u5185\u7684\u6848\u4f8b\u5c06\u4f1a\u88ab\u5220\u9664\u3002\u786e\u5b9a\u6267\u884c\u5220\u9664\u64cd\u4f5c\u5417\uff1f",buttons:[{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary"},{text:"\u786e\u5b9a",handler:function(){var e=[];o.SelectedNode.SubNodesId(e),o.dbservice.DeleteNodes(e).then((function(e){o.Nodes=o.buildNodeTree(e,null)}))}}]});case 3:return n=e.sent,e.next=6,n.present();case 6:case"end":return e.stop()}}),e,this)})))}},{key:"MoveNode",value:function(){return Object(a.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,o,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return w.a.getNodePath(null,this.SelectedNode?this.SelectedNode.ID:null,this.Nodes),e.next=3,this.modalController.create({component:p.a,componentProps:{Titel:"\u9009\u62e9\u65b0\u76ee\u5f55",SelectDocument:!1,NodeID:this.SelectedNode.ID}});case 3:return t=e.sent,e.next=6,t.present();case 6:return e.next=8,t.onWillDismiss();case 8:n=e.sent,(o=n.data).nodeid&&!o.nodeid.IsNullOrEmpty()&&this.dbservice.ChangeNode(this.SelectedNode.ID,null,o.nodeid).then((function(e){r.Nodes=r.buildNodeTree(e,null)}));case 11:case"end":return e.stop()}}),e,this)})))}},{key:"ShowRecordes",value:function(e){if(e){var t=[];this.findDocumentNode(e,t),this.router.navigateByUrl("/menu/recordes/".concat(t.join("-")))}else this.router.navigateByUrl("/menu/recordes/*")}},{key:"ShowActions",value:function(){return Object(a.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.actionsheetctrl.create({header:"\u7f16\u8f91\uff1a".concat(this.SelectedNode.Title),buttons:[{text:"\u5220\u9664",role:"destructive",icon:"trash",handler:function(){n.DeleteNode()}},{text:"\u4fee\u6539",icon:"create",handler:function(){n.EditNode()}},{text:"\u8fc1\u79fb\u76ee\u5f55",icon:"arrow-round-back",handler:function(){n.MoveNode()}},{text:" \u53d6\u6d88",icon:"close",role:"cancel",handler:function(){}}]});case 2:return t=e.sent,e.next=5,t.present();case 5:case"end":return e.stop()}}),e,this)})))}},{key:"SyncCloud",value:function(){return Object(a.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.modalController.create({component:S});case 2:return t=e.sent,e.next=5,t.present();case 5:return e.next=7,t.onWillDismiss();case 7:this.dbservice.GetAllNodes().then((function(e){n.Nodes=n.buildNodeTree(e,null)}));case 8:case"end":return e.stop()}}),e,this)})))}},{key:"buildNodeTree",value:function(e,t){var n=this,o=[];return(t||"").IsNullOrEmpty(),t=null!=t?t:"",(o=e.where((function(e){return(e.parent||"")===t})).sortByKey(this.SortKey).select((function(e){var t=new w.a(e.type,e.name);return t.ID=e.id||null,t.Version=e.version?e.version:0,t}))).forEach((function(t){t.Sub=n.buildNodeTree(e,t.ID)})),o}},{key:"findDocumentNode",value:function(e,t){if(32!==e.Type){var n=!0,o=!1,r=void 0;try{for(var i,s=(e.Sub||[])[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var c=i.value;this.findDocumentNode(c,t)}}catch(a){o=!0,r=a}finally{try{n||null==s.return||s.return()}finally{if(o)throw r}}}else t.push(e.ID)}},{key:"findTreeNode",value:function(e,t){var n=(e||[]).find((function(e){return e.ID===t}));if(n)return n;var o=!0,r=!1,i=void 0;try{for(var s,c=e[Symbol.iterator]();!(o=(s=c.next()).done);o=!0){var a=s.value,u=this.findTreeNode(a.Sub,t);if(u)return u}}catch(d){r=!0,i=d}finally{try{o||null==c.return||c.return()}finally{if(r)throw i}}return null}},{key:"OpenEnable",get:function(){return!!this.SelectedNode&&32===this.SelectedNode.Type}}]),e}()).\u0275fac=function(e){return new(e||C)(b.Wb(u.a),b.Wb(d.a),b.Wb(l.a),b.Wb(c.a),b.Wb(c.b),b.Wb(c.fb),b.Wb(c.cb),b.Wb(s.a),b.Wb(s.g))},C.\u0275cmp=b.Qb({type:C,selectors:[["app-nodes"]],decls:36,vars:6,consts:[["color","primary"],["slot","start"],["slot","end"],["size","small",3,"disabled","click"],["slot","icon-only","name","cloud-upload"],["size","small",3,"click"],["name","md-funnel"],["class","spin",4,"ngIf"],[3,"nodes","nodeSelected","nodeAdd"],["name","add"],["name","book"],["name","build"],[1,"spin"],["name","bubbles"]],template:function(e,t){1&e&&(b.Zb(0,"ion-header"),b.Zb(1,"ion-toolbar",0),b.Zb(2,"ion-buttons",1),b.Xb(3,"ion-menu-button"),b.Yb(),b.Zb(4,"ion-title"),b.xc(5,"\u6848\u4f8b\u76ee\u5f55"),b.Yb(),b.Zb(6,"ion-buttons",2),b.Zb(7,"ion-button",3),b.hc("click",(function(){return t.SyncCloud()})),b.Xb(8,"ion-icon",4),b.Yb(),b.Zb(9,"ion-button",5),b.hc("click",(function(e){return t.sortOptions(e)})),b.Xb(10,"ion-icon",6),b.Zb(11,"ion-text"),b.xc(12),b.Yb(),b.Yb(),b.Yb(),b.Yb(),b.Yb(),b.Zb(13,"ion-content"),b.wc(14,Z,2,0,"div",7),b.Zb(15,"app-tree-node",8),b.hc("nodeSelected",(function(e){return t.onNodeSelecte(e)}))("nodeAdd",(function(e){return t.onNodeAdd(e)})),b.Yb(),b.Yb(),b.Zb(16,"ion-footer"),b.Zb(17,"ion-toolbar"),b.Zb(18,"ion-buttons",1),b.Zb(19,"ion-button",5),b.hc("click",(function(){return t.onNodeAdd(null)})),b.Xb(20,"ion-icon",9),b.Zb(21,"ion-text"),b.xc(22,"\u65b0\u5efa"),b.Yb(),b.Yb(),b.Zb(23,"ion-button",3),b.hc("click",(function(){return t.ShowRecordes(t.SelectedNode)})),b.Xb(24,"ion-icon",10),b.Zb(25,"ion-text"),b.xc(26,"\u6253\u5f00"),b.Yb(),b.Yb(),b.Zb(27,"ion-button",3),b.hc("click",(function(){return t.ShowActions()})),b.Xb(28,"ion-icon",11),b.Zb(29,"ion-text"),b.xc(30,"\u7f16\u8f91"),b.Yb(),b.Yb(),b.Yb(),b.Zb(31,"ion-buttons",2),b.Zb(32,"ion-button",5),b.hc("click",(function(){return t.ShowRecordes(null)})),b.Xb(33,"ion-icon",10),b.Zb(34,"ion-text"),b.xc(35,"\u5168\u90e8"),b.Yb(),b.Yb(),b.Yb(),b.Yb(),b.Yb()),2&e&&(b.Mb(7),b.oc("disabled",!t.HasUser),b.Mb(5),b.yc(t.SortName),b.Mb(2),b.oc("ngIf",!0===t.spinner),b.Mb(1),b.oc("nodes",t.Nodes),b.Mb(8),b.oc("disabled",!t.SelectedNode),b.Mb(4),b.oc("disabled",!t.SelectedNode))},directives:[c.s,c.Y,c.k,c.G,c.W,c.j,c.t,c.T,c.o,r.j,Y.a,c.q,c.R],styles:[".spin[_ngcontent-%COMP%]{position:fixed;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}ion-spinner[_ngcontent-%COMP%]{width:50px;height:50px;stroke:#444;fill:#222}"]}),C);n("yLV6");var R,T=((R=function e(){_classCallCheck(this,e)}).\u0275mod=b.Ub({type:R}),R.\u0275inj=b.Tb({factory:function(e){return new(e||R)},imports:[[r.b]]}),R);n.d(t,"NodesPageModule",(function(){return M}));var D,O=[{path:"",component:I}],M=((D=function e(){_classCallCheck(this,e)}).\u0275mod=b.Ub({type:D}),D.\u0275inj=b.Tb({factory:function(e){return new(e||D)},imports:[[r.b,i.a,c.Z,T,s.i.forChild(O)]]}),D)}}]);