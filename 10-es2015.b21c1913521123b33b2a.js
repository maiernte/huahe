(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{L99X:function(e,n,t){"use strict";t.d(n,"a",(function(){return l}));var s=t("mrSG"),i=t("c7TG"),o=t("LTmD"),r=t("2Vo4"),c=t("Y6BA"),d=(t("xPBH"),t("fXoL")),a=t("e8h1"),h=t("tk/3");let l=(()=>{class e{constructor(e,n,t,s){this.settings=e,this.plateform=n,this.storage=t,this.http=s,this.dbReady=new r.a(!1),this.LoadBooks().then(e=>{if(this.nodes=e||[],0===this.Nodes.length)return this.CreateNode(void 0,"\u4e34\u65f6\u6848\u4f8b",32)}).finally(()=>{this.dbReady.next(!0)})}ReloadBooks(){this.dbReady.next(!1),this.LoadBooks().then(e=>{this.nodes=e||[]}).finally(()=>{this.dbReady.next(!0)})}get DatabaseState(){return this.dbReady.asObservable()}get Nodes(){return this.nodes.filter(e=>e.size>=0)}get NodesAlle(){return this.nodes}get NodeModified(){return Math.max(...this.nodes.map(e=>e.modified))}GetAllNodes(){return new Promise((e,n)=>{this.DatabaseState.subscribe(n=>{n&&e(this.Nodes)})})}SaveNodes(){const n=this.settings.HasUser?`${e.DB_NODES}_${this.settings.User.id}`:e.DB_NODES;return new Promise((e,t)=>{const s=JSON.stringify(this.nodes);this.storage.set(n,s).then(n=>{e(!0)}).catch(e=>{t(!1)})})}CreateNode(e,n,t){return new Promise((s,i)=>{const o={id:Object(c.createGuid)(8),created:0,modified:0,parent:e,name:n||"\u4e34\u65f6\u6848\u4f8b",comment:"",type:t||1,size:0,sync:0};this.nodes=this.nodes||[],this.nodes.push(o),this.SaveNodes().then(e=>{s(this.Nodes)}).catch(e=>{i(e)})})}ChangeNode(e,n,t=null){return new Promise((s,i)=>{const o=this.nodes.where(n=>n.id===e);if(o&&1===o.length){const e=o[0];e.name=n||e.name,e.parent=t||e.parent,this.SaveNodes().then(e=>{s(this.Nodes)}).catch(e=>{i(!1)})}})}DeleteNodes(e){const n=Date.now();return new Promise((t,s)=>{const i=[];this.nodes.forEach(t=>{e.includes(t.id)&&(t.size=-1,t.modified=n,32===t.type&&i.push(t.id))}),this.SaveNodes().then(e=>{t(this.Nodes)}).catch(e=>{s(!1)})})}SyncNodes(e){const n=this.nodes.map(e=>e.id),t=[],s=[];return e.forEach(e=>{if(n.includes(e.id)){if(this.nodes.find(n=>n.id===e.id).modified<e.modified){const n=this.nodes.findIndex(n=>n.id===e.id);this.nodes.splice(n,1,Object(o.b)(e)),t.push(e.id)}}else this.nodes.push(Object(o.b)(e)),t.push(e.id)}),this.CleanNodes(),this.nodes.forEach(n=>{const t=e.find(e=>e.id===n.id);n.name.startsWith("\u516d\u723b")&&console.log("...",t,n),(!t||t.modified<n.modified)&&s.push(n.id)}),t.length>0?(console.log("new Booktree will be saved.",this.nodes),this.SaveNodes().then(()=>[t,s])):Promise.resolve([t,s])}CleanNodes(){const e=Date.now()-2592e6;this.nodes=this.nodes.filter(n=>n.size<0&&n.modified<e||n.size>=0)}GetRecordes(e){return new Promise((n,t)=>{this.storage.get(`Book_${e}`).then(s=>{if(s){const e=JSON.parse(s);n(e.filter(e=>e.size>=0))}else 0===this.Nodes.find(n=>n.id===e).sync?(this.SaveRecordes(e,[]),n([])):t([])}).catch(e=>{t(e)})})}SaveRecordes(e,n,t=!0){console.log("save recordes of ",e);const s=JSON.stringify(n);if(this.storage.set(`Book_${e}`,s),t){const n=this.nodes.find(n=>n.id===e);n.created=0===n.created?Date.now():n.created,n.modified=Date.now(),n.size=s.length,this.SaveNodes()}}CreateRecord(e,n,t,s){return{id:Object(c.createGuid)(8),node:e,created:Date.now(),modified:Date.now(),type:t,titel:n,arg:s,content:"",size:0,sync:0}}SaveRecord(e,n,t,s){return new Promise((i,o)=>{this.storage.get(`Book_${e}`).then(o=>{const r=JSON.parse(o),c=this.CreateRecord(e,n,t,s);r.push(c),this.SaveRecordes(e,r),i(c)})})}DeleteRecordes(e,n){return new Promise((t,s)=>{this.storage.get(`Book_${e}`).then(s=>{const i=JSON.parse(s);i.forEach(e=>{n.includes(e.id)&&(e.size=-1,e.content="",e.arg="",e.modified=Date.now())}),this.SaveRecordes(e,i),t(i.filter(e=>e.size>=0))})})}MoveRecordes(e,n,t){return new Promise((s,i)=>{const o=this.storage.get(`Book_${e}`).then(e=>JSON.parse(e)||[]),r=this.storage.get(`Book_${n}`).then(e=>JSON.parse(e)||[]);Promise.all([o,r]).then(i=>{let o=i[0];const r=i[1];for(const e of t){const t=o.find(n=>n.id===e);t.node=n,r.push(t),o=o.filter(n=>n.id!==e)}console.log("move finish",o,r,t),this.SaveRecordes(e,o),this.SaveRecordes(n,r),s(o.filter(e=>e.size>=0))})})}ChangeBooktreeOfAnonym(n){const t=`${e.DB_NODES}_${n}`;return this.storage.keys().then(n=>n.includes(t)?Promise.reject(`${t} is already hier.`):this.storage.get(e.DB_NODES)).then(e=>e?(console.log("umschreiben booktree to ",t),this.storage.set(`${t}`,e)):Promise.reject("booktree can not founde.")).then(()=>(console.log("umschreiben erfolg!"),this.storage.remove(e.DB_NODES))).then(()=>(console.log(`Record ${e.DB_NODES} will deleted`),!0)).catch(e=>(console.log("ChangeBooktreeOfAnonym denied: ",e),!1))}test(e){return this.storage.get("...").then(n=>(console.log("get ...",n),this.storage.get(e))).then(n=>(console.log(`get ${e}`,n),Promise.resolve(!0)))}WaitInit(){return new Promise((e,n)=>{this.DatabaseState.subscribe(n=>{n&&e(!0)})})}LoadBooks(){return Object(s.b)(this,void 0,void 0,(function*(){yield this.settings.WaitInit();const n=this.settings.HasUser?`${e.DB_NODES}_${this.settings.User.id}`:e.DB_NODES;return console.log(`loadbooks of ${n}`),this.storage.get(n).then(e=>Promise.resolve(Object(o.d)(e))).catch(e=>(console.error("LoadBooks() error:",e),Promise.resolve([])))}))}}return e.DB_NODES="booktree",e.\u0275fac=function(n){return new(n||e)(d.dc(o.a),d.dc(i.Y),d.dc(a.b),d.dc(h.b))},e.\u0275prov=d.Sb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},bkV9:function(e,n,t){"use strict";t.r(n);var s=t("ofXK"),i=t("3Pt+"),o=t("tyNb"),r=t("c7TG"),c=t("mrSG"),d=t("LTmD"),a=t("L99X"),h=t("lEof"),l=t("fXoL");function b(e,n){1&e&&(l.Zb(0,"div",4),l.Xb(1,"ion-spinner",5),l.Yb())}function g(e,n){if(1&e){const e=l.ac();l.Zb(0,"ion-list"),l.Zb(1,"ion-list-header"),l.Zb(2,"ion-label"),l.xc(3,"\u7528\u6237\u767b\u5f55"),l.Yb(),l.Yb(),l.Zb(4,"ion-item",6),l.Zb(5,"ion-label",7),l.xc(6,"\u7528\u6237\u540d"),l.Yb(),l.Zb(7,"ion-input",8),l.hc("ngModelChange",(function(n){return l.rc(e),l.jc().SignIn.name=n})),l.Yb(),l.Yb(),l.Zb(8,"ion-item",6),l.Zb(9,"ion-label",7),l.xc(10,"\u5bc6\u7801"),l.Yb(),l.Zb(11,"ion-input",9),l.hc("ngModelChange",(function(n){return l.rc(e),l.jc().SignIn.password=n})),l.Yb(),l.Yb(),l.Zb(12,"ion-item",6),l.Zb(13,"ion-button",10),l.hc("click",(function(n){return l.rc(e),l.jc().UserSignIn()})),l.xc(14,"\u767b\u5f55"),l.Yb(),l.Zb(15,"ion-button",10),l.hc("click",(function(n){l.rc(e);const t=l.jc();return t.ChangeUIMode(t.PageModes.SignUp)})),l.xc(16,"\u6ce8\u518c"),l.Yb(),l.Zb(17,"ion-button",11),l.hc("click",(function(n){l.rc(e);const t=l.jc();return t.ChangeUIMode(t.PageModes.ForgetPassword)})),l.xc(18,"\u5fd8\u8bb0\u5bc6\u7801"),l.Yb(),l.Yb(),l.Yb()}if(2&e){const e=l.jc();l.Mb(4),l.oc("disabled",!0===e.spinner),l.Mb(3),l.oc("ngModel",e.SignIn.name),l.Mb(1),l.oc("disabled",!0===e.spinner),l.Mb(3),l.oc("ngModel",e.SignIn.password),l.Mb(1),l.oc("disabled",!0===e.spinner)}}function u(e,n){if(1&e){const e=l.ac();l.Zb(0,"ion-list"),l.Zb(1,"ion-list-header"),l.Zb(2,"ion-label"),l.xc(3,"\u7528\u6237\u6ce8\u518c"),l.Yb(),l.Yb(),l.Zb(4,"ion-item",6),l.Zb(5,"ion-label",7),l.xc(6,"\u7528\u6237\u540d"),l.Yb(),l.Zb(7,"ion-input",12),l.hc("ngModelChange",(function(n){return l.rc(e),l.jc().SignIn.name=n})),l.Yb(),l.Yb(),l.Zb(8,"ion-item",6),l.Zb(9,"ion-label",7),l.xc(10,"\u5bc6\u7801\u7b2c\u4e00\u6b21"),l.Yb(),l.Zb(11,"ion-input",13),l.hc("ngModelChange",(function(n){return l.rc(e),l.jc().SignIn.password=n})),l.Yb(),l.Yb(),l.Zb(12,"ion-item",6),l.Zb(13,"ion-label",7),l.xc(14,"\u5bc6\u7801\u7b2c\u4e8c\u6b21"),l.Yb(),l.Zb(15,"ion-input",14),l.hc("ngModelChange",(function(n){return l.rc(e),l.jc().SignIn.password2=n})),l.Yb(),l.Yb(),l.Zb(16,"ion-item",6),l.Zb(17,"ion-button",10),l.hc("click",(function(n){return l.rc(e),l.jc().UserSignUp()})),l.xc(18," \u6ce8\u518c "),l.Xb(19,"ion-icon",15),l.Yb(),l.Zb(20,"ion-button",11),l.hc("click",(function(n){l.rc(e);const t=l.jc();return t.ChangeUIMode(t.PageModes.SignIn)})),l.xc(21,"\u5df2\u6709\u8d26\u6237"),l.Yb(),l.Yb(),l.Yb()}if(2&e){const e=l.jc();l.Mb(4),l.oc("disabled",!0===e.spinner),l.Mb(3),l.oc("ngModel",e.SignIn.name),l.Mb(1),l.oc("disabled",!0===e.spinner),l.Mb(3),l.oc("ngModel",e.SignIn.password),l.Mb(1),l.oc("disabled",!0===e.spinner),l.Mb(3),l.oc("ngModel",e.SignIn.password2),l.Mb(1),l.oc("disabled",!0===e.spinner)}}function p(e,n){if(1&e){const e=l.ac();l.Zb(0,"ion-item",6),l.Zb(1,"ion-label"),l.xc(2,"\u7535\u5b50\u90ae\u7bb1"),l.Yb(),l.Zb(3,"ion-input",24),l.hc("ngModelChange",(function(n){return l.rc(e),l.jc(2).SignIn.email=n})),l.Yb(),l.Zb(4,"ion-button",18),l.hc("click",(function(n){return l.rc(e),l.jc(2).VerifyEmail()})),l.xc(5,"\u53d1\u9001\u9a8c\u8bc1"),l.Yb(),l.Yb()}if(2&e){const e=l.jc(2);l.oc("disabled",!0===e.spinner),l.Mb(3),l.oc("ngModel",e.SignIn.email)}}function f(e,n){if(1&e&&(l.Zb(0,"ion-item",6),l.Zb(1,"ion-label"),l.xc(2,"\u7535\u5b50\u90ae\u7bb1"),l.Yb(),l.Zb(3,"ion-input",25),l.xc(4),l.Yb(),l.Xb(5,"ion-icon",26),l.Yb()),2&e){const e=l.jc(2);l.oc("disabled",!0===e.spinner),l.Mb(4),l.yc(e.UserProfile.email)}}function m(e,n){if(1&e){const e=l.ac();l.Zb(0,"ion-list"),l.Zb(1,"ion-item"),l.Zb(2,"ion-thumbnail",0),l.Xb(3,"ion-img",16),l.Yb(),l.Zb(4,"ion-text"),l.xc(5),l.Yb(),l.Yb(),l.wc(6,p,6,2,"ion-item",17),l.wc(7,f,6,2,"ion-item",17),l.Zb(8,"ion-item",6),l.Zb(9,"ion-button",18),l.hc("click",(function(n){return l.rc(e),l.jc().LogOut()})),l.Xb(10,"ion-icon",19),l.xc(11," \u9000\u51fa\u767b\u5f55 "),l.Yb(),l.Zb(12,"ion-button",11),l.hc("click",(function(n){return l.rc(e),l.jc().Reflash()})),l.Xb(13,"ion-icon",20),l.xc(14," \u66f4\u65b0\u8d44\u6599 "),l.Yb(),l.Zb(15,"ion-button",21),l.Xb(16,"ion-icon",22),l.xc(17," \u66f4\u65b0\u5934\u50cf "),l.Yb(),l.Zb(18,"ion-button",23),l.hc("click",(function(n){l.rc(e);const t=l.jc();return t.ChangeUIMode(t.PageModes.ChangePassword)})),l.xc(19,"\u4fee\u6539\u5bc6\u7801"),l.Yb(),l.Yb(),l.Yb()}if(2&e){const e=l.jc();l.Mb(3),l.oc("src",e.UserProfile.avatar),l.Mb(2),l.yc(e.UserProfile.name),l.Mb(1),l.oc("ngIf",!e.HasEmail),l.Mb(1),l.oc("ngIf",e.HasEmail),l.Mb(1),l.oc("disabled",!0===e.spinner)}}function S(e,n){if(1&e){const e=l.ac();l.Zb(0,"ion-list"),l.Zb(1,"ion-list-header"),l.Zb(2,"ion-label"),l.xc(3,"\u901a\u8fc7\u6ce8\u518c\u90ae\u7bb1\u53d6\u56de\u5bc6\u7801"),l.Yb(),l.Yb(),l.Zb(4,"ion-item",6),l.Zb(5,"ion-label",7),l.xc(6,"\u586b\u5199\u60a8\u7684\u7528\u6237\u540d"),l.Yb(),l.Zb(7,"ion-input",8),l.hc("ngModelChange",(function(n){return l.rc(e),l.jc().SignIn.name=n})),l.Yb(),l.Yb(),l.Zb(8,"ion-item",6),l.Zb(9,"ion-label",7),l.xc(10,"\u586b\u5199\u60a8\u7684\u6ce8\u518c\u90ae\u7bb1"),l.Yb(),l.Zb(11,"ion-input",8),l.hc("ngModelChange",(function(n){return l.rc(e),l.jc().SignIn.email=n})),l.Yb(),l.Yb(),l.Zb(12,"ion-item",6),l.Zb(13,"ion-button",18),l.hc("click",(function(n){return l.rc(e),l.jc().SendPW2Email()})),l.xc(14,"\u53d1\u9001\u5bc6\u7801\u5230\u90ae\u7bb1"),l.Yb(),l.Yb(),l.Yb()}if(2&e){const e=l.jc();l.Mb(4),l.oc("disabled",!0===e.spinner),l.Mb(3),l.oc("ngModel",e.SignIn.name),l.Mb(1),l.oc("disabled",!0===e.spinner),l.Mb(3),l.oc("ngModel",e.SignIn.email),l.Mb(1),l.oc("disabled",!0===e.spinner)}}function M(e,n){if(1&e){const e=l.ac();l.Zb(0,"ion-list"),l.Zb(1,"ion-list-header"),l.Zb(2,"ion-label"),l.xc(3,"\u66f4\u6539\u5bc6\u7801"),l.Yb(),l.Yb(),l.Zb(4,"ion-item",6),l.Zb(5,"ion-label",7),l.xc(6,"\u65e7\u5bc6\u7801"),l.Yb(),l.Zb(7,"ion-input",8),l.hc("ngModelChange",(function(n){return l.rc(e),l.jc().SignIn.passwordOld=n})),l.Yb(),l.Yb(),l.Zb(8,"ion-item",6),l.Zb(9,"ion-label",7),l.xc(10,"\u65b0\u5bc6\u7801\u7b2c\u4e00\u6b21"),l.Yb(),l.Zb(11,"ion-input",13),l.hc("ngModelChange",(function(n){return l.rc(e),l.jc().SignIn.password=n})),l.Yb(),l.Yb(),l.Zb(12,"ion-item",6),l.Zb(13,"ion-label",7),l.xc(14,"\u65b0\u5bc6\u7801\u7b2c\u4e8c\u6b21"),l.Yb(),l.Zb(15,"ion-input",14),l.hc("ngModelChange",(function(n){return l.rc(e),l.jc().SignIn.password2=n})),l.Yb(),l.Yb(),l.Zb(16,"ion-item",6),l.Zb(17,"ion-button",10),l.hc("click",(function(n){return l.rc(e),l.jc().ChangePassword()})),l.xc(18,"\u66f4\u6539\u5bc6\u7801"),l.Yb(),l.Zb(19,"ion-button",11),l.hc("click",(function(n){l.rc(e);const t=l.jc();return t.Mode=t.PageModes.SignIned})),l.xc(20,"\u53d6\u6d88"),l.Yb(),l.Yb(),l.Yb()}if(2&e){const e=l.jc();l.Mb(4),l.oc("disabled",!0===e.spinner),l.Mb(3),l.oc("ngModel",e.SignIn.passwordOld),l.Mb(1),l.oc("disabled",!0===e.spinner),l.Mb(3),l.oc("ngModel",e.SignIn.password),l.Mb(1),l.oc("disabled",!0===e.spinner),l.Mb(3),l.oc("ngModel",e.SignIn.password2),l.Mb(1),l.oc("disabled",!0===e.spinner)}}let w=(()=>{class e{constructor(e,n,t,s,i){this.settings=e,this.dbservice=n,this.host=t,this.toastController=s,this.alertController=i,this.PageModes={SignIn:"signin",SignUp:"signup",SignIned:"signined",ForgetPassword:"forgetpassword",ChangePassword:"changepassword"},this.SignIn={name:"",password:"",password2:"",passwordOld:"",email:"",phone:""},this.mode=this.PageModes.SignIn,this.spinner=!1}ngOnInit(){return Object(c.b)(this,void 0,void 0,(function*(){yield this.settings.WaitInit(),this.mode=this.settings.User&&null!=this.settings.User.id?this.PageModes.SignIned:this.PageModes.SignIn}))}get Mode(){return this.mode}set Mode(e){this.mode=e}get UserProfile(){return this.settings.User}get HasEmail(){return!!this.settings.User&&!!this.settings.User.email&&!this.settings.User.email.IsNullOrEmpty()}get HasPhone(){return!!this.settings.User&&!!this.settings.User.phone&&!this.settings.User.phone.IsNullOrEmpty()}showTostMessage(e){return Object(c.b)(this,void 0,void 0,(function*(){(yield this.toastController.create({message:e,duration:2e3})).present()}))}presentAlert(e,n,t){return Object(c.b)(this,void 0,void 0,(function*(){const s=yield this.alertController.create({header:e||"\u9519\u8bef",subHeader:n||"",message:t,buttons:["\u786e\u5b9a"]});yield s.present()}))}ChangeUIMode(e){this.SignIn.name="",this.SignIn.password="",this.SignIn.password2="",this.SignIn.passwordOld="",this.SignIn.phone="",this.SignIn.email="",this.mode=e}Reflash(){return Object(c.b)(this,void 0,void 0,(function*(){const e=this.settings.User;this.spinner=!0,this.host.SignIn(e.id,e.password).then(e=>{e&&(this.settings.User=e,this.showTostMessage("\u7528\u6237\u8d44\u6599\u5df2\u66f4\u65b0\uff01"))}).catch(e=>{this.presentAlert(null,null,e.toString())}).finally(()=>{this.spinner=!1})}))}UserSignIn(){return Object(c.b)(this,void 0,void 0,(function*(){this.settings.User&&this.SignIn.name===this.settings.User.name&&this.SignIn.password===this.settings.User.password?this.mode=this.PageModes.SignIned:(this.spinner=!0,this.host.SignIn(this.SignIn.name,this.SignIn.password).then(e=>{const n=e;if(!n)return Promise.reject("It is not a UserT Object.");this.settings.User=n,this.mode=this.PageModes.SignIned,this.dbservice.ChangeBooktreeOfAnonym(n.id).then(()=>{this.dbservice.ReloadBooks()})}).catch(e=>{this.presentAlert(null,null,e.toString())}).finally(()=>{this.spinner=!1}))}))}ChangePassword(){return Object(c.b)(this,void 0,void 0,(function*(){this.SignIn.passwordOld===this.settings.User.password?this.SignIn.password===this.SignIn.password2?/^[\S]{4,20}$/i.test(this.SignIn.password2)?(this.spinner=!0,this.host.ChangePassword(this.settings.User.id,this.SignIn.passwordOld,this.SignIn.password).then(e=>{const n=e;if(!n)return Promise.reject("It is not a UserT Object.");this.settings.User=n,this.mode=this.PageModes.SignIned,this.showTostMessage("\u4fee\u6539\u5bc6\u7801\u6210\u529f\uff01")}).catch(e=>{this.presentAlert(null,null,e.toString())}).finally(()=>{this.spinner=!1})):this.showTostMessage("\u5bc6\u7801\u4e0d\u7b26\u5408\u8981\u6c42\u3002"):this.showTostMessage("\u4e24\u6b21\u5bc6\u7801\u4e0d\u4e00\u81f4\uff0c\u8bf7\u91cd\u65b0\u786e\u8ba4\u3002"):this.presentAlert("\u9519\u8bef","\u4fee\u6539\u5bc6\u7801","\u60a8\u8f93\u5165\u7684\u65e7\u5bc6\u7801\u6709\u8bef\u3002")}))}UserSignUp(){return Object(c.b)(this,void 0,void 0,(function*(){this.SignIn.password===this.SignIn.password2?/^[\S]{2,20}$/i.test(this.SignIn.name)&&/^[\S]{4,20}$/i.test(this.SignIn.password2)?(this.spinner=!0,this.host.SignUp(this.SignIn.name,this.SignIn.password).then(e=>{const n=e;if(!n)return Promise.reject("It is not a UserT Object.");this.settings.User=n,this.mode=this.PageModes.SignIned,this.showTostMessage("\u6ce8\u518c\u6210\u529f\uff01")}).catch(e=>{this.presentAlert(null,null,e.toString())}).finally(()=>{this.spinner=!1})):this.showTostMessage("\u7528\u6237\u540d\u6216\u5bc6\u7801\u4e0d\u7b26\u5408\u8981\u6c42\u3002"):this.showTostMessage("\u4e24\u6b21\u5bc6\u7801\u4e0d\u4e00\u81f4\uff0c\u8bf7\u91cd\u65b0\u786e\u8ba4\u3002")}))}VerifyEmail(){if(!1===this.validateEmail(this.SignIn.email))return void this.presentAlert("\u9519\u8bef","\u90ae\u7bb1","\u8bf7\u8f93\u5165\u6709\u6548\u7684\u90ae\u7bb1\u5730\u5740\u3002");this.spinner=!0;const e=this.settings.User;this.host.VerifyEmail(e.id,e.password,this.SignIn.email).then(e=>{this.presentAlert("\u6ce8\u518c\u90ae\u7bb1",null,e)}).catch(e=>{this.presentAlert(null,null,e.toString())}).finally(()=>{this.spinner=!1})}SendPW2Email(){this.spinner=!0,this.host.SendPW2Email(this.SignIn.name,this.SignIn.email).then(e=>{this.presentAlert("\u4fe1\u606f","\u83b7\u53d6\u5bc6\u7801",e)}).catch(e=>{this.showTostMessage(`\u5931\u8d25: ${e.error.text}`)}).finally(()=>{this.spinner=!1})}LogOut(){this.ChangeUIMode(this.PageModes.SignIn),this.settings.User=null,this.dbservice.ReloadBooks()}validateEmail(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e.toLowerCase())}}return e.\u0275fac=function(n){return new(n||e)(l.Wb(d.a),l.Wb(a.a),l.Wb(h.a),l.Wb(r.db),l.Wb(r.b))},e.\u0275cmp=l.Qb({type:e,selectors:[["app-user"]],decls:13,vars:6,consts:[["slot","start"],[1,"ion-padding"],["class","spin",4,"ngIf"],[4,"ngIf"],[1,"spin"],["name","bubbles"],[3,"disabled"],["position","stacked"],[3,"ngModel","ngModelChange"],["type","password",3,"ngModel","ngModelChange"],[3,"click"],["slot","end",3,"click"],["placeholder","2 ~ 20 \u4e2a\u82f1\u6587\u6216\u4e2d\u6587\u5b57\u7b26",3,"ngModel","ngModelChange"],["type","password","placeholder","4 ~ 20 \u4e2a\u82f1\u6587\u3001\u6570\u5b57\u548c\u7279\u6b8a\u5b57\u7b26",3,"ngModel","ngModelChange"],["type","password","placeholder","\u8bf7\u518d\u6b21\u8f93\u5165\u4e00\u904d\u5bc6\u7801",3,"ngModel","ngModelChange"],["slot","end","name","person-add"],[3,"src"],[3,"disabled",4,"ngIf"],["size","small",3,"click"],["name","exit"],["name","ios-repeat"],["slot","end"],["name","ios-person"],["size","small","slot","end",3,"click"],["type","email","placeholder","\u6ca1\u6709\u9a8c\u8bc1\u90ae\u7bb1",3,"ngModel","ngModelChange"],["type","email"],["name","checkmark"]],template:function(e,n){1&e&&(l.Zb(0,"ion-header"),l.Zb(1,"ion-toolbar"),l.Zb(2,"ion-buttons",0),l.Xb(3,"ion-menu-button"),l.Yb(),l.Zb(4,"ion-title"),l.xc(5,"\u7528\u6237"),l.Yb(),l.Yb(),l.Yb(),l.Zb(6,"ion-content",1),l.wc(7,b,2,0,"div",2),l.wc(8,g,19,5,"ion-list",3),l.wc(9,u,22,7,"ion-list",3),l.wc(10,m,20,5,"ion-list",3),l.wc(11,S,15,5,"ion-list",3),l.wc(12,M,21,7,"ion-list",3),l.Yb()),2&e&&(l.Mb(7),l.oc("ngIf",!0===n.spinner),l.Mb(1),l.oc("ngIf",n.Mode===n.PageModes.SignIn),l.Mb(1),l.oc("ngIf",n.Mode===n.PageModes.SignUp),l.Mb(1),l.oc("ngIf",n.Mode===n.PageModes.SignIned),l.Mb(1),l.oc("ngIf",n.Mode===n.PageModes.ForgetPassword),l.Mb(1),l.oc("ngIf",n.Mode===n.PageModes.ChangePassword))},directives:[r.p,r.T,r.i,r.y,r.R,r.l,s.j,r.J,r.v,r.w,r.u,r.t,r.s,r.cb,i.c,i.d,r.h,r.q,r.Q,r.r,r.O],styles:[".spin[_ngcontent-%COMP%]{position:fixed;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}ion-spinner[_ngcontent-%COMP%]{width:50px;height:50px;stroke:#444;fill:#222}"]}),e})();t.d(n,"UserPageModule",(function(){return Y}));const I=[{path:"",component:w}];let Y=(()=>{class e{}return e.\u0275mod=l.Ub({type:e}),e.\u0275inj=l.Tb({factory:function(n){return new(n||e)},imports:[[s.b,i.a,r.U,o.i.forChild(I)]]}),e})()},xPBH:function(e,n,t){"use strict";t.d(n,"a",(function(){return s}));class s{constructor(e,n,t=!1){this.Type=e,this.Title=n,this.ShowButton=!0,this.isExpanded=!1,this.isSelected=!1,this.url="",this.sub=[]}static getNodePath(e,n,t=null){var s,i;const o=e?e.Sub:t;if((n||"").IsNullOrEmpty())return["\u6839\u76ee\u5f55"];if((null===(s=e)||void 0===s?void 0:s.ID)===n)return[e.Title];if(!(o.length>0))return null;for(const r of o){const t=this.getNodePath(r,n);if(t)return t.insert(0,(null===(i=e)||void 0===i?void 0:i.Title)||""),t}}get IsFile(){return 32===this.Type}get IsSelected(){return this.isSelected}set IsSelected(e){this.isSelected=e}get IsExpanded(){return this.isExpanded}set IsExpanded(e){0!==this.Sub.length&&(this.isExpanded=e)}get Icon(){switch(this.Type){case 2:return"person";case 4:return"lock";case 8:return"menu";case 16:return"walk";case 32:return"document";case 1:default:return"folder"}}get Url(){return this.url}get Sub(){return this.sub}set Sub(e){this.sub=e}get Color(){return this.isSelected?"tertiary":""}get ColorB(){return this.isSelected?"light":""}SubNodesId(e){e.push(this.ID);for(const n of this.Sub)n.SubNodesId(e)}static get Examples(){const e=[],n=new s(1,"Folder 01"),t=new s(2,"Folder 02"),i=new s(4,"Folder 03"),o=new s(32,"file 01",!0),r=new s(8,"file 02",!0),c=new s(16,"file 03",!0),d=new s(8,"file 04",!0),a=new s(32,"file 05",!0),h=new s(16,"file 06",!0);return n.Sub.push(t),t.Sub.push(o),t.Sub.push(r),t.Sub.push(c),i.Sub.push(d),i.Sub.push(a),i.Sub.push(h),e.push(n),e.push(i),e}}}}]);