(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{qNzN:function(t,i,o){"use strict";o.r(i);var e=o("ofXK"),n=o("3Pt+"),s=o("tyNb"),c=o("c7TG"),a=o("mrSG"),r=o("LTmD"),b=o("lEof"),l=o("PKx9"),d=o("HQI1"),h=o("8/yo"),u=o("G6JS"),g=(o("Y6BA"),o("fXoL"));function f(t,i){if(1&t){const t=g.ac();g.Zb(0,"ion-buttons",7),g.Zb(1,"ion-button",14),g.hc("click",(function(){return g.rc(t),g.jc().EditTopic(null)})),g.Xb(2,"ion-icon",15),g.Zb(3,"ion-text"),g.xc(4,"\u65b0\u8d34"),g.Yb(),g.Yb(),g.Yb()}}function m(t,i){if(1&t){const t=g.ac();g.Zb(0,"ion-button",20),g.hc("click",(function(){return g.rc(t),g.jc(2).JinghuaTopics(-2,!0)})),g.xc(1," [\u7cbe\u534e] "),g.Yb()}}function p(t,i){if(1&t){const t=g.ac();g.Zb(0,"ion-button",17),g.hc("click",(function(){return g.rc(t),g.jc(2).JinghuaTopics(0,!0)})),g.xc(1," [\u9996\u9875] "),g.Yb()}}function v(t,i){if(1&t){const t=g.ac();g.Zb(0,"ion-item-divider",16),g.Zb(1,"ion-label",1),g.Zb(2,"ion-text"),g.xc(3,"\u7248\u4e3b\uff1a"),g.Yb(),g.Yb(),g.Zb(4,"ion-buttons",1),g.Zb(5,"ion-button",17),g.hc("click",(function(){g.rc(t);const i=g.jc();return i.ShowUserInfo(i.Admin)})),g.xc(6),g.Yb(),g.Yb(),g.Zb(7,"ion-buttons",7),g.wc(8,m,2,0,"ion-button",18),g.wc(9,p,2,0,"ion-button",19),g.Yb(),g.Yb()}if(2&t){const t=g.jc();g.Mb(6),g.yc(t.Admin),g.Mb(2),g.oc("ngIf",0===t.PageType),g.Mb(1),g.oc("ngIf",-2===t.PageType)}}function T(t,i){if(1&t){const t=g.ac();g.Zb(0,"ion-item",21),g.hc("click",(function(){g.rc(t);const o=i.$implicit;return g.jc().Navi2Topic(o)})),g.Zb(1,"ion-thumbnail",1),g.Xb(2,"img",22),g.Yb(),g.Zb(3,"ion-label",23),g.Zb(4,"ion-text"),g.xc(5),g.Yb(),g.Zb(6,"ion-text",24),g.xc(7,"[\u7f6e\u9876]"),g.Yb(),g.Xb(8,"br"),g.Zb(9,"ion-note"),g.xc(10),g.Yb(),g.Xb(11,"br"),g.Zb(12,"ion-note"),g.Zb(13,"small"),g.xc(14),g.Yb(),g.Yb(),g.Xb(15,"br"),g.Zb(16,"ion-note"),g.Zb(17,"small"),g.xc(18),g.Yb(),g.Yb(),g.Xb(19,"br"),g.Zb(20,"ion-note"),g.Zb(21,"small"),g.xc(22),g.Yb(),g.Yb(),g.Zb(23,"ion-note"),g.Zb(24,"small"),g.xc(25),g.Yb(),g.Yb(),g.Yb(),g.Yb()}if(2&t){const t=i.$implicit,o=g.jc();g.Mb(2),g.oc("src",t.avatar,g.tc),g.Mb(3),g.yc(t.title),g.Mb(5),g.zc("\u4f5c\u8005\uff1a[",t.author,"]"),g.Mb(4),g.zc("\u53d1\u5e16\u65f6\u95f4: ",o.DateText(t.created),""),g.Mb(4),g.zc("\u56de\u5e16\u65f6\u95f4: ",o.DateText(t.update),""),g.Mb(4),g.zc("\u56de\u5e16\u6570\u91cf: ",t.child,""),g.Mb(3),g.zc("\u6d4f\u89c8\u6570\u91cf: ",t.view,"")}}function x(t,i){1&t&&(g.Zb(0,"ion-text",24),g.xc(1,"[\u7cbe\u534e]"),g.Yb())}function Y(t,i){if(1&t){const t=g.ac();g.Zb(0,"ion-item",21),g.hc("click",(function(){g.rc(t);const o=i.$implicit;return g.jc().Navi2Topic(o)})),g.Zb(1,"ion-thumbnail",1),g.Xb(2,"img",22),g.Yb(),g.Zb(3,"ion-label",23),g.Zb(4,"ion-text"),g.xc(5),g.Yb(),g.wc(6,x,2,0,"ion-text",25),g.Xb(7,"br"),g.Zb(8,"ion-note"),g.xc(9),g.Yb(),g.Xb(10,"br"),g.Zb(11,"ion-note"),g.Zb(12,"small"),g.xc(13),g.Yb(),g.Yb(),g.Xb(14,"br"),g.Zb(15,"ion-note"),g.Zb(16,"small"),g.xc(17),g.Yb(),g.Yb(),g.Xb(18,"br"),g.Zb(19,"ion-note"),g.Zb(20,"small"),g.xc(21),g.Yb(),g.Yb(),g.Zb(22,"ion-note"),g.Zb(23,"small"),g.xc(24),g.Yb(),g.Yb(),g.Yb(),g.Yb()}if(2&t){const t=i.$implicit,o=g.jc();g.Mb(2),g.oc("src",t.avatar,g.tc),g.Mb(3),g.yc(t.title),g.Mb(1),g.oc("ngIf",t.good),g.Mb(3),g.zc("\u4f5c\u8005\uff1a[",t.author,"]"),g.Mb(4),g.zc("\u53d1\u5e16\u65f6\u95f4: ",o.DateText(t.created),""),g.Mb(4),g.zc("\u56de\u5e16\u65f6\u95f4: ",o.DateText(t.update),""),g.Mb(4),g.zc("\u56de\u5e16\u6570\u91cf: ",t.child,""),g.Mb(3),g.zc("\u6d4f\u89c8\u6570\u91cf: ",t.view,"")}}function Z(t,i){if(1&t&&(g.Zb(0,"ion-select-option",26),g.xc(1),g.Yb()),2&t){const t=i.$implicit;g.oc("value",t),g.Mb(1),g.zc("\u7b2c",t+1,"\u9875")}}let y=(()=>{class t{constructor(t,i,o,e,n,s,c,a){this.loadingController=t,this.settings=i,this.forumservice=o,this.host=e,this.popoverCtrl=n,this.modalCtrl=s,this.route=c,this.router=a,this.pageindex=0,this.loadfailed=!1,this.Titel="\u8bba\u575b",this.SortKey="lasttopic",this.Pages=[0],this.PageType=0,this.Topics=[],this.TTopics=[],this.route.params.subscribe(t=>{this.forumid=t.forumid})}ngOnInit(){return Object(a.b)(this,void 0,void 0,(function*(){yield this.settings.WaitInit(),this.loadingView=yield this.loadingController.create({message:"\u6b63\u5728\u83b7\u53d6\u8bba\u575b\u5e16\u5b50...",duration:6e4}),this.user=this.settings.User||this.settings.AnonymUser,"forum_me"===this.forumid?(this.Titel="\u6211\u7684\u5e16\u5b50",this.PageType=-3):"forum_ticket"===this.forumid?(this.Titel="\u6211\u7684\u6c42\u52a9",this.PageType=-4):"forum_master"===this.forumid?(this.Titel="\u5411\u6211\u7684\u53d1\u95ee",this.PageType=-5):this.PageType=0,this.PageIndex=0}))}get HasUser(){return this.settings.HasUser}get DefaultAvatar(){return this.settings.Avatar()}get PageIndex(){return this.pageindex}set PageIndex(t){this.pageindex=t,0!==this.PageType?this.JinghuaTopics(this.PageType):this.Reconnect()}get Admin(){return this.admin}DateText(t){if(!t)return"\u65e0";const i=new Date(t);return i.toChinaStr()+` ${i.getHours()}:${i.getMinutes()}:${i.getSeconds()}`}Reconnect(){return Object(a.b)(this,void 0,void 0,(function*(){this.loadfailed=!1,yield this.showLoading(),this.forumservice.ForumList().then(t=>(this.forum=t.find(t=>t.id===this.forumid),this.Titel=this.forum.name,this.admin=this.forum.admin.join("\u3001"),this.forumservice.LoadTopicList(this.forum.id,this.PageIndex,0))).then(t=>(this.BuildPages(t.sum),this.Topics=t.data,this.Topics.forEach(t=>t.avatar=this.DefaultAvatar),this.updateUserAvatar(this.Topics),this.forumservice.LoadTopicList(this.forum.id,0,-1))).then(t=>{this.TTopics=t.data,this.TTopics.forEach(t=>t.avatar=this.DefaultAvatar),this.updateUserAvatar(this.TTopics)}).catch(t=>{this.loadfailed=!0}).finally(()=>{this.closeLoading()})}))}JinghuaTopics(t,i=!1){return Object(a.b)(this,void 0,void 0,(function*(){i&&(this.pageindex=0,this.PageType=t),t<0?(yield this.showLoading(),this.forumservice.LoadTopicList(t<-2?null:this.forumid,this.PageIndex,t).then(t=>{this.BuildPages(t.sum),this.Topics=t.data,this.Topics.forEach(t=>t.avatar=this.DefaultAvatar),this.updateUserAvatar(this.Topics)}).finally(()=>{this.closeLoading()})):this.Reconnect()}))}Navi2Topic(t){let i=t.forumid;i="forum_ticket"===this.forumid?"\u6c42\u52a9\uff1a"+i:i,i="forum_master"===this.forumid?"\u89e3\u7b54\u5ba2\u6237":i,this.router.navigateByUrl(`menu/topicdetail/${i}/${t.id}`)}updateUserAvatar(t){const i=this.settings.ForumSetting;t.forEach(t=>{t.avatar&&t.avatar!==this.DefaultAvatar||this.forumservice.GetUserInfo(t.author).then(o=>{var e;const n=((null===(e=o)||void 0===e?void 0:e.avatar)||"").IsNullOrEmpty();t.avatar=n?this.settings.Avatar(o.gender):o.avatar,t.showimg=i.showimg&&!i.imgOut,t.showgua=i.showgua&&!i.guaOut,t.showbazi=i.showbazi&&!i.baziOut})})}sortOptions(t){return Object(a.b)(this,void 0,void 0,(function*(){const i=yield this.popoverCtrl.create({component:d.a,event:t,componentProps:{items:[{name:"\u521b\u5efa\u65f6\u95f4",value:"created"},{name:"\u4fee\u6539\u65f6\u95f4",value:"modified"}],currentOption:this.SortKey},translucent:!0});yield i.present();const{data:o}=yield i.onDidDismiss();(o||this.SortKey)!==this.SortKey&&(this.SortKey=o.toString())}))}EditTopic(t){return Object(a.b)(this,void 0,void 0,(function*(){const i=yield this.modalCtrl.create({component:h.a,componentProps:{MainTopic:t||this.CreateMainTopic(),forumid:this.forumid,forumname:this.forum.name}});yield i.present();const{data:o}=yield i.onWillDismiss();o&&this.AddToLocal(o)}))}ShowUserInfo(t){return Object(a.b)(this,void 0,void 0,(function*(){const i=yield this.modalCtrl.create({component:u.a,componentProps:{Uerid:t}});yield i.present(),yield i.onWillDismiss()}))}GoPage(t){console.log("change page",t)}AddToLocal(t){t.avatar=this.settings.User.avatar,t.forumid===this.forumid&&this.forumservice.ForumMG.SetTopic(t,t.forumid)}CreateMainTopic(){const t=this.settings.User,i=Date.now();return{id:"",created:i,modified:i,author:t.id,forumid:this.forumid,title:"",top:0,good:!1,update:0,gua:null,bazi:null,img:null,content:"",frozen:!1,deleted:!1,child:0,view:0}}showLoading(){return Object(a.b)(this,void 0,void 0,(function*(){this.loadingView||(this.loadingView=yield this.loadingController.create({message:"\u6b63\u5728\u83b7\u53d6\u8bba\u575b\u5e16\u5b50...",duration:6e4})),yield this.loadingView.present()}))}closeLoading(){return Object(a.b)(this,void 0,void 0,(function*(){this.loadingView&&(yield this.loadingView.dismiss(),this.loadingView=null)}))}BuildPages(t){if(0!==this.PageIndex)return;if(0===t)return void(this.Pages=[0]);this.Pages=[];const i=Math.ceil(t/20);for(let o=0;o<i;o++)this.Pages.push(o)}}return t.\u0275fac=function(i){return new(i||t)(g.Wb(c.bb),g.Wb(r.a),g.Wb(l.a),g.Wb(b.a),g.Wb(c.fb),g.Wb(c.cb),g.Wb(s.a),g.Wb(s.g))},t.\u0275cmp=g.Qb({type:t,selectors:[["app-topiclist"]],decls:22,vars:9,consts:[["color","primary"],["slot","start"],["defaulthref","","text","\u8fd4\u56de"],["slot","end",4,"ngIf"],["ion-no-padding",""],["ion-no-padding","","slot","fixed",4,"ngIf"],["detail","",3,"click",4,"ngFor","ngForOf"],["slot","end"],[3,"disabled","click"],["name","arrow-back"],["cancelText","\u53d6\u6d88","doneText","\u786e\u5b9a",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"small",3,"disabled","click"],["name","arrow-forward"],["size","small",3,"click"],["slot","icon-only","name","add"],["ion-no-padding","","slot","fixed"],["color","primary",3,"click"],["color","danger",3,"click",4,"ngIf"],["color","primary",3,"click",4,"ngIf"],["color","danger",3,"click"],["detail","",3,"click"],[3,"src"],[1,"ion-text-wrap"],["color","danger"],["color","danger",4,"ngIf"],[3,"value"]],template:function(t,i){1&t&&(g.Zb(0,"ion-header"),g.Zb(1,"ion-toolbar",0),g.Zb(2,"ion-buttons",1),g.Xb(3,"ion-back-button",2),g.Yb(),g.Zb(4,"ion-title"),g.xc(5),g.Yb(),g.wc(6,f,5,0,"ion-buttons",3),g.Yb(),g.Yb(),g.Zb(7,"ion-content"),g.Zb(8,"ion-list",4),g.wc(9,v,10,3,"ion-item-divider",5),g.wc(10,T,26,7,"ion-item",6),g.wc(11,Y,25,8,"ion-item",6),g.Yb(),g.Yb(),g.Zb(12,"ion-footer"),g.Zb(13,"small"),g.Zb(14,"ion-toolbar"),g.Zb(15,"ion-buttons",7),g.Zb(16,"ion-button",8),g.hc("click",(function(){return i.PageIndex=i.PageIndex-1})),g.Xb(17,"ion-icon",9),g.Yb(),g.Zb(18,"ion-select",10),g.hc("ngModelChange",(function(t){return i.PageIndex=t})),g.wc(19,Z,2,2,"ion-select-option",11),g.Yb(),g.Zb(20,"ion-button",12),g.hc("click",(function(){return i.PageIndex=i.PageIndex+1})),g.Xb(21,"ion-icon",13),g.Yb(),g.Yb(),g.Yb(),g.Yb(),g.Yb()),2&t&&(g.Mb(5),g.zc(": ",i.Titel," :"),g.Mb(1),g.oc("ngIf",i.PageType>=-2),g.Mb(3),g.oc("ngIf",i.PageType>=-2),g.Mb(1),g.oc("ngForOf",i.TTopics),g.Mb(1),g.oc("ngForOf",i.Topics),g.Mb(5),g.oc("disabled",0===i.PageIndex),g.Mb(2),g.oc("ngModel",i.PageIndex),g.Mb(1),g.oc("ngForOf",i.Pages),g.Mb(1),g.oc("disabled",i.PageIndex===i.Pages.length-1))},directives:[c.s,c.Y,c.k,c.g,c.h,c.W,e.j,c.o,c.D,e.i,c.q,c.j,c.t,c.P,c.hb,n.c,n.d,c.T,c.x,c.C,c.w,c.V,c.I,c.Q],styles:[""]}),t})();var w=o("Gfuc"),P=o("9UMr");o.d(i,"TopiclistPageModule",(function(){return I}));const M=[{path:"",component:y}];let I=(()=>{class t{}return t.\u0275mod=g.Ub({type:t}),t.\u0275inj=g.Tb({factory:function(i){return new(i||t)},imports:[[w.a,P.a,e.b,n.a,c.Z,s.i.forChild(M)]]}),t})()}}]);