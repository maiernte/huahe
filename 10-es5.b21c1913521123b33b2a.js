function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var n=0,t=new Array(e.length);n<e.length;n++)t[n]=e[n];return t}}function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,n,t){return n&&_defineProperties(e.prototype,n),t&&_defineProperties(e,t),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{L99X:function(e,n,t){"use strict";t.d(n,"a",(function(){return d}));var i=t("mrSG"),o=t("c7TG"),r=t("LTmD"),s=t("2Vo4"),a=t("Y6BA"),c=(t("xPBH"),t("fXoL")),u=t("e8h1"),l=t("tk/3"),d=function(){var e=function(){function e(n,t,i,o){var r=this;_classCallCheck(this,e),this.settings=n,this.plateform=t,this.storage=i,this.http=o,this.dbReady=new s.a(!1),this.LoadBooks().then((function(e){if(r.nodes=e||[],0===r.Nodes.length)return r.CreateNode(void 0,"\u4e34\u65f6\u6848\u4f8b",32)})).finally((function(){r.dbReady.next(!0)}))}return _createClass(e,[{key:"ReloadBooks",value:function(){var e=this;this.dbReady.next(!1),this.LoadBooks().then((function(n){e.nodes=n||[]})).finally((function(){e.dbReady.next(!0)}))}},{key:"GetAllNodes",value:function(){var e=this;return new Promise((function(n,t){e.DatabaseState.subscribe((function(t){t&&n(e.Nodes)}))}))}},{key:"SaveNodes",value:function(){var n=this,t=this.settings.HasUser?"".concat(e.DB_NODES,"_").concat(this.settings.User.id):e.DB_NODES;return new Promise((function(e,i){var o=JSON.stringify(n.nodes);n.storage.set(t,o).then((function(n){e(!0)})).catch((function(e){i(!1)}))}))}},{key:"CreateNode",value:function(e,n,t){var i=this;return new Promise((function(o,r){var s={id:Object(a.createGuid)(8),created:0,modified:0,parent:e,name:n||"\u4e34\u65f6\u6848\u4f8b",comment:"",type:t||1,size:0,sync:0};i.nodes=i.nodes||[],i.nodes.push(s),i.SaveNodes().then((function(e){o(i.Nodes)})).catch((function(e){r(e)}))}))}},{key:"ChangeNode",value:function(e,n){var t=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new Promise((function(o,r){var s=t.nodes.where((function(n){return n.id===e}));if(s&&1===s.length){var a=s[0];a.name=n||a.name,a.parent=i||a.parent,t.SaveNodes().then((function(e){o(t.Nodes)})).catch((function(e){r(!1)}))}}))}},{key:"DeleteNodes",value:function(e){var n=this,t=Date.now();return new Promise((function(i,o){var r=[];n.nodes.forEach((function(n){e.includes(n.id)&&(n.size=-1,n.modified=t,32===n.type&&r.push(n.id))})),n.SaveNodes().then((function(e){i(n.Nodes)})).catch((function(e){o(!1)}))}))}},{key:"SyncNodes",value:function(e){var n=this,t=this.nodes.map((function(e){return e.id})),i=[],o=[];return e.forEach((function(e){if(t.includes(e.id)){if(n.nodes.find((function(n){return n.id===e.id})).modified<e.modified){var o=n.nodes.findIndex((function(n){return n.id===e.id}));n.nodes.splice(o,1,Object(r.b)(e)),i.push(e.id)}}else n.nodes.push(Object(r.b)(e)),i.push(e.id)})),this.CleanNodes(),this.nodes.forEach((function(n){var t=e.find((function(e){return e.id===n.id}));n.name.startsWith("\u516d\u723b")&&console.log("...",t,n),(!t||t.modified<n.modified)&&o.push(n.id)})),i.length>0?(console.log("new Booktree will be saved.",this.nodes),this.SaveNodes().then((function(){return[i,o]}))):Promise.resolve([i,o])}},{key:"CleanNodes",value:function(){var e=Date.now()-2592e6;this.nodes=this.nodes.filter((function(n){return n.size<0&&n.modified<e||n.size>=0}))}},{key:"GetRecordes",value:function(e){var n=this;return new Promise((function(t,i){n.storage.get("Book_".concat(e)).then((function(o){if(o){var r=JSON.parse(o);t(r.filter((function(e){return e.size>=0})))}else 0===n.Nodes.find((function(n){return n.id===e})).sync?(n.SaveRecordes(e,[]),t([])):i([])})).catch((function(e){i(e)}))}))}},{key:"SaveRecordes",value:function(e,n){var t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];console.log("save recordes of ",e);var i=JSON.stringify(n);if(this.storage.set("Book_".concat(e),i),t){var o=this.nodes.find((function(n){return n.id===e}));o.created=0===o.created?Date.now():o.created,o.modified=Date.now(),o.size=i.length,this.SaveNodes()}}},{key:"CreateRecord",value:function(e,n,t,i){return{id:Object(a.createGuid)(8),node:e,created:Date.now(),modified:Date.now(),type:t,titel:n,arg:i,content:"",size:0,sync:0}}},{key:"SaveRecord",value:function(e,n,t,i){var o=this;return new Promise((function(r,s){o.storage.get("Book_".concat(e)).then((function(s){var a=JSON.parse(s),c=o.CreateRecord(e,n,t,i);a.push(c),o.SaveRecordes(e,a),r(c)}))}))}},{key:"DeleteRecordes",value:function(e,n){var t=this;return new Promise((function(i,o){t.storage.get("Book_".concat(e)).then((function(o){var r=JSON.parse(o);r.forEach((function(e){n.includes(e.id)&&(e.size=-1,e.content="",e.arg="",e.modified=Date.now())})),t.SaveRecordes(e,r),i(r.filter((function(e){return e.size>=0})))}))}))}},{key:"MoveRecordes",value:function(e,n,t){var i=this;return new Promise((function(o,r){var s=i.storage.get("Book_".concat(e)).then((function(e){return JSON.parse(e)||[]})),a=i.storage.get("Book_".concat(n)).then((function(e){return JSON.parse(e)||[]}));Promise.all([s,a]).then((function(r){var s=r[0],a=r[1],c=!0,u=!1,l=void 0;try{for(var d,h=function(){var e=d.value,t=s.find((function(n){return n.id===e}));t.node=n,a.push(t),s=s.filter((function(n){return n.id!==e}))},b=t[Symbol.iterator]();!(c=(d=b.next()).done);c=!0)h()}catch(f){u=!0,l=f}finally{try{c||null==b.return||b.return()}finally{if(u)throw l}}console.log("move finish",s,a,t),i.SaveRecordes(e,s),i.SaveRecordes(n,a),o(s.filter((function(e){return e.size>=0})))}))}))}},{key:"ChangeBooktreeOfAnonym",value:function(n){var t=this,i="".concat(e.DB_NODES,"_").concat(n);return this.storage.keys().then((function(n){return n.includes(i)?Promise.reject("".concat(i," is already hier.")):t.storage.get(e.DB_NODES)})).then((function(e){return e?(console.log("umschreiben booktree to ",i),t.storage.set("".concat(i),e)):Promise.reject("booktree can not founde.")})).then((function(){return console.log("umschreiben erfolg!"),t.storage.remove(e.DB_NODES)})).then((function(){return console.log("Record ".concat(e.DB_NODES," will deleted")),!0})).catch((function(e){return console.log("ChangeBooktreeOfAnonym denied: ",e),!1}))}},{key:"test",value:function(e){var n=this;return this.storage.get("...").then((function(t){return console.log("get ...",t),n.storage.get(e)})).then((function(n){return console.log("get ".concat(e),n),Promise.resolve(!0)}))}},{key:"WaitInit",value:function(){var e=this;return new Promise((function(n,t){e.DatabaseState.subscribe((function(e){e&&n(!0)}))}))}},{key:"LoadBooks",value:function(){return Object(i.b)(this,void 0,void 0,regeneratorRuntime.mark((function n(){var t;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.settings.WaitInit();case 2:return t=this.settings.HasUser?"".concat(e.DB_NODES,"_").concat(this.settings.User.id):e.DB_NODES,n.abrupt("return",(console.log("loadbooks of ".concat(t)),this.storage.get(t).then((function(e){return Promise.resolve(Object(r.d)(e))})).catch((function(e){return console.error("LoadBooks() error:",e),Promise.resolve([])}))));case 4:case"end":return n.stop()}}),n,this)})))}},{key:"DatabaseState",get:function(){return this.dbReady.asObservable()}},{key:"Nodes",get:function(){return this.nodes.filter((function(e){return e.size>=0}))}},{key:"NodesAlle",get:function(){return this.nodes}},{key:"NodeModified",get:function(){return Math.max.apply(Math,_toConsumableArray(this.nodes.map((function(e){return e.modified}))))}}]),e}();return e.DB_NODES="booktree",e.\u0275fac=function(n){return new(n||e)(c.dc(r.a),c.dc(o.Y),c.dc(u.b),c.dc(l.b))},e.\u0275prov=c.Sb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}()},bkV9:function(e,n,t){"use strict";t.r(n);var i=t("ofXK"),o=t("3Pt+"),r=t("tyNb"),s=t("c7TG"),a=t("mrSG"),c=t("LTmD"),u=t("L99X"),l=t("lEof"),d=t("fXoL");function h(e,n){1&e&&(d.Zb(0,"div",4),d.Xb(1,"ion-spinner",5),d.Yb())}function b(e,n){if(1&e){var t=d.ac();d.Zb(0,"ion-list"),d.Zb(1,"ion-list-header"),d.Zb(2,"ion-label"),d.xc(3,"\u7528\u6237\u767b\u5f55"),d.Yb(),d.Yb(),d.Zb(4,"ion-item",6),d.Zb(5,"ion-label",7),d.xc(6,"\u7528\u6237\u540d"),d.Yb(),d.Zb(7,"ion-input",8),d.hc("ngModelChange",(function(e){return d.rc(t),d.jc().SignIn.name=e})),d.Yb(),d.Yb(),d.Zb(8,"ion-item",6),d.Zb(9,"ion-label",7),d.xc(10,"\u5bc6\u7801"),d.Yb(),d.Zb(11,"ion-input",9),d.hc("ngModelChange",(function(e){return d.rc(t),d.jc().SignIn.password=e})),d.Yb(),d.Yb(),d.Zb(12,"ion-item",6),d.Zb(13,"ion-button",10),d.hc("click",(function(e){return d.rc(t),d.jc().UserSignIn()})),d.xc(14,"\u767b\u5f55"),d.Yb(),d.Zb(15,"ion-button",10),d.hc("click",(function(e){d.rc(t);var n=d.jc();return n.ChangeUIMode(n.PageModes.SignUp)})),d.xc(16,"\u6ce8\u518c"),d.Yb(),d.Zb(17,"ion-button",11),d.hc("click",(function(e){d.rc(t);var n=d.jc();return n.ChangeUIMode(n.PageModes.ForgetPassword)})),d.xc(18,"\u5fd8\u8bb0\u5bc6\u7801"),d.Yb(),d.Yb(),d.Yb()}if(2&e){var i=d.jc();d.Mb(4),d.oc("disabled",!0===i.spinner),d.Mb(3),d.oc("ngModel",i.SignIn.name),d.Mb(1),d.oc("disabled",!0===i.spinner),d.Mb(3),d.oc("ngModel",i.SignIn.password),d.Mb(1),d.oc("disabled",!0===i.spinner)}}function f(e,n){if(1&e){var t=d.ac();d.Zb(0,"ion-list"),d.Zb(1,"ion-list-header"),d.Zb(2,"ion-label"),d.xc(3,"\u7528\u6237\u6ce8\u518c"),d.Yb(),d.Yb(),d.Zb(4,"ion-item",6),d.Zb(5,"ion-label",7),d.xc(6,"\u7528\u6237\u540d"),d.Yb(),d.Zb(7,"ion-input",12),d.hc("ngModelChange",(function(e){return d.rc(t),d.jc().SignIn.name=e})),d.Yb(),d.Yb(),d.Zb(8,"ion-item",6),d.Zb(9,"ion-label",7),d.xc(10,"\u5bc6\u7801\u7b2c\u4e00\u6b21"),d.Yb(),d.Zb(11,"ion-input",13),d.hc("ngModelChange",(function(e){return d.rc(t),d.jc().SignIn.password=e})),d.Yb(),d.Yb(),d.Zb(12,"ion-item",6),d.Zb(13,"ion-label",7),d.xc(14,"\u5bc6\u7801\u7b2c\u4e8c\u6b21"),d.Yb(),d.Zb(15,"ion-input",14),d.hc("ngModelChange",(function(e){return d.rc(t),d.jc().SignIn.password2=e})),d.Yb(),d.Yb(),d.Zb(16,"ion-item",6),d.Zb(17,"ion-button",10),d.hc("click",(function(e){return d.rc(t),d.jc().UserSignUp()})),d.xc(18," \u6ce8\u518c "),d.Xb(19,"ion-icon",15),d.Yb(),d.Zb(20,"ion-button",11),d.hc("click",(function(e){d.rc(t);var n=d.jc();return n.ChangeUIMode(n.PageModes.SignIn)})),d.xc(21,"\u5df2\u6709\u8d26\u6237"),d.Yb(),d.Yb(),d.Yb()}if(2&e){var i=d.jc();d.Mb(4),d.oc("disabled",!0===i.spinner),d.Mb(3),d.oc("ngModel",i.SignIn.name),d.Mb(1),d.oc("disabled",!0===i.spinner),d.Mb(3),d.oc("ngModel",i.SignIn.password),d.Mb(1),d.oc("disabled",!0===i.spinner),d.Mb(3),d.oc("ngModel",i.SignIn.password2),d.Mb(1),d.oc("disabled",!0===i.spinner)}}function g(e,n){if(1&e){var t=d.ac();d.Zb(0,"ion-item",6),d.Zb(1,"ion-label"),d.xc(2,"\u7535\u5b50\u90ae\u7bb1"),d.Yb(),d.Zb(3,"ion-input",24),d.hc("ngModelChange",(function(e){return d.rc(t),d.jc(2).SignIn.email=e})),d.Yb(),d.Zb(4,"ion-button",18),d.hc("click",(function(e){return d.rc(t),d.jc(2).VerifyEmail()})),d.xc(5,"\u53d1\u9001\u9a8c\u8bc1"),d.Yb(),d.Yb()}if(2&e){var i=d.jc(2);d.oc("disabled",!0===i.spinner),d.Mb(3),d.oc("ngModel",i.SignIn.email)}}function p(e,n){if(1&e&&(d.Zb(0,"ion-item",6),d.Zb(1,"ion-label"),d.xc(2,"\u7535\u5b50\u90ae\u7bb1"),d.Yb(),d.Zb(3,"ion-input",25),d.xc(4),d.Yb(),d.Xb(5,"ion-icon",26),d.Yb()),2&e){var t=d.jc(2);d.oc("disabled",!0===t.spinner),d.Mb(4),d.yc(t.UserProfile.email)}}function v(e,n){if(1&e){var t=d.ac();d.Zb(0,"ion-list"),d.Zb(1,"ion-item"),d.Zb(2,"ion-thumbnail",0),d.Xb(3,"ion-img",16),d.Yb(),d.Zb(4,"ion-text"),d.xc(5),d.Yb(),d.Yb(),d.wc(6,g,6,2,"ion-item",17),d.wc(7,p,6,2,"ion-item",17),d.Zb(8,"ion-item",6),d.Zb(9,"ion-button",18),d.hc("click",(function(e){return d.rc(t),d.jc().LogOut()})),d.Xb(10,"ion-icon",19),d.xc(11," \u9000\u51fa\u767b\u5f55 "),d.Yb(),d.Zb(12,"ion-button",11),d.hc("click",(function(e){return d.rc(t),d.jc().Reflash()})),d.Xb(13,"ion-icon",20),d.xc(14," \u66f4\u65b0\u8d44\u6599 "),d.Yb(),d.Zb(15,"ion-button",21),d.Xb(16,"ion-icon",22),d.xc(17," \u66f4\u65b0\u5934\u50cf "),d.Yb(),d.Zb(18,"ion-button",23),d.hc("click",(function(e){d.rc(t);var n=d.jc();return n.ChangeUIMode(n.PageModes.ChangePassword)})),d.xc(19,"\u4fee\u6539\u5bc6\u7801"),d.Yb(),d.Yb(),d.Yb()}if(2&e){var i=d.jc();d.Mb(3),d.oc("src",i.UserProfile.avatar),d.Mb(2),d.yc(i.UserProfile.name),d.Mb(1),d.oc("ngIf",!i.HasEmail),d.Mb(1),d.oc("ngIf",i.HasEmail),d.Mb(1),d.oc("disabled",!0===i.spinner)}}function m(e,n){if(1&e){var t=d.ac();d.Zb(0,"ion-list"),d.Zb(1,"ion-list-header"),d.Zb(2,"ion-label"),d.xc(3,"\u901a\u8fc7\u6ce8\u518c\u90ae\u7bb1\u53d6\u56de\u5bc6\u7801"),d.Yb(),d.Yb(),d.Zb(4,"ion-item",6),d.Zb(5,"ion-label",7),d.xc(6,"\u586b\u5199\u60a8\u7684\u7528\u6237\u540d"),d.Yb(),d.Zb(7,"ion-input",8),d.hc("ngModelChange",(function(e){return d.rc(t),d.jc().SignIn.name=e})),d.Yb(),d.Yb(),d.Zb(8,"ion-item",6),d.Zb(9,"ion-label",7),d.xc(10,"\u586b\u5199\u60a8\u7684\u6ce8\u518c\u90ae\u7bb1"),d.Yb(),d.Zb(11,"ion-input",8),d.hc("ngModelChange",(function(e){return d.rc(t),d.jc().SignIn.email=e})),d.Yb(),d.Yb(),d.Zb(12,"ion-item",6),d.Zb(13,"ion-button",18),d.hc("click",(function(e){return d.rc(t),d.jc().SendPW2Email()})),d.xc(14,"\u53d1\u9001\u5bc6\u7801\u5230\u90ae\u7bb1"),d.Yb(),d.Yb(),d.Yb()}if(2&e){var i=d.jc();d.Mb(4),d.oc("disabled",!0===i.spinner),d.Mb(3),d.oc("ngModel",i.SignIn.name),d.Mb(1),d.oc("disabled",!0===i.spinner),d.Mb(3),d.oc("ngModel",i.SignIn.email),d.Mb(1),d.oc("disabled",!0===i.spinner)}}function S(e,n){if(1&e){var t=d.ac();d.Zb(0,"ion-list"),d.Zb(1,"ion-list-header"),d.Zb(2,"ion-label"),d.xc(3,"\u66f4\u6539\u5bc6\u7801"),d.Yb(),d.Yb(),d.Zb(4,"ion-item",6),d.Zb(5,"ion-label",7),d.xc(6,"\u65e7\u5bc6\u7801"),d.Yb(),d.Zb(7,"ion-input",8),d.hc("ngModelChange",(function(e){return d.rc(t),d.jc().SignIn.passwordOld=e})),d.Yb(),d.Yb(),d.Zb(8,"ion-item",6),d.Zb(9,"ion-label",7),d.xc(10,"\u65b0\u5bc6\u7801\u7b2c\u4e00\u6b21"),d.Yb(),d.Zb(11,"ion-input",13),d.hc("ngModelChange",(function(e){return d.rc(t),d.jc().SignIn.password=e})),d.Yb(),d.Yb(),d.Zb(12,"ion-item",6),d.Zb(13,"ion-label",7),d.xc(14,"\u65b0\u5bc6\u7801\u7b2c\u4e8c\u6b21"),d.Yb(),d.Zb(15,"ion-input",14),d.hc("ngModelChange",(function(e){return d.rc(t),d.jc().SignIn.password2=e})),d.Yb(),d.Yb(),d.Zb(16,"ion-item",6),d.Zb(17,"ion-button",10),d.hc("click",(function(e){return d.rc(t),d.jc().ChangePassword()})),d.xc(18,"\u66f4\u6539\u5bc6\u7801"),d.Yb(),d.Zb(19,"ion-button",11),d.hc("click",(function(e){d.rc(t);var n=d.jc();return n.Mode=n.PageModes.SignIned})),d.xc(20,"\u53d6\u6d88"),d.Yb(),d.Yb(),d.Yb()}if(2&e){var i=d.jc();d.Mb(4),d.oc("disabled",!0===i.spinner),d.Mb(3),d.oc("ngModel",i.SignIn.passwordOld),d.Mb(1),d.oc("disabled",!0===i.spinner),d.Mb(3),d.oc("ngModel",i.SignIn.password),d.Mb(1),d.oc("disabled",!0===i.spinner),d.Mb(3),d.oc("ngModel",i.SignIn.password2),d.Mb(1),d.oc("disabled",!0===i.spinner)}}var w,y=((w=function(){function e(n,t,i,o,r){_classCallCheck(this,e),this.settings=n,this.dbservice=t,this.host=i,this.toastController=o,this.alertController=r,this.PageModes={SignIn:"signin",SignUp:"signup",SignIned:"signined",ForgetPassword:"forgetpassword",ChangePassword:"changepassword"},this.SignIn={name:"",password:"",password2:"",passwordOld:"",email:"",phone:""},this.mode=this.PageModes.SignIn,this.spinner=!1}return _createClass(e,[{key:"ngOnInit",value:function(){return Object(a.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.settings.WaitInit();case 2:this.mode=this.settings.User&&null!=this.settings.User.id?this.PageModes.SignIned:this.PageModes.SignIn;case 3:case"end":return e.stop()}}),e,this)})))}},{key:"showTostMessage",value:function(e){return Object(a.b)(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.toastController.create({message:e,duration:2e3});case 2:n.sent.present();case 3:case"end":return n.stop()}}),n,this)})))}},{key:"presentAlert",value:function(e,n,t){return Object(a.b)(this,void 0,void 0,regeneratorRuntime.mark((function i(){var o;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,this.alertController.create({header:e||"\u9519\u8bef",subHeader:n||"",message:t,buttons:["\u786e\u5b9a"]});case 2:return o=i.sent,i.next=5,o.present();case 5:case"end":return i.stop()}}),i,this)})))}},{key:"ChangeUIMode",value:function(e){this.SignIn.name="",this.SignIn.password="",this.SignIn.password2="",this.SignIn.passwordOld="",this.SignIn.phone="",this.SignIn.email="",this.mode=e}},{key:"Reflash",value:function(){return Object(a.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n,t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this.settings.User,this.spinner=!0,this.host.SignIn(n.id,n.password).then((function(e){e&&(t.settings.User=e,t.showTostMessage("\u7528\u6237\u8d44\u6599\u5df2\u66f4\u65b0\uff01"))})).catch((function(e){t.presentAlert(null,null,e.toString())})).finally((function(){t.spinner=!1}));case 2:case"end":return e.stop()}}),e,this)})))}},{key:"UserSignIn",value:function(){return Object(a.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.settings.User&&this.SignIn.name===this.settings.User.name&&this.SignIn.password===this.settings.User.password?this.mode=this.PageModes.SignIned:(this.spinner=!0,this.host.SignIn(this.SignIn.name,this.SignIn.password).then((function(e){var t=e;if(!t)return Promise.reject("It is not a UserT Object.");n.settings.User=t,n.mode=n.PageModes.SignIned,n.dbservice.ChangeBooktreeOfAnonym(t.id).then((function(){n.dbservice.ReloadBooks()}))})).catch((function(e){n.presentAlert(null,null,e.toString())})).finally((function(){n.spinner=!1})));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"ChangePassword",value:function(){return Object(a.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.SignIn.passwordOld===this.settings.User.password?this.SignIn.password===this.SignIn.password2?/^[\S]{4,20}$/i.test(this.SignIn.password2)?(this.spinner=!0,this.host.ChangePassword(this.settings.User.id,this.SignIn.passwordOld,this.SignIn.password).then((function(e){var t=e;if(!t)return Promise.reject("It is not a UserT Object.");n.settings.User=t,n.mode=n.PageModes.SignIned,n.showTostMessage("\u4fee\u6539\u5bc6\u7801\u6210\u529f\uff01")})).catch((function(e){n.presentAlert(null,null,e.toString())})).finally((function(){n.spinner=!1}))):this.showTostMessage("\u5bc6\u7801\u4e0d\u7b26\u5408\u8981\u6c42\u3002"):this.showTostMessage("\u4e24\u6b21\u5bc6\u7801\u4e0d\u4e00\u81f4\uff0c\u8bf7\u91cd\u65b0\u786e\u8ba4\u3002"):this.presentAlert("\u9519\u8bef","\u4fee\u6539\u5bc6\u7801","\u60a8\u8f93\u5165\u7684\u65e7\u5bc6\u7801\u6709\u8bef\u3002");case 1:case"end":return e.stop()}}),e,this)})))}},{key:"UserSignUp",value:function(){return Object(a.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.SignIn.password===this.SignIn.password2?/^[\S]{2,20}$/i.test(this.SignIn.name)&&/^[\S]{4,20}$/i.test(this.SignIn.password2)?(this.spinner=!0,this.host.SignUp(this.SignIn.name,this.SignIn.password).then((function(e){var t=e;if(!t)return Promise.reject("It is not a UserT Object.");n.settings.User=t,n.mode=n.PageModes.SignIned,n.showTostMessage("\u6ce8\u518c\u6210\u529f\uff01")})).catch((function(e){n.presentAlert(null,null,e.toString())})).finally((function(){n.spinner=!1}))):this.showTostMessage("\u7528\u6237\u540d\u6216\u5bc6\u7801\u4e0d\u7b26\u5408\u8981\u6c42\u3002"):this.showTostMessage("\u4e24\u6b21\u5bc6\u7801\u4e0d\u4e00\u81f4\uff0c\u8bf7\u91cd\u65b0\u786e\u8ba4\u3002");case 1:case"end":return e.stop()}}),e,this)})))}},{key:"VerifyEmail",value:function(){var e=this;if(!1!==this.validateEmail(this.SignIn.email)){this.spinner=!0;var n=this.settings.User;this.host.VerifyEmail(n.id,n.password,this.SignIn.email).then((function(n){e.presentAlert("\u6ce8\u518c\u90ae\u7bb1",null,n)})).catch((function(n){e.presentAlert(null,null,n.toString())})).finally((function(){e.spinner=!1}))}else this.presentAlert("\u9519\u8bef","\u90ae\u7bb1","\u8bf7\u8f93\u5165\u6709\u6548\u7684\u90ae\u7bb1\u5730\u5740\u3002")}},{key:"SendPW2Email",value:function(){var e=this;this.spinner=!0,this.host.SendPW2Email(this.SignIn.name,this.SignIn.email).then((function(n){e.presentAlert("\u4fe1\u606f","\u83b7\u53d6\u5bc6\u7801",n)})).catch((function(n){e.showTostMessage("\u5931\u8d25: ".concat(n.error.text))})).finally((function(){e.spinner=!1}))}},{key:"LogOut",value:function(){this.ChangeUIMode(this.PageModes.SignIn),this.settings.User=null,this.dbservice.ReloadBooks()}},{key:"validateEmail",value:function(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e.toLowerCase())}},{key:"Mode",get:function(){return this.mode},set:function(e){this.mode=e}},{key:"UserProfile",get:function(){return this.settings.User}},{key:"HasEmail",get:function(){return!!this.settings.User&&!!this.settings.User.email&&!this.settings.User.email.IsNullOrEmpty()}},{key:"HasPhone",get:function(){return!!this.settings.User&&!!this.settings.User.phone&&!this.settings.User.phone.IsNullOrEmpty()}}]),e}()).\u0275fac=function(e){return new(e||w)(d.Wb(c.a),d.Wb(u.a),d.Wb(l.a),d.Wb(s.db),d.Wb(s.b))},w.\u0275cmp=d.Qb({type:w,selectors:[["app-user"]],decls:13,vars:6,consts:[["slot","start"],[1,"ion-padding"],["class","spin",4,"ngIf"],[4,"ngIf"],[1,"spin"],["name","bubbles"],[3,"disabled"],["position","stacked"],[3,"ngModel","ngModelChange"],["type","password",3,"ngModel","ngModelChange"],[3,"click"],["slot","end",3,"click"],["placeholder","2 ~ 20 \u4e2a\u82f1\u6587\u6216\u4e2d\u6587\u5b57\u7b26",3,"ngModel","ngModelChange"],["type","password","placeholder","4 ~ 20 \u4e2a\u82f1\u6587\u3001\u6570\u5b57\u548c\u7279\u6b8a\u5b57\u7b26",3,"ngModel","ngModelChange"],["type","password","placeholder","\u8bf7\u518d\u6b21\u8f93\u5165\u4e00\u904d\u5bc6\u7801",3,"ngModel","ngModelChange"],["slot","end","name","person-add"],[3,"src"],[3,"disabled",4,"ngIf"],["size","small",3,"click"],["name","exit"],["name","ios-repeat"],["slot","end"],["name","ios-person"],["size","small","slot","end",3,"click"],["type","email","placeholder","\u6ca1\u6709\u9a8c\u8bc1\u90ae\u7bb1",3,"ngModel","ngModelChange"],["type","email"],["name","checkmark"]],template:function(e,n){1&e&&(d.Zb(0,"ion-header"),d.Zb(1,"ion-toolbar"),d.Zb(2,"ion-buttons",0),d.Xb(3,"ion-menu-button"),d.Yb(),d.Zb(4,"ion-title"),d.xc(5,"\u7528\u6237"),d.Yb(),d.Yb(),d.Yb(),d.Zb(6,"ion-content",1),d.wc(7,h,2,0,"div",2),d.wc(8,b,19,5,"ion-list",3),d.wc(9,f,22,7,"ion-list",3),d.wc(10,v,20,5,"ion-list",3),d.wc(11,m,15,5,"ion-list",3),d.wc(12,S,21,7,"ion-list",3),d.Yb()),2&e&&(d.Mb(7),d.oc("ngIf",!0===n.spinner),d.Mb(1),d.oc("ngIf",n.Mode===n.PageModes.SignIn),d.Mb(1),d.oc("ngIf",n.Mode===n.PageModes.SignUp),d.Mb(1),d.oc("ngIf",n.Mode===n.PageModes.SignIned),d.Mb(1),d.oc("ngIf",n.Mode===n.PageModes.ForgetPassword),d.Mb(1),d.oc("ngIf",n.Mode===n.PageModes.ChangePassword))},directives:[s.p,s.T,s.i,s.y,s.R,s.l,i.j,s.J,s.v,s.w,s.u,s.t,s.s,s.cb,o.c,o.d,s.h,s.q,s.Q,s.r,s.O],styles:[".spin[_ngcontent-%COMP%]{position:fixed;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}ion-spinner[_ngcontent-%COMP%]{width:50px;height:50px;stroke:#444;fill:#222}"]}),w);t.d(n,"UserPageModule",(function(){return I}));var M,k=[{path:"",component:y}],I=((M=function e(){_classCallCheck(this,e)}).\u0275mod=d.Ub({type:M}),M.\u0275inj=d.Tb({factory:function(e){return new(e||M)},imports:[[i.b,o.a,s.U,r.i.forChild(k)]]}),M)},xPBH:function(e,n,t){"use strict";t.d(n,"a",(function(){return i}));var i=function(){function e(n,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];_classCallCheck(this,e),this.Type=n,this.Title=t,this.ShowButton=!0,this.isExpanded=!1,this.isSelected=!1,this.url="",this.sub=[]}return _createClass(e,[{key:"SubNodesId",value:function(e){e.push(this.ID);var n=!0,t=!1,i=void 0;try{for(var o,r=this.Sub[Symbol.iterator]();!(n=(o=r.next()).done);n=!0){o.value.SubNodesId(e)}}catch(s){t=!0,i=s}finally{try{n||null==r.return||r.return()}finally{if(t)throw i}}}},{key:"IsFile",get:function(){return 32===this.Type}},{key:"IsSelected",get:function(){return this.isSelected},set:function(e){this.isSelected=e}},{key:"IsExpanded",get:function(){return this.isExpanded},set:function(e){0!==this.Sub.length&&(this.isExpanded=e)}},{key:"Icon",get:function(){switch(this.Type){case 2:return"person";case 4:return"lock";case 8:return"menu";case 16:return"walk";case 32:return"document";case 1:default:return"folder"}}},{key:"Url",get:function(){return this.url}},{key:"Sub",get:function(){return this.sub},set:function(e){this.sub=e}},{key:"Color",get:function(){return this.isSelected?"tertiary":""}},{key:"ColorB",get:function(){return this.isSelected?"light":""}}],[{key:"getNodePath",value:function(e,n){var t,i,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=e?e.Sub:o;if((n||"").IsNullOrEmpty())return["\u6839\u76ee\u5f55"];if((null===(t=e)||void 0===t?void 0:t.ID)===n)return[e.Title];if(!(r.length>0))return null;var s=!0,a=!1,c=void 0;try{for(var u,l=r[Symbol.iterator]();!(s=(u=l.next()).done);s=!0){var d=u.value,h=this.getNodePath(d,n);if(h)return h.insert(0,(null===(i=e)||void 0===i?void 0:i.Title)||""),h}}catch(b){a=!0,c=b}finally{try{s||null==l.return||l.return()}finally{if(a)throw c}}}},{key:"Examples",get:function(){var n=[],t=new e(1,"Folder 01"),i=new e(2,"Folder 02"),o=new e(4,"Folder 03"),r=new e(32,"file 01",!0),s=new e(8,"file 02",!0),a=new e(16,"file 03",!0),c=new e(8,"file 04",!0),u=new e(32,"file 05",!0),l=new e(16,"file 06",!0);return t.Sub.push(i),i.Sub.push(r),i.Sub.push(s),i.Sub.push(a),o.Sub.push(c),o.Sub.push(u),o.Sub.push(l),n.push(t),n.push(o),n}}]),e}()}}]);