(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{oR3u:function(e,t,n){"use strict";n.r(t);var i=n("ofXK"),s=n("3Pt+"),o=n("tyNb"),r=n("c7TG"),l=n("CGrG"),c=n("mrSG"),a=n("LTmD"),d=n("L99X"),b=n("lEof"),h=n("PKx9"),u=n("+z1p"),g=n("fXoL"),p=n("zioG");let m=(()=>{class e{constructor(e,t,n,i,s,o){this.modalCtrl=e,this.loadingController=t,this.alertController=n,this.settings=i,this.host=s,this.forumservice=o,this.describe="",this.gender="none",this.birthday=null,this.Editor=u,this.EditorConfig={toolbar:["heading","|","bold","italic","bulletedList","numberedList","|","link","undo","redo"]}}ngOnInit(){return Object(c.b)(this,void 0,void 0,(function*(){yield this.settings.WaitInit(),this.user=this.settings.User,this.loadingView=yield this.loadingController.create({message:"\u4e0b\u8f7d\u6570\u636e...",duration:6e4}),yield this.loadingView.present(),this.forumservice.GetUserInfo(this.user.id).then(e=>{this.describe=e.describe?e.describe:"",this.gender=e.gender?e.gender:this.gender,this.birthday=e.birthday||""}).catch(e=>{this.presentAlert("\u5931\u8d25",null,"\u4e0b\u8f7d\u6570\u636e\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002")}).finally(()=>{this.loadingView.dismiss()})}))}onSave(){return Object(c.b)(this,void 0,void 0,(function*(){this.loadingView=yield this.loadingController.create({message:"\u4e0a\u4f20\u6570\u636e...",duration:6e4});let e=null;if(this.SelectedTime&&this.SelectedDate){const t=new Date(this.SelectedDate),n=new Date(this.SelectedTime);e=new Date(t.getFullYear(),t.getMonth(),t.getDate(),n.getHours(),n.getMinutes()).toDatabaseStr()}yield this.loadingView.present(),this.host.UpdateUser(this.user,{describe:this.describe,gender:this.gender,birthday:e||this.birthday},!1).then(e=>{console.log("update vuser:",e)}).catch(e=>{this.presentAlert("\u5931\u8d25",null,"\u4e0a\u4f20\u5931\u8d25")}).finally(()=>{this.loadingView.dismiss(),this.modalCtrl.dismiss()})}))}onCancel(){this.modalCtrl.dismiss(!1)}DeleteTime(){this.SelectedDate=null,this.SelectedTime=null}presentAlert(e,t,n){return Object(c.b)(this,void 0,void 0,(function*(){const i=yield this.alertController.create({header:e||"\u9519\u8bef",subHeader:t||"",message:n,buttons:["\u786e\u5b9a"]});yield i.present()}))}}return e.\u0275fac=function(t){return new(t||e)(g.Wb(r.cb),g.Wb(r.bb),g.Wb(r.b),g.Wb(a.a),g.Wb(b.a),g.Wb(h.a))},e.\u0275cmp=g.Qb({type:e,selectors:[["app-profileditor"]],decls:37,vars:7,consts:[["color","secondary"],["slot","start"],[3,"click"],["name","close-circle"],["slot","end"],["name","save"],["cancelText","\u53d6\u6d88","okText","\u786e\u5b9a",3,"ngModel","ngModelChange"],["value","none"],["value","male"],["value","female"],[1,"ion-margin-start"],["fill","outline",3,"click"],["placeholder","\u65e5\u671f","displayFormat","YYYY\u5e74MM\u6708DD\u65e5","cancelText","\u53d6\u6d88","doneText","\u786e\u5b9a",3,"ngModel","ngModelChange"],["placeholder","\u65f6\u95f4","displayFormat","HH:mm","cancelText","\u53d6\u6d88","doneText","\u786e\u5b9a",3,"ngModel","ngModelChange"],[3,"ngModel","config","editor","ngModelChange"]],template:function(e,t){1&e&&(g.Zb(0,"ion-header"),g.Zb(1,"ion-toolbar",0),g.Zb(2,"ion-buttons",1),g.Zb(3,"ion-button",2),g.hc("click",(function(){return t.onCancel()})),g.Xb(4,"ion-icon",3),g.Zb(5,"ion-text"),g.xc(6,"\u53d6\u6d88"),g.Yb(),g.Yb(),g.Yb(),g.Zb(7,"ion-title"),g.xc(8,"\u7f16\u8f91\u7b80\u4ecb/\u8d44\u5386"),g.Yb(),g.Zb(9,"ion-buttons",4),g.Zb(10,"ion-button",2),g.hc("click",(function(){return t.onSave()})),g.Xb(11,"ion-icon",5),g.Zb(12,"ion-text"),g.xc(13,"\u4fdd\u5b58"),g.Yb(),g.Yb(),g.Yb(),g.Yb(),g.Yb(),g.Zb(14,"ion-content"),g.Zb(15,"ion-item"),g.Zb(16,"ion-label"),g.Zb(17,"ion-text"),g.xc(18,"\u6027\u522b"),g.Yb(),g.Yb(),g.Zb(19,"ion-select",6),g.hc("ngModelChange",(function(e){return t.gender=e})),g.Zb(20,"ion-select-option",7),g.xc(21,"\u4e0d\u516c\u5f00"),g.Yb(),g.Zb(22,"ion-select-option",8),g.xc(23,"\u7537\u58eb"),g.Yb(),g.Zb(24,"ion-select-option",9),g.xc(25,"\u5973\u58eb"),g.Yb(),g.Yb(),g.Yb(),g.Zb(26,"ion-item"),g.Zb(27,"ion-label"),g.Zb(28,"ion-text"),g.xc(29,"\u751f\u65e5"),g.Yb(),g.Zb(30,"ion-text",10),g.xc(31),g.Yb(),g.Yb(),g.Zb(32,"ion-button",11),g.hc("click",(function(){return t.DeleteTime()})),g.xc(33,"\u5220\u9664"),g.Yb(),g.Zb(34,"ion-datetime",12),g.hc("ngModelChange",(function(e){return t.SelectedDate=e})),g.Yb(),g.Zb(35,"ion-datetime",13),g.hc("ngModelChange",(function(e){return t.SelectedTime=e})),g.Yb(),g.Yb(),g.Zb(36,"ckeditor",14),g.hc("ngModelChange",(function(e){return t.describe=e})),g.Yb(),g.Yb()),2&e&&(g.Mb(19),g.oc("ngModel",t.gender),g.Mb(12),g.yc(t.birthday),g.Mb(3),g.oc("ngModel",t.SelectedDate),g.Mb(1),g.oc("ngModel",t.SelectedTime),g.Mb(1),g.oc("ngModel",t.describe)("config",t.EditorConfig)("editor",t.Editor))},directives:[r.s,r.Y,r.k,r.j,r.t,r.T,r.W,r.o,r.w,r.C,r.P,r.hb,s.c,s.d,r.Q,r.p,p.a],styles:[""]}),e})();var f=n("7L00");let y=(()=>{class e{constructor(e,t){this.modalCtrl=e,this.alertController=t,this.quadCode="https://huaheapp.oss-cn-hangzhou.aliyuncs.com/app/weixinpay"}ngOnInit(){}get QuadCode(){return`${this.quadCode}${this.PaySum.toString().padStart(2,"0")}.png`}onclose(){return Object(c.b)(this,void 0,void 0,(function*(){yield this.presentAlert("\u591a\u8c22\uff01",null,"\u518d\u6b21\u611f\u8c22\u60a8\u7684\u652f\u6301\u3002\u6211\u4eec\u4f1a\u5c3d\u5feb\u4e3a\u60a8\u670d\u52a1\uff01"),this.modalCtrl.dismiss()}))}presentAlert(e,t,n){return Object(c.b)(this,void 0,void 0,(function*(){const i=yield this.alertController.create({header:e||"\u9519\u8bef",subHeader:t||"",message:n,buttons:["\u786e\u5b9a"]});yield i.present()}))}}return e.\u0275fac=function(t){return new(t||e)(g.Wb(r.cb),g.Wb(r.b))},e.\u0275cmp=g.Qb({type:e,selectors:[["app-payment"]],inputs:{PaySum:"PaySum"},decls:18,vars:1,consts:[["color","primary"],["slot","end"],[3,"click"],["name","cash"],[3,"src"],[1,"ion-text-wrap"]],template:function(e,t){1&e&&(g.Zb(0,"ion-header"),g.Zb(1,"ion-toolbar",0),g.Zb(2,"ion-title"),g.xc(3,"\u8d2d\u4e70VIP"),g.Yb(),g.Zb(4,"ion-buttons",1),g.Zb(5,"ion-button",2),g.hc("click",(function(){return t.onclose()})),g.Xb(6,"ion-icon",3),g.xc(7," \u786e\u5b9a "),g.Yb(),g.Yb(),g.Yb(),g.Yb(),g.Zb(8,"ion-content"),g.Zb(9,"ion-item"),g.Xb(10,"ion-img",4),g.Yb(),g.Zb(11,"ion-item"),g.Zb(12,"ion-label",5),g.Zb(13,"ion-text"),g.xc(14,"\u975e\u5e38\u611f\u8c22\u60a8\u7684\u652f\u6301\uff01"),g.Yb(),g.Xb(15,"br"),g.Zb(16,"ion-text"),g.xc(17,"\u8bf7\u60a8\u5728\u652f\u4ed8\u7684\u65f6\u5019\uff0c\u5907\u6ce8\u91cc\u586b\u5199\u5728\u672c\u8f6f\u4ef6\u4e2d\u4f7f\u7528\u7684\u8d26\u53f7\uff0c\u65b9\u4fbf\u6211\u4eec\u5c3d\u5feb\u4e3a\u60a8\u5f00\u901aVIP\u6743\u9650\u3002"),g.Yb(),g.Yb(),g.Yb(),g.Yb()),2&e&&(g.Mb(10),g.oc("src",t.QuadCode))},directives:[r.s,r.Y,r.W,r.k,r.j,r.t,r.o,r.w,r.u,r.C,r.T],styles:[""]}),e})();var Y=n("Y6BA"),Z=n("i/He");const v=["filePicker"];function M(e,t){if(1&e){const e=g.ac();g.Zb(0,"ion-list"),g.Zb(1,"ion-list-header"),g.Zb(2,"ion-label"),g.xc(3,"\u7528\u6237\u767b\u5f55"),g.Yb(),g.Yb(),g.Zb(4,"ion-item"),g.Zb(5,"ion-label",2),g.xc(6,"\u7528\u6237\u540d"),g.Yb(),g.Zb(7,"ion-input",3),g.hc("ngModelChange",(function(t){return g.rc(e),g.jc().SignIn.name=t})),g.Yb(),g.Yb(),g.Zb(8,"ion-item"),g.Zb(9,"ion-label",2),g.xc(10,"\u5bc6\u7801"),g.Yb(),g.Zb(11,"ion-input",4),g.hc("ngModelChange",(function(t){return g.rc(e),g.jc().SignIn.password=t})),g.Yb(),g.Yb(),g.Zb(12,"ion-item"),g.Zb(13,"ion-buttons",0),g.Zb(14,"ion-button",5),g.hc("click",(function(){return g.rc(e),g.jc().UserSignIn("signin")})),g.xc(15,"\u767b\u5f55"),g.Yb(),g.Zb(16,"ion-button",5),g.hc("click",(function(){return g.rc(e),g.jc().UserSignUp()})),g.xc(17,"\u6ce8\u518c\u65b0\u7528\u6237"),g.Yb(),g.Yb(),g.Zb(18,"ion-buttons",6),g.Zb(19,"ion-button",7),g.hc("click",(function(){return g.rc(e),g.jc().SendPW2Mail()})),g.xc(20,"\u5fd8\u8bb0\u5bc6\u7801"),g.Yb(),g.Yb(),g.Yb(),g.Yb()}if(2&e){const e=g.jc();g.Mb(7),g.oc("ngModel",e.SignIn.name),g.Mb(4),g.oc("ngModel",e.SignIn.password)}}function w(e,t){if(1&e&&(g.Zb(0,"ion-chip"),g.Zb(1,"ion-avatar"),g.Xb(2,"img",8),g.Yb(),g.Zb(3,"ion-text"),g.xc(4),g.Yb(),g.Yb()),2&e){const e=t.$implicit;g.Mb(2),g.oc("src",e.icon,g.tc),g.Mb(2),g.yc(e.name)}}function x(e,t){1&e&&g.Xb(0,"ion-icon",19)}function S(e,t){if(1&e){const e=g.ac();g.Zb(0,"ion-list"),g.Zb(1,"ion-item"),g.Zb(2,"ion-thumbnail",0),g.Xb(3,"ion-img",8),g.Yb(),g.Zb(4,"ion-label",9),g.Zb(5,"ion-text"),g.Zb(6,"h1"),g.xc(7),g.Yb(),g.Yb(),g.Xb(8,"p"),g.wc(9,w,5,2,"ion-chip",10),g.Yb(),g.Yb(),g.Zb(10,"ion-item"),g.Zb(11,"ion-button",11,12),g.hc("readStart",(function(t){return g.rc(e),g.jc().onReadStart(t)}))("filePick",(function(t){return g.rc(e),g.jc().onFilePicked(t)}))("readEnd",(function(t){return g.rc(e),g.jc().onReadEnd(t)})),g.Xb(13,"ion-icon",13),g.xc(14," \u66f4\u6362\u5934\u50cf "),g.Yb(),g.Zb(15,"ion-button",14),g.hc("click",(function(){return g.rc(e),g.jc().ReLoad()})),g.Xb(16,"ion-icon",15),g.xc(17," \u66f4\u65b0\u8d44\u6599 "),g.Yb(),g.Zb(18,"ion-button",14),g.hc("click",(function(){return g.rc(e),g.jc().EditVC()})),g.Xb(19,"ion-icon",16),g.xc(20," \u7f16\u5199\u7b80\u4ecb "),g.Yb(),g.Yb(),g.Zb(21,"ion-item"),g.Zb(22,"ion-label"),g.Zb(23,"ion-button",14),g.hc("click",(function(){return g.rc(e),g.jc().Payment()})),g.xc(24," VIP \u81f3\u5230 "),g.Yb(),g.Yb(),g.Zb(25,"ion-label"),g.Zb(26,"ion-text"),g.xc(27),g.Yb(),g.Yb(),g.Yb(),g.Zb(28,"ion-item"),g.Zb(29,"ion-label"),g.Zb(30,"ion-button",14),g.hc("click",(function(){return g.rc(e),g.jc().SendVerifyEmail()})),g.Xb(31,"ion-icon",17),g.xc(32," \u90ae\u7bb1 "),g.Yb(),g.Yb(),g.Zb(33,"ion-text"),g.xc(34),g.Yb(),g.wc(35,x,1,0,"ion-icon",18),g.Yb(),g.Zb(36,"ion-item"),g.Zb(37,"ion-text"),g.xc(38,"\u4e0a\u6b21\u767b\u5f55\u65f6\u95f4\uff1a"),g.Yb(),g.Zb(39,"ion-note"),g.Zb(40,"small"),g.xc(41),g.Yb(),g.Yb(),g.Yb(),g.Yb()}if(2&e){const e=g.jc();g.Mb(3),g.oc("src",e.Avatar),g.Mb(4),g.yc(e.UserProfile.name),g.Mb(2),g.oc("ngForOf",e.Rolers),g.Mb(2),g.oc("readMode",e.readMode),g.Mb(16),g.zc(" ",e.VIPbis," "),g.Mb(7),g.yc(e.UserProfile.email),g.Mb(1),g.oc("ngIf",e.HasEmail),g.Mb(6),g.yc(e.LastLogin)}}function C(e,t){if(1&e){const e=g.ac();g.Zb(0,"ion-button",5),g.hc("click",(function(){return g.rc(e),g.jc(2).EditMessage()})),g.Xb(1,"ion-icon",24),g.xc(2," \u516c\u5171\u4fe1\u606f "),g.Yb()}}function I(e,t){if(1&e){const e=g.ac();g.Zb(0,"ion-button",5),g.hc("click",(function(){return g.rc(e),g.jc(2).Payment()})),g.Xb(1,"ion-icon",25),g.xc(2," \u8d2d\u4e70VIP "),g.Yb()}}function k(e,t){if(1&e){const e=g.ac();g.Zb(0,"ion-footer"),g.Zb(1,"ion-toolbar"),g.Zb(2,"ion-buttons",0),g.Zb(3,"ion-button",20),g.hc("click",(function(){return g.rc(e),g.jc().LogOut()})),g.Xb(4,"ion-icon",21),g.xc(5," \u9000\u51fa "),g.Yb(),g.wc(6,C,3,0,"ion-button",22),g.wc(7,I,3,0,"ion-button",22),g.Yb(),g.Zb(8,"ion-buttons",6),g.Zb(9,"ion-button",5),g.hc("click",(function(){return g.rc(e),g.jc().ChangePassword()})),g.Xb(10,"ion-icon",23),g.xc(11," \u66f4\u6539\u5bc6\u7801 "),g.Yb(),g.Yb(),g.Yb(),g.Yb()}if(2&e){const e=g.jc();g.Mb(6),g.oc("ngIf",e.IsAdmin),g.Mb(1),g.oc("ngIf",!e.IsAdmin)}}const P=n("mxV5");let U=(()=>{class e{constructor(e,t,n,i,s,o,r){this.settings=e,this.dbservice=t,this.host=n,this.loadingController=i,this.toastController=s,this.alertController=o,this.modalCtrl=r,this.PageModes={SignIn:"signin",SignIned:"signined"},this.SignIn={name:"",password:""},this.mode=this.PageModes.SignIn,this.readMode=l.c.arrayBuffer}ngOnInit(){return Object(c.b)(this,void 0,void 0,(function*(){yield this.settings.WaitInit(),this.mode=this.settings.HasUser?this.PageModes.SignIned:this.PageModes.SignIn,this.mode===this.PageModes.SignIned&&this.ReLoad(!1)}))}get Mode(){return this.mode}set Mode(e){this.mode=e}get UserProfile(){return this.settings.User}get Rolers(){return this.settings.UserRolers(this.settings.User.roller)}get VIPbis(){return new Date(this.settings.User.vip).toChinaStr()}get IsAdmin(){return this.settings.User&&this.settings.User.roller>=256}get HasEmail(){return!!this.settings.User&&!!this.settings.User.email&&!this.settings.User.email.IsNullOrEmpty()}get HasPhone(){return!!this.settings.User&&!!this.settings.User.phone&&!this.settings.User.phone.IsNullOrEmpty()}get Avatar(){const e=this.settings.User;return e.avatar&&!e.avatar.IsNullOrEmpty()?e.avatar:this.settings.Avatar()}get LastLogin(){const e=new Date(this.UserProfile.lastlogin);return`${e.toChinaStr()} ${e.getHours()}:${e.getMinutes()}:${e.getSeconds()}`}Payment(){return Object(c.b)(this,void 0,void 0,(function*(){let e=!1;const t=yield this.alertController.create({header:"\u5ef6\u957fVIP\u65f6\u95f4",inputs:[{name:"3months",type:"radio",label:"3 \u4e2a\u6708",value:3,checked:!1},{name:"6months",type:"radio",label:"\u534a\u5e74",value:6,checked:!1},{name:"12months",type:"radio",label:"\u4e00\u5e74",value:12,checked:!0}],buttons:[{text:"\u786e\u5b9a",handler:()=>{e=!0}},{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary"}]});yield t.present();const{data:n}=yield t.onWillDismiss();if(!1===e)return;const i=yield this.modalCtrl.create({component:y,componentProps:{PaySum:n.values}});yield i.present()}))}onReadStart(e){}onFilePicked(e){return Object(c.b)(this,void 0,void 0,(function*(){const t=Z.Buffer.from(e.content);if(t.length/1024>300)return void this.presentAlert("\u6587\u4ef6\u592a\u5927",null,"\u76ee\u524d\u53ea\u63a5\u53d7\u5c0f\u4e8e 300KB \u7684\u56fe\u7247\u3002");const n=e.name.split("."),i=n[n.length-1].toLowerCase();if(!["jpg","png","jpeg"].includes(i))return void this.presentAlert("\u6587\u4ef6\u683c\u5f0f",null,"\u53ea\u63a5\u53d7 jpg, jpeg, png \u683c\u5f0f\u7684\u56fe\u7247\u3002");yield this.showLoading();const s=this.settings.User;let o="";this.host.GetAliToken(s.id,s.password,"osstoken").then(e=>{const n=`avatar/${s.id}.${i}`;return new P({region:e.region,accessKeyId:e.token.accessKeyId,accessKeySecret:e.token.accessKeySecret,stsToken:e.token.securityToken,bucket:"huaheapp",endpoint:e.endpoint}).put(n,t)}).then(e=>(o=e.url,this.host.UpdateUser(this.UserProfile,{avatar:e.url},!0))).then(e=>{this.settings.User.avatar=o,this.settings.User=this.settings.User,this.presentAlert("\u4e0a\u4f20\u6210\u529f\uff01",null,"\u8bf7\u70b9\u51fb\u66f4\u65b0\u7528\u6237\u8d44\u6599\uff0c\u66f4\u65b0\u5934\u50cf\u94fe\u63a5\u3002")}).catch(e=>{this.presentAlert("\u4e0a\u4f20\u5934\u50cf\u5931\u8d25",null," \u8bf7\u786e\u5b9a\u60a8\u62e5\u6709\u64cd\u4f5c\u6743\u9650\u3002\u8bf7\u91cd\u65b0\u4e0a\u4f20\uff0c\u6216\u7a0d\u540e\u518d\u8bd5\u3002")})}))}onReadEnd(e){this.filePicker.reset()}ChangeUIMode(e){this.SignIn.name="",this.SignIn.password="",this.mode=e}LogOut(){this.ChangeUIMode(this.PageModes.SignIn),this.settings.User=null,this.dbservice.ReloadBooks()}UserSignIn(e){return Object(c.b)(this,void 0,void 0,(function*(){this.SignIn.name.IsNullOrEmpty()||this.SignIn.password.IsNullOrEmpty()?this.presentAlert(null,null,"\u7528\u6237\u540d\u548c\u5bc6\u7801\u4e0d\u80fd\u4e3a\u7a7a"):(yield this.showLoading(),this.host.SignIn(this.SignIn.name,this.SignIn.password).then(e=>{this.settings.User=e,this.ChangeUIMode(this.PageModes.SignIned)}).catch(e=>{this.presentAlert("\u767b\u5f55\u5931\u8d25",null,e)}).finally(()=>{this.closeLoading()}))}))}UserSignUp(){return Object(c.b)(this,void 0,void 0,(function*(){yield this.showLoading(),this.host.SignUp(this.SignIn.name,this.SignIn.password).then(e=>{this.settings.User=e,this.ChangeUIMode(this.PageModes.SignIned)}).catch(e=>{this.presentAlert("\u6ce8\u518c\u5931\u8d25",null,e)}).finally(()=>{this.closeLoading()})}))}ReLoad(e=!0){return Object(c.b)(this,void 0,void 0,(function*(){const t=this.settings.User;e&&(yield this.showLoading()),this.host.SignIn(t.id,t.password).then(e=>{e?this.settings.User=e:this.presentAlert(null,null,"\u627e\u4e0d\u5230\u60a8\u7684\u7528\u6237\u8d44\u6599\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u3002")}).catch(e=>{this.presentAlert(null,null,e.toString())}).finally(()=>{this.closeLoading()})}))}SendVerifyEmail(){return Object(c.b)(this,void 0,void 0,(function*(){let e=!1;const t=yield this.alertController.create({header:"\u6ce8\u518c\u90ae\u7bb1",inputs:[{name:"keymail",type:"email",label:"Key",placeholder:"\u586b\u5199\u90ae\u7bb1\u5730\u5740"}],buttons:[{text:"\u53d1\u9001",handler:()=>{e=!0}},{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary"}]});yield t.present();const{data:n}=yield t.onWillDismiss(),i=n.values.keymail;!1!==e&&(!1!==this.validateEmail(i)?(yield this.showLoading(),this.host.VerifyEmail(this.UserProfile.id,this.UserProfile.password,i).then(e=>{this.presentAlert("\u6ce8\u518c\u90ae\u7bb1",null,e)}).catch(()=>{this.presentAlert("\u90ae\u4ef6\u9a8c\u8bc1\u5931\u8d25",null,"\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002")})):this.presentAlert("\u9519\u8bef","\u90ae\u7bb1","\u8bf7\u8f93\u5165\u6709\u6548\u7684\u90ae\u7bb1\u5730\u5740\u3002"))}))}ChangePassword(){return Object(c.b)(this,void 0,void 0,(function*(){let e=!1;const t=yield this.alertController.create({header:"\u66f4\u6539\u5bc6\u7801",inputs:[{name:"pwo",type:"password",placeholder:"\u8bf7\u8f93\u5165\u65e7\u5bc6\u7801"},{name:"pw1",type:"password",placeholder:"\u8bf7\u8f93\u5165\u65b0\u5bc6\u7801"},{name:"pw2",type:"password",placeholder:"\u8bf7\u91cd\u590d\u65b0\u5bc6\u7801"}],buttons:[{text:"\u66f4\u6539",handler:()=>{e=!0}},{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary"}]});yield t.present();const{data:n}=yield t.onWillDismiss();!1!==e&&(n.values.pwo===this.settings.User.password?n.values.pw1===n.values.pw2?/^[\S]{4,20}$/i.test(n.values.pw1)?(yield this.showLoading(),this.host.UpdateUser(this.UserProfile,{password:n.values.pw1},!0).then(e=>{this.UserProfile.password=n.values.pw1,this.settings.User=this.UserProfile,this.presentAlert("\u4fee\u6539\u5bc6\u7801",null,"\u4fee\u6539\u5bc6\u7801\u6210\u529f\uff01")}).catch(e=>{this.presentAlert("\u4fee\u6539\u5bc6\u7801\u5931\u8d25",null,JSON.stringify(e))})):this.presentAlert("\u9519\u8bef","\u4fee\u6539\u5bc6\u7801","\u5bc6\u7801\u4e0d\u7b26\u5408\u8981\u6c42\u3002"):this.presentAlert("\u9519\u8bef","\u4fee\u6539\u5bc6\u7801","\u4e24\u6b21\u5bc6\u7801\u4e0d\u4e00\u81f4\uff0c\u8bf7\u91cd\u65b0\u786e\u8ba4\u3002"):this.presentAlert("\u9519\u8bef","\u4fee\u6539\u5bc6\u7801","\u60a8\u8f93\u5165\u7684\u65e7\u5bc6\u7801\u6709\u8bef\u3002"))}))}SendPW2Mail(){return Object(c.b)(this,void 0,void 0,(function*(){let e=!1;const t=yield this.alertController.create({header:"\u5fd8\u8bb0\u5bc6\u7801",inputs:[{name:"name",type:"text",label:"name",placeholder:"\u7528\u6237\u540d"},{name:"mail",type:"text",label:"mail",placeholder:"\u90ae\u7bb1"}],buttons:[{text:"\u53d1\u9001",handler:()=>{e=!0}},{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary"}]});yield t.present();const{data:n}=yield t.onWillDismiss();!1!==e&&(yield this.showLoading(),this.host.SendPW2Email(n.values.name,n.values.mail).then(e=>{e.statue?this.presentAlert("\u4fe1\u606f","\u83b7\u53d6\u5bc6\u7801",e.statue):this.presentAlert("\u5931\u8d25","\u83b7\u53d6\u5bc6\u7801\u5931\u8d25",e.error)}).catch(e=>{this.presentAlert("\u5931\u8d25","\u83b7\u53d6\u5bc6\u7801\u5931\u8d25",e.toString())}))}))}EditVC(){return Object(c.b)(this,void 0,void 0,(function*(){const e=yield this.modalCtrl.create({component:m,componentProps:{}});yield e.present();const{data:t}=yield e.onWillDismiss();console.log(t)}))}EditMessage(){return Object(c.b)(this,void 0,void 0,(function*(){const e={id:Object(Y.b)(),created:Date.now(),valid:0,author:this.settings.User.id,receiver:null,roller:1,readed:!1,private:!1,replyable:!1,title:"\u3002\u3002\u3002\u4f60\u597d\uff01",content:""},t=yield this.modalCtrl.create({component:f.a,componentProps:{Message:e}});yield t.present(),yield t.onWillDismiss()}))}presentAlert(e,t,n){return Object(c.b)(this,void 0,void 0,(function*(){yield this.closeLoading();const i=yield this.alertController.create({header:e||"\u9519\u8bef",subHeader:t||"",message:n,buttons:["\u786e\u5b9a"]});yield i.present()}))}showLoading(){return Object(c.b)(this,void 0,void 0,(function*(){this.loadingView||(this.loadingView=yield this.loadingController.create({message:"\u6b63\u5728\u4f20\u8f93\u6570\u636e...",duration:6e5})),yield this.loadingView.present()}))}closeLoading(){return Object(c.b)(this,void 0,void 0,(function*(){this.loadingView&&(yield this.loadingView.dismiss(),this.loadingView=null)}))}validateEmail(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test((e||"").toLowerCase())}}return e.\u0275fac=function(t){return new(t||e)(g.Wb(a.a),g.Wb(d.a),g.Wb(b.a),g.Wb(r.bb),g.Wb(r.jb),g.Wb(r.b),g.Wb(r.cb))},e.\u0275cmp=g.Qb({type:e,selectors:[["app-userprofil"]],viewQuery:function(e,t){var n;1&e&&g.Ac(v,!0),2&e&&g.qc(n=g.ic())&&(t.filePicker=n.first)},decls:10,vars:3,consts:[["slot","start"],[4,"ngIf"],["position","stacked"],[3,"ngModel","ngModelChange"],["type","password",3,"ngModel","ngModelChange"],[3,"click"],["slot","end"],["slot","end",3,"click"],[3,"src"],[1,"ion-text-wrap"],[4,"ngFor","ngForOf"],["ngxFilePicker","","fill","outline",3,"readMode","readStart","filePick","readEnd"],["filePicker","ngxFilePicker"],["name","contact"],["fill","outline",3,"click"],["name","ios-repeat"],["name","card"],["name","mail"],["name","checkmark",4,"ngIf"],["name","checkmark"],["size","small",3,"click"],["name","exit"],[3,"click",4,"ngIf"],["name","key"],["name","send"],["name","cash"]],template:function(e,t){1&e&&(g.Zb(0,"ion-header"),g.Zb(1,"ion-toolbar"),g.Zb(2,"ion-buttons",0),g.Xb(3,"ion-menu-button"),g.Yb(),g.Zb(4,"ion-title"),g.xc(5,"\u7528\u6237"),g.Yb(),g.Yb(),g.Yb(),g.Zb(6,"ion-content"),g.wc(7,M,21,2,"ion-list",1),g.wc(8,S,42,8,"ion-list",1),g.Yb(),g.wc(9,k,12,2,"ion-footer",1)),2&e&&(g.Mb(7),g.oc("ngIf",t.Mode===t.PageModes.SignIn),g.Mb(1),g.oc("ngIf",t.Mode===t.PageModes.SignIned),g.Mb(1),g.oc("ngIf",t.Mode===t.PageModes.SignIned))},directives:[r.s,r.Y,r.k,r.G,r.W,r.o,i.j,r.D,r.E,r.C,r.w,r.v,r.ib,s.c,s.d,r.j,r.V,r.u,r.T,i.i,l.a,r.t,r.I,r.m,r.f,r.q],styles:[""]}),e})();n.d(t,"UserprofilPageModule",(function(){return A}));const j=[{path:"",component:U}];let A=(()=>{class e{}return e.\u0275mod=g.Ub({type:e}),e.\u0275inj=g.Tb({factory:function(t){return new(t||e)},imports:[[p.b,i.b,s.a,r.Z,l.b,o.i.forChild(j)]]}),e})()}}]);