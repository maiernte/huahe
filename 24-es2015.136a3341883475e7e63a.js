(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{CGrG:function(e,t,n){"use strict";n.d(t,"a",(function(){return l})),n.d(t,"c",(function(){return o})),n.d(t,"b",(function(){return a}));var i=n("mrSG"),r=n("fXoL");const o=function(){var e={arrayBuffer:0,binaryString:1,dataURL:2,text:3};return e[e.arrayBuffer]="arrayBuffer",e[e.binaryString]="binaryString",e[e.dataURL]="dataURL",e[e.text]="text",e}();class s{constructor(e,t,n){this._underlyingFile=e,this._readMode=t,this._content=n}get name(){return this._underlyingFile.name}get size(){return this._underlyingFile.size}get type(){return this._underlyingFile.type}get readMode(){return this._readMode}get content(){return this._content}get underlyingFile(){return this._underlyingFile}}let c=(()=>{class e{constructor(){this.filter=()=>!0,this.readStart=new r.s,this.readEnd=new r.s}readFiles(e,t){return Object(i.b)(this,void 0,void 0,(function*(){const n=Array.from(e).filter(this.filter),r=n.length;this.readStart.emit(r),yield Promise.all(n.map(e=>Object(i.b)(this,void 0,void 0,(function*(){const n=yield function(e,t){return Object(i.b)(this,void 0,void 0,(function*(){return new Promise((n,i)=>{const r=new FileReader;switch(r.onload=i=>{const r=new s(e,t,i.target.result);n(r)},r.onerror=e=>{i(e)},t){case o.arrayBuffer:r.readAsArrayBuffer(e);break;case o.binaryString:r.readAsBinaryString(e);break;case o.text:r.readAsText(e);break;case o.dataURL:default:r.readAsDataURL(e)}})}))}(e,this.readMode);t(n)})))),this.readEnd.emit(r)}))}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=r.Rb({type:e,inputs:{filter:"filter",readMode:"readMode"},outputs:{readStart:"readStart",readEnd:"readEnd"}}),e})(),l=(()=>{class e extends c{constructor(e,t){super(),this.el=e,this.renderer=t,this.accept="",this.filePick=new r.s}get multiple(){return this._multiple}set multiple(e){this._multiple=function(e){return null!=e&&"false"!==`${e}`}(e)}ngOnInit(){this._input=this.renderer.createElement("input"),this.renderer.appendChild(this.el.nativeElement,this._input),this.renderer.setAttribute(this._input,"type","file"),this.renderer.setAttribute(this._input,"accept",this.accept),this.renderer.setStyle(this._input,"display","none"),this.multiple&&this.renderer.setAttribute(this._input,"multiple","multiple"),this.renderer.listen(this._input,"change",e=>this._onListen(e))}reset(){this._input?this._input.value=null:console.error("It seems that ngOnInit() has not been executed or that the hidden _input element is null. Did you mess with the DOM?")}browse(){this._input?this._input.click():console.error("It seems that ngOnInit() has not been executed or that the hidden _input element is null. Did you mess with the DOM?")}_onListen(e){this.readFiles(e.target.files,e=>this.filePick.emit(e))}}return e.\u0275fac=function(t){return new(t||e)(r.Wb(r.q),r.Wb(r.M))},e.\u0275dir=r.Rb({type:e,selectors:[["","ngxFilePicker",""]],hostBindings:function(e,t){1&e&&r.hc("click",(function(){return t.browse()}))},inputs:{accept:"accept",multiple:"multiple"},outputs:{filePick:"filePick"},exportAs:["ngxFilePicker"],features:[r.Jb]}),e})(),a=(()=>{class e{}return e.\u0275mod=r.Ub({type:e}),e.\u0275inj=r.Tb({factory:function(t){return new(t||e)},imports:[[]]}),e})()},Iab2:function(e,t,n){var i,r;void 0===(r="function"==typeof(i=function(){"use strict";function t(e,t,n){var i=new XMLHttpRequest;i.open("GET",e),i.responseType="blob",i.onload=function(){o(i.response,t,n)},i.onerror=function(){console.error("could not download file")},i.send()}function n(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function i(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(t){var n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(n)}}var r="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0,o=r.saveAs||("object"!=typeof window||window!==r?function(){}:"download"in HTMLAnchorElement.prototype?function(e,o,s){var c=r.URL||r.webkitURL,l=document.createElement("a");l.download=o=o||e.name||"download",l.rel="noopener","string"==typeof e?(l.href=e,l.origin===location.origin?i(l):n(l.href)?t(e,o,s):i(l,l.target="_blank")):(l.href=c.createObjectURL(e),setTimeout((function(){c.revokeObjectURL(l.href)}),4e4),setTimeout((function(){i(l)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,r,o){if(r=r||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(function(e,t){return void 0===t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}(e,o),r);else if(n(e))t(e,r,o);else{var s=document.createElement("a");s.href=e,s.target="_blank",setTimeout((function(){i(s)}))}}:function(e,n,i,o){if((o=o||open("","_blank"))&&(o.document.title=o.document.body.innerText="downloading..."),"string"==typeof e)return t(e,n,i);var s="application/octet-stream"===e.type,c=/constructor/i.test(r.HTMLElement)||r.safari,l=/CriOS\/[\d]+/.test(navigator.userAgent);if((l||s&&c)&&"object"==typeof FileReader){var a=new FileReader;a.onloadend=function(){var e=a.result;e=l?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),o?o.location.href=e:location=e,o=null},a.readAsDataURL(e)}else{var d=r.URL||r.webkitURL,u=d.createObjectURL(e);o?o.location=u:location.href=u,o=null,setTimeout((function(){d.revokeObjectURL(u)}),4e4)}});r.saveAs=o.saveAs=o,e.exports=o})?i.apply(t,[]):i)||(e.exports=r)},hBK9:function(e,t,n){"use strict";n.r(t);var i=n("ofXK"),r=n("3Pt+"),o=n("tyNb"),s=n("c7TG"),c=n("mrSG"),l=n("CGrG"),a=n("LTmD"),d=n("B8lH"),u=n("L99X"),h=n("lEof"),b=n("Iab2"),p=n("fXoL"),f=n("tk/3");const g=["filePicker"];function y(e,t){if(1&e){const e=p.ac();p.Zb(0,"ion-button",7),p.hc("click",(function(){return p.rc(e),p.jc().ChangeNode()})),p.xc(1,"\u4fee\u6539\u8bb0\u5f55"),p.Yb()}}function m(e,t){if(1&e){const e=p.ac();p.Zb(0,"ion-item"),p.Zb(1,"ion-button",7),p.hc("click",(function(){return p.rc(e),p.jc().ShowRecord()})),p.xc(2,"\u67e5\u770b\uff0f\u5220\u9664"),p.Yb(),p.Yb()}}const v=n("NFKh");let w=(()=>{class e{constructor(e,t,n,i,r,o){this.settings=e,this.dbservice=t,this.host=n,this.alertController=i,this.modalController=r,this.http=o,this.readMode=l.c.text,this.webapp="",this.document="",this.server="",this.encryp="false"}ngOnInit(){return Object(c.b)(this,void 0,void 0,(function*(){yield this.settings.WaitInit(),this.encryp=this.settings.HasUser&&this.settings.Encryp?"true":"false"}))}get Version(){return`Beta ${this.settings.AppConfig.app.version} (\u6d4b\u8bd5\u7248)`}get HasUser(){return this.settings.HasUser}get Product(){return a.a.Product}get Encryp(){return this.encryp}set Encryp(e){console.log("val",e,typeof e),this.encryp=e,this.settings.Encryp="true"===e,console.log("Encryp",this.settings.Encryp,typeof this.settings.Encryp)}CleanMemory(e){return Object(c.b)(this,void 0,void 0,(function*(){const t=yield this.alertController.create({header:"\u6e05\u7a7a\u7f13\u5b58",message:"\u53ea\u6e05\u7a7a\u672c\u5730\u7684\u7528\u6237\u6570\u636e\u3002\u53ef\u91cd\u65b0\u4e0b\u8f7d\u5728\u670d\u52a1\u5668\u4fdd\u5b58\u7684\u7528\u6237\u6570\u636e\u548c\u6848\u4f8b\u3002",buttons:[{text:"\u786e\u5b9a",handler:()=>{this.settings.ResetDB(e).then(e=>{this.dbservice.ReloadBooks()})}},{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary",handler:()=>{}}]});yield t.present()}))}CleanCloud(){return Object(c.b)(this,void 0,void 0,(function*(){let e=!0;const t=yield this.alertController.create({header:"\u6e05\u7a7a\u4e91\u7aef\u6570\u636e",message:"\u7528\u6237\u4fdd\u5b58\u5728\u4e91\u7aef\u7684\u6570\u636e\u3002\u672c\u5730\u6570\u636e\u4ecd\u7136\u4fdd\u7559\u3002",buttons:[{text:"\u786e\u5b9a",handler:()=>{e=!1}},{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary",handler:()=>{}}]});if(yield t.present(),yield t.onWillDismiss(),!0===e)return;const n=this.settings.User;yield this.host.CleanUserRecord(n.id,n.password),this.presentAlert("\u6e05\u7a7a\u4e91\u7aef\u6570\u636e",null,"\u60a8\u7684\u4e91\u7aef\u6570\u636e\u5df2\u7ecf\u88ab\u6e05\u7a7a\u3002")}))}onReadStart(e){}onFilePicked(e){try{const t=JSON.parse(e.content);if(null==t.encryp||!t.tree)throw new Error("data corrubt.");{let e,n;if(!0===t.encryp){const i=this.settings.HasUser?this.settings.User.encryp:"";e=this.DecrypData(t.tree,i),n=this.DecrypData(t.books,i)}else e=t.tree,n=t.books;const i=Array.isArray(e)&&Array.isArray(n);console.log(e),console.log(n),i&&this.ApplyImport(e,n)}}catch(t){console.log(t),this.presentAlert("\u683c\u5f0f\u9519\u8bef",null,"\u65e0\u6cd5\u8bfb\u53d6\u5bfc\u5165\u7684\u6570\u636e\u6587\u4ef6\u3002")}}onReadEnd(e){this.filePicker.reset()}ApplyImport(e,t){return Object(c.b)(this,void 0,void 0,(function*(){let n=!0;const i=yield this.alertController.create({header:"\u5bfc\u5165\u6570\u636e\u5e93",subHeader:"\u63d0\u9192\u5907\u4efd",message:"\u6b64\u64cd\u4f5c\u5c06\u4f1a\u7528\u5bfc\u5165\u6587\u4ef6\u4e2d\u7684\u6570\u636e\uff0c\u66ff\u6362\u6389\u60a8\u8f6f\u4ef6\u4e2d\u7684\u6240\u6709\u8bb0\u5f55\u3002\u4e3a\u4e86\u6570\u636e\u5b89\u5168\uff0c\u5efa\u8bae\u60a8\u5148\u5c06\u672c\u5730\u6570\u636e\u4e0a\u4f20\u5230\u4e91\u7aef\u3002\u8bef\u64cd\u4f5c\u540e\u4e5f\u53ef\u4ee5\u91cd\u65b0\u4ece\u4e91\u7aef\u4e0b\u8f7d\u6570\u636e\u3002",buttons:[{text:"\u786e\u5b9a",handler:()=>{n=!1}},{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary",handler:()=>{}}]});yield i.present(),yield i.onWillDismiss(),!0!==n&&(yield this.settings.ResetDB("recordes"),console.log("clean db"),yield this.dbservice.SaveNodes(e),console.log("save tree"),t.forEach(e=>{this.dbservice.SaveRecordes(e.nodeid,e.content),console.log(`save record ${e.nodeid}`)}))}))}UpdateServer(){this.http.get("https://huaheapp.oss-cn-hangzhou.aliyuncs.com/app/huahe.config.json").subscribe(e=>{const t=e;console.log("new conf",t),console.log("current",this.settings.AppConfig),this.document=t.document,this.webapp=t.website,t.servers.filter(e=>e.version===this.settings.AppConfig.app.version)?console.log("Found Server!!!!!!!!!!!!"):console.log("not found Server!!!!")},e=>{console.log("err",e)})}SettingConfig(e){return Object(c.b)(this,void 0,void 0,(function*(){const t=yield this.modalController.create({component:d.a,componentProps:{SettingComponent:e,Global:!0,OnlyGlobal:!0,Config:"bazi"===e?Object(a.b)(this.settings.Bazi):Object(a.b)(this.settings.Gua)}});yield t.present();const{data:n}=yield t.onWillDismiss();console.log(n)}))}ShowRecord(){return Object(c.b)(this,void 0,void 0,(function*(){let e=!0;const t=yield this.alertController.create({header:"Show Record",inputs:[{name:"keyid",type:"text",label:"Key",value:"*",placeholder:"enter key"}],buttons:[{text:"\u5220\u9664",role:"destructive",handler:()=>{e=!1}},{text:"\u67e5\u770b",role:"cancel",cssClass:"secondary",handler:()=>{}}]});yield t.present();const{data:n}=yield t.onWillDismiss();if(!n)return;const i=n.values.keyid;e?this.settings.ShowData(i.trim()):this.settings.ResetDB(i.trim())}))}Ticket(){var e,t;return Object(c.b)(this,void 0,void 0,(function*(){let n=!0;const i=this.settings.User,r=yield this.alertController.create({header:"\u62a5\u544a\u95ee\u9898",inputs:[{name:"user",type:"text",label:"\u7528\u6237\u540d",value:null===(e=i)||void 0===e?void 0:e.id,placeholder:"\u7528\u6237\u540d"},{name:"mail",type:"text",label:"\u6ce8\u518c\u90ae\u7bb1",value:null===(t=i)||void 0===t?void 0:t.email,placeholder:"user@mail.com"},{name:"titel",type:"text",label:"\u95ee\u9898",placeholder:"\u4f60\u7684\u95ee\u9898\uff0f\u610f\u89c1"},{name:"comment",type:"text",label:"\u5907\u6ce8",placeholder:"\u5907\u6ce8"}],buttons:[{text:"\u53d1\u9001",handler:()=>{n=!1}},{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary",handler:()=>{}}]});yield r.present();const{data:o}=yield r.onWillDismiss();console.log(o),o&&o.values&&(o.values.user?o.values.mail?o.values.titel?n||this.host.SendTicket(o.values):this.presentAlert("\u8868\u5355\u9519\u8bef","\u95ee\u9898","\u8bf7\u8f93\u5165\u60a8\u7684\u95ee\u9898\u3002"):this.presentAlert("\u8868\u5355\u9519\u8bef","\u6ce8\u518c\u90ae\u7bb1","\u8bf7\u8f93\u5165\u60a8\u7684\u6ce8\u518c\u90ae\u7bb1, \u5426\u5219\u6211\u4eec\u65e0\u6cd5\u56de\u590d\u3002"):this.presentAlert("\u8868\u5355\u9519\u8bef","\u7528\u6237\u540d","\u8bf7\u8f93\u5165\u60a8\u7684\u7528\u6237\u540d, \u5426\u5219\u6211\u4eec\u65e0\u6cd5\u6838\u5b9e\u8d44\u6599\u3002"))}))}ExportDB(){return Object(c.b)(this,void 0,void 0,(function*(){const e=this.settings.Encryp?this.settings.User.encryp:"",t=yield this.dbservice.Export(e),n=new Blob([JSON.stringify(t)],{type:"text/plain;charset=utf-8"});Object(b.saveAs)(n,"huaheapp.json")}))}ChangeNode(){this.dbservice.NodesAlle.forEach(e=>{console.log(`change node ${e.id}  ${e.name}`),e.version=e.version?e.version:0,e.dirty=!0,delete e.sync}),console.log("update nodes finished."),this.dbservice.SaveNodes()}presentAlert(e,t,n){return Object(c.b)(this,void 0,void 0,(function*(){const i=yield this.alertController.create({header:e||"\u9519\u8bef",subHeader:t||"",message:n,buttons:["\u786e\u5b9a"]});yield i.present()}))}DecrypData(e,t){try{const n=v.AES.decrypt(e,t).toString(v.enc.Utf8);return JSON.parse(n)}catch(n){throw new Error("\u6587\u4ef6\u5df2\u635f\u574f\uff0c\u6216\u52a0\u5bc6\u53e3\u4ee4\u4e0d\u6b63\u786e\uff0c\u65e0\u6cd5\u6253\u5f00\u6587\u4ef6\u3002")}}}return e.\u0275fac=function(t){return new(t||e)(p.Wb(a.a),p.Wb(u.a),p.Wb(h.a),p.Wb(s.b),p.Wb(s.cb),p.Wb(f.a))},e.\u0275cmp=p.Qb({type:e,selectors:[["app-setting"]],viewQuery:function(e,t){var n;1&e&&p.Ac(g,!0),2&e&&p.qc(n=p.ic())&&(t.filePicker=n.first)},decls:49,vars:8,consts:[["slot","start"],["ngxFilePicker","","fill","outline",3,"readMode","readStart","filePick","readEnd"],["filePicker","ngxFilePicker"],[3,"click"],[3,"ngModel","disabled","ngModelChange"],["value","true"],["value","false","checked",""],["fill","outline",3,"click"],["slot","end"],[3,"href"],["fill","outline",3,"click",4,"ngIf"],["color","danger","fill","outline",3,"click"],[4,"ngIf"]],template:function(e,t){1&e&&(p.Zb(0,"ion-header"),p.Zb(1,"ion-toolbar"),p.Zb(2,"ion-buttons",0),p.Xb(3,"ion-menu-button"),p.Yb(),p.Zb(4,"ion-title"),p.xc(5,"\u8bbe\u7f6e"),p.Yb(),p.Yb(),p.Yb(),p.Zb(6,"ion-content"),p.Zb(7,"ion-item"),p.Zb(8,"ion-button",1,2),p.hc("readStart",(function(e){return t.onReadStart(e)}))("filePick",(function(e){return t.onFilePicked(e)}))("readEnd",(function(e){return t.onReadEnd(e)})),p.xc(10,"\u5bfc\u5165\u6848\u4f8b"),p.Yb(),p.Zb(11,"ion-button",3),p.hc("click",(function(){return t.ExportDB()})),p.xc(12,"\u5bfc\u51fa\u6848\u4f8b"),p.Yb(),p.Yb(),p.Zb(13,"ion-item"),p.Zb(14,"ion-segment",4),p.hc("ngModelChange",(function(e){return t.Encryp=e})),p.Zb(15,"ion-segment-button",5),p.xc(16,"\u4f7f\u7528\u6570\u636e\u52a0\u5bc6"),p.Yb(),p.Zb(17,"ion-segment-button",6),p.xc(18,"\u4e0d\u4f7f\u7528\u52a0\u5bc6"),p.Yb(),p.Yb(),p.Yb(),p.Zb(19,"ion-item"),p.Zb(20,"ion-button",7),p.hc("click",(function(){return t.UpdateServer()})),p.xc(21,"\u66f4\u65b0\u670d\u52a1\u5730\u5740"),p.Yb(),p.Zb(22,"ion-buttons",8),p.Zb(23,"ion-button",9),p.xc(24,"\u7f51\u9875\u7248APP"),p.Yb(),p.Zb(25,"ion-button",9),p.xc(26,"\u5728\u7ebf\u6587\u6863"),p.Yb(),p.Yb(),p.Yb(),p.Zb(27,"ion-item"),p.Zb(28,"ion-buttons"),p.Zb(29,"ion-button",3),p.hc("click",(function(){return t.SettingConfig("gua")})),p.xc(30,"\u516d\u723b\u5168\u5c40\u8bbe\u7f6e"),p.Yb(),p.Zb(31,"ion-button",3),p.hc("click",(function(){return t.SettingConfig("bazi")})),p.xc(32,"\u516b\u5b57\u5168\u5c40\u8bbe\u7f6e"),p.Yb(),p.Yb(),p.Yb(),p.Zb(33,"ion-item"),p.Zb(34,"ion-button",7),p.hc("click",(function(){return t.Ticket()})),p.xc(35,"\u62a5\u544a\u95ee\u9898"),p.Yb(),p.wc(36,y,2,0,"ion-button",10),p.Yb(),p.Zb(37,"ion-item"),p.Zb(38,"ion-button",11),p.hc("click",(function(){return t.CleanMemory("recordes")})),p.xc(39,"\u6e05\u7a7a\u672c\u5730\u6848\u4f8b"),p.Yb(),p.Zb(40,"ion-button",11),p.hc("click",(function(){return t.CleanMemory("all")})),p.xc(41,"\u6e05\u7a7a\u7528\u6237\u6570\u636e"),p.Yb(),p.Zb(42,"ion-button",11),p.hc("click",(function(){return t.CleanCloud()})),p.xc(43,"\u6e05\u7a7a\u4e91\u7aef\u6570\u636e"),p.Yb(),p.Yb(),p.wc(44,m,3,0,"ion-item",12),p.Zb(45,"ion-item"),p.Zb(46,"ion-label"),p.Zb(47,"ion-text"),p.xc(48),p.Yb(),p.Yb(),p.Yb(),p.Yb()),2&e&&(p.Mb(8),p.oc("readMode",t.readMode),p.Mb(6),p.oc("ngModel",t.Encryp)("disabled",!t.HasUser),p.Mb(9),p.oc("href",t.webapp),p.Mb(2),p.oc("href",t.document),p.Mb(11),p.oc("ngIf",!t.Product),p.Mb(8),p.oc("ngIf",!t.Product),p.Mb(4),p.zc("\u7248\u672c\u4fe1\u606f\uff1a",t.Version,""))},directives:[s.s,s.Y,s.k,s.G,s.W,s.o,s.w,s.j,l.a,s.N,s.hb,r.c,r.d,s.O,i.j,s.C,s.T],styles:[".spin[_ngcontent-%COMP%]{position:fixed;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}ion-spinner[_ngcontent-%COMP%]{width:50px;height:50px;stroke:#444;fill:#222}"]}),e})();var x=n("KPWP");n.d(t,"SettingPageModule",(function(){return S}));const k=[{path:"",component:w}];let S=(()=>{class e{}return e.\u0275mod=p.Ub({type:e}),e.\u0275inj=p.Tb({factory:function(t){return new(t||e)},imports:[[i.b,r.a,s.Z,l.b,x.a,o.i.forChild(k)]]}),e})()}}]);