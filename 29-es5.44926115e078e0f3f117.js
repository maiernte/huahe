function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{qNzN:function(t,e,n){"use strict";n.r(e);var i=n("ofXK"),o=n("3Pt+"),r=n("tyNb"),a=n("c7TG"),c=n("mrSG"),s=n("LTmD"),u=n("lEof"),b=n("PKx9"),l=n("HQI1"),f=n("8/yo"),d=n("G6JS"),h=(n("Y6BA"),n("fXoL"));function g(t,e){if(1&t){var n=h.ac();h.Zb(0,"ion-buttons",7),h.Zb(1,"ion-button",14),h.hc("click",(function(){return h.rc(n),h.jc().EditTopic(null)})),h.Xb(2,"ion-icon",15),h.Zb(3,"ion-text"),h.xc(4,"\u65b0\u8d34"),h.Yb(),h.Yb(),h.Yb()}}function m(t,e){if(1&t){var n=h.ac();h.Zb(0,"ion-button",20),h.hc("click",(function(){return h.rc(n),h.jc(2).JinghuaTopics(-2,!0)})),h.xc(1," [\u7cbe\u534e] "),h.Yb()}}function p(t,e){if(1&t){var n=h.ac();h.Zb(0,"ion-button",17),h.hc("click",(function(){return h.rc(n),h.jc(2).JinghuaTopics(0,!0)})),h.xc(1," [\u9996\u9875] "),h.Yb()}}function v(t,e){if(1&t){var n=h.ac();h.Zb(0,"ion-item-divider",16),h.Zb(1,"ion-label",1),h.Zb(2,"ion-text"),h.xc(3,"\u7248\u4e3b\uff1a"),h.Yb(),h.Yb(),h.Zb(4,"ion-buttons",1),h.Zb(5,"ion-button",17),h.hc("click",(function(){h.rc(n);var t=h.jc();return t.ShowUserInfo(t.Admin)})),h.xc(6),h.Yb(),h.Yb(),h.Zb(7,"ion-buttons",7),h.wc(8,m,2,0,"ion-button",18),h.wc(9,p,2,0,"ion-button",19),h.Yb(),h.Yb()}if(2&t){var i=h.jc();h.Mb(6),h.yc(i.Admin),h.Mb(2),h.oc("ngIf",0===i.PageType),h.Mb(1),h.oc("ngIf",-2===i.PageType)}}function x(t,e){if(1&t){var n=h.ac();h.Zb(0,"ion-item",21),h.hc("click",(function(){h.rc(n);var t=e.$implicit;return h.jc().Navi2Topic(t)})),h.Zb(1,"ion-thumbnail",1),h.Xb(2,"img",22),h.Yb(),h.Zb(3,"ion-label",23),h.Zb(4,"ion-text"),h.xc(5),h.Yb(),h.Zb(6,"ion-text",24),h.xc(7,"[\u7f6e\u9876]"),h.Yb(),h.Xb(8,"br"),h.Zb(9,"ion-note"),h.xc(10),h.Yb(),h.Xb(11,"br"),h.Zb(12,"ion-note"),h.Zb(13,"small"),h.xc(14),h.Yb(),h.Yb(),h.Xb(15,"br"),h.Zb(16,"ion-note"),h.Zb(17,"small"),h.xc(18),h.Yb(),h.Yb(),h.Xb(19,"br"),h.Zb(20,"ion-note"),h.Zb(21,"small"),h.xc(22),h.Yb(),h.Yb(),h.Zb(23,"ion-note"),h.Zb(24,"small"),h.xc(25),h.Yb(),h.Yb(),h.Yb(),h.Yb()}if(2&t){var i=e.$implicit,o=h.jc();h.Mb(2),h.oc("src",i.avatar,h.tc),h.Mb(3),h.yc(i.title),h.Mb(5),h.zc("\u4f5c\u8005\uff1a[",i.author,"]"),h.Mb(4),h.zc("\u53d1\u5e16\u65f6\u95f4: ",o.DateText(i.created),""),h.Mb(4),h.zc("\u56de\u5e16\u65f6\u95f4: ",o.DateText(i.update),""),h.Mb(4),h.zc("\u56de\u5e16\u6570\u91cf: ",i.child,""),h.Mb(3),h.zc("\u6d4f\u89c8\u6570\u91cf: ",i.view,"")}}function T(t,e){1&t&&(h.Zb(0,"ion-text",24),h.xc(1,"[\u7cbe\u534e]"),h.Yb())}function w(t,e){if(1&t){var n=h.ac();h.Zb(0,"ion-item",21),h.hc("click",(function(){h.rc(n);var t=e.$implicit;return h.jc().Navi2Topic(t)})),h.Zb(1,"ion-thumbnail",1),h.Xb(2,"img",22),h.Yb(),h.Zb(3,"ion-label",23),h.Zb(4,"ion-text"),h.xc(5),h.Yb(),h.wc(6,T,2,0,"ion-text",25),h.Xb(7,"br"),h.Zb(8,"ion-note"),h.xc(9),h.Yb(),h.Xb(10,"br"),h.Zb(11,"ion-note"),h.Zb(12,"small"),h.xc(13),h.Yb(),h.Yb(),h.Xb(14,"br"),h.Zb(15,"ion-note"),h.Zb(16,"small"),h.xc(17),h.Yb(),h.Yb(),h.Xb(18,"br"),h.Zb(19,"ion-note"),h.Zb(20,"small"),h.xc(21),h.Yb(),h.Yb(),h.Zb(22,"ion-note"),h.Zb(23,"small"),h.xc(24),h.Yb(),h.Yb(),h.Yb(),h.Yb()}if(2&t){var i=e.$implicit,o=h.jc();h.Mb(2),h.oc("src",i.avatar,h.tc),h.Mb(3),h.yc(i.title),h.Mb(1),h.oc("ngIf",i.good),h.Mb(3),h.zc("\u4f5c\u8005\uff1a[",i.author,"]"),h.Mb(4),h.zc("\u53d1\u5e16\u65f6\u95f4: ",o.DateText(i.created),""),h.Mb(4),h.zc("\u56de\u5e16\u65f6\u95f4: ",o.DateText(i.update),""),h.Mb(4),h.zc("\u56de\u5e16\u6570\u91cf: ",i.child,""),h.Mb(3),h.zc("\u6d4f\u89c8\u6570\u91cf: ",i.view,"")}}function k(t,e){if(1&t&&(h.Zb(0,"ion-select-option",26),h.xc(1),h.Yb()),2&t){var n=e.$implicit;h.oc("value",n),h.Mb(1),h.zc("\u7b2c",n+1,"\u9875")}}var y,Y=((y=function(){function t(e,n,i,o,r,a,c,s){var u=this;_classCallCheck(this,t),this.loadingController=e,this.settings=n,this.forumservice=i,this.host=o,this.popoverCtrl=r,this.modalCtrl=a,this.route=c,this.router=s,this.pageindex=0,this.loadfailed=!1,this.Titel="\u8bba\u575b",this.SortKey="lasttopic",this.Pages=[0],this.PageType=0,this.Topics=[],this.TTopics=[],this.route.params.subscribe((function(t){u.forumid=t.forumid}))}return _createClass(t,[{key:"ngOnInit",value:function(){return Object(c.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.settings.WaitInit();case 2:return t.next=4,this.loadingController.create({message:"\u6b63\u5728\u83b7\u53d6\u8bba\u575b\u5e16\u5b50...",duration:6e4});case 4:this.loadingView=t.sent,this.user=this.settings.User||this.settings.AnonymUser,"forum_me"===this.forumid?(this.Titel="\u6211\u7684\u5e16\u5b50",this.PageType=-3):"forum_ticket"===this.forumid?(this.Titel="\u6211\u7684\u6c42\u52a9",this.PageType=-4):"forum_master"===this.forumid?(this.Titel="\u5411\u6211\u7684\u53d1\u95ee",this.PageType=-5):this.PageType=0,this.PageIndex=0;case 8:case"end":return t.stop()}}),t,this)})))}},{key:"DateText",value:function(t){if(!t)return"\u65e0";var e=new Date(t);return e.toChinaStr()+" ".concat(e.getHours(),":").concat(e.getMinutes(),":").concat(e.getSeconds())}},{key:"Reconnect",value:function(){return Object(c.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var e=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.loadfailed=!1,t.next=3,this.showLoading();case 3:this.forumservice.ForumList().then((function(t){return e.forum=t.find((function(t){return t.id===e.forumid})),e.Titel=e.forum.name,e.admin=e.forum.admin.join("\u3001"),e.forumservice.LoadTopicList(e.forum.id,e.PageIndex,0)})).then((function(t){return e.BuildPages(t.sum),e.Topics=t.data,e.Topics.forEach((function(t){return t.avatar=e.DefaultAvatar})),e.updateUserAvatar(e.Topics),e.forumservice.LoadTopicList(e.forum.id,0,-1)})).then((function(t){e.TTopics=t.data,e.TTopics.forEach((function(t){return t.avatar=e.DefaultAvatar})),e.updateUserAvatar(e.TTopics)})).catch((function(t){e.loadfailed=!0})).finally((function(){e.closeLoading()}));case 4:case"end":return t.stop()}}),t,this)})))}},{key:"JinghuaTopics",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Object(c.b)(this,void 0,void 0,regeneratorRuntime.mark((function n(){var i=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e&&(this.pageindex=0,this.PageType=t),!(t<0)){n.next=7;break}return n.next=4,this.showLoading();case 4:this.forumservice.LoadTopicList(t<-2?null:this.forumid,this.PageIndex,t).then((function(t){i.BuildPages(t.sum),i.Topics=t.data,i.Topics.forEach((function(t){return t.avatar=i.DefaultAvatar})),i.updateUserAvatar(i.Topics)})).finally((function(){i.closeLoading()})),n.next=8;break;case 7:this.Reconnect();case 8:case"end":return n.stop()}}),n,this)})))}},{key:"Navi2Topic",value:function(t){var e=t.forumid;e="forum_ticket"===this.forumid?"\u6c42\u52a9\uff1a"+e:e,e="forum_master"===this.forumid?"\u89e3\u7b54\u5ba2\u6237":e,this.router.navigateByUrl("menu/topicdetail/".concat(e,"/").concat(t.id))}},{key:"updateUserAvatar",value:function(t){var e=this,n=this.settings.ForumSetting;t.forEach((function(t){t.avatar&&t.avatar!==e.DefaultAvatar||e.forumservice.GetUserInfo(t.author).then((function(i){var o,r=((null===(o=i)||void 0===o?void 0:o.avatar)||"").IsNullOrEmpty();t.avatar=r?e.settings.Avatar(i.gender):i.avatar,t.showimg=n.showimg&&!n.imgOut,t.showgua=n.showgua&&!n.guaOut,t.showbazi=n.showbazi&&!n.baziOut}))}))}},{key:"sortOptions",value:function(t){return Object(c.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n,i,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.popoverCtrl.create({component:l.a,event:t,componentProps:{items:[{name:"\u521b\u5efa\u65f6\u95f4",value:"created"},{name:"\u4fee\u6539\u65f6\u95f4",value:"modified"}],currentOption:this.SortKey},translucent:!0});case 2:return n=e.sent,e.next=5,n.present();case 5:return e.next=7,n.onDidDismiss();case 7:i=e.sent,((o=i.data)||this.SortKey)!==this.SortKey&&(this.SortKey=o.toString());case 10:case"end":return e.stop()}}),e,this)})))}},{key:"EditTopic",value:function(t){return Object(c.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n,i,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.modalCtrl.create({component:f.a,componentProps:{MainTopic:t||this.CreateMainTopic(),forumid:this.forumid,forumname:this.forum.name}});case 2:return n=e.sent,e.next=5,n.present();case 5:return e.next=7,n.onWillDismiss();case 7:i=e.sent,(o=i.data)&&this.AddToLocal(o);case 10:case"end":return e.stop()}}),e,this)})))}},{key:"ShowUserInfo",value:function(t){return Object(c.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.modalCtrl.create({component:d.a,componentProps:{Uerid:t}});case 2:return n=e.sent,e.next=5,n.present();case 5:return e.next=7,n.onWillDismiss();case 7:case"end":return e.stop()}}),e,this)})))}},{key:"GoPage",value:function(t){console.log("change page",t)}},{key:"AddToLocal",value:function(t){t.avatar=this.settings.User.avatar,t.forumid===this.forumid&&this.forumservice.ForumMG.SetTopic(t,t.forumid)}},{key:"CreateMainTopic",value:function(){var t=this.settings.User,e=Date.now();return{id:"",created:e,modified:e,author:t.id,forumid:this.forumid,title:"",top:0,good:!1,update:0,gua:null,bazi:null,img:null,content:"",frozen:!1,deleted:!1,child:0,view:0}}},{key:"showLoading",value:function(){return Object(c.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=this.loadingView,t.t0){t.next=5;break}return t.next=4,this.loadingController.create({message:"\u6b63\u5728\u83b7\u53d6\u8bba\u575b\u5e16\u5b50...",duration:6e4});case 4:this.loadingView=t.sent;case 5:return t.next=7,this.loadingView.present();case 7:case"end":return t.stop()}}),t,this)})))}},{key:"closeLoading",value:function(){return Object(c.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=this.loadingView,!t.t0){t.next=5;break}return t.next=4,this.loadingView.dismiss();case 4:this.loadingView=null;case 5:case"end":return t.stop()}}),t,this)})))}},{key:"BuildPages",value:function(t){if(0===this.PageIndex)if(0!==t){this.Pages=[];for(var e=Math.ceil(t/20),n=0;n<e;n++)this.Pages.push(n)}else this.Pages=[0]}},{key:"HasUser",get:function(){return this.settings.HasUser}},{key:"DefaultAvatar",get:function(){return this.settings.Avatar()}},{key:"PageIndex",get:function(){return this.pageindex},set:function(t){this.pageindex=t,0!==this.PageType?this.JinghuaTopics(this.PageType):this.Reconnect()}},{key:"Admin",get:function(){return this.admin}}]),t}()).\u0275fac=function(t){return new(t||y)(h.Wb(a.bb),h.Wb(s.a),h.Wb(b.a),h.Wb(u.a),h.Wb(a.fb),h.Wb(a.cb),h.Wb(r.a),h.Wb(r.g))},y.\u0275cmp=h.Qb({type:y,selectors:[["app-topiclist"]],decls:22,vars:9,consts:[["color","primary"],["slot","start"],["defaulthref","","text","\u8fd4\u56de"],["slot","end",4,"ngIf"],["ion-no-padding",""],["ion-no-padding","","slot","fixed",4,"ngIf"],["detail","",3,"click",4,"ngFor","ngForOf"],["slot","end"],[3,"disabled","click"],["name","arrow-back"],["cancelText","\u53d6\u6d88","doneText","\u786e\u5b9a",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"small",3,"disabled","click"],["name","arrow-forward"],["size","small",3,"click"],["slot","icon-only","name","add"],["ion-no-padding","","slot","fixed"],["color","primary",3,"click"],["color","danger",3,"click",4,"ngIf"],["color","primary",3,"click",4,"ngIf"],["color","danger",3,"click"],["detail","",3,"click"],[3,"src"],[1,"ion-text-wrap"],["color","danger"],["color","danger",4,"ngIf"],[3,"value"]],template:function(t,e){1&t&&(h.Zb(0,"ion-header"),h.Zb(1,"ion-toolbar",0),h.Zb(2,"ion-buttons",1),h.Xb(3,"ion-back-button",2),h.Yb(),h.Zb(4,"ion-title"),h.xc(5),h.Yb(),h.wc(6,g,5,0,"ion-buttons",3),h.Yb(),h.Yb(),h.Zb(7,"ion-content"),h.Zb(8,"ion-list",4),h.wc(9,v,10,3,"ion-item-divider",5),h.wc(10,x,26,7,"ion-item",6),h.wc(11,w,25,8,"ion-item",6),h.Yb(),h.Yb(),h.Zb(12,"ion-footer"),h.Zb(13,"small"),h.Zb(14,"ion-toolbar"),h.Zb(15,"ion-buttons",7),h.Zb(16,"ion-button",8),h.hc("click",(function(){return e.PageIndex=e.PageIndex-1})),h.Xb(17,"ion-icon",9),h.Yb(),h.Zb(18,"ion-select",10),h.hc("ngModelChange",(function(t){return e.PageIndex=t})),h.wc(19,k,2,2,"ion-select-option",11),h.Yb(),h.Zb(20,"ion-button",12),h.hc("click",(function(){return e.PageIndex=e.PageIndex+1})),h.Xb(21,"ion-icon",13),h.Yb(),h.Yb(),h.Yb(),h.Yb(),h.Yb()),2&t&&(h.Mb(5),h.zc(": ",e.Titel," :"),h.Mb(1),h.oc("ngIf",e.PageType>=-2),h.Mb(3),h.oc("ngIf",e.PageType>=-2),h.Mb(1),h.oc("ngForOf",e.TTopics),h.Mb(1),h.oc("ngForOf",e.Topics),h.Mb(5),h.oc("disabled",0===e.PageIndex),h.Mb(2),h.oc("ngModel",e.PageIndex),h.Mb(1),h.oc("ngForOf",e.Pages),h.Mb(1),h.oc("disabled",e.PageIndex===e.Pages.length-1))},directives:[a.s,a.Y,a.k,a.g,a.h,a.W,i.j,a.o,a.D,i.i,a.q,a.j,a.t,a.P,a.hb,o.c,o.d,a.T,a.x,a.C,a.w,a.V,a.I,a.Q],styles:[""]}),y),Z=n("Gfuc"),P=n("9UMr");n.d(e,"TopiclistPageModule",(function(){return C}));var M,I=[{path:"",component:Y}],C=((M=function t(){_classCallCheck(this,t)}).\u0275mod=h.Ub({type:M}),M.\u0275inj=h.Tb({factory:function(t){return new(t||M)},imports:[[Z.a,P.a,i.b,o.a,a.Z,r.i.forChild(I)]]}),M)}}]);