(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{"8PFr":function(e,t,c){"use strict";c.r(t);var o=c("ofXK"),i=c("3Pt+"),n=c("tyNb"),s=c("c7TG"),d=c("mrSG"),r=c("HQI1"),l=c("LvB5"),u=c("SRjL"),a=c("mo90"),h=c("LTmD"),b=(c("0eVs"),c("Y6BA"),c("pLZG")),f=c("HULg"),p=c("fXoL");function m(e,t){if(1&e){const e=p.fc();p.ec(0,"ion-buttons",6),p.ec(1,"ion-button",7),p.mc("click",(function(t){return p.Ac(e),p.pc().sortOptions(t)})),p.ac(2,"ion-icon",8),p.ec(3,"ion-text"),p.Hc(4,"\u6392\u5e8f"),p.dc(),p.dc(),p.dc()}if(2&e){const e=p.pc();p.uc("hidden",e.EditModul)}}function g(e,t){if(1&e){const e=p.fc();p.ec(0,"ion-item"),p.ec(1,"ion-buttons"),p.ec(2,"ion-button",9),p.mc("click",(function(){return p.Ac(e),p.pc().showPaiguaModal()})),p.ac(3,"ion-icon",10),p.ec(4,"ion-text"),p.Hc(5,"\u5366\u4f8b"),p.dc(),p.dc(),p.ec(6,"ion-button",9),p.mc("click",(function(){return p.Ac(e),p.pc().showPaibaziModal()})),p.ac(7,"ion-icon",10),p.ec(8,"ion-text"),p.Hc(9,"\u547d\u4f8b"),p.dc(),p.dc(),p.ec(10,"ion-button",9),p.mc("click",(function(){return p.Ac(e),p.pc().ShowActions()})),p.ac(11,"ion-icon",11),p.ec(12,"ion-text"),p.Hc(13,"\u64cd\u4f5c"),p.dc(),p.dc(),p.ec(14,"ion-button",9),p.mc("click",(function(){return p.Ac(e),p.pc().CheckAll()})),p.ec(15,"ion-text"),p.Hc(16,"\u5168\u9009"),p.dc(),p.dc(),p.ec(17,"ion-button",7),p.mc("click",(function(){p.Ac(e);const t=p.pc();return t.EditModul=!t.EditModul})),p.ac(18,"ion-icon",12),p.Hc(19," \u7f16\u8f91 "),p.dc(),p.dc(),p.ec(20,"ion-buttons",6),p.ec(21,"ion-text"),p.Hc(22,"\u6392\u5e8f"),p.dc(),p.ec(23,"ion-segment",13),p.mc("ngModelChange",(function(t){return p.Ac(e),p.pc().SortKey=t}))("ionChange",(function(){return p.Ac(e),p.pc().SortRecord()})),p.ec(24,"ion-segment-button",14),p.Hc(25,"\u8bb0\u5f55\u540d\u79f0"),p.dc(),p.ec(26,"ion-segment-button",15),p.Hc(27,"\u521b\u5efa\u65f6\u95f4"),p.dc(),p.ec(28,"ion-segment-button",16),p.Hc(29,"\u4fee\u6539\u65f6\u95f4"),p.dc(),p.dc(),p.dc(),p.dc()}if(2&e){const e=p.pc();p.Nb(2),p.uc("hidden",e.EditModul),p.Nb(4),p.uc("hidden",e.EditModul),p.Nb(4),p.uc("hidden",!e.EditModul),p.Nb(4),p.uc("hidden",!e.EditModul),p.Nb(6),p.uc("hidden",e.EditModul),p.Nb(3),p.uc("ngModel",e.SortKey)}}function v(e,t){if(1&e){const e=p.fc();p.ec(0,"ion-list-header"),p.ec(1,"ion-searchbar",17),p.mc("ngModelChange",(function(t){return p.Ac(e),p.pc().SearchQuery=t})),p.dc(),p.dc()}if(2&e){const e=p.pc();p.Nb(1),p.uc("ngModel",e.SearchQuery)}}function y(e,t){if(1&e){const e=p.fc();p.ec(0,"ion-item"),p.ec(1,"ion-label"),p.Hc(2),p.dc(),p.ec(3,"ion-note",18),p.Hc(4),p.dc(),p.ec(5,"ion-text"),p.ec(6,"small"),p.Hc(7),p.dc(),p.dc(),p.ec(8,"ion-button",19),p.mc("click",(function(){p.Ac(e);const c=t.$implicit;return p.pc().ShowRecordes(c)})),p.ac(9,"ion-icon",20),p.dc(),p.ec(10,"ion-checkbox",21),p.mc("ngModelChange",(function(c){return p.Ac(e),t.$implicit.isChecked=c})),p.dc(),p.dc()}if(2&e){const e=t.$implicit,c=p.pc();p.Nb(2),p.Ic(e.titel),p.Nb(2),p.Ic(e.type),p.Nb(3),p.Ic(e.time),p.Nb(1),p.uc("hidden",c.EditModul),p.Nb(2),p.uc("hidden",!c.EditModul)("ngModel",e.isChecked)}}function N(e,t){if(1&e){const e=p.fc();p.ec(0,"ion-footer"),p.ec(1,"ion-toolbar"),p.ec(2,"ion-buttons",22),p.ec(3,"ion-button",9),p.mc("click",(function(){return p.Ac(e),p.pc().showPaiguaModal()})),p.ac(4,"ion-icon",10),p.ec(5,"ion-text"),p.Hc(6,"\u5366\u4f8b"),p.dc(),p.dc(),p.ec(7,"ion-button",9),p.mc("click",(function(){return p.Ac(e),p.pc().showPaibaziModal()})),p.ac(8,"ion-icon",10),p.ec(9,"ion-text"),p.Hc(10,"\u547d\u4f8b"),p.dc(),p.dc(),p.ec(11,"ion-button",9),p.mc("click",(function(){return p.Ac(e),p.pc().ShowActions()})),p.ac(12,"ion-icon",11),p.ec(13,"ion-text"),p.Hc(14,"\u64cd\u4f5c"),p.dc(),p.dc(),p.ec(15,"ion-button",9),p.mc("click",(function(){return p.Ac(e),p.pc().CheckAll()})),p.ec(16,"ion-text"),p.Hc(17,"\u5168\u9009"),p.dc(),p.dc(),p.dc(),p.ec(18,"ion-buttons",23),p.ec(19,"ion-button",7),p.mc("click",(function(){p.Ac(e);const t=p.pc();return t.EditModul=!t.EditModul})),p.ac(20,"ion-icon",12),p.Hc(21," \u7f16\u8f91 "),p.dc(),p.dc(),p.dc(),p.dc()}if(2&e){const e=p.pc();p.Nb(3),p.uc("hidden",e.EditModul),p.Nb(4),p.uc("hidden",e.EditModul),p.Nb(4),p.uc("hidden",!e.EditModul),p.Nb(4),p.uc("hidden",!e.EditModul)}}let C=(()=>{class e{constructor(e,t,c,o,i,s,d,r){this.dbservice=e,this.settings=t,this.actionsheetctrl=c,this.alertCtrl=o,this.popoverCtrl=i,this.modalController=s,this.route=d,this.router=r,this.searchQuery="",this.docNodes=[],this.columns=[{prop:"time"},{name:"titel"},{name:"type"}],this.SortKey="created",this.EditModul=!1,this.AllNodes=!1,this.route.params.subscribe(e=>{this.node_id=e.id}),this.router.events.pipe(Object(b.a)(e=>e instanceof n.c)).subscribe(e=>{e.url.match(/\/menu\/recordes\/(?<nodeid>[0-9]+)/i)})}get IsDevice(){return this.settings.IsDevice}get Recordes(){const e=this.SearchQuery.trim();return e?(this.recordes||[]).filter(t=>t.titel.toLowerCase().includes(e)):this.recordes||[]}get SearchQuery(){return this.searchQuery}set SearchQuery(e){this.searchQuery=e}ngOnInit(){return Object(d.b)(this,void 0,void 0,(function*(){this.recordes=[],this.recordesOrigin=[],yield this.dbservice.getNodes().then(e=>("*"===this.node_id?(this.AllNodes=!0,this.docNodes=e.where(e=>32===e.type).select(e=>e.id)):this.docNodes=this.node_id.split("-"),!0)),this.Reload()}))}SortRecord(){this.recordes=this.recordesOrigin.sortByKey(this.SortKey).select(e=>this.Convert(e))}sortOptions(e){return Object(d.b)(this,void 0,void 0,(function*(){const t=yield this.popoverCtrl.create({component:r.a,event:e,componentProps:{items:[{name:"\u76ee\u5f55\u540d\u79f0",value:"titel"},{name:"\u521b\u5efa\u65f6\u95f4",value:"created"},{name:"\u4fee\u6539\u65f6\u95f4",value:"modified"}],currentOption:this.SortKey},translucent:!0});yield t.present();const{data:c}=yield t.onDidDismiss();(c||this.SortKey)!==this.SortKey&&(this.SortKey=c.toString(),this.SortRecord())}))}loadRecordes(e){return this.dbservice.GetRecordes(e).then(e=>{const t=e.select(e=>this.Convert(e));return this.recordesOrigin=this.recordesOrigin.concat(e||[]),t}).catch(t=>{t===[]?console.log(`loadRecordes ${e} not found in local`):console.log(`Err loadRecordes ${e}`,t)})}showPaiguaModal(){return Object(d.b)(this,void 0,void 0,(function*(){const e=yield this.selectNode();if(!e)return;const t=yield this.modalController.create({component:l.a});yield t.present();const{data:c}=yield t.onWillDismiss();if(c.result){const t=c.result;this.dbservice.CreateRecord(e,t.question,8,JSON.stringify(t)).then(e=>{this.recordes.push(this.Convert(e))})}}))}showPaibaziModal(){return Object(d.b)(this,void 0,void 0,(function*(){const e=yield this.selectNode();if(!e)return;const t=yield this.modalController.create({component:u.a});yield t.present();const{data:c}=yield t.onWillDismiss();if(c.result){const t=c.result;this.dbservice.CreateRecord(e,t.person,16,JSON.stringify(t)).then(e=>{this.recordes.push(this.Convert(e))})}}))}showHelp(){return Object(d.b)(this,void 0,void 0,(function*(){const e=yield this.alertCtrl.create({header:"\u5e2e\u52a9",message:"\u5f53\u6848\u4f8b\u6765\u81ea\u591a\u4e2a\u6587\u4ef6\u5939\u7684\u65f6\u5019\uff0c\u65e0\u6cd5\u7f16\u8f91\u3002\u5982\u9700\u7f16\u8f91\uff0c\u8bf7\u8fd4\u56de\u76ee\u5f55\u754c\u9762\uff0c\u6253\u5f00\u4e00\u4e2a\u5355\u4e00\u7684\u6587\u4ef6\u5939\u76ee\u5f55\u3002",buttons:["\u786e\u5b9a"]});yield e.present()}))}CheckAll(){this.checkAll=!this.checkAll,this.recordes.forEach(e=>e.isChecked=this.checkAll)}ShowActions(){return Object(d.b)(this,void 0,void 0,(function*(){if(0===this.recordes.filter(e=>e.isChecked).length){const e=yield this.alertCtrl.create({header:"\u5e2e\u52a9",message:"\u8bf7\u9009\u5b9a\u81f3\u5c11\u4e00\u4f8b\u88ab\u7f16\u8f91\u7684\u6848\u4f8b\u3002",buttons:["\u786e\u5b9a"]});return void(yield e.present())}const e=yield this.actionsheetctrl.create({header:"\u7f16\u8f91",buttons:[{text:"\u5220\u9664",role:"destructive",icon:"trash",handler:()=>{this.DeleteNode()}},{text:"\u8fc1\u79fb\u76ee\u5f55",icon:"arrow-round-back",handler:()=>{this.MoveNode()}},{text:" \u53d6\u6d88",icon:"close",role:"cancel",handler:()=>{}}]});yield e.present()}))}MoveNode(){return Object(d.b)(this,void 0,void 0,(function*(){const e=yield this.modalController.create({component:a.a,componentProps:{Titel:"\u9009\u62e9\u65b0\u76ee\u5f55",SelectDocument:!0,NodeID:this.docNodes.length>1?null:this.docNodes[0]}});yield e.present();const{data:t}=yield e.onWillDismiss();if(t.nodeid&&!t.nodeid.IsNullOrEmpty()){this.EditModul=!1;const e=this.recordes.filter(e=>e.isChecked);for(const c of e)yield this.dbservice.MoveRecord(c.nodeid,t.nodeid,c.id);this.Reload()}}))}DeleteNode(){return Object(d.b)(this,void 0,void 0,(function*(){let e=!1;const t=yield this.alertCtrl.create({header:"\u5220\u9664\u6848\u4f8b",message:"\u786e\u5b9a\u5220\u9664\u9009\u5b9a\u7684\u6848\u4f8b\u5417\uff1f",buttons:[{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary"},{text:"\u786e\u5b9a",handler:()=>{e=!0}}]});if(yield t.present(),yield t.onDidDismiss(),!1===e)return;const c=this.recordes.where(e=>e.isChecked);this.EditModul=!1;for(const o of c)yield this.dbservice.DeleteRecord(o.id,o.nodeid);this.Reload()}))}ShowRecordes(e){this.router.navigateByUrl(`/menu/recordview/${e.nodeid}/${e.id}`)}Reload(){this.recordes=[];for(const e of this.docNodes)this.loadRecordes(e).then(e=>{this.recordes=this.Recordes.concat(e||[])})}Convert(e){return{time:new Date("modified"===this.SortKey?e.modified:e.created).toChinaStr(),titel:e.titel,type:8===e.type?"\u516d\u723b":"\u516b\u5b57",id:e.id,nodeid:e.node,isChecked:!1}}selectNode(){return Object(d.b)(this,void 0,void 0,(function*(){if(1===this.docNodes.length)return Promise.resolve(this.docNodes[0]);let e=!1,t=yield this.dbservice.getNodes();t=t.filter(e=>this.docNodes.includes(e.id));const c=t.map(e=>({name:e.id,type:"radio",label:e.name,value:e.id,checked:!1}));c[0].checked=!0;const o=yield this.alertCtrl.create({header:"\u9009\u62e9\u4e00\u4e2a\u6587\u4ef6\u5939",inputs:c,buttons:[{text:"\u786e\u5b9a",handler:()=>{e=!0}},{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary"}]});yield o.present();const{data:i}=yield o.onWillDismiss();return i.values}))}}return e.\u0275fac=function(t){return new(t||e)(p.Zb(f.a),p.Zb(h.a),p.Zb(s.a),p.Zb(s.b),p.Zb(s.ib),p.Zb(s.fb),p.Zb(n.a),p.Zb(n.g))},e.\u0275cmp=p.Tb({type:e,selectors:[["app-recordes"]],decls:14,vars:6,consts:[["slot","start",3,"hidden"],["defaulthref","","text","\u8fd4\u56de"],["rdbackbtn",""],["slot","end",3,"hidden",4,"ngIf"],[4,"ngIf"],[4,"ngFor","ngForOf"],["slot","end",3,"hidden"],[3,"click"],["name","md-funnel"],[3,"hidden","click"],["name","add"],["name","build"],["name","md-reorder"],[3,"ngModel","ngModelChange","ionChange"],["value","titel"],["value","created"],["value","modified"],["color","light","showCancelButton","focus","cancelButtonText","\u53d6\u6d88","placeholder","\u641c\u7d22\u95ee\u5ff5/\u540d\u5b57",3,"ngModel","ngModelChange"],["button",""],["color","light",3,"hidden","click"],["icon-only","","name","ios-arrow-forward"],[3,"hidden","ngModel","ngModelChange"],["slot","start"],["slot","end"]],template:function(e,t){1&e&&(p.ec(0,"ion-header"),p.ec(1,"ion-toolbar"),p.ec(2,"ion-buttons",0),p.ac(3,"ion-back-button",1,2),p.dc(),p.ec(5,"ion-title"),p.Hc(6,"\u6613\u5b66\u6848\u4f8b"),p.dc(),p.Fc(7,m,5,1,"ion-buttons",3),p.dc(),p.dc(),p.ec(8,"ion-content"),p.ec(9,"ion-list"),p.Fc(10,g,30,6,"ion-item",4),p.Fc(11,v,2,1,"ion-list-header",4),p.Fc(12,y,11,6,"ion-item",5),p.dc(),p.dc(),p.Fc(13,N,22,4,"ion-footer",4)),2&e&&(p.Nb(2),p.uc("hidden",t.EditModul),p.Nb(5),p.uc("ngIf",t.IsDevice),p.Nb(3),p.uc("ngIf",!t.IsDevice),p.Nb(1),p.uc("ngIf",t.AllNodes),p.Nb(1),p.uc("ngForOf",t.Recordes),p.Nb(1),p.uc("ngIf",t.IsDevice))},directives:[s.t,s.bb,s.j,s.f,s.g,s.Z,o.j,s.n,s.E,o.i,s.i,s.u,s.W,s.x,s.Q,s.kb,i.f,i.g,s.R,s.F,s.P,s.lb,s.D,s.J,s.k,s.c,s.r],styles:[""]}),e})();c.d(t,"RecordesPageModule",(function(){return k}));const M=[{path:"",component:C}];let k=(()=>{class e{}return e.\u0275mod=p.Xb({type:e}),e.\u0275inj=p.Wb({factory:function(t){return new(t||e)},imports:[[o.b,i.c,s.cb,n.i.forChild(M)]]}),e})()},HQI1:function(e,t,c){"use strict";c.d(t,"a",(function(){return a}));var o=c("c7TG"),i=c("fXoL"),n=c("ofXK");function s(e,t){if(1&e){const e=i.fc();i.ec(0,"ion-item",3),i.mc("click",(function(){i.Ac(e);const c=t.$implicit;return i.pc(2).onSelect(c.value)})),i.ec(1,"ion-text"),i.Hc(2),i.dc(),i.dc()}if(2&e){const e=t.$implicit,c=i.pc(2);i.uc("color",e.value===c.currentOption?"light":""),i.Nb(2),i.Ic(e.name)}}function d(e,t){if(1&e&&(i.ec(0,"div"),i.Fc(1,s,3,2,"ion-item",2),i.dc()),2&e){const e=i.pc();i.Nb(1),i.uc("ngForOf",e.items)}}function r(e,t){if(1&e&&(i.ec(0,"ion-note"),i.Hc(1),i.dc()),2&e){const e=i.pc().$implicit;i.Nb(1),i.Jc(" ",e.name," ")}}function l(e,t){if(1&e&&(i.ec(0,"ion-item",6),i.Fc(1,r,2,1,"ion-note",0),i.ec(2,"ion-label",7),i.ec(3,"small"),i.ac(4,"ion-text",8),i.dc(),i.dc(),i.dc()),2&e){const e=t.$implicit;i.Nb(1),i.uc("ngIf",e.name),i.Nb(3),i.uc("innerHtml",e.value,i.Bc)}}function u(e,t){if(1&e&&(i.ec(0,"ion-list",4),i.Fc(1,l,5,2,"ion-item",5),i.dc()),2&e){const e=i.pc();i.Nb(1),i.uc("ngForOf",e.items)}}let a=(()=>{class e{constructor(e){this.popoverCtrl=e,this.toselect=!0}ngOnInit(){}onSelect(e){this.popoverCtrl.dismiss(e)}}return e.\u0275fac=function(t){return new(t||e)(i.Zb(o.ib))},e.\u0275cmp=i.Tb({type:e,selectors:[["app-optionpopover"]],inputs:{currentOption:"currentOption",items:"items",toselect:"toselect"},decls:2,vars:2,consts:[[4,"ngIf"],["class","ion-no-padding",4,"ngIf"],["button","",3,"color","click",4,"ngFor","ngForOf"],["button","",3,"color","click"],[1,"ion-no-padding"],["lines","none",4,"ngFor","ngForOf"],["lines","none"],["slot","end",1,"ion-text-wrap"],[3,"innerHtml"]],template:function(e,t){1&e&&(i.Fc(0,d,2,1,"div",0),i.Fc(1,u,2,1,"ion-list",1)),2&e&&(i.uc("ngIf",t.toselect),i.Nb(1),i.uc("ngIf",!t.toselect))},directives:[n.j,n.i,o.x,o.W,o.E,o.D,o.J],styles:[""]}),e})()}}]);