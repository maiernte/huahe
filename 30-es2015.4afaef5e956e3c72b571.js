(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{"8PFr":function(t,e,o){"use strict";o.r(e);var i=o("ofXK"),n=o("3Pt+"),c=o("tyNb"),s=o("c7TG"),r=o("mrSG"),d=o("L99X"),l=o("HQI1"),b=o("LvB5"),h=o("SRjL"),a=o("mo90"),u=(o("0eVs"),o("Y6BA"),o("pLZG")),f=o("fXoL");function m(t,e){if(1&t){const t=f.ac();f.Zb(0,"ion-item"),f.Zb(1,"ion-label"),f.xc(2),f.Yb(),f.Zb(3,"ion-note",11),f.xc(4),f.Yb(),f.Zb(5,"ion-text"),f.Zb(6,"small"),f.xc(7),f.Yb(),f.Yb(),f.Zb(8,"ion-button",12),f.hc("click",(function(){f.rc(t);const o=e.$implicit;return f.jc().ShowRecordes(o)})),f.Xb(9,"ion-icon",13),f.Yb(),f.Zb(10,"ion-checkbox",14),f.hc("ngModelChange",(function(o){return f.rc(t),e.$implicit.isChecked=o})),f.Yb(),f.Yb()}if(2&t){const t=e.$implicit,o=f.jc();f.Mb(2),f.yc(t.titel),f.Mb(2),f.yc(t.type),f.Mb(3),f.yc(t.time),f.Mb(1),f.oc("hidden",o.EditModul),f.Mb(2),f.oc("hidden",!o.EditModul)("ngModel",t.isChecked)}}function p(t,e){if(1&t){const t=f.ac();f.Zb(0,"ion-buttons",15),f.Zb(1,"ion-button",16),f.hc("click",(function(){return f.rc(t),f.jc().showPaiguaModal()})),f.Xb(2,"ion-icon",17),f.Zb(3,"ion-text"),f.xc(4,"\u5366\u4f8b"),f.Yb(),f.Yb(),f.Zb(5,"ion-button",16),f.hc("click",(function(){return f.rc(t),f.jc().showPaibaziModal()})),f.Xb(6,"ion-icon",17),f.Zb(7,"ion-text"),f.xc(8,"\u547d\u4f8b"),f.Yb(),f.Yb(),f.Zb(9,"ion-button",16),f.hc("click",(function(){return f.rc(t),f.jc().ShowActions()})),f.Xb(10,"ion-icon",18),f.Zb(11,"ion-text"),f.xc(12,"\u7f16\u8f91"),f.Yb(),f.Yb(),f.Zb(13,"ion-button",16),f.hc("click",(function(){return f.rc(t),f.jc().CheckAll()})),f.Zb(14,"ion-text"),f.xc(15,"\u5168\u9009"),f.Yb(),f.Yb(),f.Yb()}if(2&t){const t=f.jc();f.Mb(1),f.oc("hidden",t.EditModul),f.Mb(4),f.oc("hidden",t.EditModul),f.Mb(4),f.oc("hidden",!t.EditModul),f.Mb(4),f.oc("hidden",!t.EditModul)}}function v(t,e){if(1&t){const t=f.ac();f.Zb(0,"ion-buttons",19),f.Zb(1,"ion-button",4),f.hc("click",(function(){f.rc(t);const e=f.jc();return e.EditModul=!e.EditModul})),f.Xb(2,"ion-icon",20),f.Yb(),f.Yb()}}function y(t,e){if(1&t){const t=f.ac();f.Zb(0,"ion-buttons",19),f.Zb(1,"ion-button",4),f.hc("click",(function(){return f.rc(t),f.jc().showHelp()})),f.Xb(2,"ion-icon",21),f.Zb(3,"ion-text"),f.xc(4,"\u5e2e\u52a9"),f.Yb(),f.Yb(),f.Yb()}}let g=(()=>{class t{constructor(t,e,o,i,n,s,r){this.dbservice=t,this.actionsheetctrl=e,this.alertCtrl=o,this.popoverCtrl=i,this.modalController=n,this.route=s,this.router=r,this.columns=[{prop:"time"},{name:"titel"},{name:"type"}],this.SortKey="created",this.SortName="\u521b\u5efa\u65e5\u671f",this.EditModul=!1,this.Editable=!0,this.route.params.subscribe(t=>{this.node_id=t.id}),this.router.events.pipe(Object(u.a)(t=>t instanceof c.c)).subscribe(t=>{t.url.match(/\/menu\/recordes\/(?<nodeid>[0-9]+)/i)})}ngOnInit(){return Object(r.b)(this,void 0,void 0,(function*(){this.recordes=[],this.recordesOrigin=[];let t=[];yield this.dbservice.GetAllNodes().then(e=>{"*"===this.node_id?(t=e.where(t=>32===t.type).select(t=>t.id),this.Editable=!1):(t=this.node_id.split("-"),this.Editable=1===t.length);for(const o of t)this.loadRecordes(o).then(t=>{this.recordes=this.Recordes.concat(t||[])})})}))}sortOptions(t){return Object(r.b)(this,void 0,void 0,(function*(){const e=yield this.popoverCtrl.create({component:l.a,event:t,componentProps:{items:[{name:"\u76ee\u5f55\u540d\u79f0",value:"titel"},{name:"\u521b\u5efa\u65f6\u95f4",value:"created"},{name:"\u4fee\u6539\u65f6\u95f4",value:"modified"}],currentOption:this.SortKey},translucent:!0});yield e.present();const{data:o}=yield e.onDidDismiss();if((o||this.SortKey)!==this.SortKey){switch(this.SortKey=o.toString(),this.SortKey){case"titel":this.SortName="\u76ee\u5f55\u540d\u79f0";break;case"created":this.SortName="\u521b\u5efa\u65f6\u95f4";break;case"modified":this.SortName="\u4fee\u6539\u65f6\u95f4";break;default:this.SortName="\u9ed8\u8ba4"}this.recordes=this.recordesOrigin.sortByKey(this.SortKey).select(t=>this.Convert(t))}}))}get Recordes(){return this.recordes||[]}loadRecordes(t){return this.dbservice.GetRecordes(t).then(t=>{const e=t.select(t=>this.Convert(t));return this.recordesOrigin=this.recordesOrigin.concat(t||[]),e}).catch(e=>{e===[]?console.log(`loadRecordes ${t} not found in local`):console.log(`Err loadRecordes ${t}`,e)})}showPaiguaModal(){return Object(r.b)(this,void 0,void 0,(function*(){const t=yield this.modalController.create({component:b.a});yield t.present();const{data:e}=yield t.onWillDismiss();if(e.result){const t=e.result;this.dbservice.SaveRecord(this.node_id,t.question,8,JSON.stringify(t)).then(t=>{this.recordes.push(this.Convert(t))})}}))}showPaibaziModal(){return Object(r.b)(this,void 0,void 0,(function*(){const t=yield this.modalController.create({component:h.a});yield t.present();const{data:e}=yield t.onWillDismiss();if(e.result){const t=e.result;this.dbservice.SaveRecord(this.node_id,t.person,16,JSON.stringify(t)).then(t=>{this.recordes.push(this.Convert(t))})}}))}showHelp(){return Object(r.b)(this,void 0,void 0,(function*(){const t=yield this.alertCtrl.create({header:"\u5e2e\u52a9",message:"\u5f53\u6848\u4f8b\u6765\u81ea\u591a\u4e2a\u6587\u4ef6\u5939\u7684\u65f6\u5019\uff0c\u65e0\u6cd5\u7f16\u8f91\u3002\u5982\u9700\u7f16\u8f91\uff0c\u8bf7\u8fd4\u56de\u76ee\u5f55\u754c\u9762\uff0c\u6253\u5f00\u4e00\u4e2a\u5355\u4e00\u7684\u6587\u4ef6\u5939\u76ee\u5f55\u3002",buttons:["\u786e\u5b9a"]});yield t.present()}))}CheckAll(){this.checkAll=!this.checkAll,this.recordes.forEach(t=>t.isChecked=this.checkAll)}ShowActions(){return Object(r.b)(this,void 0,void 0,(function*(){if(0===this.recordes.filter(t=>t.isChecked).length){const t=yield this.alertCtrl.create({header:"\u5e2e\u52a9",message:"\u8bf7\u9009\u5b9a\u81f3\u5c11\u4e00\u4f8b\u88ab\u7f16\u8f91\u7684\u6848\u4f8b\u3002",buttons:["\u786e\u5b9a"]});return void(yield t.present())}const t=yield this.actionsheetctrl.create({header:"\u7f16\u8f91",buttons:[{text:"\u5220\u9664",role:"destructive",icon:"trash",handler:()=>{this.DeleteNode()}},{text:"\u8fc1\u79fb\u76ee\u5f55",icon:"arrow-round-back",handler:()=>{this.MoveNode()}},{text:" \u53d6\u6d88",icon:"close",role:"cancel",handler:()=>{}}]});yield t.present()}))}MoveNode(){return Object(r.b)(this,void 0,void 0,(function*(){const t=yield this.modalController.create({component:a.a,componentProps:{Titel:"\u9009\u62e9\u65b0\u76ee\u5f55",SelectDocument:!0,NodeID:this.node_id}});yield t.present();const{data:e}=yield t.onWillDismiss();e.nodeid&&!e.nodeid.IsNullOrEmpty()&&(this.EditModul=!1,this.dbservice.MoveRecordes(this.node_id,e.nodeid,this.recordes.filter(t=>t.isChecked).map(t=>t.id)).then(t=>{this.recordesOrigin=t,this.recordes=t.sortByKey(this.SortKey).map(t=>this.Convert(t))}))}))}DeleteNode(){return Object(r.b)(this,void 0,void 0,(function*(){const t=yield this.alertCtrl.create({header:"\u5220\u9664\u6848\u4f8b",message:"\u786e\u5b9a\u5220\u9664\u9009\u5b9a\u7684\u6848\u4f8b\u5417\uff1f",buttons:[{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary"},{text:"\u786e\u5b9a",handler:()=>{const t=this.recordes.where(t=>t.isChecked).map(t=>t.id);console.log("next to delete recordes",t),this.EditModul=!1,this.dbservice.DeleteRecordes(this.node_id,t).then(t=>{this.recordesOrigin=t,this.recordes=t.sortByKey(this.SortKey).select(t=>this.Convert(t))})}}]});yield t.present()}))}ShowRecordes(t){this.router.navigateByUrl(`/menu/recordview/${t.nodeid}/${t.id}`)}Convert(t){return{time:new Date("modified"===this.SortKey?t.modified:t.created).toChinaStr(),titel:t.titel,type:8===t.type?"\u516d\u723b":"\u516b\u5b57",id:t.id,nodeid:t.node,isChecked:!1}}}return t.\u0275fac=function(e){return new(e||t)(f.Wb(d.a),f.Wb(s.a),f.Wb(s.b),f.Wb(s.fb),f.Wb(s.cb),f.Wb(c.a),f.Wb(c.g))},t.\u0275cmp=f.Qb({type:t,selectors:[["app-recordes"]],decls:22,vars:8,consts:[["slot","start",3,"hidden"],["defaulthref","","text","\u8fd4\u56de"],["rdbackbtn",""],["slot","end",3,"hidden"],[3,"click"],["name","md-funnel"],[3,"hidden"],["color","light","showCancelButton","focus","cancelButtonText","\u53d6\u6d88","placeholder","\u641c\u7d22\u95ee\u5ff5/\u540d\u5b57"],[4,"ngFor","ngForOf"],["slot","start",4,"ngIf"],["slot","end",4,"ngIf"],["button",""],["color","light",3,"hidden","click"],["icon-only","","name","ios-arrow-forward"],[3,"hidden","ngModel","ngModelChange"],["slot","start"],[3,"hidden","click"],["name","add"],["name","build"],["slot","end"],["name","md-reorder"],["name","md-help-circle"]],template:function(t,e){1&t&&(f.Zb(0,"ion-header"),f.Zb(1,"ion-toolbar"),f.Zb(2,"ion-buttons",0),f.Xb(3,"ion-back-button",1,2),f.Yb(),f.Zb(5,"ion-title"),f.xc(6,"\u6613\u5b66\u6848\u4f8b"),f.Yb(),f.Zb(7,"ion-buttons",3),f.Zb(8,"ion-button",4),f.hc("click",(function(t){return e.sortOptions(t)})),f.Xb(9,"ion-icon",5),f.Zb(10,"ion-text"),f.xc(11),f.Yb(),f.Yb(),f.Yb(),f.Yb(),f.Yb(),f.Zb(12,"ion-content"),f.Zb(13,"ion-list"),f.Zb(14,"ion-list-header",6),f.Xb(15,"ion-searchbar",7),f.Yb(),f.wc(16,m,11,6,"ion-item",8),f.Yb(),f.Yb(),f.Zb(17,"ion-footer"),f.Zb(18,"ion-toolbar"),f.wc(19,p,16,4,"ion-buttons",9),f.wc(20,v,3,0,"ion-buttons",10),f.wc(21,y,5,0,"ion-buttons",10),f.Yb(),f.Yb()),2&t&&(f.Mb(2),f.oc("hidden",e.EditModul),f.Mb(5),f.oc("hidden",e.EditModul),f.Mb(4),f.yc(e.SortName),f.Mb(3),f.oc("hidden",e.EditModul),f.Mb(2),f.oc("ngForOf",e.Recordes),f.Mb(3),f.oc("ngIf",e.Editable),f.Mb(1),f.oc("ngIf",e.Editable),f.Mb(1),f.oc("ngIf",!e.Editable))},directives:[s.s,s.Y,s.k,s.g,s.h,s.W,s.j,s.t,s.T,s.o,s.D,s.E,s.M,s.ib,i.i,s.q,i.j,s.w,s.C,s.I,s.l,s.c,n.c,n.d],styles:[""]}),t})();o.d(e,"RecordesPageModule",(function(){return Y}));const M=[{path:"",component:g}];let Y=(()=>{class t{}return t.\u0275mod=f.Ub({type:t}),t.\u0275inj=f.Tb({factory:function(e){return new(e||t)},imports:[[i.b,n.a,s.Z,c.i.forChild(M)]]}),t})()},HQI1:function(t,e,o){"use strict";o.d(e,"a",(function(){return b}));var i=o("c7TG"),n=o("fXoL"),c=o("ofXK");function s(t,e){if(1&t){const t=n.ac();n.Zb(0,"ion-item",2),n.hc("click",(function(){n.rc(t);const o=e.$implicit;return n.jc(2).onSelect(o.value)})),n.Zb(1,"ion-text"),n.xc(2),n.Yb(),n.Yb()}if(2&t){const t=e.$implicit,o=n.jc(2);n.oc("color",t.value===o.currentOption?"light":""),n.Mb(2),n.yc(t.name)}}function r(t,e){if(1&t&&(n.Zb(0,"div"),n.wc(1,s,3,2,"ion-item",1),n.Yb()),2&t){const t=n.jc();n.Mb(1),n.oc("ngForOf",t.items)}}function d(t,e){if(1&t&&(n.Zb(0,"ion-item",4),n.Zb(1,"ion-note"),n.xc(2),n.Yb(),n.Zb(3,"ion-label",5),n.xc(4),n.Yb(),n.Yb()),2&t){const t=e.$implicit;n.Mb(2),n.yc(t.name),n.Mb(2),n.zc(" ",t.value," ")}}function l(t,e){if(1&t&&(n.Zb(0,"small"),n.wc(1,d,5,2,"ion-item",3),n.Yb()),2&t){const t=n.jc();n.Mb(1),n.oc("ngForOf",t.items)}}let b=(()=>{class t{constructor(t){this.popoverCtrl=t,this.toselect=!0}ngOnInit(){}onSelect(t){this.popoverCtrl.dismiss(t)}}return t.\u0275fac=function(e){return new(e||t)(n.Wb(i.fb))},t.\u0275cmp=n.Qb({type:t,selectors:[["app-optionpopover"]],inputs:{currentOption:"currentOption",items:"items",toselect:"toselect"},decls:2,vars:2,consts:[[4,"ngIf"],["button","",3,"color","click",4,"ngFor","ngForOf"],["button","",3,"color","click"],["lines","none",4,"ngFor","ngForOf"],["lines","none"],["slot","end",1,"ion-text-wrap"]],template:function(t,e){1&t&&(n.wc(0,r,2,1,"div",0),n.wc(1,l,2,1,"small",0)),2&t&&(n.oc("ngIf",e.toselect),n.Mb(1),n.oc("ngIf",!e.toselect))},directives:[c.j,c.i,i.w,i.T,i.I,i.C],styles:[""]}),t})()}}]);