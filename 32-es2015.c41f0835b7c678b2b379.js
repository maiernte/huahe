(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{"8PFr":function(e,t,i){"use strict";i.r(t);var o=i("ofXK"),c=i("3Pt+"),n=i("tyNb"),s=i("c7TG"),r=i("mrSG"),d=i("HQI1"),l=i("LvB5"),a=i("SRjL"),h=i("mo90"),u=(i("0eVs"),i("Y6BA"),i("pLZG")),b=i("HULg"),f=i("fXoL");function m(e,t){if(1&e){const e=f.fc();f.ec(0,"ion-list-header"),f.ec(1,"ion-searchbar",15),f.mc("ngModelChange",(function(t){return f.Ac(e),f.pc().SearchQuery=t})),f.dc(),f.dc()}if(2&e){const e=f.pc();f.Nb(1),f.uc("ngModel",e.SearchQuery)}}function p(e,t){if(1&e){const e=f.fc();f.ec(0,"ion-item"),f.ec(1,"ion-label"),f.Hc(2),f.dc(),f.ec(3,"ion-note",16),f.Hc(4),f.dc(),f.ec(5,"ion-text"),f.ec(6,"small"),f.Hc(7),f.dc(),f.dc(),f.ec(8,"ion-button",17),f.mc("click",(function(){f.Ac(e);const i=t.$implicit;return f.pc().ShowRecordes(i)})),f.ac(9,"ion-icon",18),f.dc(),f.ec(10,"ion-checkbox",19),f.mc("ngModelChange",(function(i){return f.Ac(e),t.$implicit.isChecked=i})),f.dc(),f.dc()}if(2&e){const e=t.$implicit,i=f.pc();f.Nb(2),f.Ic(e.titel),f.Nb(2),f.Ic(e.type),f.Nb(3),f.Ic(e.time),f.Nb(1),f.uc("hidden",i.EditModul),f.Nb(2),f.uc("hidden",!i.EditModul)("ngModel",e.isChecked)}}let y=(()=>{class e{constructor(e,t,i,o,c,s,r){this.dbservice=e,this.actionsheetctrl=t,this.alertCtrl=i,this.popoverCtrl=o,this.modalController=c,this.route=s,this.router=r,this.searchQuery="",this.docNodes=[],this.columns=[{prop:"time"},{name:"titel"},{name:"type"}],this.SortKey="created",this.SortName="\u521b\u5efa\u65e5\u671f",this.EditModul=!1,this.AllNodes=!1,this.route.params.subscribe(e=>{this.node_id=e.id}),this.router.events.pipe(Object(u.a)(e=>e instanceof n.c)).subscribe(e=>{e.url.match(/\/menu\/recordes\/(?<nodeid>[0-9]+)/i)})}get Recordes(){const e=this.SearchQuery.trim();return e?(this.recordes||[]).filter(t=>t.titel.toLowerCase().includes(e)):this.recordes||[]}get SearchQuery(){return this.searchQuery}set SearchQuery(e){this.searchQuery=e}ngOnInit(){return Object(r.b)(this,void 0,void 0,(function*(){this.recordes=[],this.recordesOrigin=[],yield this.dbservice.getNodes().then(e=>("*"===this.node_id?(this.AllNodes=!0,this.docNodes=e.where(e=>32===e.type).select(e=>e.id)):this.docNodes=this.node_id.split("-"),!0)),this.Reload()}))}sortOptions(e){return Object(r.b)(this,void 0,void 0,(function*(){const t=yield this.popoverCtrl.create({component:d.a,event:e,componentProps:{items:[{name:"\u76ee\u5f55\u540d\u79f0",value:"titel"},{name:"\u521b\u5efa\u65f6\u95f4",value:"created"},{name:"\u4fee\u6539\u65f6\u95f4",value:"modified"}],currentOption:this.SortKey},translucent:!0});yield t.present();const{data:i}=yield t.onDidDismiss();if((i||this.SortKey)!==this.SortKey){switch(this.SortKey=i.toString(),this.SortKey){case"titel":this.SortName="\u76ee\u5f55\u540d\u79f0";break;case"created":this.SortName="\u521b\u5efa\u65f6\u95f4";break;case"modified":this.SortName="\u4fee\u6539\u65f6\u95f4";break;default:this.SortName="\u9ed8\u8ba4"}this.recordes=this.recordesOrigin.sortByKey(this.SortKey).select(e=>this.Convert(e))}}))}loadRecordes(e){return this.dbservice.GetRecordes(e).then(e=>{const t=e.select(e=>this.Convert(e));return this.recordesOrigin=this.recordesOrigin.concat(e||[]),t}).catch(t=>{t===[]?console.log(`loadRecordes ${e} not found in local`):console.log(`Err loadRecordes ${e}`,t)})}showPaiguaModal(){return Object(r.b)(this,void 0,void 0,(function*(){const e=yield this.selectNode();if(!e)return;const t=yield this.modalController.create({component:l.a});yield t.present();const{data:i}=yield t.onWillDismiss();if(i.result){const t=i.result;this.dbservice.CreateRecord(e,t.question,8,JSON.stringify(t)).then(e=>{this.recordes.push(this.Convert(e))})}}))}showPaibaziModal(){return Object(r.b)(this,void 0,void 0,(function*(){const e=yield this.selectNode();if(!e)return;const t=yield this.modalController.create({component:a.a});yield t.present();const{data:i}=yield t.onWillDismiss();if(i.result){const t=i.result;this.dbservice.CreateRecord(e,t.person,16,JSON.stringify(t)).then(e=>{this.recordes.push(this.Convert(e))})}}))}showHelp(){return Object(r.b)(this,void 0,void 0,(function*(){const e=yield this.alertCtrl.create({header:"\u5e2e\u52a9",message:"\u5f53\u6848\u4f8b\u6765\u81ea\u591a\u4e2a\u6587\u4ef6\u5939\u7684\u65f6\u5019\uff0c\u65e0\u6cd5\u7f16\u8f91\u3002\u5982\u9700\u7f16\u8f91\uff0c\u8bf7\u8fd4\u56de\u76ee\u5f55\u754c\u9762\uff0c\u6253\u5f00\u4e00\u4e2a\u5355\u4e00\u7684\u6587\u4ef6\u5939\u76ee\u5f55\u3002",buttons:["\u786e\u5b9a"]});yield e.present()}))}CheckAll(){this.checkAll=!this.checkAll,this.recordes.forEach(e=>e.isChecked=this.checkAll)}ShowActions(){return Object(r.b)(this,void 0,void 0,(function*(){if(0===this.recordes.filter(e=>e.isChecked).length){const e=yield this.alertCtrl.create({header:"\u5e2e\u52a9",message:"\u8bf7\u9009\u5b9a\u81f3\u5c11\u4e00\u4f8b\u88ab\u7f16\u8f91\u7684\u6848\u4f8b\u3002",buttons:["\u786e\u5b9a"]});return void(yield e.present())}const e=yield this.actionsheetctrl.create({header:"\u7f16\u8f91",buttons:[{text:"\u5220\u9664",role:"destructive",icon:"trash",handler:()=>{this.DeleteNode()}},{text:"\u8fc1\u79fb\u76ee\u5f55",icon:"arrow-round-back",handler:()=>{this.MoveNode()}},{text:" \u53d6\u6d88",icon:"close",role:"cancel",handler:()=>{}}]});yield e.present()}))}MoveNode(){return Object(r.b)(this,void 0,void 0,(function*(){const e=yield this.modalController.create({component:h.a,componentProps:{Titel:"\u9009\u62e9\u65b0\u76ee\u5f55",SelectDocument:!0,NodeID:this.docNodes.length>1?null:this.docNodes[0]}});yield e.present();const{data:t}=yield e.onWillDismiss();if(t.nodeid&&!t.nodeid.IsNullOrEmpty()){this.EditModul=!1;const e=this.recordes.filter(e=>e.isChecked);for(const i of e)yield this.dbservice.MoveRecord(i.nodeid,t.nodeid,i.id);this.Reload()}}))}DeleteNode(){return Object(r.b)(this,void 0,void 0,(function*(){let e=!1;const t=yield this.alertCtrl.create({header:"\u5220\u9664\u6848\u4f8b",message:"\u786e\u5b9a\u5220\u9664\u9009\u5b9a\u7684\u6848\u4f8b\u5417\uff1f",buttons:[{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary"},{text:"\u786e\u5b9a",handler:()=>{e=!0}}]});if(yield t.present(),yield t.onDidDismiss(),!1===e)return;const i=this.recordes.where(e=>e.isChecked);this.EditModul=!1;for(const o of i)yield this.dbservice.DeleteRecord(o.id,o.nodeid);this.Reload()}))}ShowRecordes(e){this.router.navigateByUrl(`/menu/recordview/${e.nodeid}/${e.id}`)}Reload(){this.recordes=[];for(const e of this.docNodes)this.loadRecordes(e).then(e=>{this.recordes=this.Recordes.concat(e||[])})}Convert(e){return{time:new Date("modified"===this.SortKey?e.modified:e.created).toChinaStr(),titel:e.titel,type:8===e.type?"\u516d\u723b":"\u516b\u5b57",id:e.id,nodeid:e.node,isChecked:!1}}selectNode(){return Object(r.b)(this,void 0,void 0,(function*(){if(1===this.docNodes.length)return Promise.resolve(this.docNodes[0]);let e=!1,t=yield this.dbservice.getNodes();t=t.filter(e=>this.docNodes.includes(e.id));const i=t.map(e=>({name:e.id,type:"radio",label:e.name,value:e.id,checked:!1}));i[0].checked=!0;const o=yield this.alertCtrl.create({header:"\u9009\u62e9\u4e00\u4e2a\u6587\u4ef6\u5939",inputs:i,buttons:[{text:"\u786e\u5b9a",handler:()=>{e=!0}},{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary"}]});yield o.present();const{data:c}=yield o.onWillDismiss();return c.values}))}}return e.\u0275fac=function(t){return new(t||e)(f.Zb(b.a),f.Zb(s.a),f.Zb(s.b),f.Zb(s.gb),f.Zb(s.db),f.Zb(n.a),f.Zb(n.g))},e.\u0275cmp=f.Tb({type:e,selectors:[["app-recordes"]],decls:42,vars:9,consts:[["slot","start",3,"hidden"],["defaulthref","","text","\u8fd4\u56de"],["rdbackbtn",""],["slot","end",3,"hidden"],[3,"click"],["name","md-funnel"],[4,"ngIf"],[4,"ngFor","ngForOf"],["slot","start"],[3,"hidden","click"],["name","add"],["name","build"],["slot","end"],["name","md-reorder"],["name","md-help-circle"],["color","light","showCancelButton","focus","cancelButtonText","\u53d6\u6d88","placeholder","\u641c\u7d22\u95ee\u5ff5/\u540d\u5b57",3,"ngModel","ngModelChange"],["button",""],["color","light",3,"hidden","click"],["icon-only","","name","ios-arrow-forward"],[3,"hidden","ngModel","ngModelChange"]],template:function(e,t){1&e&&(f.ec(0,"ion-header"),f.ec(1,"ion-toolbar"),f.ec(2,"ion-buttons",0),f.ac(3,"ion-back-button",1,2),f.dc(),f.ec(5,"ion-title"),f.Hc(6,"\u6613\u5b66\u6848\u4f8b"),f.dc(),f.ec(7,"ion-buttons",3),f.ec(8,"ion-button",4),f.mc("click",(function(e){return t.sortOptions(e)})),f.ac(9,"ion-icon",5),f.ec(10,"ion-text"),f.Hc(11),f.dc(),f.dc(),f.dc(),f.dc(),f.dc(),f.ec(12,"ion-content"),f.ec(13,"ion-list"),f.Fc(14,m,2,1,"ion-list-header",6),f.Fc(15,p,11,6,"ion-item",7),f.dc(),f.dc(),f.ec(16,"ion-footer"),f.ec(17,"ion-toolbar"),f.ec(18,"ion-buttons",8),f.ec(19,"ion-button",9),f.mc("click",(function(){return t.showPaiguaModal()})),f.ac(20,"ion-icon",10),f.ec(21,"ion-text"),f.Hc(22,"\u5366\u4f8b"),f.dc(),f.dc(),f.ec(23,"ion-button",9),f.mc("click",(function(){return t.showPaibaziModal()})),f.ac(24,"ion-icon",10),f.ec(25,"ion-text"),f.Hc(26,"\u547d\u4f8b"),f.dc(),f.dc(),f.ec(27,"ion-button",9),f.mc("click",(function(){return t.ShowActions()})),f.ac(28,"ion-icon",11),f.ec(29,"ion-text"),f.Hc(30,"\u7f16\u8f91"),f.dc(),f.dc(),f.ec(31,"ion-button",9),f.mc("click",(function(){return t.CheckAll()})),f.ec(32,"ion-text"),f.Hc(33,"\u5168\u9009"),f.dc(),f.dc(),f.dc(),f.ec(34,"ion-buttons",12),f.ec(35,"ion-button",4),f.mc("click",(function(){return t.EditModul=!t.EditModul})),f.ac(36,"ion-icon",13),f.dc(),f.dc(),f.ec(37,"ion-buttons",12),f.ec(38,"ion-button",4),f.mc("click",(function(){return t.showHelp()})),f.ac(39,"ion-icon",14),f.ec(40,"ion-text"),f.Hc(41,"\u5e2e\u52a9"),f.dc(),f.dc(),f.dc(),f.dc(),f.dc()),2&e&&(f.Nb(2),f.uc("hidden",t.EditModul),f.Nb(5),f.uc("hidden",t.EditModul),f.Nb(4),f.Ic(t.SortName),f.Nb(3),f.uc("ngIf",t.AllNodes),f.Nb(1),f.uc("ngForOf",t.Recordes),f.Nb(4),f.uc("hidden",t.EditModul),f.Nb(4),f.uc("hidden",t.EditModul),f.Nb(4),f.uc("hidden",!t.EditModul),f.Nb(4),f.uc("hidden",!t.EditModul))},directives:[s.t,s.Z,s.j,s.f,s.g,s.X,s.i,s.u,s.U,s.n,s.E,o.j,o.i,s.r,s.F,s.N,s.jb,c.f,c.g,s.x,s.D,s.J,s.k,s.c],styles:[""]}),e})();i.d(t,"RecordesPageModule",(function(){return v}));const g=[{path:"",component:y}];let v=(()=>{class e{}return e.\u0275mod=f.Xb({type:e}),e.\u0275inj=f.Wb({factory:function(t){return new(t||e)},imports:[[o.b,c.c,s.ab,n.i.forChild(g)]]}),e})()},HQI1:function(e,t,i){"use strict";i.d(t,"a",(function(){return h}));var o=i("c7TG"),c=i("fXoL"),n=i("ofXK");function s(e,t){if(1&e){const e=c.fc();c.ec(0,"ion-item",2),c.mc("click",(function(){c.Ac(e);const i=t.$implicit;return c.pc(2).onSelect(i.value)})),c.ec(1,"ion-text"),c.Hc(2),c.dc(),c.dc()}if(2&e){const e=t.$implicit,i=c.pc(2);c.uc("color",e.value===i.currentOption?"light":""),c.Nb(2),c.Ic(e.name)}}function r(e,t){if(1&e&&(c.ec(0,"div"),c.Fc(1,s,3,2,"ion-item",1),c.dc()),2&e){const e=c.pc();c.Nb(1),c.uc("ngForOf",e.items)}}function d(e,t){if(1&e&&c.ac(0,"ion-note",8),2&e){const e=c.pc().$implicit;c.uc("innerHtml",e.name,c.Bc)}}function l(e,t){if(1&e&&(c.ec(0,"ion-item",5),c.Fc(1,d,1,1,"ion-note",6),c.ec(2,"ion-label",7),c.ac(3,"ion-text",8),c.dc(),c.dc()),2&e){const e=t.$implicit;c.Nb(1),c.uc("ngIf",e.name),c.Nb(2),c.uc("innerHtml",e.value,c.Bc)}}function a(e,t){if(1&e&&(c.ec(0,"small"),c.ec(1,"ion-list",3),c.Fc(2,l,4,2,"ion-item",4),c.dc(),c.dc()),2&e){const e=c.pc();c.Nb(2),c.uc("ngForOf",e.items)}}let h=(()=>{class e{constructor(e){this.popoverCtrl=e,this.toselect=!0}ngOnInit(){}onSelect(e){this.popoverCtrl.dismiss(e)}}return e.\u0275fac=function(t){return new(t||e)(c.Zb(o.gb))},e.\u0275cmp=c.Tb({type:e,selectors:[["app-optionpopover"]],inputs:{currentOption:"currentOption",items:"items",toselect:"toselect"},decls:2,vars:2,consts:[[4,"ngIf"],["button","",3,"color","click",4,"ngFor","ngForOf"],["button","",3,"color","click"],[1,"ion-no-padding"],["lines","none",4,"ngFor","ngForOf"],["lines","none"],[3,"innerHtml",4,"ngIf"],["slot","end",1,"ion-text-wrap"],[3,"innerHtml"]],template:function(e,t){1&e&&(c.Fc(0,r,2,1,"div",0),c.Fc(1,a,3,1,"small",0)),2&e&&(c.uc("ngIf",t.toselect),c.Nb(1),c.uc("ngIf",!t.toselect))},directives:[n.j,n.i,o.x,o.U,o.E,o.D,o.J],styles:[""]}),e})()}}]);