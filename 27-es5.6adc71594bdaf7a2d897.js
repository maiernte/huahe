function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{AyTO:function(e,t,n){"use strict";n.r(t);var r=n("ofXK"),i=n("3Pt+"),o=n("tyNb"),s=n("c7TG"),c=n("mrSG"),a=n("LTmD"),u=n("lEof"),l=n("PKx9"),b=n("HQI1"),m=n("Y6BA"),h=n("7L00"),f=n("fXoL");function d(e,t){if(1&e){var n=f.ac();f.Zb(0,"ion-buttons",13),f.Zb(1,"ion-button",2),f.hc("click",(function(){return f.rc(n),f.jc().onclose(!0)})),f.xc(2," \u4fdd\u5b58 "),f.Yb(),f.Yb()}}function p(e,t){if(1&e){var n=f.ac();f.Zb(0,"ion-chip",2),f.hc("click",(function(){f.rc(n);var e=t.$implicit;return f.jc().DeleteAdmin(e)})),f.xc(1),f.Yb()}if(2&e){var r=t.$implicit;f.Mb(1),f.yc(r)}}function v(e,t){if(1&e){var n=f.ac();f.Zb(0,"ion-button",14),f.hc("click",(function(){return f.rc(n),f.jc().AddAdmin()})),f.xc(1,"\u6dfb\u52a0"),f.Yb()}}function g(e,t){if(1&e&&(f.Zb(0,"ion-chip"),f.Zb(1,"ion-avatar"),f.Xb(2,"img",15),f.Yb(),f.Zb(3,"ion-text"),f.xc(4),f.Yb(),f.Yb()),2&e){var n=t.$implicit;f.Mb(2),f.oc("src",n.icon,f.tc),f.Mb(2),f.yc(n.name)}}function x(e,t){if(1&e){var n=f.ac();f.Zb(0,"ion-button",14),f.hc("click",(function(){return f.rc(n),f.jc().EditRoles()})),f.xc(1,"\u7f16\u8f91"),f.Yb()}}function k(e,t){if(1&e){var n=f.ac();f.Zb(0,"ion-textarea",16),f.hc("ngModelChange",(function(e){return f.rc(n),f.jc().Forum.detail=e})),f.Yb()}if(2&e){var r=f.jc();f.oc("ngModel",r.Forum.detail)}}function w(e,t){if(1&e&&(f.Zb(0,"ion-text"),f.xc(1),f.Yb()),2&e){var n=f.jc();f.Mb(1),f.zc(" ",n.Forum.detail||"\u7248\u4e3b\u5f88\u61d2\uff0c\u6ca1\u6709\u8be6\u7ec6\u7684\u4ecb\u7ecd\u3002"," ")}}function y(e,t){if(1&e){var n=f.ac();f.Zb(0,"ion-item",5),f.Zb(1,"ion-label",9),f.Zb(2,"ion-text"),f.xc(3,"\u6dfb\u52a0\u7279\u8bb8\u7528\u6237\uff0c\u540d\u5b57\u95f4\u7528\u82f1\u6587\u5206\u53f7\u9694\u5f00\uff1a"),f.Yb(),f.Zb(4,"ion-button",17),f.hc("click",(function(){return f.rc(n),f.jc().EditMessage()})),f.xc(5,"\u7fa4\u53d1\u6d88\u606f"),f.Yb(),f.Yb(),f.Zb(6,"ion-textarea",18),f.hc("ngModelChange",(function(e){return f.rc(n),f.jc().Users=e})),f.Yb(),f.Yb()}if(2&e){var r=f.jc();f.Mb(6),f.oc("ngModel",r.Users)}}var Y,Z=((Y=function(){function e(t,n,r,i,o,s){_classCallCheck(this,e),this.toastController=t,this.loadingController=n,this.alertController=r,this.modalCtrl=i,this.forumservice=o,this.settings=s,this.Rolers=[],this.Users=""}return _createClass(e,[{key:"ngOnInit",value:function(){this.Rolers=this.settings.UserRolers(this.Forum.reader||0),this.Users=(this.Forum.user||[]).join(";")}},{key:"DeleteAdmin",value:function(e){return Object(c.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=this.IsAdmin,!t.t0){t.next=5;break}return t.next=4,this.presentConfirm("\u5220\u9664\u7248\u4e3b",null,"\u786e\u5b9a\u5220\u9664\u7528\u6237 [".concat(e,"] \u7684\u7248\u4e3b\u804c\u52a1\u5417\uff1f"));case 4:t.t0=t.sent;case 5:if(t.t1=t.t0,!t.t1){t.next=8;break}this.Forum.admin=this.Forum.admin.filter((function(t){return t!==e}));case 8:case"end":return t.stop()}}),t,this)})))}},{key:"AddAdmin",value:function(){return Object(c.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.presentInput("\u65b0\u7248\u4e3b",null,"\u7528\u6237\u8d26\u6237");case 2:if(!(t=e.sent)){e.next=8;break}return e.next=6,this.forumservice.GetUserInfo(t.name);case 6:(n=e.sent)&&n.id===t.name?this.Forum.admin.push(t.name):this.presentToast("\u627e\u4e0d\u5230\u7528\u6237 [".concat(t.name,"]"),3e3);case 8:case"end":return e.stop()}}),e,this)})))}},{key:"EditRoles",value:function(){return Object(c.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,i,o,s,c,a,u,l,b,m;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.Forum.reader||1,n=!1,e.next=4,this.alertController.create({header:"\u63a5\u6536\u8005\u89d2\u8272",inputs:[{name:"register",type:"checkbox",label:"\u6ce8\u518c\u7528\u6237",value:1,checked:(1&t)>0},{name:"vip",type:"checkbox",label:"VIP\u7528\u6237",value:2,checked:(2&t)>0},{name:"huahe",type:"checkbox",label:"\u534e\u9e64\u540c\u95e8",value:4,checked:(4&t)>0},{name:"bbs",type:"checkbox",label:"\u7248\u4e3b",value:8,checked:(8&t)>0},{name:"liuyao",type:"checkbox",label:"\u516d\u723b\u8001\u5e08",value:16,checked:(16&t)>0},{name:"bazi",type:"checkbox",label:"\u547d\u7406\u8001\u5e08",value:32,checked:(32&t)>0},{name:"fengshui",type:"checkbox",label:"\u98ce\u6c34\u8001\u5e08",value:64,checked:(64&t)>0},{name:"supermaster",type:"checkbox",label:"\u5927\u5b97\u5e08",value:128,checked:(128&t)>0},{name:"admin",type:"checkbox",label:"\u7ba1\u7406\u5458",value:256,checked:(256&t)>0}],buttons:[{text:"\u786e\u5b9a",handler:function(){n=!0}},{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary",handler:function(){}}]});case 4:return r=e.sent,e.next=7,r.present();case 7:return e.next=9,r.onWillDismiss();case 9:if(i=e.sent,o=i.data,n){e.next=13;break}return e.abrupt("return");case 13:for(s=0,c=!0,a=!1,u=void 0,e.prev=17,l=o.values[Symbol.iterator]();!(c=(b=l.next()).done);c=!0)m=b.value,s|=m;e.next=25;break;case 21:e.prev=21,e.t0=e.catch(17),a=!0,u=e.t0;case 25:e.prev=25,e.prev=26,c||null==l.return||l.return();case 28:if(e.prev=28,!a){e.next=31;break}throw u;case 31:return e.finish(28);case 32:return e.finish(25);case 33:this.Forum.reader=s,this.Rolers=this.settings.UserRolers(s);case 34:case"end":return e.stop()}}),e,this,[[17,21,25,33],[26,,28,32]])})))}},{key:"EditMessage",value:function(){return Object(c.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,i,o,s,c,a,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.Forum.user.length){e.next=2;break}return e.abrupt("return",void this.presentToast("\u8bba\u575b\u6ca1\u6709\u7279\u7ea6\u7528\u6237\u3002\u65e0\u6cd5\u53d1\u9001\u7fa4\u4f53\u4fe1\u606f\u3002",5e3));case 2:return Object(m.b)(),t={id:"",created:Date.now(),valid:0,author:this.settings.User.id,receiver:"\u8bba\u575b[".concat(this.Forum.name,"]\u7684\u4f1a\u5458"),roller:0,readed:!1,private:!0,replyable:!0,title:"\u7fa4\u53d1\u6d88\u606f",content:"\u8bf7\u8f93\u5165\u5185\u5bb9\u3002\u3002\u3002"},e.next=6,this.modalCtrl.create({component:h.a,componentProps:{Message:t,NoSend:!0}});case 6:return n=e.sent,e.next=9,n.present();case 9:return e.next=11,n.onWillDismiss();case 11:if(!1===e.sent.data){e.next=46;break}r=!0,i=!1,o=void 0,e.prev=17,s=this.Forum.user[Symbol.iterator]();case 19:if(r=(c=s.next()).done){e.next=31;break}return a=c.value,e.next=23,this.forumservice.GetUserInfo(a);case 23:return u=e.sent,t.receiver=u.id,e.next=27,this.forumservice.SendMessage(t);case 27:console.log("send message to",t.receiver);case 28:r=!0,e.next=19;break;case 31:e.next=37;break;case 33:e.prev=33,e.t0=e.catch(17),i=!0,o=e.t0;case 37:e.prev=37,e.prev=38,r||null==s.return||s.return();case 40:if(e.prev=40,!i){e.next=43;break}throw o;case 43:return e.finish(40);case 44:return e.finish(37);case 45:this.presentToast("\u60a8\u7684\u7fa4\u53d1\u4fe1\u606f\u5df2\u7ecf\u53d1\u9001\u3002\u3002\u3002",5e3);case 46:case"end":return e.stop()}}),e,this,[[17,33,37,45],[38,,40,44]])})))}},{key:"onclose",value:function(e){return Object(c.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!1!==e){t.next=4;break}this.modalCtrl.dismiss(!1),t.next=11;break;case 4:return this.Forum.user=this.Users.split(/;|\uff1b|,|\uff0c|:|\uff1a/).filter((function(e){return""!==e})),delete(n=Object(a.b)(this.Forum)).id,delete n._id,t.next=10,this.showLoading();case 10:this.forumservice.UpdatForum(n,this.Forum.id).then((function(){r.presentToast("\u66f4\u65b0\u6210\u529f\uff01",3e3),r.modalCtrl.dismiss(!0)})).catch((function(e){r.presentToast("\u66f4\u65b0\u8bba\u575b\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002",3e3)})).finally((function(){r.closeLoading()}));case 11:case"end":return t.stop()}}),t,this)})))}},{key:"presentConfirm",value:function(e,t,n){return Object(c.b)(this,void 0,void 0,regeneratorRuntime.mark((function r(){var i,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i=!1,r.next=3,this.alertController.create({header:e||"\u63d0\u793a",subHeader:t||"",message:n,buttons:[{text:"\u786e\u5b9a",handler:function(){i=!0}},{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary",handler:function(){}}]});case 3:return o=r.sent,r.next=6,o.present();case 6:return r.next=8,o.onWillDismiss();case 8:return r.abrupt("return",Promise.resolve(i));case 9:case"end":return r.stop()}}),r,this)})))}},{key:"presentInput",value:function(e,t,n){return Object(c.b)(this,void 0,void 0,regeneratorRuntime.mark((function r(){var i,o,s,c;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i=!1,r.next=3,this.alertController.create({header:e||"\u63d0\u793a",subHeader:t||"",inputs:[{name:"name",type:"text",id:"name",value:"",label:n,placeholder:n}],buttons:[{text:"\u786e\u5b9a",handler:function(){i=!0}},{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary",handler:function(){}}]});case 3:return o=r.sent,r.next=6,o.present();case 6:return r.next=8,o.onWillDismiss();case 8:return s=r.sent,c=s.data,r.abrupt("return",Promise.resolve(i?c.values:null));case 11:case"end":return r.stop()}}),r,this)})))}},{key:"presentToast",value:function(e,t){return Object(c.b)(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.toastController.create({message:e,duration:t,color:"secondary",position:"middle"});case 2:n.sent.present();case 3:case"end":return n.stop()}}),n,this)})))}},{key:"showLoading",value:function(){return Object(c.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.loadingView,e.t0){e.next=5;break}return e.next=4,this.loadingController.create({message:"\u4fdd\u5b58\u5230\u8bba\u575b...",duration:6e4});case 4:this.loadingView=e.sent;case 5:return e.next=7,this.loadingView.present();case 7:case"end":return e.stop()}}),e,this)})))}},{key:"closeLoading",value:function(){return Object(c.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.loadingView,!e.t0){e.next=5;break}return e.next=4,this.loadingView.dismiss();case 4:this.loadingView=null;case 5:case"end":return e.stop()}}),e,this)})))}},{key:"IsAdmin",get:function(){return this.settings.User.roller>=256}}]),e}()).\u0275fac=function(e){return new(e||Y)(f.Wb(s.jb),f.Wb(s.bb),f.Wb(s.b),f.Wb(s.cb),f.Wb(l.a),f.Wb(a.a))},Y.\u0275cmp=f.Qb({type:Y,selectors:[["app-forumeditor"]],inputs:{Forum:"Forum"},decls:33,vars:13,consts:[["color","primary"],["slot","start"],[3,"click"],["slot","end",4,"ngIf"],["required","","type","text",3,"readonly","ngModel","ngModelChange"],[1,"ion-text-wrap"],[3,"click",4,"ngFor","ngForOf"],["slot","end","fill","outline",3,"click",4,"ngIf"],[4,"ngFor","ngForOf"],["position","stacked"],["placeholder","\u5bf9\u8bba\u575b\u7684\u8be6\u7ec6\u8868\u8ff0\u3002\u3002\u3002","rows","6","auto-grow","true",3,"ngModel","ngModelChange",4,"ngIf"],[4,"ngIf"],["class","ion-text-wrap",4,"ngIf"],["slot","end"],["slot","end","fill","outline",3,"click"],[3,"src"],["placeholder","\u5bf9\u8bba\u575b\u7684\u8be6\u7ec6\u8868\u8ff0\u3002\u3002\u3002","rows","6","auto-grow","true",3,"ngModel","ngModelChange"],["fill","outline",3,"click"],["placeholder","\u6dfb\u52a0\u8fdb\u6765\u7684\u7528\u6237\uff0c\u6ca1\u6709\u4ee5\u4e0a\u6743\u9650\u4e5f\u53ef\u4ee5\u8bbf\u95ee\u672c\u8bba\u575b\u3002\u3002\u3002","rows","6","auto-grow","true",3,"ngModel","ngModelChange"]],template:function(e,t){1&e&&(f.Zb(0,"ion-header"),f.Zb(1,"ion-toolbar",0),f.Zb(2,"ion-buttons",1),f.Zb(3,"ion-button",2),f.hc("click",(function(){return t.onclose(!1)})),f.xc(4," \u53d6\u6d88 "),f.Yb(),f.Yb(),f.Zb(5,"ion-title"),f.xc(6),f.Yb(),f.wc(7,d,3,0,"ion-buttons",3),f.Yb(),f.Yb(),f.Zb(8,"ion-content"),f.Zb(9,"ion-item"),f.Zb(10,"ion-label"),f.xc(11,"\u540d\u5b57\uff1a"),f.Yb(),f.Zb(12,"ion-input",4),f.hc("ngModelChange",(function(e){return t.Forum.name=e})),f.Yb(),f.Yb(),f.Zb(13,"ion-item"),f.Zb(14,"ion-label"),f.xc(15,"\u7b80\u4ecb\uff1a"),f.Yb(),f.Zb(16,"ion-input",4),f.hc("ngModelChange",(function(e){return t.Forum.describe=e})),f.Yb(),f.Yb(),f.Zb(17,"ion-item",5),f.Zb(18,"ion-text"),f.xc(19,"\u7248\u4e3b\uff1a"),f.Yb(),f.wc(20,p,2,1,"ion-chip",6),f.wc(21,v,2,0,"ion-button",7),f.Yb(),f.Zb(22,"ion-item",5),f.Zb(23,"ion-text"),f.xc(24,"\u6743\u9650\uff1a"),f.Yb(),f.wc(25,g,5,2,"ion-chip",8),f.wc(26,x,2,0,"ion-button",7),f.Yb(),f.Zb(27,"ion-item",5),f.Zb(28,"ion-label",9),f.xc(29,"\u8be6\u7ec6\u4ecb\u7ecd"),f.Yb(),f.wc(30,k,1,1,"ion-textarea",10),f.wc(31,w,2,1,"ion-text",11),f.Yb(),f.wc(32,y,7,1,"ion-item",12),f.Yb()),2&e&&(f.Mb(6),f.yc(t.Forum.name),f.Mb(1),f.oc("ngIf",t.IsAdmin),f.Mb(5),f.oc("readonly",!t.IsAdmin)("ngModel",t.Forum.name),f.Mb(4),f.oc("readonly",!t.IsAdmin)("ngModel",t.Forum.describe),f.Mb(4),f.oc("ngForOf",t.Forum.admin),f.Mb(1),f.oc("ngIf",t.IsAdmin),f.Mb(4),f.oc("ngForOf",t.Rolers),f.Mb(1),f.oc("ngIf",t.IsAdmin),f.Mb(4),f.oc("ngIf",t.IsAdmin),f.Mb(1),f.oc("ngIf",!t.IsAdmin),f.Mb(1),f.oc("ngIf",t.IsAdmin))},directives:[s.s,s.Y,s.k,s.j,s.W,r.j,s.o,s.w,s.C,s.v,s.ib,i.e,i.c,i.d,s.T,r.i,s.m,s.f,s.U],styles:[""]}),Y);function F(e,t){if(1&e){var n=f.ac();f.Zb(0,"ion-item"),f.Zb(1,"ion-text"),f.xc(2,"\u8fde\u63a5\u670d\u52a1\u5668\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u5c1d\u8bd5\u3002"),f.Yb(),f.Zb(3,"ion-button",13),f.hc("click",(function(){return f.rc(n),f.jc().Reconnect(!0)})),f.xc(4,"\u91cd\u65b0\u8fde\u63a5"),f.Yb(),f.Yb()}}function C(e,t){1&e&&f.Xb(0,"ion-icon",20)}function M(e,t){if(1&e){var n=f.ac();f.Zb(0,"ion-item-sliding"),f.Zb(1,"ion-item",14),f.hc("click",(function(){f.rc(n);var e=t.$implicit;return f.jc(2).NaviToForum(e.id)})),f.Zb(2,"ion-label",15),f.Zb(3,"ion-text"),f.xc(4),f.Yb(),f.Zb(5,"ion-text",8),f.Zb(6,"h6"),f.xc(7),f.Yb(),f.Yb(),f.wc(8,C,1,0,"ion-icon",16),f.Zb(9,"ion-text",17),f.xc(10),f.Yb(),f.Zb(11,"ion-text",17),f.xc(12),f.Yb(),f.Yb(),f.Yb(),f.Zb(13,"ion-item-options",18),f.Zb(14,"ion-item-option",9),f.hc("click",(function(){f.rc(n);var e=t.$implicit;return f.jc(2).ForumEditor(e.name)})),f.Xb(15,"ion-icon",19),f.Yb(),f.Yb(),f.Yb()}if(2&e){var r=t.$implicit;f.Mb(1),f.oc("detail",!r.block),f.Mb(3),f.zc(" ",r.name," "),f.Mb(3),f.yc(r.describe),f.Mb(1),f.oc("ngIf",r.block),f.Mb(2),f.zc("\u65b0\u8d34\uff1a",r.modified.toChinaStr(),""),f.Mb(2),f.zc("\u5e16\u6570\uff1a",r.topiccount,"")}}function O(e,t){if(1&e&&(f.Zb(0,"ion-item-group"),f.Zb(1,"ion-item-divider"),f.Zb(2,"ion-label"),f.xc(3),f.Yb(),f.Yb(),f.wc(4,M,16,6,"ion-item-sliding",7),f.Yb()),2&e){var n=t.$implicit;f.Mb(3),f.yc(n.name),f.Mb(1),f.oc("ngForOf",n.items)}}function R(e,t){if(1&e){var n=f.ac();f.Zb(0,"ion-buttons",2),f.Zb(1,"ion-button",9),f.hc("click",(function(e){return f.rc(n),f.jc().personalOption(e)})),f.Xb(2,"ion-icon",21),f.Zb(3,"ion-text"),f.xc(4,"\u6211\u7684"),f.Yb(),f.Yb(),f.Yb()}}var j,I=((j=function(){function e(t,n,r,i,o,s,c,a){_classCallCheck(this,e),this.loadingController=t,this.modalCtrl=n,this.alertController=r,this.settings=i,this.forumservice=o,this.host=s,this.popoverCtrl=c,this.router=a,this.forums=[],this.showallforums=!1,this.loadfailed=!1,this.hasuser=!0,this.SortKey="lasttopic"}return _createClass(e,[{key:"ngOnInit",value:function(){return Object(c.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.settings.WaitInit();case 2:this.user=this.settings.User||m.a,this.hasuser=this.settings.HasUser,this.showallforums=!this.hasuser,this.Reconnect(!1);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"Reconnect",value:function(e){return Object(c.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.loadfailed=!1,t.next=3,this.showLoading();case 3:this.forumservice.ForumList(e).then((function(e){n.buildForumList(e),n.forumservice.ForumMG.Reset()})).catch((function(e){console.log("forum reconnect",e),n.loadfailed=!0})).finally((function(){n.closeLoading()}));case 4:case"end":return t.stop()}}),t,this)})))}},{key:"ChangeList",value:function(){this.showallforums=!this.showallforums,this.Reconnect(!1)}},{key:"NaviToForum",value:function(e){this.router.navigateByUrl("menu/topiclist/".concat(e))}},{key:"ForumEditor",value:function(e){return Object(c.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,i,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.forumservice.ForumList();case 2:return t.t0=function(t){return t.name===e},n=t.sent.find(t.t0),t.next=6,this.modalCtrl.create({component:Z,componentProps:{Forum:n}});case 6:return r=t.sent,t.next=9,r.present();case 9:return t.next=11,r.onWillDismiss();case 11:i=t.sent,o=i.data,console.log("Forumeditor close"),!0===o&&this.Reconnect(!1);case 14:case"end":return t.stop()}}),t,this)})))}},{key:"Setting",value:function(){return Object(c.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,i,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.settings.ForumSetting,n=!1,e.next=4,this.alertController.create({header:"\u663e\u793a\u504f\u597d",inputs:[{name:"showimg",type:"checkbox",label:"\u663e\u793a/\u9690\u85cf \u56fe\u7247",value:1,checked:t.showimg},{name:"vip",type:"checkbox",label:"\u663e\u793a/\u9690\u85cf \u5366\u4f8b",value:2,checked:t.showgua},{name:"huahe",type:"checkbox",label:"\u663e\u793a/\u9690\u85cf \u547d\u4f8b",value:3,checked:t.showbazi},{name:"bbs",type:"checkbox",label:"\u8d34\u5185\u663e\u793a\u56fe\u7247",value:4,checked:!t.imgOut},{name:"liuyao",type:"checkbox",label:"\u8d34\u5185\u663e\u793a\u5366\u4f8b",value:5,checked:!t.guaOut},{name:"bazi",type:"checkbox",label:"\u8d34\u5185\u663e\u793a\u547d\u4f8b",value:6,checked:!t.baziOut}],buttons:[{text:"\u786e\u5b9a",handler:function(){n=!0}},{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary",handler:function(){}}]});case 4:return r=e.sent,e.next=7,r.present();case 7:return e.next=9,r.onWillDismiss();case 9:if(i=e.sent,o=i.data,n){e.next=13;break}return e.abrupt("return");case 13:s={showimg:o.values.includes(1),showgua:o.values.includes(2),showbazi:o.values.includes(3),imgOut:!o.values.includes(4),guaOut:!o.values.includes(5),baziOut:!o.values.includes(6)},this.settings.ForumSetting=s;case 15:case"end":return e.stop()}}),e,this)})))}},{key:"sortOptions",value:function(e){return Object(c.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.popoverCtrl.create({component:b.a,event:e,componentProps:{items:[{name:"\u9ed8\u8ba4",value:"id"},{name:"\u65f6\u95f4",value:"lasttopic"}],currentOption:this.SortKey},translucent:!0});case 2:return n=t.sent,t.next=5,n.present();case 5:return t.next=7,n.onDidDismiss();case 7:r=t.sent,((i=r.data)||this.SortKey)!==this.SortKey&&(this.SortKey=i.toString());case 10:case"end":return t.stop()}}),t,this)})))}},{key:"personalOption",value:function(e){return Object(c.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,i,o,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=[{name:"\u5e16\u5b50",value:"forum_me"},{name:"\u6c42\u52a9",value:"forum_ticket"},{name:"\u6d88\u606f",value:"messagelist"},{name:"\u627e\u4eba",value:"searchuser"}],this.user.roller>=16&&n.insert(2,{name:"\u5ba2\u6237\u6c42\u52a9",value:"forum_master"}),t.next=4,this.popoverCtrl.create({component:b.a,event:e,componentProps:{items:n,currentOption:"forum_me"},translucent:!0});case 4:return r=t.sent,t.next=7,r.present();case 7:return t.next=9,r.onDidDismiss();case 9:i=t.sent,o=i.data,!(s=o||"").IsNullOrEmpty()&&s.startsWith("forum_")?this.NaviToForum(s):"messagelist"===s?this.router.navigateByUrl("menu/messagelist/true"):"searchuser"===s&&this.router.navigateByUrl("menu/searchuser");case 13:case"end":return t.stop()}}),t,this)})))}},{key:"buildForumList",value:function(e){var t=this;this.initForums(),e.map((function(e){var n=new Date(0===e.lasttopic?Date.now():e.lasttopic),r=e.admin.includes(t.user.id);r=(r=r||e.user.includes(t.user.id))||0===e.reader||(e.reader&t.user.roller)>0;var i={id:e.id,name:e.name,describe:e.describe,modified:n,block:!r,group:e.group,topiccount:e.topiccount};return!0!==t.showallforums&&!1!==i.block||t.forums.find((function(e){return e.group===i.group})).items.push(i),i}))}},{key:"initForums",value:function(){this.forums=[{group:0,name:"\u6613\u5b66\u533a",items:[]},{group:1,name:"\u7406\u5b66\u533a",items:[]},{group:2,name:"\u85cf\u5b66\u533a",items:[]},{group:10,name:"\u4e8b\u52a1\u533a",items:[]}]}},{key:"showLoading",value:function(){return Object(c.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.loadingView,e.t0){e.next=5;break}return e.next=4,this.loadingController.create({message:"\u6b63\u5728\u83b7\u53d6\u8bba\u575b\u5217\u8868...",duration:6e4});case 4:this.loadingView=e.sent;case 5:return e.next=7,this.loadingView.present();case 7:case"end":return e.stop()}}),e,this)})))}},{key:"closeLoading",value:function(){return Object(c.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.loadingView,!e.t0){e.next=5;break}return e.next=4,this.loadingView.dismiss();case 4:this.loadingView=null;case 5:case"end":return e.stop()}}),e,this)})))}},{key:"Forums",get:function(){return this.forums}},{key:"HasUser",get:function(){return this.hasuser}}]),e}()).\u0275fac=function(e){return new(e||j)(f.Wb(s.bb),f.Wb(s.cb),f.Wb(s.b),f.Wb(a.a),f.Wb(l.a),f.Wb(u.a),f.Wb(s.fb),f.Wb(o.g))},j.\u0275cmp=f.Qb({type:j,selectors:[["app-forum"]],decls:28,vars:3,consts:[["color","primary"],["slot","start"],["slot","end"],["size","small",3,"click"],["slot","icon-only","name","md-code-working"],["name","md-funnel"],[4,"ngIf"],[4,"ngFor","ngForOf"],["color","medium"],[3,"click"],["name","refresh"],["name","settings"],["slot","end",4,"ngIf"],["fill","outline",3,"click"],[3,"detail","click"],[1,"ion-text-wrap"],["name","ios-lock","style","margin-right: 10px;",4,"ngIf"],["color","medium",1,"ion-margin-end"],["side","start"],["slot","icon-only","name","information-circle"],["name","ios-lock",2,"margin-right","10px"],["name","person"]],template:function(e,t){1&e&&(f.Zb(0,"ion-header"),f.Zb(1,"ion-toolbar",0),f.Zb(2,"ion-buttons",1),f.Xb(3,"ion-menu-button"),f.Yb(),f.Zb(4,"ion-title"),f.xc(5,"\u8ba8\u8bba\u533a\u5217\u8868"),f.Yb(),f.Zb(6,"ion-buttons",2),f.Zb(7,"ion-button",3),f.hc("click",(function(){return t.ChangeList()})),f.Xb(8,"ion-icon",4),f.Yb(),f.Zb(9,"ion-button",3),f.hc("click",(function(e){return t.sortOptions(e)})),f.Xb(10,"ion-icon",5),f.Zb(11,"ion-text"),f.xc(12,"\u6392\u5e8f"),f.Yb(),f.Yb(),f.Yb(),f.Yb(),f.Yb(),f.Zb(13,"ion-content"),f.wc(14,F,5,0,"ion-item",6),f.wc(15,O,5,2,"ion-item-group",7),f.Yb(),f.Zb(16,"ion-footer"),f.Zb(17,"ion-toolbar",8),f.Zb(18,"ion-buttons",1),f.Zb(19,"ion-button",9),f.hc("click",(function(){return t.Reconnect(!0)})),f.Xb(20,"ion-icon",10),f.Zb(21,"ion-text"),f.xc(22,"\u5237\u65b0"),f.Yb(),f.Yb(),f.Zb(23,"ion-button",9),f.hc("click",(function(){return t.Setting()})),f.Xb(24,"ion-icon",11),f.Zb(25,"ion-text"),f.xc(26,"\u8bbe\u7f6e"),f.Yb(),f.Yb(),f.Yb(),f.wc(27,R,5,0,"ion-buttons",12),f.Yb(),f.Yb()),2&e&&(f.Mb(14),f.oc("ngIf",t.loadfailed),f.Mb(1),f.oc("ngForOf",t.Forums),f.Mb(12),f.oc("ngIf",t.HasUser))},directives:[s.s,s.Y,s.k,s.G,s.W,s.j,s.t,s.T,s.o,r.j,r.i,s.q,s.w,s.y,s.x,s.C,s.B,s.A,s.z],styles:[""]}),j);n.d(t,"ForumPageModule",(function(){return A}));var W,U=[{path:"",component:I}],A=((W=function e(){_classCallCheck(this,e)}).\u0275mod=f.Ub({type:W}),W.\u0275inj=f.Tb({factory:function(e){return new(e||W)},imports:[[r.b,i.a,s.Z,o.i.forChild(U)]]}),W)},HQI1:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n("c7TG"),i=n("fXoL"),o=n("ofXK");function s(e,t){if(1&e){var n=i.ac();i.Zb(0,"ion-item",2),i.hc("click",(function(){i.rc(n);var e=t.$implicit;return i.jc(2).onSelect(e.value)})),i.Zb(1,"ion-text"),i.xc(2),i.Yb(),i.Yb()}if(2&e){var r=t.$implicit,o=i.jc(2);i.oc("color",r.value===o.currentOption?"light":""),i.Mb(2),i.yc(r.name)}}function c(e,t){if(1&e&&(i.Zb(0,"div"),i.wc(1,s,3,2,"ion-item",1),i.Yb()),2&e){var n=i.jc();i.Mb(1),i.oc("ngForOf",n.items)}}function a(e,t){if(1&e&&(i.Zb(0,"ion-item",4),i.Zb(1,"ion-note"),i.xc(2),i.Yb(),i.Zb(3,"ion-label",5),i.xc(4),i.Yb(),i.Yb()),2&e){var n=t.$implicit;i.Mb(2),i.yc(n.name),i.Mb(2),i.zc(" ",n.value," ")}}function u(e,t){if(1&e&&(i.Zb(0,"small"),i.wc(1,a,5,2,"ion-item",3),i.Yb()),2&e){var n=i.jc();i.Mb(1),i.oc("ngForOf",n.items)}}var l=function(){var e=function(){function e(t){_classCallCheck(this,e),this.popoverCtrl=t,this.toselect=!0}return _createClass(e,[{key:"ngOnInit",value:function(){}},{key:"onSelect",value:function(e){this.popoverCtrl.dismiss(e)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(i.Wb(r.fb))},e.\u0275cmp=i.Qb({type:e,selectors:[["app-optionpopover"]],inputs:{currentOption:"currentOption",items:"items",toselect:"toselect"},decls:2,vars:2,consts:[[4,"ngIf"],["button","",3,"color","click",4,"ngFor","ngForOf"],["button","",3,"color","click"],["lines","none",4,"ngFor","ngForOf"],["lines","none"],["slot","end",1,"ion-text-wrap"]],template:function(e,t){1&e&&(i.wc(0,c,2,1,"div",0),i.wc(1,u,2,1,"small",0)),2&e&&(i.oc("ngIf",t.toselect),i.Mb(1),i.oc("ngIf",!t.toselect))},directives:[o.j,o.i,r.w,r.T,r.I,r.C],styles:[""]}),e}()}}]);