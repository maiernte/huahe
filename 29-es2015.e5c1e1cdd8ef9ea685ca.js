(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{HQI1:function(t,i,c){"use strict";c.d(i,"a",(function(){return u}));var e=c("c7TG"),o=c("fXoL"),n=c("ofXK");function s(t,i){if(1&t){const t=o.ec();o.dc(0,"ion-item",3),o.lc("click",(function(){o.Cc(t);const c=i.$implicit;return o.oc(2).onSelect(c.value)})),o.dc(1,"ion-text"),o.Jc(2),o.cc(),o.cc()}if(2&t){const t=i.$implicit,c=o.oc(2);o.vc("color",t.value===c.currentOption?"light":""),o.Nb(2),o.Kc(t.name)}}function a(t,i){if(1&t&&(o.dc(0,"div"),o.Hc(1,s,3,2,"ion-item",2),o.cc()),2&t){const t=o.oc();o.Nb(1),o.vc("ngForOf",t.items)}}function r(t,i){if(1&t&&(o.dc(0,"ion-note"),o.Jc(1),o.cc()),2&t){const t=o.oc().$implicit;o.Nb(1),o.Lc(" ",t.name," ")}}function d(t,i){if(1&t&&(o.dc(0,"ion-item",6),o.Hc(1,r,2,1,"ion-note",0),o.dc(2,"ion-label",7),o.dc(3,"small"),o.Zb(4,"ion-text",8),o.cc(),o.cc(),o.cc()),2&t){const t=i.$implicit;o.Nb(1),o.vc("ngIf",t.name),o.Nb(3),o.vc("innerHtml",t.value,o.Dc)}}function l(t,i){if(1&t&&(o.dc(0,"ion-list",4),o.Hc(1,d,5,2,"ion-item",5),o.cc()),2&t){const t=o.oc();o.Nb(1),o.vc("ngForOf",t.items)}}let u=(()=>{class t{constructor(t){this.popoverCtrl=t,this.toselect=!0}ngOnInit(){}onSelect(t){this.popoverCtrl.dismiss(t)}}return t.\u0275fac=function(i){return new(i||t)(o.Yb(e.db))},t.\u0275cmp=o.Sb({type:t,selectors:[["app-optionpopover"]],inputs:{currentOption:"currentOption",items:"items",toselect:"toselect"},decls:2,vars:2,consts:[[4,"ngIf"],["class","ion-no-padding",4,"ngIf"],["button","",3,"color","click",4,"ngFor","ngForOf"],["button","",3,"color","click"],[1,"ion-no-padding"],["lines","none",4,"ngFor","ngForOf"],["lines","none"],["slot","end",1,"ion-text-wrap"],[3,"innerHtml"]],template:function(t,i){1&t&&(o.Hc(0,a,2,1,"div",0),o.Hc(1,l,2,1,"ion-list",1)),2&t&&(o.vc("ngIf",i.toselect),o.Nb(1),o.vc("ngIf",!i.toselect))},directives:[n.j,n.i,e.w,e.S,e.D,e.C,e.G],styles:[""]}),t})()},qNzN:function(t,i,c){"use strict";c.r(i);var e=c("ofXK"),o=c("3Pt+"),n=c("tyNb"),s=c("c7TG"),a=c("mrSG"),r=c("LTmD"),d=c("lEof"),l=c("PKx9"),u=c("HQI1"),h=c("8/yo"),f=c("G6JS"),m=c("Y6BA"),g=c("fXoL"),p=c("i/bi");function b(t,i){if(1&t){const t=g.ec();g.dc(0,"ion-buttons",10),g.dc(1,"ion-button",11),g.lc("click",(function(){return g.Cc(t),g.oc(2).EditTopic(null)})),g.Zb(2,"ion-icon",12),g.dc(3,"ion-text"),g.Jc(4,"\u65b0\u8d34"),g.cc(),g.cc(),g.cc()}}function v(t,i){if(1&t&&(g.dc(0,"ion-header"),g.dc(1,"ion-toolbar",6),g.dc(2,"ion-buttons",7),g.Zb(3,"ion-back-button",8),g.cc(),g.dc(4,"ion-title"),g.Jc(5),g.cc(),g.Hc(6,b,5,0,"ion-buttons",9),g.cc(),g.cc()),2&t){const t=g.oc();g.Nb(5),g.Lc(": ",t.Titel," :"),g.Nb(1),g.vc("ngIf",t.PageType>=-2&&t.HasUser)}}function T(t,i){if(1&t){const t=g.ec();g.dc(0,"ion-button",20),g.lc("click",(function(){return g.Cc(t),g.oc(2).JinghuaTopics(-2,!0)})),g.Jc(1," [\u7cbe\u534e] "),g.cc()}}function y(t,i){if(1&t){const t=g.ec();g.dc(0,"ion-button",14),g.lc("click",(function(){return g.Cc(t),g.oc(2).JinghuaTopics(0,!0)})),g.Jc(1," [\u9996\u9875] "),g.cc()}}function N(t,i){if(1&t){const t=g.ec();g.dc(0,"ion-item-divider",13),g.dc(1,"ion-label",7),g.dc(2,"ion-text"),g.Jc(3,"\u7248\u4e3b\uff1a"),g.cc(),g.cc(),g.dc(4,"ion-buttons",7),g.dc(5,"ion-button",14),g.lc("click",(function(){g.Cc(t);const i=g.oc();return i.ShowUserInfo(i.Admin)})),g.Jc(6),g.cc(),g.cc(),g.dc(7,"ion-buttons",10),g.dc(8,"ion-button",15),g.Zb(9,"ion-icon",16),g.Jc(10," \u9996\u9875 "),g.cc(),g.dc(11,"ion-button",17),g.lc("click",(function(){return g.Cc(t),g.oc().EditTopic(null)})),g.Zb(12,"ion-icon",12),g.dc(13,"ion-text"),g.Jc(14,"[+\u65b0\u8d34]"),g.cc(),g.cc(),g.Hc(15,T,2,0,"ion-button",18),g.Hc(16,y,2,0,"ion-button",19),g.cc(),g.cc()}if(2&t){const t=g.oc();g.Nb(6),g.Kc(t.Admin),g.Nb(9),g.vc("ngIf",0===t.PageType),g.Nb(1),g.vc("ngIf",-2===t.PageType)}}function I(t,i){if(1&t){const t=g.ec();g.dc(0,"ion-item",21),g.lc("click",(function(){g.Cc(t);const c=i.$implicit;return g.oc().Navi2Topic(c)})),g.dc(1,"ion-thumbnail",7),g.Zb(2,"img",22),g.cc(),g.dc(3,"ion-label",23),g.dc(4,"ion-text"),g.Jc(5),g.cc(),g.dc(6,"ion-text",24),g.Jc(7,"[\u7f6e\u9876]"),g.cc(),g.Zb(8,"br"),g.dc(9,"ion-note"),g.Jc(10),g.cc(),g.Zb(11,"br"),g.dc(12,"ion-note"),g.dc(13,"small"),g.Jc(14),g.cc(),g.cc(),g.Zb(15,"br"),g.dc(16,"ion-note"),g.dc(17,"small"),g.Jc(18),g.cc(),g.cc(),g.Zb(19,"br"),g.dc(20,"ion-note"),g.dc(21,"small"),g.Jc(22),g.cc(),g.cc(),g.dc(23,"ion-note"),g.dc(24,"small"),g.Jc(25),g.cc(),g.cc(),g.cc(),g.cc()}if(2&t){const t=i.$implicit,c=g.oc();g.Nb(2),g.vc("src",t.avatar,g.Ec),g.Nb(3),g.Kc(t.title),g.Nb(5),g.Lc("\u4f5c\u8005\uff1a[",t.author,"]"),g.Nb(4),g.Lc("\u53d1\u5e16\u65f6\u95f4: ",c.DateText(t.created),""),g.Nb(4),g.Lc("\u56de\u5e16\u65f6\u95f4: ",c.DateText(t.update),""),g.Nb(4),g.Lc("\u56de\u5e16\u6570\u91cf: ",t.child,""),g.Nb(3),g.Lc("\u6d4f\u89c8\u6570\u91cf: ",t.view,"")}}function x(t,i){1&t&&(g.dc(0,"ion-text",24),g.Jc(1,"[\u7cbe\u534e]"),g.cc())}function L(t,i){if(1&t){const t=g.ec();g.dc(0,"ion-item",21),g.lc("click",(function(){g.Cc(t);const c=i.$implicit;return g.oc().Navi2Topic(c)})),g.dc(1,"ion-thumbnail",7),g.Zb(2,"img",22),g.cc(),g.dc(3,"ion-label",23),g.dc(4,"ion-text"),g.Jc(5),g.cc(),g.Hc(6,x,2,0,"ion-text",25),g.Zb(7,"br"),g.dc(8,"ion-note"),g.Jc(9),g.cc(),g.Zb(10,"br"),g.dc(11,"ion-note"),g.dc(12,"small"),g.Jc(13),g.cc(),g.cc(),g.Zb(14,"br"),g.dc(15,"ion-note"),g.dc(16,"small"),g.Jc(17),g.cc(),g.cc(),g.Zb(18,"br"),g.dc(19,"ion-note"),g.dc(20,"small"),g.Jc(21),g.cc(),g.cc(),g.dc(22,"ion-note"),g.dc(23,"small"),g.Jc(24),g.cc(),g.cc(),g.cc(),g.cc()}if(2&t){const t=i.$implicit,c=g.oc();g.Nb(2),g.vc("src",t.avatar,g.Ec),g.Nb(3),g.Kc(t.title),g.Nb(1),g.vc("ngIf",t.good),g.Nb(3),g.Lc("\u4f5c\u8005\uff1a[",t.author,"]"),g.Nb(4),g.Lc("\u53d1\u5e16\u65f6\u95f4: ",c.DateText(t.created),""),g.Nb(4),g.Lc("\u56de\u5e16\u65f6\u95f4: ",c.DateText(t.update),""),g.Nb(4),g.Lc("\u56de\u5e16\u6570\u91cf: ",t.child,""),g.Nb(3),g.Lc("\u6d4f\u89c8\u6570\u91cf: ",t.view,"")}}function w(t,i){if(1&t){const t=g.ec();g.dc(0,"div",26),g.dc(1,"sui-pagination",27),g.lc("pageChange",(function(i){return g.Cc(t),g.oc().PageIndex=i})),g.cc(),g.cc()}if(2&t){const t=g.oc();g.Nb(1),g.vc("collectionSize",t.PageSum)("pageSize",20)("maxSize",t.MaxPageButtons)("hasNavigationLinks",!0)("hasBoundaryLinks",!0)("page",t.PageIndex)}}let P=(()=>{class t{constructor(t,i,c,e,o,n,s,a){this.loadingController=t,this.settings=i,this.forumservice=c,this.host=e,this.popoverCtrl=o,this.modalCtrl=n,this.route=s,this.router=a,this.pageindex=0,this.cache=[],this.loadfailed=!0,this.Titel="\u8bba\u575b",this.SortKey="update",this.Pages=[0],this.PageType=0,this.PageSum=0,this.Topics=[],this.TTopics=[],this.route.params.subscribe(t=>{this.forumid=t.forumid})}ngOnInit(){return Object(a.b)(this,void 0,void 0,(function*(){yield this.settings.WaitInit(),this.loadingView=yield this.loadingController.create({message:"\u6b63\u5728\u83b7\u53d6\u8bba\u575b\u5e16\u5b50...",duration:6e4}),this.user=this.settings.User||m.a,"forum_me"===this.forumid?(this.Titel="\u6211\u7684\u5e16\u5b50",this.PageType=-3):"forum_ticket"===this.forumid?(this.Titel="\u6211\u7684\u6c42\u52a9",this.PageType=-4):"forum_master"===this.forumid?(this.Titel="\u5411\u6211\u7684\u53d1\u95ee",this.PageType=-5):this.PageType=0,this.PageIndex=0}))}get IsWeb(){return"web"===m.b}get HasUser(){return this.settings.HasUser&&this.user!==m.a}get MaxPageButtons(){return this.settings.DeviceWidth>=400?7:2}get DefaultAvatar(){return this.settings.Avatar()}get PageIndex(){return this.pageindex}set PageIndex(t){this.pageindex=t,0!==this.PageType?this.JinghuaTopics(this.PageType):this.Reconnect().then(t=>{this.loadfailed=!t})}get Admin(){return this.admin}DateText(t){if(!t)return"\u65e0";const i=new Date(t);return i.toChinaStr()+` ${i.getHours()}:${i.getMinutes()}:${i.getSeconds()}`}doRefresh(t){this.Reconnect().then(t=>{this.loadfailed=!t}).catch(t=>{console.log(t)}).finally(()=>{t.target.complete()})}Reconnect(){return Object(a.b)(this,void 0,void 0,(function*(){return yield this.showLoading(),this.forumservice.ForumList().then(t=>(this.forum=t.find(t=>t.id===this.forumid),this.Titel=this.forum.name,this.admin=this.forum.admin.join("\u3001"),this.forumservice.LoadTopicList(this.forum.id,this.PageIndex,0))).then(t=>(this.PageSum=t.sum,this.Topics=t.data.sort((t,i)=>(i.update||i.created)-(t.update||t.created)),this.Topics.forEach(t=>t.avatar=this.DefaultAvatar),this.updateUserAvatar(this.Topics),this.forumservice.LoadTopicList(this.forum.id,0,-1))).then(t=>(this.TTopics=t.data,this.TTopics.forEach(t=>t.avatar=this.DefaultAvatar),this.updateUserAvatar(this.TTopics),!0)).catch(t=>!1).finally(()=>{this.closeLoading()})}))}JinghuaTopics(t,i=!1){return Object(a.b)(this,void 0,void 0,(function*(){i&&(this.pageindex=0,this.PageType=t),t<0?(yield this.showLoading(),this.forumservice.LoadTopicList(t<-2?null:this.forumid,this.PageIndex,t).then(t=>{this.PageSum=t.sum,this.Topics=t.data,this.Topics.forEach(t=>t.avatar=this.DefaultAvatar),this.updateUserAvatar(this.Topics),this.loadfailed=!1}).finally(()=>{this.closeLoading()})):this.Reconnect()}))}Navi2Topic(t){let i=t.forumid;i="forum_ticket"===this.forumid?"\u6c42\u52a9\uff1a"+i:i,i="forum_master"===this.forumid?"\u89e3\u7b54\u5ba2\u6237":i,this.router.navigateByUrl(`menu/topicdetail/${i}/${t.id}`)}updateUserAvatar(t){t.forEach(t=>{t.avatar&&t.avatar!==this.DefaultAvatar||this.forumservice.GetUserInfo(t.author).then(i=>{const c=(i||m.a).avatar||"";t.avatar=c.IsNullOrEmpty()?this.settings.Avatar(i.gender):c,t.showImg=!0,t.showGua=!0,t.showBazi=!0})})}sortOptions(t){return Object(a.b)(this,void 0,void 0,(function*(){const i=yield this.popoverCtrl.create({component:u.a,event:t,componentProps:{items:[{name:"\u521b\u5efa\u65f6\u95f4",value:"created"},{name:"\u4fee\u6539\u65f6\u95f4",value:"update"}],currentOption:this.SortKey},translucent:!0});yield i.present();const{data:c}=yield i.onDidDismiss();(c||this.SortKey)!==this.SortKey&&(this.SortKey=c.toString())}))}EditTopic(t){return Object(a.b)(this,void 0,void 0,(function*(){const i=yield this.modalCtrl.create({component:h.a,componentProps:{MainTopic:t||this.CreateMainTopic(),forumid:this.forumid,forumname:this.forum.name}});yield i.present();const{data:c}=yield i.onWillDismiss();c&&this.AddToLocal(c)}))}ShowUserInfo(t){return Object(a.b)(this,void 0,void 0,(function*(){const i=yield this.modalCtrl.create({component:f.a,componentProps:{Uerid:t}});yield i.present(),yield i.onWillDismiss()}))}GoPage(t){console.log("change page",t)}AddToLocal(t){t.avatar=this.settings.User.avatar,t.forumid===this.forumid&&this.forumservice.ForumMG.SetTopic(t,t.forumid)}CreateMainTopic(){const t=this.settings.User,i=Date.now();return{id:"",created:i,modified:i,author:t.id,forumid:this.forumid,title:"",top:0,good:!1,update:0,gua:null,bazi:null,img:null,content:"",frozen:!1,deleted:!1,child:0,view:0}}showLoading(){return Object(a.b)(this,void 0,void 0,(function*(){this.loadingView||(this.loadingView=yield this.loadingController.create({message:"\u6b63\u5728\u83b7\u53d6\u8bba\u575b\u5e16\u5b50...",duration:6e4})),yield this.loadingView.present()}))}closeLoading(){return Object(a.b)(this,void 0,void 0,(function*(){this.loadingView&&(yield this.loadingView.dismiss(),this.loadingView=null)}))}SearchCache(t,i=!1){const c=this.cache.find(i=>i.forum===t);return c?i?c.TT:c.T:null}SaveCache(t,i,c=!1){let e=this.cache.find(i=>i.forum===t);e||(e={forum:t,TT:null,T:null},this.cache.push(e)),c?e.TT=i||[]:e.T=i||[]}CleanCache(t){if(t){const i=this.cache.find(i=>i.forum===t);i&&(i.T=null,i.TT=null)}else this.cache=[]}}return t.\u0275fac=function(i){return new(i||t)(g.Yb(s.Z),g.Yb(r.a),g.Yb(l.a),g.Yb(d.a),g.Yb(s.db),g.Yb(s.ab),g.Yb(n.a),g.Yb(n.g))},t.\u0275cmp=g.Sb({type:t,selectors:[["app-topiclist"]],decls:9,vars:5,consts:[[4,"ngIf"],["slot","fixed",3,"ionRefresh"],["ion-no-padding",""],["ion-no-padding","","slot","fixed",4,"ngIf"],["detail","",3,"click",4,"ngFor","ngForOf"],["class","ui very basic segment",4,"ngIf"],["color","primary"],["slot","start"],["defaulthref","","text","\u8fd4\u56de"],["slot","end",4,"ngIf"],["slot","end"],["size","small",3,"click"],["slot","icon-only","name","add"],["ion-no-padding","","slot","fixed"],["color","primary",3,"click"],["routerLink","/menu/forum"],["name","home"],[3,"click"],["color","danger",3,"click",4,"ngIf"],["color","primary",3,"click",4,"ngIf"],["color","danger",3,"click"],["detail","",3,"click"],[3,"src"],[1,"ion-text-wrap"],["color","danger"],["color","danger",4,"ngIf"],[1,"ui","very","basic","segment"],[1,"ui","right","floated",3,"collectionSize","pageSize","maxSize","hasNavigationLinks","hasBoundaryLinks","page","pageChange"]],template:function(t,i){1&t&&(g.Hc(0,v,7,2,"ion-header",0),g.dc(1,"ion-content"),g.dc(2,"ion-refresher",1),g.lc("ionRefresh",(function(t){return i.doRefresh(t)})),g.Zb(3,"ion-refresher-content"),g.cc(),g.dc(4,"ion-list",2),g.Hc(5,N,17,3,"ion-item-divider",3),g.Hc(6,I,26,7,"ion-item",4),g.Hc(7,L,25,8,"ion-item",4),g.Hc(8,w,2,6,"div",5),g.cc(),g.cc()),2&t&&(g.vc("ngIf",!i.IsWeb),g.Nb(5),g.vc("ngIf",i.PageType>=-2),g.Nb(1),g.vc("ngForOf",i.TTopics),g.Nb(1),g.vc("ngForOf",i.Topics),g.Nb(1),g.vc("ngIf",!i.loadfailed))},directives:[e.j,s.m,s.I,s.J,s.D,e.i,s.s,s.W,s.i,s.f,s.g,s.U,s.h,s.t,s.S,s.x,s.C,s.eb,n.h,s.w,s.T,s.G,p.f],styles:[""]}),t})();var J=c("Gfuc"),C=c("9UMr");c.d(i,"TopiclistPageModule",(function(){return k}));const S=[{path:"",component:P}];let k=(()=>{class t{}return t.\u0275mod=g.Wb({type:t}),t.\u0275inj=g.Vb({factory:function(i){return new(i||t)},imports:[[J.a,C.a,e.b,p.e,o.c,s.X,n.j.forChild(S)]]}),t})()}}]);