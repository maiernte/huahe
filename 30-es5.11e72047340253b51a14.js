function _wrapRegExp(e,t){_wrapRegExp=function(e,t){return new i(e,void 0,t)};var n=_wrapNativeSuper(RegExp),r=RegExp.prototype,o=new WeakMap;function i(e,t,r){var i=n.call(this,e,t);return o.set(i,r||o.get(e)),i}function c(e,t){var n=o.get(t);return Object.keys(n).reduce((function(t,r){return t[r]=e[n[r]],t}),Object.create(null))}return _inherits(i,n),i.prototype.exec=function(e){var t=r.exec.call(this,e);return t&&(t.groups=c(t,this)),t},i.prototype[Symbol.replace]=function(e,t){if("string"==typeof t){var n=o.get(this);return r[Symbol.replace].call(this,e,t.replace(/\$<([^>]+)>/g,(function(e,t){return"$"+n[t]})))}if("function"==typeof t){var i=this;return r[Symbol.replace].call(this,e,(function(){var e=[];return e.push.apply(e,arguments),"object"!=typeof e[e.length-1]&&e.push(c(e,i)),t.apply(this,e)}))}return r[Symbol.replace].call(this,e,t)},_wrapRegExp.apply(this,arguments)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _wrapNativeSuper(e){var t="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(e){if(null===e||!_isNativeFunction(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return _construct(e,arguments,_getPrototypeOf(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(n,e)})(e)}function isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _construct(e,t,n){return(_construct=isNativeReflectConstruct()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&_setPrototypeOf(o,n.prototype),o}).apply(null,arguments)}function _isNativeFunction(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{"8PFr":function(e,t,n){"use strict";n.r(t);var r=n("ofXK"),o=n("3Pt+"),i=n("tyNb"),c=n("c7TG"),s=n("mrSG"),a=n("L99X"),u=n("HQI1"),l=n("LvB5"),d=n("SRjL"),f=n("mo90"),b=(n("0eVs"),n("Y6BA"),n("pLZG")),h=n("fXoL");function p(e,t){if(1&e){var n=h.ac();h.Zb(0,"ion-item"),h.Zb(1,"ion-label"),h.xc(2),h.Yb(),h.Zb(3,"ion-note",11),h.xc(4),h.Yb(),h.Zb(5,"ion-text"),h.Zb(6,"small"),h.xc(7),h.Yb(),h.Yb(),h.Zb(8,"ion-button",12),h.hc("click",(function(){h.rc(n);var e=t.$implicit;return h.jc().ShowRecordes(e)})),h.Xb(9,"ion-icon",13),h.Yb(),h.Zb(10,"ion-checkbox",14),h.hc("ngModelChange",(function(e){return h.rc(n),t.$implicit.isChecked=e})),h.Yb(),h.Yb()}if(2&e){var r=t.$implicit,o=h.jc();h.Mb(2),h.yc(r.titel),h.Mb(2),h.yc(r.type),h.Mb(3),h.yc(r.time),h.Mb(1),h.oc("hidden",o.EditModul),h.Mb(2),h.oc("hidden",!o.EditModul)("ngModel",r.isChecked)}}function v(e,t){if(1&e){var n=h.ac();h.Zb(0,"ion-buttons",15),h.Zb(1,"ion-button",16),h.hc("click",(function(){return h.rc(n),h.jc().showPaiguaModal()})),h.Xb(2,"ion-icon",17),h.Zb(3,"ion-text"),h.xc(4,"\u5366\u4f8b"),h.Yb(),h.Yb(),h.Zb(5,"ion-button",16),h.hc("click",(function(){return h.rc(n),h.jc().showPaibaziModal()})),h.Xb(6,"ion-icon",17),h.Zb(7,"ion-text"),h.xc(8,"\u547d\u4f8b"),h.Yb(),h.Yb(),h.Zb(9,"ion-button",16),h.hc("click",(function(){return h.rc(n),h.jc().ShowActions()})),h.Xb(10,"ion-icon",18),h.Zb(11,"ion-text"),h.xc(12,"\u7f16\u8f91"),h.Yb(),h.Yb(),h.Zb(13,"ion-button",16),h.hc("click",(function(){return h.rc(n),h.jc().CheckAll()})),h.Zb(14,"ion-text"),h.xc(15,"\u5168\u9009"),h.Yb(),h.Yb(),h.Yb()}if(2&e){var r=h.jc();h.Mb(1),h.oc("hidden",r.EditModul),h.Mb(4),h.oc("hidden",r.EditModul),h.Mb(4),h.oc("hidden",!r.EditModul),h.Mb(4),h.oc("hidden",!r.EditModul)}}function m(e,t){if(1&e){var n=h.ac();h.Zb(0,"ion-buttons",19),h.Zb(1,"ion-button",4),h.hc("click",(function(){h.rc(n);var e=h.jc();return e.EditModul=!e.EditModul})),h.Xb(2,"ion-icon",20),h.Yb(),h.Yb()}}function y(e,t){if(1&e){var n=h.ac();h.Zb(0,"ion-buttons",19),h.Zb(1,"ion-button",4),h.hc("click",(function(){return h.rc(n),h.jc().showHelp()})),h.Xb(2,"ion-icon",21),h.Zb(3,"ion-text"),h.xc(4,"\u5e2e\u52a9"),h.Yb(),h.Yb(),h.Yb()}}var g,w=((g=function(){function e(t,n,r,o,c,s,a){var u=this;_classCallCheck(this,e),this.dbservice=t,this.actionsheetctrl=n,this.alertCtrl=r,this.popoverCtrl=o,this.modalController=c,this.route=s,this.router=a,this.columns=[{prop:"time"},{name:"titel"},{name:"type"}],this.SortKey="created",this.SortName="\u521b\u5efa\u65e5\u671f",this.EditModul=!1,this.Editable=!0,this.route.params.subscribe((function(e){u.node_id=e.id})),this.router.events.pipe(Object(b.a)((function(e){return e instanceof i.c}))).subscribe((function(e){e.url.match(_wrapRegExp(/\/menu\/recordes\/([0-9]+)/i,{nodeid:1}))}))}return _createClass(e,[{key:"ngOnInit",value:function(){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.recordes=[],this.recordesOrigin=[],t=[],e.next=4,this.dbservice.GetAllNodes().then((function(e){"*"===n.node_id?(t=e.where((function(e){return 32===e.type})).select((function(e){return e.id})),n.Editable=!1):(t=n.node_id.split("-"),n.Editable=1===t.length);var r=!0,o=!1,i=void 0;try{for(var c,s=t[Symbol.iterator]();!(r=(c=s.next()).done);r=!0){var a=c.value;n.loadRecordes(a).then((function(e){n.recordes=n.Recordes.concat(e||[])}))}}catch(u){o=!0,i=u}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}}));case 4:case"end":return e.stop()}}),e,this)})))}},{key:"sortOptions",value:function(e){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,o,i=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.popoverCtrl.create({component:u.a,event:e,componentProps:{items:[{name:"\u76ee\u5f55\u540d\u79f0",value:"titel"},{name:"\u521b\u5efa\u65f6\u95f4",value:"created"},{name:"\u4fee\u6539\u65f6\u95f4",value:"modified"}],currentOption:this.SortKey},translucent:!0});case 2:return n=t.sent,t.next=5,n.present();case 5:return t.next=7,n.onDidDismiss();case 7:if(r=t.sent,((o=r.data)||this.SortKey)===this.SortKey){t.next=21;break}t.t0=(this.SortKey=o.toString(),this.SortKey),t.next="titel"===t.t0?13:"created"===t.t0?15:"modified"===t.t0?17:19;break;case 13:return this.SortName="\u76ee\u5f55\u540d\u79f0",t.abrupt("break",20);case 15:return this.SortName="\u521b\u5efa\u65f6\u95f4",t.abrupt("break",20);case 17:return this.SortName="\u4fee\u6539\u65f6\u95f4",t.abrupt("break",20);case 19:this.SortName="\u9ed8\u8ba4";case 20:this.recordes=this.recordesOrigin.sortByKey(this.SortKey).select((function(e){return i.Convert(e)}));case 21:case"end":return t.stop()}}),t,this)})))}},{key:"loadRecordes",value:function(e){var t=this;return this.dbservice.GetRecordes(e).then((function(e){var n=e.select((function(e){return t.Convert(e)}));return t.recordesOrigin=t.recordesOrigin.concat(e||[]),n})).catch((function(t){t===[]?console.log("loadRecordes ".concat(e," not found in local")):console.log("Err loadRecordes ".concat(e),t)}))}},{key:"showPaiguaModal",value:function(){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,o,i=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.modalController.create({component:l.a});case 2:return t=e.sent,e.next=5,t.present();case 5:return e.next=7,t.onWillDismiss();case 7:n=e.sent,(r=n.data).result&&(o=r.result,this.dbservice.SaveRecord(this.node_id,o.question,8,JSON.stringify(o)).then((function(e){i.recordes.push(i.Convert(e))})));case 10:case"end":return e.stop()}}),e,this)})))}},{key:"showPaibaziModal",value:function(){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,o,i=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.modalController.create({component:d.a});case 2:return t=e.sent,e.next=5,t.present();case 5:return e.next=7,t.onWillDismiss();case 7:n=e.sent,(r=n.data).result&&(o=r.result,this.dbservice.SaveRecord(this.node_id,o.person,16,JSON.stringify(o)).then((function(e){i.recordes.push(i.Convert(e))})));case 10:case"end":return e.stop()}}),e,this)})))}},{key:"showHelp",value:function(){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.alertCtrl.create({header:"\u5e2e\u52a9",message:"\u5f53\u6848\u4f8b\u6765\u81ea\u591a\u4e2a\u6587\u4ef6\u5939\u7684\u65f6\u5019\uff0c\u65e0\u6cd5\u7f16\u8f91\u3002\u5982\u9700\u7f16\u8f91\uff0c\u8bf7\u8fd4\u56de\u76ee\u5f55\u754c\u9762\uff0c\u6253\u5f00\u4e00\u4e2a\u5355\u4e00\u7684\u6587\u4ef6\u5939\u76ee\u5f55\u3002",buttons:["\u786e\u5b9a"]});case 2:return t=e.sent,e.next=5,t.present();case 5:case"end":return e.stop()}}),e,this)})))}},{key:"CheckAll",value:function(){var e=this;this.checkAll=!this.checkAll,this.recordes.forEach((function(t){return t.isChecked=e.checkAll}))}},{key:"ShowActions",value:function(){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.recordes.filter((function(e){return e.isChecked})).length){e.next=7;break}return e.next=3,this.alertCtrl.create({header:"\u5e2e\u52a9",message:"\u8bf7\u9009\u5b9a\u81f3\u5c11\u4e00\u4f8b\u88ab\u7f16\u8f91\u7684\u6848\u4f8b\u3002",buttons:["\u786e\u5b9a"]});case 3:return t=e.sent,e.next=6,t.present();case 6:return e.abrupt("return",void e.sent);case 7:return e.next=9,this.actionsheetctrl.create({header:"\u7f16\u8f91",buttons:[{text:"\u5220\u9664",role:"destructive",icon:"trash",handler:function(){r.DeleteNode()}},{text:"\u8fc1\u79fb\u76ee\u5f55",icon:"arrow-round-back",handler:function(){r.MoveNode()}},{text:" \u53d6\u6d88",icon:"close",role:"cancel",handler:function(){}}]});case 9:return n=e.sent,e.next=12,n.present();case 12:case"end":return e.stop()}}),e,this)})))}},{key:"MoveNode",value:function(){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,o=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.modalController.create({component:f.a,componentProps:{Titel:"\u9009\u62e9\u65b0\u76ee\u5f55",SelectDocument:!0,NodeID:this.node_id}});case 2:return t=e.sent,e.next=5,t.present();case 5:return e.next=7,t.onWillDismiss();case 7:n=e.sent,(r=n.data).nodeid&&!r.nodeid.IsNullOrEmpty()&&(this.EditModul=!1,this.dbservice.MoveRecordes(this.node_id,r.nodeid,this.recordes.filter((function(e){return e.isChecked})).map((function(e){return e.id}))).then((function(e){o.recordesOrigin=e,o.recordes=e.sortByKey(o.SortKey).map((function(e){return o.Convert(e)}))})));case 10:case"end":return e.stop()}}),e,this)})))}},{key:"DeleteNode",value:function(){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.alertCtrl.create({header:"\u5220\u9664\u6848\u4f8b",message:"\u786e\u5b9a\u5220\u9664\u9009\u5b9a\u7684\u6848\u4f8b\u5417\uff1f",buttons:[{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary"},{text:"\u786e\u5b9a",handler:function(){var e=n.recordes.where((function(e){return e.isChecked})).map((function(e){return e.id}));console.log("next to delete recordes",e),n.EditModul=!1,n.dbservice.DeleteRecordes(n.node_id,e).then((function(e){n.recordesOrigin=e,n.recordes=e.sortByKey(n.SortKey).select((function(e){return n.Convert(e)}))}))}}]});case 2:return t=e.sent,e.next=5,t.present();case 5:case"end":return e.stop()}}),e,this)})))}},{key:"ShowRecordes",value:function(e){this.router.navigateByUrl("/menu/recordview/".concat(e.nodeid,"/").concat(e.id))}},{key:"Convert",value:function(e){return{time:new Date("modified"===this.SortKey?e.modified:e.created).toChinaStr(),titel:e.titel,type:8===e.type?"\u516d\u723b":"\u516b\u5b57",id:e.id,nodeid:e.node,isChecked:!1}}},{key:"Recordes",get:function(){return this.recordes||[]}}]),e}()).\u0275fac=function(e){return new(e||g)(h.Wb(a.a),h.Wb(c.a),h.Wb(c.b),h.Wb(c.fb),h.Wb(c.cb),h.Wb(i.a),h.Wb(i.g))},g.\u0275cmp=h.Qb({type:g,selectors:[["app-recordes"]],decls:22,vars:8,consts:[["slot","start",3,"hidden"],["defaulthref","","text","\u8fd4\u56de"],["rdbackbtn",""],["slot","end",3,"hidden"],[3,"click"],["name","md-funnel"],[3,"hidden"],["color","light","showCancelButton","focus","cancelButtonText","\u53d6\u6d88","placeholder","\u641c\u7d22\u95ee\u5ff5/\u540d\u5b57"],[4,"ngFor","ngForOf"],["slot","start",4,"ngIf"],["slot","end",4,"ngIf"],["button",""],["color","light",3,"hidden","click"],["icon-only","","name","ios-arrow-forward"],[3,"hidden","ngModel","ngModelChange"],["slot","start"],[3,"hidden","click"],["name","add"],["name","build"],["slot","end"],["name","md-reorder"],["name","md-help-circle"]],template:function(e,t){1&e&&(h.Zb(0,"ion-header"),h.Zb(1,"ion-toolbar"),h.Zb(2,"ion-buttons",0),h.Xb(3,"ion-back-button",1,2),h.Yb(),h.Zb(5,"ion-title"),h.xc(6,"\u6613\u5b66\u6848\u4f8b"),h.Yb(),h.Zb(7,"ion-buttons",3),h.Zb(8,"ion-button",4),h.hc("click",(function(e){return t.sortOptions(e)})),h.Xb(9,"ion-icon",5),h.Zb(10,"ion-text"),h.xc(11),h.Yb(),h.Yb(),h.Yb(),h.Yb(),h.Yb(),h.Zb(12,"ion-content"),h.Zb(13,"ion-list"),h.Zb(14,"ion-list-header",6),h.Xb(15,"ion-searchbar",7),h.Yb(),h.wc(16,p,11,6,"ion-item",8),h.Yb(),h.Yb(),h.Zb(17,"ion-footer"),h.Zb(18,"ion-toolbar"),h.wc(19,v,16,4,"ion-buttons",9),h.wc(20,m,3,0,"ion-buttons",10),h.wc(21,y,5,0,"ion-buttons",10),h.Yb(),h.Yb()),2&e&&(h.Mb(2),h.oc("hidden",t.EditModul),h.Mb(5),h.oc("hidden",t.EditModul),h.Mb(4),h.yc(t.SortName),h.Mb(3),h.oc("hidden",t.EditModul),h.Mb(2),h.oc("ngForOf",t.Recordes),h.Mb(3),h.oc("ngIf",t.Editable),h.Mb(1),h.oc("ngIf",t.Editable),h.Mb(1),h.oc("ngIf",!t.Editable))},directives:[c.s,c.Y,c.k,c.g,c.h,c.W,c.j,c.t,c.T,c.o,c.D,c.E,c.M,c.ib,r.i,c.q,r.j,c.w,c.C,c.I,c.l,c.c,o.c,o.d],styles:[""]}),g);n.d(t,"RecordesPageModule",(function(){return O}));var x,k=[{path:"",component:w}],O=((x=function e(){_classCallCheck(this,e)}).\u0275mod=h.Ub({type:x}),x.\u0275inj=h.Tb({factory:function(e){return new(e||x)},imports:[[r.b,o.a,c.Z,i.i.forChild(k)]]}),x)},HQI1:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n("c7TG"),o=n("fXoL"),i=n("ofXK");function c(e,t){if(1&e){var n=o.ac();o.Zb(0,"ion-item",2),o.hc("click",(function(){o.rc(n);var e=t.$implicit;return o.jc(2).onSelect(e.value)})),o.Zb(1,"ion-text"),o.xc(2),o.Yb(),o.Yb()}if(2&e){var r=t.$implicit,i=o.jc(2);o.oc("color",r.value===i.currentOption?"light":""),o.Mb(2),o.yc(r.name)}}function s(e,t){if(1&e&&(o.Zb(0,"div"),o.wc(1,c,3,2,"ion-item",1),o.Yb()),2&e){var n=o.jc();o.Mb(1),o.oc("ngForOf",n.items)}}function a(e,t){if(1&e&&(o.Zb(0,"ion-item",4),o.Zb(1,"ion-note"),o.xc(2),o.Yb(),o.Zb(3,"ion-label",5),o.xc(4),o.Yb(),o.Yb()),2&e){var n=t.$implicit;o.Mb(2),o.yc(n.name),o.Mb(2),o.zc(" ",n.value," ")}}function u(e,t){if(1&e&&(o.Zb(0,"small"),o.wc(1,a,5,2,"ion-item",3),o.Yb()),2&e){var n=o.jc();o.Mb(1),o.oc("ngForOf",n.items)}}var l=function(){var e=function(){function e(t){_classCallCheck(this,e),this.popoverCtrl=t,this.toselect=!0}return _createClass(e,[{key:"ngOnInit",value:function(){}},{key:"onSelect",value:function(e){this.popoverCtrl.dismiss(e)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(o.Wb(r.fb))},e.\u0275cmp=o.Qb({type:e,selectors:[["app-optionpopover"]],inputs:{currentOption:"currentOption",items:"items",toselect:"toselect"},decls:2,vars:2,consts:[[4,"ngIf"],["button","",3,"color","click",4,"ngFor","ngForOf"],["button","",3,"color","click"],["lines","none",4,"ngFor","ngForOf"],["lines","none"],["slot","end",1,"ion-text-wrap"]],template:function(e,t){1&e&&(o.wc(0,s,2,1,"div",0),o.wc(1,u,2,1,"small",0)),2&e&&(o.oc("ngIf",t.toselect),o.Mb(1),o.oc("ngIf",!t.toselect))},directives:[i.j,i.i,r.w,r.T,r.I,r.C],styles:[""]}),e}()}}]);