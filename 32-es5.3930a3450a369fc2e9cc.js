function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,n,t){return n&&_defineProperties(e.prototype,n),t&&_defineProperties(e,t),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{dnR8:function(e,n,t){"use strict";t.r(n);var i=t("ofXK"),r=t("3Pt+"),o=t("tyNb"),a=t("c7TG"),s=t("mrSG"),c=t("PKx9"),u=t("LTmD"),l=t("7L00"),b=t("Y6BA"),d=t("fXoL");function h(e,n){1&e&&d.Xb(0,"ion-menu-button")}function f(e,n){if(1&e&&(d.Zb(0,"ion-item"),d.Zb(1,"ion-label"),d.Zb(2,"ion-text"),d.xc(3),d.Yb(),d.Yb(),d.Yb()),2&e){var t=d.jc();d.Mb(3),d.yc(t.InfoNoMessage)}}function g(e,n){if(1&e&&(d.Zb(0,"ion-text"),d.xc(1),d.Yb()),2&e){var t=d.jc().$implicit;d.Mb(1),d.zc("\u6765\u81ea\uff1a",t.author,"")}}function m(e,n){if(1&e&&(d.Zb(0,"ion-text"),d.xc(1),d.Yb()),2&e){var t=d.jc().$implicit;d.Mb(1),d.zc("\u53d1\u9001\u7ed9\uff1a",t.receiver,"")}}function p(e,n){if(1&e){var t=d.ac();d.Zb(0,"ion-item-sliding",14),d.Zb(1,"ion-item"),d.Zb(2,"ion-label"),d.Zb(3,"ion-text",15),d.xc(4),d.Yb(),d.Xb(5,"br"),d.wc(6,g,2,1,"ion-text",3),d.wc(7,m,2,1,"ion-text",3),d.Xb(8,"br"),d.Zb(9,"p"),d.Zb(10,"small"),d.xc(11),d.Yb(),d.Yb(),d.Yb(),d.Zb(12,"ion-buttons",4),d.Zb(13,"ion-button",16),d.hc("click",(function(){d.rc(t);var e=n.$implicit;return d.jc().ShowMessage(e)})),d.Xb(14,"ion-icon",17),d.Yb(),d.Yb(),d.Yb(),d.Zb(15,"ion-item-options",18),d.Zb(16,"ion-item-option",19),d.hc("click",(function(){d.rc(t);var e=n.$implicit;return d.jc().ReplyMessage(e)})),d.Xb(17,"ion-icon",20),d.Yb(),d.Yb(),d.Zb(18,"ion-item-options",21),d.Zb(19,"ion-item-option",22),d.hc("click",(function(){d.rc(t);var e=n.$implicit;return d.jc().DeleteMsg(e)})),d.Xb(20,"ion-icon",23),d.Yb(),d.Yb(),d.Yb()}if(2&e){var i=n.$implicit,r=d.jc();d.oc("disabled",!r.ForMe),d.Mb(3),d.oc("color",i.readed?"medium":"dark"),d.Mb(1),d.zc("\u6807\u9898\uff1a",i.title,""),d.Mb(2),d.oc("ngIf",r.ForMe),d.Mb(1),d.oc("ngIf",!r.ForMe),d.Mb(4),d.yc(r.ShowTime(i.created)),d.Mb(2),d.oc("color",i.readed?"medium":"primary"),d.Mb(1),d.oc("name",i.readed?"mail":"mail-unread"),d.Mb(2),d.oc("disabled",!i.replyable)("color",i.replyable?"primary":"medium")}}function v(e,n){if(1&e&&(d.Zb(0,"ion-select-option",24),d.xc(1),d.Yb()),2&e){var t=n.$implicit;d.oc("value",t),d.Mb(1),d.zc("\u7b2c",t+1,"\u9875")}}var M,x=((M=function(){function e(n,t,i,r,o,a,s){var c=this;_classCallCheck(this,e),this.loadingController=n,this.modalCtrl=t,this.alertController=i,this.route=r,this.router=o,this.forumservice=a,this.settings=s,this.pageindex=0,this.Messages=[],this.ForMe=!0,this.InfoNoMessage="\u6b63\u5728\u8bfb\u53d6\u60a8\u7684\u6d88\u606f\u3002\u3002\u3002",this.Pages=[0],this.CanNaviBack=!0,this.route.params.subscribe((function(e){c.CanNaviBack="true"===e.naviback}))}return _createClass(e,[{key:"ngOnInit",value:function(){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.settings.HasUser){e.next=2;break}return e.abrupt("return",(this.presentAlert("\u65e0\u6cd5\u8bbf\u95ee",null,"\u60a8\u8fd8\u6ca1\u6709\u6ce8\u518c\u8d26\u53f7\uff0c\u65e0\u6cd5\u53d1\u9001\u6d88\u606f\u3002"),void this.router.navigateByUrl("/menu/user")));case 2:this.PageIndex=0;case 3:case"end":return e.stop()}}),e,this)})))}},{key:"ShowTime",value:function(e){return new Date(e).toChinaStr(!0)}},{key:"ShowMessage",value:function(e){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function n(){var t;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return this.ForMe&&!1===e.readed&&this.forumservice.DeleteMessage(e.id,!1).then((function(){e.readed=!0})),n.next=3,this.modalCtrl.create({component:l.a,componentProps:{Message:e,Read:!0}});case 3:return t=n.sent,n.next=6,t.present();case 6:case"end":return n.stop()}}),n,this)})))}},{key:"ChangeMode",value:function(){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.ForMe=!this.ForMe,this.Messages=[],this.PageIndex=0;case 1:case"end":return e.stop()}}),e,this)})))}},{key:"DeleteMsg",value:function(e){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function n(){var t=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.showLoading();case 2:this.forumservice.DeleteMessage(e.id,!0).then((function(){t.Messages=t.Messages.filter((function(n){return n.id!==e.id})),0===t.Messages.length&&(t.InfoNoMessage="\u60a8\u6ca1\u6709\u4efb\u4f55\u6d88\u606f\u3002\u3002\u3002")})).finally((function(){t.closeLoading()}));case 3:case"end":return n.stop()}}),n,this)})))}},{key:"ReplyMessage",value:function(e){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function n(){var t,i,r,o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t=Object(b.b)(),i=new Date(e.created).toChinaStr(!0),r={id:t,created:Date.now(),valid:0,author:this.settings.User.id,receiver:e.author,roller:0,readed:!1,private:!0,replyable:!0,title:"\u56de\u590d\uff1a".concat(e.title),content:"\n\n\u539f\u6d88\u606f\uff1a".concat(i,"\n\u539f\u5185\u5bb9\uff1a=======================\n").concat(e.content)},n.next=5,this.modalCtrl.create({component:l.a,componentProps:{Message:r}});case 5:return o=n.sent,n.next=8,o.present();case 8:return n.next=10,o.onWillDismiss();case 10:case"end":return n.stop()}}),n,this)})))}},{key:"Reload",value:function(e){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function n(){var t=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.showLoading();case 2:this.forumservice.LoadMessages(e,this.ForMe).then((function(e){t.BuildPages(e.sum),t.Messages=e.data||[],0===t.Messages.length&&(t.InfoNoMessage="\u60a8\u6ca1\u6709\u4efb\u4f55\u6d88\u606f")})).finally((function(){t.closeLoading()}));case 3:case"end":return n.stop()}}),n,this)})))}},{key:"showLoading",value:function(){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.loadingView,e.t0){e.next=5;break}return e.next=4,this.loadingController.create({message:"\u8bfb\u53d6\u6211\u7684\u6d88\u606f...",duration:6e4});case 4:this.loadingView=e.sent;case 5:return e.next=7,this.loadingView.present();case 7:case"end":return e.stop()}}),e,this)})))}},{key:"closeLoading",value:function(){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.loadingView,!e.t0){e.next=5;break}return e.next=4,this.loadingView.dismiss();case 4:this.loadingView=null;case 5:case"end":return e.stop()}}),e,this)})))}},{key:"presentAlert",value:function(e,n,t){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function i(){var r;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,this.alertController.create({header:e||"\u9519\u8bef",subHeader:n||"",message:t,buttons:["\u786e\u5b9a"]});case 2:return r=i.sent,i.next=5,r.present();case 5:case"end":return i.stop()}}),i,this)})))}},{key:"BuildPages",value:function(e){if(0===this.PageIndex)if(0!==e){this.Pages=[];for(var n=Math.ceil(e/20),t=0;t<n;t++)this.Pages.push(t)}else this.Pages=[0]}},{key:"PageIndex",get:function(){return this.pageindex},set:function(e){this.pageindex=e,this.Reload(e)}}]),e}()).\u0275fac=function(e){return new(e||M)(d.Wb(a.cb),d.Wb(a.db),d.Wb(a.b),d.Wb(o.a),d.Wb(o.g),d.Wb(c.a),d.Wb(u.a))},M.\u0275cmp=d.Qb({type:M,selectors:[["app-messagelist"]],decls:24,vars:8,consts:[["color","primary"],["slot","start"],["defaulthref","","text","\u8fd4\u56de"],[4,"ngIf"],["slot","end"],[3,"click"],["ion-no-padding",""],[3,"disabled",4,"ngFor","ngForOf"],[3,"disabled","click"],["name","arrow-back"],["cancelText","\u53d6\u6d88","doneText","\u786e\u5b9a",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"small",3,"disabled","click"],["name","arrow-forward"],[3,"disabled"],[3,"color"],[3,"color","click"],["slot","end",3,"name"],["side","start"],[3,"disabled","color","click"],["slot","icon-only","name","send"],["side","end"],["color","danger",3,"click"],["slot","icon-only","name","trash"],[3,"value"]],template:function(e,n){1&e&&(d.Zb(0,"ion-header"),d.Zb(1,"ion-toolbar",0),d.Zb(2,"ion-buttons",1),d.Xb(3,"ion-back-button",2),d.wc(4,h,1,0,"ion-menu-button",3),d.Yb(),d.Zb(5,"ion-title"),d.xc(6,"\u6211\u7684\u6d88\u606f"),d.Yb(),d.Zb(7,"ion-buttons",4),d.Zb(8,"ion-button",5),d.hc("click",(function(){return n.ChangeMode()})),d.xc(9),d.Yb(),d.Yb(),d.Yb(),d.Yb(),d.Zb(10,"ion-content"),d.Zb(11,"ion-list",6),d.wc(12,f,4,1,"ion-item",3),d.wc(13,p,21,10,"ion-item-sliding",7),d.Yb(),d.Yb(),d.Zb(14,"ion-footer"),d.Zb(15,"small"),d.Zb(16,"ion-toolbar"),d.Zb(17,"ion-buttons",4),d.Zb(18,"ion-button",8),d.hc("click",(function(){return n.PageIndex=n.PageIndex-1})),d.Xb(19,"ion-icon",9),d.Yb(),d.Zb(20,"ion-select",10),d.hc("ngModelChange",(function(e){return n.PageIndex=e})),d.wc(21,v,2,2,"ion-select-option",11),d.Yb(),d.Zb(22,"ion-button",12),d.hc("click",(function(){return n.PageIndex=n.PageIndex+1})),d.Xb(23,"ion-icon",13),d.Yb(),d.Yb(),d.Yb(),d.Yb(),d.Yb()),2&e&&(d.Mb(4),d.oc("ngIf",!n.CanNaviBack),d.Mb(5),d.yc(n.ForMe?"\u6536\u5230\u7684":"\u53d1\u9001\u7684"),d.Mb(3),d.oc("ngIf",0===n.Messages.length),d.Mb(1),d.oc("ngForOf",n.Messages),d.Mb(5),d.oc("disabled",0===n.PageIndex),d.Mb(2),d.oc("ngModel",n.PageIndex),d.Mb(1),d.oc("ngForOf",n.Pages),d.Mb(1),d.oc("disabled",n.PageIndex===n.Pages.length-1))},directives:[a.t,a.Z,a.j,a.f,a.g,i.j,a.X,a.i,a.n,a.E,i.i,a.r,a.u,a.Q,a.ib,r.c,r.d,a.H,a.x,a.D,a.U,a.C,a.B,a.A,a.R],styles:[""]}),M);t.d(n,"MessagelistPageModule",(function(){return y}));var w,k=[{path:"",component:x}],y=((w=function e(){_classCallCheck(this,e)}).\u0275mod=d.Ub({type:w}),w.\u0275inj=d.Tb({factory:function(e){return new(e||w)},imports:[[i.b,r.a,a.ab,o.i.forChild(k)]]}),w)}}]);