function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{"7L00":function(e,t,n){"use strict";n.d(t,"a",(function(){return y}));var r=n("mrSG"),i=n("c7TG"),c=n("PKx9"),o=n("G6JS"),s=n("fXoL"),a=n("ofXK"),u=n("3Pt+");function l(e,t){if(1&e){var n=s.ec();s.dc(0,"ion-buttons",8),s.dc(1,"ion-button",3),s.lc("click",(function(){return s.Cc(n),s.oc().onclose(!1)})),s.Jc(2," \u53d6\u6d88 "),s.cc(),s.cc()}}function d(e,t){if(1&e){var n=s.ec();s.dc(0,"ion-item"),s.dc(1,"ion-label"),s.dc(2,"ion-text"),s.Jc(3,"\u53d1\u9001\u7ed9\uff1a"),s.cc(),s.dc(4,"ion-text",9),s.lc("click",(function(){s.Cc(n);var e=s.oc();return e.ShowUserInfo(e.Message.receiver)})),s.Jc(5),s.cc(),s.cc(),s.cc()}if(2&e){var r=s.oc();s.Nb(5),s.Kc(r.Message.receiver)}}function h(e,t){if(1&e){var n=s.ec();s.dc(0,"ion-item",10),s.dc(1,"ion-label"),s.dc(2,"ion-text"),s.Jc(3),s.cc(),s.cc(),s.dc(4,"ion-button",11),s.lc("click",(function(){return s.Cc(n),s.oc().EditRoles()})),s.Jc(5,"\u63a5\u6536\u8005\u89d2\u8272"),s.cc(),s.cc()}if(2&e){var r=s.oc();s.Nb(3),s.Kc(r.RollerText)}}function f(e,t){if(1&e){var n=s.ec();s.dc(0,"ion-item"),s.dc(1,"ion-text"),s.Jc(2,"\u53d1\u9001\u4eba\uff1a"),s.cc(),s.dc(3,"ion-select",12),s.lc("ngModelChange",(function(e){return s.Cc(n),s.oc().Sender=e})),s.dc(4,"ion-select-option",13),s.Jc(5,"\u7cfb\u7edf\u53d1\u9001"),s.cc(),s.dc(6,"ion-select-option",14),s.Jc(7),s.cc(),s.cc(),s.dc(8,"ion-label"),s.dc(9,"ion-segment",12),s.lc("ngModelChange",(function(e){return s.Cc(n),s.oc().Replyable=e})),s.dc(10,"ion-segment-button",15),s.Jc(11,"\u53ef\u56de\u590d"),s.cc(),s.dc(12,"ion-segment-button",16),s.Jc(13,"\u4e0d\u53ef\u56de\u590d"),s.cc(),s.cc(),s.cc(),s.cc()}if(2&e){var r=s.oc();s.Nb(3),s.vc("ngModel",r.Sender),s.Nb(3),s.vc("value",r.Message.author),s.Nb(1),s.Kc(r.Message.author),s.Nb(2),s.vc("ngModel",r.Replyable)}}function p(e,t){if(1&e){var n=s.ec();s.dc(0,"ion-item"),s.dc(1,"ion-text"),s.Jc(2,"\u6765\u81ea\u4e8e\uff1a"),s.cc(),s.dc(3,"ion-text",9),s.lc("click",(function(){s.Cc(n);var e=s.oc();return e.ShowUserInfo(e.Message.author)})),s.Jc(4),s.cc(),s.cc()}if(2&e){var r=s.oc();s.Nb(4),s.Lc(" ",r.Message.author,"")}}function m(e,t){if(1&e&&(s.dc(0,"ion-text"),s.Jc(1),s.cc()),2&e){var n=s.oc();s.Nb(1),s.Kc(n.Message.readed?"[\u5df2\u8bfb]\uff1a":"[\u672a\u8bfb]\uff1a")}}function v(e,t){1&e&&(s.dc(0,"ion-text"),s.Jc(1,"\u4e3b\u9898\uff1a"),s.cc())}function b(e,t){if(1&e){var n=s.ec();s.dc(0,"textarea",20),s.lc("ngModelChange",(function(e){return s.Cc(n),s.oc(2).Message.content=e})),s.cc()}if(2&e){var r=s.oc(2);s.vc("ngModel",r.Message.content)}}function g(e,t){if(1&e&&(s.dc(0,"div",17),s.dc(1,"div",18),s.dc(2,"label"),s.Jc(3,"\u5185\u5bb9"),s.cc(),s.Hc(4,b,1,1,"textarea",19),s.cc(),s.cc()),2&e){var n=s.oc();s.Nb(4),s.vc("ngIf",!n.Read)}}function k(e,t){if(1&e&&(s.dc(0,"ion-item"),s.dc(1,"ion-text"),s.Jc(2),s.cc(),s.cc()),2&e){var n=s.oc();s.Nb(2),s.Kc(n.Message.content)}}var y=function(){var e=function(){function e(t,n,r,i,c){_classCallCheck(this,e),this.toastController=t,this.loadingController=n,this.alertController=r,this.modalCtrl=i,this.forumservice=c,this.Read=!1,this.NoSend=!1,this.Sender="",this.Replyable="true",this.RollerText=""}return _createClass(e,[{key:"ngOnInit",value:function(){this.Sender=this.Message.author,this.Replyable=JSON.stringify(this.Message.replyable),this.RollerText=this.Roles2Text(this.Message.roller)}},{key:"EditRoles",value:function(){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,i,c,o,s,a,u,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.Message.roller,!1,e.next=4,this.alertController.create({header:"\u63a5\u6536\u8005\u89d2\u8272",inputs:[{name:"register",type:"checkbox",label:"\u6ce8\u518c\u7528\u6237",value:1,checked:(1&t)>0},{name:"vip",type:"checkbox",label:"VIP\u7528\u6237",value:2,checked:(2&t)>0},{name:"huahe",type:"checkbox",label:"\u534e\u9e64\u540c\u95e8",value:4,checked:(4&t)>0},{name:"bbs",type:"checkbox",label:"\u7248\u4e3b",value:8,checked:(8&t)>0},{name:"liuyao",type:"checkbox",label:"\u516d\u723b\u8001\u5e08",value:16,checked:(16&t)>0},{name:"bazi",type:"checkbox",label:"\u547d\u7406\u8001\u5e08",value:32,checked:(32&t)>0},{name:"fengshui",type:"checkbox",label:"\u98ce\u6c34\u8001\u5e08",value:64,checked:(64&t)>0},{name:"supermaster",type:"checkbox",label:"\u5927\u5b97\u5e08",value:128,checked:(128&t)>0},{name:"admin",type:"checkbox",label:"\u7ba1\u7406\u5458",value:256,checked:(256&t)>0}],buttons:[{text:"\u786e\u5b9a",handler:function(){!0}},{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary",handler:function(){}}]});case 4:return n=e.sent,e.next=7,n.present();case 7:return e.next=9,n.onWillDismiss();case 9:for(r=e.sent,i=r.data,console.log("roles",i),this.Message.roller=0,c=!0,o=!1,s=void 0,e.prev=15,a=i.values[Symbol.iterator]();!(c=(u=a.next()).done);c=!0)l=u.value,this.Message.roller=this.Message.roller|l;e.next=23;break;case 19:e.prev=19,e.t0=e.catch(15),o=!0,s=e.t0;case 23:e.prev=23,e.prev=24,c||null==a.return||a.return();case 26:if(e.prev=26,!o){e.next=29;break}throw s;case 29:return e.finish(26);case 30:return e.finish(23);case 31:this.RollerText=this.Roles2Text(this.Message.roller),console.log(this.Message.roller);case 32:case"end":return e.stop()}}),e,this,[[15,19,23,31],[24,,26,30]])})))}},{key:"Roles2Text",value:function(e){var t=[];return(1&e)>0&&t.push("\u6ce8\u518c\u7528\u6237"),(2&e)>0&&t.push("VIP\u7528\u6237"),(4&e)>0&&t.push("\u534e\u9e64\u540c\u95e8"),(8&e)>0&&t.push("\u7248\u4e3b"),(16&e)>0&&t.push("\u516d\u723b\u8001\u5e08"),(32&e)>0&&t.push("\u547d\u7406\u8001\u5e08"),(64&e)>0&&t.push("\u98ce\u6c34\u8001\u5e08"),(128&e)>0&&t.push("\u5927\u5b97\u5e08"),(256&e)>0&&t.push("\u7ba1\u7406\u5458"),t.join(";")}},{key:"ShowUserInfo",value:function(e){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.modalCtrl.create({component:o.a,componentProps:{Uerid:e}});case 2:return n=t.sent,t.next=5,n.present();case 5:return t.next=7,n.onWillDismiss();case 7:case"end":return t.stop()}}),t,this)})))}},{key:"onclose",value:function(e){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log(this.Message),this.IsPublic&&(this.Message.replyable="true"===this.Replyable,this.Message.author=this.Sender),!this.NoSend||!e){t.next=6;break}this.modalCtrl.dismiss(!0),t.next=14;break;case 6:if(!e||this.Read){t.next=13;break}return t.next=9,this.showLoading();case 9:this.Message.created=Date.now(),this.forumservice.SendMessage(this.Message).then((function(e){n.ToastMsg(),n.modalCtrl.dismiss(!0)})).finally((function(){n.closeLoading()})),t.next=14;break;case 13:this.modalCtrl.dismiss(!1);case 14:case"end":return t.stop()}}),t,this)})))}},{key:"ToastMsg",value:function(){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.Message.private?this.Message.receiver:this.RollerText,e.next=3,this.toastController.create({message:"\u6d88\u606f\u5df2\u7ecf\u53d1\u9001\u7ed9 ".concat(t),duration:3e3});case 3:return n=e.sent,e.next=6,n.present();case 6:case"end":return e.stop()}}),e,this)})))}},{key:"showLoading",value:function(){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.loadingView,e.t0){e.next=5;break}return e.next=4,this.loadingController.create({message:"\u4fdd\u5b58\u5230\u8bba\u575b...",duration:6e4});case 4:this.loadingView=e.sent;case 5:return e.next=7,this.loadingView.present();case 7:case"end":return e.stop()}}),e,this)})))}},{key:"closeLoading",value:function(){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.loadingView,!e.t0){e.next=5;break}return e.next=4,this.loadingView.dismiss();case 4:this.loadingView=null;case 5:case"end":return e.stop()}}),e,this)})))}},{key:"IsPublic",get:function(){return!this.Message.private}}]),e}();return e.\u0275fac=function(t){return new(t||e)(s.Yb(i.hb),s.Yb(i.Z),s.Yb(i.b),s.Yb(i.ab),s.Yb(c.a))},e.\u0275cmp=s.Sb({type:e,selectors:[["app-messageeditor"]],inputs:{Message:"Message",Read:"Read",NoSend:"NoSend"},decls:21,vars:13,consts:[[3,"color"],["slot","start",4,"ngIf"],["slot","end"],[3,"click"],[4,"ngIf"],["class","ion-text-wrap",4,"ngIf"],["required","","type","text","placeholder","\u8bf7\u8f93\u5165\u4e3b\u9898",3,"readonly","ngModel","ngModelChange"],["class","ui attached form",4,"ngIf"],["slot","start"],["color","primary",3,"click"],[1,"ion-text-wrap"],["slot","end",3,"click"],[3,"ngModel","ngModelChange"],["value","system"],[3,"value"],["value","true"],["value","false"],[1,"ui","attached","form"],[1,"field"],["style","margin: 3px;",3,"ngModel","ngModelChange",4,"ngIf"],[2,"margin","3px",3,"ngModel","ngModelChange"]],template:function(e,t){1&e&&(s.dc(0,"ion-header"),s.dc(1,"ion-toolbar",0),s.Hc(2,l,3,0,"ion-buttons",1),s.dc(3,"ion-title"),s.Jc(4),s.cc(),s.dc(5,"ion-buttons",2),s.dc(6,"ion-button",3),s.lc("click",(function(){return t.onclose(!0)})),s.Jc(7," \u786e\u5b9a "),s.cc(),s.cc(),s.cc(),s.cc(),s.dc(8,"ion-content"),s.dc(9,"ion-list"),s.Hc(10,d,6,1,"ion-item",4),s.Hc(11,h,6,1,"ion-item",5),s.Hc(12,f,14,4,"ion-item",4),s.Hc(13,p,5,1,"ion-item",4),s.dc(14,"ion-item"),s.dc(15,"ion-label"),s.Hc(16,m,2,1,"ion-text",4),s.Hc(17,v,2,0,"ion-text",4),s.cc(),s.dc(18,"ion-input",6),s.lc("ngModelChange",(function(e){return t.Message.title=e})),s.cc(),s.cc(),s.Hc(19,g,5,1,"div",7),s.Hc(20,k,3,1,"ion-item",4),s.cc(),s.cc()),2&e&&(s.Nb(1),s.vc("color",t.Read?"primary":"secondary"),s.Nb(1),s.vc("ngIf",!t.Read),s.Nb(2),s.Kc(t.Read?"\u6d88\u606f\u5185\u5bb9":"\u7f16\u8f91\u6d88\u606f"),s.Nb(6),s.vc("ngIf",!t.IsPublic),s.Nb(1),s.vc("ngIf",t.IsPublic),s.Nb(1),s.vc("ngIf",t.IsPublic),s.Nb(1),s.vc("ngIf",t.Read&&!t.IsPublic),s.Nb(3),s.vc("ngIf",t.Read),s.Nb(1),s.vc("ngIf",!t.Read),s.Nb(1),s.vc("readonly",t.Read)("ngModel",t.Message.title),s.Nb(1),s.vc("ngIf",!t.Read),s.Nb(1),s.vc("ngIf",t.Read))},directives:[i.s,i.W,a.j,i.U,i.i,i.h,i.m,i.D,i.w,i.C,i.v,i.gb,u.h,u.f,u.g,i.S,i.P,i.fb,i.Q,i.N,i.O,u.b],styles:[""]}),e}()},"8/yo":function(e,t,n){"use strict";n.d(t,"a",(function(){return R}));var r=n("mrSG"),i=n("c7TG"),c=(n("Y6BA"),n("LTmD")),o=n("lEof"),s=n("+z1p"),a=n("LvB5"),u=n("SRjL"),l=n("pNW8"),d=n("+cLM"),h=n("PKx9"),f=n("CGrG"),p=n("i/He"),m=n("fXoL"),v=n("3Pt+"),b=n("ofXK"),g=n("zioG"),k=["filePicker"];function y(e,t){if(1&e){var n=m.ec();m.dc(0,"ion-button",14),m.lc("click",(function(){return m.Cc(n),m.oc().GuaInfo()})),m.dc(1,"ion-text"),m.Jc(2,"\u5366\u76d8"),m.cc(),m.cc()}}function x(e,t){if(1&e){var n=m.ec();m.dc(0,"ion-button",14),m.lc("click",(function(){return m.Cc(n),m.oc().BaziInfo()})),m.dc(1,"ion-text"),m.Jc(2,"\u547d\u76d8"),m.cc(),m.cc()}}var w=n("mxV5"),R=function(){var e=function(){function e(t,n,r,i,c,o){_classCallCheck(this,e),this.settings=t,this.host=n,this.forumservice=r,this.alertController=i,this.loadingController=c,this.modalCtrl=o,this.Private=!1,this.Gua=null,this.Bazi=null,this.Content="",this.TitelEditable=!0,this.Editor=s,this.EditorConfig={toolbar:["heading","|","bold","italic","bulletedList","numberedList","fontcolor","|","link","undo","redo"],colorButton_enableMore:!0,colorButton_enableAutomatic:!1,colorButton_colors:"00923E,F8C100,28166F"},this.readMode=f.c.arrayBuffer,s.builtinPlugins.map((function(e){return e.pluginName}))}return _createClass(e,[{key:"ngOnInit",value:function(){this.MainTopic?(this.Titel=this.MainTopic.title,this.TitelEditable=""===(this.MainTopic.id||"")):(this.Titel=this.forumname,this.forumname="\u56de\u5e16",this.TitelEditable=!1);var e=this.MainTopic||this.VTopic;this.Gua=e.gua,this.Bazi=e.bazi,this.Content=e.content}},{key:"onSave",value:function(){var e,t;return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this.Titel.trim().IsNullOrEmpty()){n.next=4;break}this.presentAlert("\u9519\u8bef",null,"\u9898\u76ee\u4e0d\u80fd\u4e3a\u7a7a"),n.next=7;break;case 4:return n.next=6,this.showLoading();case 6:(null===(e=this.MainTopic)||void 0===e?void 0:e.id)||(null===(t=this.VTopic)||void 0===t?void 0:t.id)?this.UpdateToServer():this.SaveNewToServer();case 7:case"end":return n.stop()}}),n,this)})))}},{key:"onCancel",value:function(){this.modalCtrl.dismiss(null)}},{key:"showPaiguaModal",value:function(){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.MainTopic.gua){e.next=2;break}return e.abrupt("return",void(this.MainTopic.gua=null));case 2:return e.next=4,this.modalCtrl.create({component:a.a});case 4:return t=e.sent,e.next=7,t.present();case 7:return e.next=9,t.onWillDismiss();case 9:n=e.sent,(r=n.data).result&&(this.Gua=r.result,new l.a(this.Gua.time,this.Gua.ben,this.Gua.bian));case 12:case"end":return e.stop()}}),e,this)})))}},{key:"showPaiBaziModal",value:function(){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.MainTopic.bazi){e.next=2;break}return e.abrupt("return",void(this.MainTopic.bazi=null));case 2:return e.next=4,this.modalCtrl.create({component:u.a});case 4:return t=e.sent,e.next=7,t.present();case 7:return e.next=9,t.onWillDismiss();case 9:n=e.sent,(r=n.data).result&&(this.Bazi=r.result);case 12:case"end":return e.stop()}}),e,this)})))}},{key:"GuaInfo",value:function(){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.Gua,n="string"==typeof t.time?t.time:"".concat(t.time[0],"\u6708").concat(t.time[1],"\u65e5"),r=new l.a(t.time,t.ben,t.bian),this.presentAlert("\u5366\u672c",n,r.Ben.Name+(r.Ben.Index!==r.Bian.Index?" \u4e4b ".concat(r.Bian.Name):""));case 2:case"end":return e.stop()}}),e,this)})))}},{key:"BaziInfo",value:function(){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.Bazi,n="".concat(t.person," (").concat(t.male?"\u4e7e":"\u5764","\u9020)"),r=t.time.parseDate(),i=new d.a(r,t.male?"m":"f"),this.presentAlert("\u547d\u76d8",n,"".concat(i.Y.Name,"\u5e74 ").concat(i.M.Name,"\u6708 ").concat(i.D.Name,"\u65e5 ").concat(i.T.Name,"\u65f6"));case 2:case"end":return e.stop()}}),e,this)})))}},{key:"CheckImageRight",value:function(){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.forumservice.ForumList();case 2:return e.t0=function(e){return e.id===n.forumid},t=e.sent.find(e.t0),e.abrupt("return",t&&!1!==t.image?0==(2&this.settings.User.roller)?(this.presentAlert("\u4f20\u56fe\u6743\u9650",null,"\u76ee\u524d\u53ea\u5bf9VIP\u7528\u6237\u5f00\u653e\u672c\u5730\u56fe\u5e8a\u7684\u6743\u9650\u3002\n      \u975eVIP\u7528\u6237\u53ef\u4ee5\u5728\u5e16\u5b50\u5185\u5bb9\u91cc\u6dfb\u52a0\u5916\u90e8\u56fe\u7247\u94fe\u63a5\u3002"),Promise.resolve(!1)):""===((this.MainTopic||this.VTopic).id||"")?(this.presentAlert("\u4f20\u56fe\u6743\u9650",null,"\u8bf7\u5728\u521b\u5efa\u5e16\u5b50\u6210\u529f\u540e\uff0c\u4fee\u6539\u5e16\u5b50\u65f6\u6dfb\u52a0\u56fe\u7247\u3002"),Promise.resolve(!1)):Promise.resolve(!0):(this.presentAlert("\u4f20\u56fe\u6743\u9650",null,"\u672c\u8ba8\u8bba\u533a\u6ca1\u6709\u5f00\u653e\u56fe\u7247\u6743\u9650\u3002"),Promise.resolve(!1)));case 5:case"end":return e.stop()}}),e,this)})))}},{key:"onReadStart",value:function(e){}},{key:"onFilePicked",value:function(e){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,i,c,o=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.CheckImageRight();case 2:if(t.sent){t.next=4;break}return t.abrupt("return");case 4:if(!((n=p.Buffer.from(e.content)).length/1024>500)){t.next=7;break}return t.abrupt("return",void this.presentAlert("\u6587\u4ef6\u592a\u5927",null,"\u9650\u4e8e\u8fd0\u8425\u6210\u672c\uff0c\u76ee\u524d\u53ea\u63a5\u53d7\u5c0f\u4e8e 500KB \u7684\u56fe\u7247\u3002"));case 7:if(r=e.name.split("."),i=r[r.length-1].toLowerCase(),["jpg","png","jpeg"].includes(i)){t.next=10;break}return t.abrupt("return",void this.presentAlert("\u6587\u4ef6\u683c\u5f0f",null,"\u53ea\u63a5\u53d7 jpg, jpeg, png \u683c\u5f0f\u7684\u56fe\u7247\u3002"));case 10:return t.next=12,this.showLoading();case 12:c=this.settings.User,this.host.GetAliToken(c.id,c.password,"osstoken").then((function(e){var t={region:e.region,accessKeyId:e.token.accessKeyId,accessKeySecret:e.token.accessKeySecret,stsToken:e.token.securityToken,bucket:"huaheapp",endpoint:e.endpoint};console.log("got token",t);var r="forum/".concat(o.forumid,"/").concat((o.MainTopic||o.VTopic).id,".").concat(i);return new w(t).put(r,n)})).then((function(e){var t=o.MainTopic||o.VTopic;return t.img=e.url,o.forumservice.UpdateTopic({img:e.url},t.id,o.Private)})).then((function(e){o.presentAlert("\u4e0a\u4f20\u6210\u529f\uff01",null,"\u8bf7\u70b9\u51fb\u5e16\u5b50\u4fdd\u5b58\u6309\u94ae\uff0c\u5c06\u4e0a\u4f20\u7684\u5185\u5bb9\u4fdd\u5b58\u5230\u5e16\u5b50\u91cc\u3002")})).catch((function(e){o.presentAlert("\u4e0a\u4f20\u5931\u8d25",null," \u8bf7\u786e\u5b9a\u60a8\u62e5\u6709\u64cd\u4f5c\u6743\u9650\u3002\u8bf7\u91cd\u65b0\u4e0a\u4f20\uff0c\u6216\u7a0d\u540e\u518d\u8bd5\u3002")}));case 14:case"end":return t.stop()}}),t,this)})))}},{key:"onReadEnd",value:function(e){this.filePicker.reset()}},{key:"onEditorReady",value:function(e){e.ui.getEditableElement().parentElement.insertBefore(e.ui.view.toolbar.element,e.ui.getEditableElement())}},{key:"presentAlert",value:function(e,t,n){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function r(){var i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.closeLoading();case 2:return r.next=4,this.alertController.create({header:e||"\u9519\u8bef",subHeader:t||"",message:n,buttons:["\u786e\u5b9a"]});case 4:return i=r.sent,r.next=7,i.present();case 7:case"end":return r.stop()}}),r,this)})))}},{key:"SaveNewToServer",value:function(){var e=this,t=this.SaveTo(this.MainTopic||this.VTopic);this.forumservice.NewTopic(this.Private?null:this.forumid,t).then((function(n){t.id=n.insertedId,e.modalCtrl.dismiss(t)})).catch((function(t){e.presentAlert("\u9519\u8bef","\u521b\u5efa\u5931\u8d25",JSON.stringify(t))})).finally((function(){e.closeLoading()}))}},{key:"UpdateToServer",value:function(){var e,t,n=this,r={};this.SaveTo(r);var i=(null===(e=this.MainTopic)||void 0===e?void 0:e.id)||(null===(t=this.VTopic)||void 0===t?void 0:t.id);this.forumservice.UpdateTopic(r,i,this.Private).then((function(e){n.SaveTo(n.MainTopic||n.VTopic),n.modalCtrl.dismiss(!0)})).catch((function(e){n.presentAlert("\u9519\u8bef","\u521b\u5efa\u5931\u8d25",JSON.stringify(e))})).finally((function(){n.closeLoading()}))}},{key:"SaveTo",value:function(e){try{return this.MainTopic&&(e.title=this.Titel),e.gua=this.Gua,e.bazi=this.Bazi,e.content=this.Content,e.modified=Date.now(),e}catch(t){console.log(t)}}},{key:"showLoading",value:function(){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.loadingView,e.t0){e.next=5;break}return e.next=4,this.loadingController.create({message:"\u4fdd\u5b58\u5230\u8bba\u575b...",duration:6e4});case 4:this.loadingView=e.sent;case 5:return e.next=7,this.loadingView.present();case 7:case"end":return e.stop()}}),e,this)})))}},{key:"closeLoading",value:function(){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.loadingView,!e.t0){e.next=5;break}return e.next=4,this.loadingView.dismiss();case 4:this.loadingView=null;case 5:case"end":return e.stop()}}),e,this)})))}},{key:"Titel",get:function(){return this.titel||""},set:function(e){this.titel=(e||"").substring(0,30)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(m.Yb(c.a),m.Yb(o.a),m.Yb(h.a),m.Yb(i.b),m.Yb(i.Z),m.Yb(i.ab))},e.\u0275cmp=m.Sb({type:e,selectors:[["app-topiceditor"]],viewQuery:function(e,t){var n;1&e&&m.Oc(k,!0),2&e&&m.yc(n=m.mc())&&(t.filePicker=n.first)},inputs:{MainTopic:"MainTopic",VTopic:"VTopic",forumid:"forumid",forumname:"forumname",Private:"Private"},decls:40,vars:11,consts:[["color","secondary"],["slot","start"],[3,"click"],["name","close-circle"],["slot","end"],["name","save"],["position","fixed"],["placeholder","\u8bf7\u8f93\u5165\u9898\u76ee\uff1a\u4e0d\u8d85\u8fc730\u4e2a\u5b57\u7b26",3,"ngModel","disabled","ngModelChange"],["color","medium",3,"click",4,"ngIf"],[3,"name"],["ngxFilePicker","","fill","outline",3,"readMode","readStart","filePick","readEnd"],["filePicker","ngxFilePicker"],["name","image"],[3,"ngModel","config","editor","ngModelChange","ready"],["color","medium",3,"click"]],template:function(e,t){1&e&&(m.dc(0,"ion-header"),m.dc(1,"ion-toolbar",0),m.dc(2,"ion-buttons",1),m.dc(3,"ion-button",2),m.lc("click",(function(){return t.onCancel()})),m.Zb(4,"ion-icon",3),m.dc(5,"ion-text"),m.Jc(6,"\u53d6\u6d88"),m.cc(),m.cc(),m.cc(),m.dc(7,"ion-title"),m.Jc(8),m.cc(),m.dc(9,"ion-buttons",4),m.dc(10,"ion-button",2),m.lc("click",(function(){return t.onSave()})),m.Zb(11,"ion-icon",5),m.dc(12,"ion-text"),m.Jc(13,"\u4fdd\u5b58"),m.cc(),m.cc(),m.cc(),m.cc(),m.cc(),m.dc(14,"ion-content"),m.dc(15,"ion-item"),m.dc(16,"ion-label",6),m.Jc(17,"\u9898\u76ee"),m.cc(),m.dc(18,"ion-input",7),m.lc("ngModelChange",(function(e){return t.Titel=e})),m.cc(),m.cc(),m.dc(19,"ion-item"),m.dc(20,"ion-text"),m.Jc(21,"\u5185\u5bb9"),m.cc(),m.dc(22,"ion-buttons"),m.Hc(23,y,3,0,"ion-button",8),m.Hc(24,x,3,0,"ion-button",8),m.cc(),m.dc(25,"ion-buttons",4),m.dc(26,"ion-button",2),m.lc("click",(function(){return t.showPaiguaModal()})),m.Zb(27,"ion-icon",9),m.dc(28,"ion-text"),m.Jc(29,"\u516d\u723b"),m.cc(),m.cc(),m.dc(30,"ion-button",2),m.lc("click",(function(){return t.showPaiBaziModal()})),m.Zb(31,"ion-icon",9),m.dc(32,"ion-text"),m.Jc(33,"\u516b\u5b57"),m.cc(),m.cc(),m.cc(),m.cc(),m.dc(34,"ion-item"),m.dc(35,"ion-button",10,11),m.lc("readStart",(function(e){return t.onReadStart(e)}))("filePick",(function(e){return t.onFilePicked(e)}))("readEnd",(function(e){return t.onReadEnd(e)})),m.Zb(37,"ion-icon",12),m.Jc(38," \u4e0a\u4f20\u56fe\u7247 "),m.cc(),m.cc(),m.dc(39,"ckeditor",13),m.lc("ngModelChange",(function(e){return t.Content=e}))("ready",(function(e){return t.onEditorReady(e)})),m.cc(),m.cc()),2&e&&(m.Nb(8),m.Lc("\u7f16\u8f91\uff1a",t.forumname,""),m.Nb(10),m.vc("ngModel",t.Titel)("disabled",!t.TitelEditable),m.Nb(5),m.vc("ngIf",t.Gua),m.Nb(1),m.vc("ngIf",t.Bazi),m.Nb(3),m.vc("name",t.Gua?"backspace":"add"),m.Nb(4),m.vc("name",t.Bazi?"backspace":"add"),m.Nb(4),m.vc("readMode",t.readMode),m.Nb(4),m.vc("ngModel",t.Content)("config",t.EditorConfig)("editor",t.Editor))},directives:[i.s,i.W,i.i,i.h,i.t,i.S,i.U,i.m,i.w,i.C,i.v,i.gb,v.f,v.g,b.j,f.a,g.a],styles:["*[_ngcontent-%COMP%]{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}[contenteditable][_ngcontent-%COMP%], ckeditor[_ngcontent-%COMP%], input[_ngcontent-%COMP%]{-webkit-user-select:text;-moz-user-select:text;-ms-user-select:text;user-select:text}[_nghost-%COMP%]     .ck-editor__editable_inline{min-height:200px}"]}),e}()},CGrG:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"c",(function(){return c})),n.d(t,"b",(function(){return u}));var r=n("mrSG"),i=n("fXoL"),c=function(){var e={arrayBuffer:0,binaryString:1,dataURL:2,text:3};return e[e.arrayBuffer]="arrayBuffer",e[e.binaryString]="binaryString",e[e.dataURL]="dataURL",e[e.text]="text",e}(),o=function(){function e(t,n,r){_classCallCheck(this,e),this._underlyingFile=t,this._readMode=n,this._content=r}return _createClass(e,[{key:"name",get:function(){return this._underlyingFile.name}},{key:"size",get:function(){return this._underlyingFile.size}},{key:"type",get:function(){return this._underlyingFile.type}},{key:"readMode",get:function(){return this._readMode}},{key:"content",get:function(){return this._content}},{key:"underlyingFile",get:function(){return this._underlyingFile}}]),e}(),s=function(){var e=function(){function e(){_classCallCheck(this,e),this.filter=function(){return!0},this.readStart=new i.s,this.readEnd=new i.s}return _createClass(e,[{key:"readFiles",value:function(e,t){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function n(){var i,s,a=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=Array.from(e).filter(this.filter),s=i.length,this.readStart.emit(s),n.next=4,Promise.all(i.map((function(e){return Object(r.b)(a,void 0,void 0,regeneratorRuntime.mark((function n(){var i;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,function(e,t){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",new Promise((function(n,r){var i=new FileReader;switch(i.onload=function(r){var i=new o(e,t,r.target.result);n(i)},i.onerror=function(e){r(e)},t){case c.arrayBuffer:i.readAsArrayBuffer(e);break;case c.binaryString:i.readAsBinaryString(e);break;case c.text:i.readAsText(e);break;case c.dataURL:default:i.readAsDataURL(e)}})));case 1:case"end":return n.stop()}}),n)})))}(e,this.readMode);case 2:i=n.sent,t(i);case 4:case"end":return n.stop()}}),n,this)})))})));case 4:this.readEnd.emit(s);case 5:case"end":return n.stop()}}),n,this)})))}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=i.Tb({type:e,inputs:{filter:"filter",readMode:"readMode"},outputs:{readStart:"readStart",readEnd:"readEnd"}}),e}(),a=function(){var e=function(e){function t(e,n){var r;return _classCallCheck(this,t),(r=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this))).el=e,r.renderer=n,r.accept="",r.filePick=new i.s,r}return _inherits(t,e),_createClass(t,[{key:"ngOnInit",value:function(){var e=this;this._input=this.renderer.createElement("input"),this.renderer.appendChild(this.el.nativeElement,this._input),this.renderer.setAttribute(this._input,"type","file"),this.renderer.setAttribute(this._input,"accept",this.accept),this.renderer.setStyle(this._input,"display","none"),this.multiple&&this.renderer.setAttribute(this._input,"multiple","multiple"),this.renderer.listen(this._input,"change",(function(t){return e._onListen(t)}))}},{key:"reset",value:function(){this._input?this._input.value=null:console.error("It seems that ngOnInit() has not been executed or that the hidden _input element is null. Did you mess with the DOM?")}},{key:"browse",value:function(){this._input?this._input.click():console.error("It seems that ngOnInit() has not been executed or that the hidden _input element is null. Did you mess with the DOM?")}},{key:"_onListen",value:function(e){var t=this;this.readFiles(e.target.files,(function(e){return t.filePick.emit(e)}))}},{key:"multiple",get:function(){return this._multiple},set:function(e){this._multiple=function(e){return null!=e&&"false"!=="".concat(e)}(e)}}]),t}(s);return e.\u0275fac=function(t){return new(t||e)(i.Yb(i.q),i.Yb(i.N))},e.\u0275dir=i.Tb({type:e,selectors:[["","ngxFilePicker",""]],hostBindings:function(e,t){1&e&&i.lc("click",(function(){return t.browse()}))},inputs:{accept:"accept",multiple:"multiple"},outputs:{filePick:"filePick"},exportAs:["ngxFilePicker"],features:[i.Kb]}),e}(),u=function(){var e=function e(){_classCallCheck(this,e)};return e.\u0275mod=i.Wb({type:e}),e.\u0275inj=i.Vb({factory:function(t){return new(t||e)},imports:[[]]}),e}()},G6JS:function(e,t,n){"use strict";n.d(t,"a",(function(){return g}));var r=n("mrSG"),i=n("c7TG"),c=n("PKx9"),o=n("LTmD"),s=n("7L00"),a=n("8/yo"),u=(n("0eVs"),n("Y6BA")),l=n("fXoL"),d=n("tyNb"),h=n("ofXK");function f(e,t){if(1&e&&(l.dc(0,"ion-chip"),l.dc(1,"ion-avatar"),l.Zb(2,"img",5),l.cc(),l.dc(3,"ion-text"),l.Jc(4),l.cc(),l.cc()),2&e){var n=t.$implicit;l.Nb(2),l.vc("src",n.icon,l.Ec),l.Nb(2),l.Kc(n.name)}}function p(e,t){if(1&e){var n=l.ec();l.dc(0,"ion-button",11),l.lc("click",(function(){return l.Cc(n),l.oc().ShowPanfu()})),l.Jc(1,"\u547d\u76d8"),l.cc()}}function m(e,t){if(1&e){var n=l.ec();l.dc(0,"ion-buttons",1),l.dc(1,"ion-button",2),l.lc("click",(function(){return l.Cc(n),l.oc(2).EditTopic()})),l.Jc(2,"\u5411\u4ed6\u6c42\u52a9"),l.cc(),l.cc()}}function v(e,t){if(1&e){var n=l.ec();l.dc(0,"ion-item"),l.dc(1,"ion-buttons"),l.dc(2,"ion-button",2),l.lc("click",(function(){return l.Cc(n),l.oc().EditMessage()})),l.Jc(3,"\u7ed9\u4ed6\u53d1\u77ed\u6d88\u606f"),l.cc(),l.cc(),l.Hc(4,m,3,0,"ion-buttons",12),l.cc()}if(2&e){var r=l.oc();l.Nb(4),l.vc("ngIf",r.IsMaster)}}function b(e,t){if(1&e){var n=l.ec();l.dc(0,"ion-footer"),l.dc(1,"ion-toolbar"),l.dc(2,"ion-buttons"),l.dc(3,"ion-button",2),l.lc("click",(function(){return l.Cc(n),l.oc().EditRoles()})),l.Jc(4,"\u66f4\u6539\u89d2\u8272"),l.cc(),l.dc(5,"ion-button",2),l.lc("click",(function(){return l.Cc(n),l.oc().ExtendVIP()})),l.Jc(6,"VIP\u5ef6\u671f"),l.cc(),l.cc(),l.cc(),l.cc()}}var g=function(){var e=function(){function e(t,n,r,i,c,o,s){_classCallCheck(this,e),this.modalCtrl=t,this.loadingController=n,this.toastController=r,this.alertController=i,this.forumservice=c,this.settings=o,this.router=s,this.Avatar="",this.Name="",this.Gender="\u6ca1\u6709\u516c\u5f00",this.Bazi=null,this.Describe="\u4ed6\u5f88\u61d2\uff0c\u4ec0\u4e48\u90fd\u6ca1\u5199\u3002",this.IsMaster=!1,this.Rolers=[],this.VIP=""}return _createClass(e,[{key:"ngOnInit",value:function(){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.Avatar=this.settings.Avatar("male"),e.next=3,this.showLoading();case 3:this.forumservice.GetUserInfo(this.Uerid).then((function(e){t.Avatar=e.avatar||t.settings.Avatar(e.gender),t.Name=e.id,t.Rolers=t.settings.UserRolers(e.roller),t.Gender="male"===e.gender?"\u7537\u58eb":t.Gender,t.Gender="female"===e.gender?"\u5973\u58eb":t.Gender,t.Describe=""!==(e.describe||"")?e.describe:t.Describe,t.IsMaster=e.roller>=16,e.birthday&&(t.Bazi={person:e.id,male:"female"!==e.gender,time:e.birthday,place:["\u672a\u77e5","\u672a\u77e5"],realsuntime:!1}),t.vuser=e})).finally((function(){t.closeLoading()}));case 4:case"end":return e.stop()}}),e,this)})))}},{key:"onSave",value:function(){this.modalCtrl.dismiss(!0)}},{key:"ShowPanfu",value:function(){this.onSave(),this.router.navigate(["menu/topicpanfu/".concat(JSON.stringify(this.Bazi))])}},{key:"EditMessage",value:function(){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={id:Object(u.c)(),created:Date.now(),valid:0,author:this.settings.User.id,receiver:this.Uerid,roller:0,readed:!1,private:!0,replyable:!0,title:"\u3002\u3002\u3002\u4f60\u597d\uff01",content:""},e.next=3,this.modalCtrl.create({component:s.a,componentProps:{Message:t}});case 3:return n=e.sent,e.next=6,n.present();case 6:return e.next=8,n.onWillDismiss();case 8:case"end":return e.stop()}}),e,this)})))}},{key:"EditTopic",value:function(){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.modalCtrl.create({component:a.a,componentProps:{MainTopic:this.CreateMainTopic(),forumid:null,forumname:"\u4e2a\u4eba\u6c42\u52a9"}});case 2:return t=e.sent,e.next=5,t.present();case 5:return e.next=7,t.onWillDismiss();case 7:n=e.sent,n.data&&this.presentToast("\u6c42\u52a9\u5df2\u53d1\u9001\uff0c\u8bf7\u7b49\u5f85\u56de\u590d\u3002");case 10:case"end":return e.stop()}}),e,this)})))}},{key:"EditRoles",value:function(){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,i,c,o,s,a,u,l,d,h,f=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.vuser.roller,n=!1,e.next=4,this.alertController.create({header:"\u63a5\u6536\u8005\u89d2\u8272",inputs:[{name:"register",type:"checkbox",label:"\u6ce8\u518c\u7528\u6237",value:1,checked:(1&t)>0},{name:"vip",type:"checkbox",label:"VIP\u7528\u6237",value:2,checked:(2&t)>0},{name:"huahe",type:"checkbox",label:"\u534e\u9e64\u540c\u95e8",value:4,checked:(4&t)>0},{name:"bbs",type:"checkbox",label:"\u7248\u4e3b",value:8,checked:(8&t)>0},{name:"liuyao",type:"checkbox",label:"\u516d\u723b\u8001\u5e08",value:16,checked:(16&t)>0},{name:"bazi",type:"checkbox",label:"\u547d\u7406\u8001\u5e08",value:32,checked:(32&t)>0},{name:"fengshui",type:"checkbox",label:"\u98ce\u6c34\u8001\u5e08",value:64,checked:(64&t)>0},{name:"supermaster",type:"checkbox",label:"\u5927\u5b97\u5e08",value:128,checked:(128&t)>0},{name:"admin",type:"checkbox",label:"\u7ba1\u7406\u5458",value:256,checked:(256&t)>0}],buttons:[{text:"\u786e\u5b9a",handler:function(){n=!0}},{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary",handler:function(){}}]});case 4:return r=e.sent,e.next=7,r.present();case 7:return e.next=9,r.onWillDismiss();case 9:if(i=e.sent,c=i.data,n){e.next=13;break}return e.abrupt("return");case 13:for(o=0,s=!0,a=!1,u=void 0,e.prev=17,l=c.values[Symbol.iterator]();!(s=(d=l.next()).done);s=!0)h=d.value,o|=h;e.next=25;break;case 21:e.prev=21,e.t0=e.catch(17),a=!0,u=e.t0;case 25:e.prev=25,e.prev=26,s||null==l.return||l.return();case 28:if(e.prev=28,!a){e.next=31;break}throw u;case 31:return e.finish(28);case 32:return e.finish(25);case 33:return e.next=35,this.showLoading();case 35:this.forumservice.UpgradUser(this.vuser.id,{roller:o}).then((function(){f.vuser.roller=o,f.Rolers=f.settings.UserRolers(o)})).catch((function(e){f.presentToast("\u8bbe\u7f6e\u7528\u6237\u6743\u9650\u5931\u8d25\u3002")})).finally((function(){f.closeLoading()}));case 36:case"end":return e.stop()}}),e,this,[[17,21,25,33],[26,,28,32]])})))}},{key:"ExtendVIP",value:function(){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,r,i=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return!1,e.next=3,this.alertController.create({header:"\u5ef6\u957fVIP",inputs:[{name:"30days",type:"radio",label:"30 \u65e5",value:30,checked:!0},{name:"60days",type:"radio",label:"60 \u65e5",value:90,checked:!1},{name:"90days",type:"radio",label:"90 \u65e5",value:90,checked:!1},{name:"180days",type:"radio",label:"180 \u65e5",value:180,checked:!1},{name:"365days",type:"radio",label:"365 \u65e5",value:365,checked:!1}],buttons:[{text:"\u786e\u5b9a",handler:function(){!0}},{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary",handler:function(){}}]});case 3:return t=e.sent,e.next=6,t.present();case 6:return e.next=8,t.onWillDismiss();case 8:return n=e.sent,r=n.data,e.next=12,this.showLoading();case 12:this.forumservice.UpgradUser(this.vuser.id,{vip:r.values}).then((function(){new Date(r.values),i.presentToast('\u7528\u6237"'.concat(i.vuser.id,'"\u7684VIP\u6743\u9650\u5ef6\u957f\u4e86 ').concat(r.values," \u65e5\u3002"))})).catch((function(e){i.presentToast("\u8bbe\u7f6e\u7528\u6237\u6743\u9650\u5931\u8d25\u3002")})).finally((function(){i.closeLoading()}));case 13:case"end":return e.stop()}}),e,this)})))}},{key:"showLoading",value:function(){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.loadingView,e.t0){e.next=5;break}return e.next=4,this.loadingController.create({message:"\u4fdd\u5b58\u7528\u6237\u8d44\u6599...",duration:6e4});case 4:this.loadingView=e.sent;case 5:return e.next=7,this.loadingView.present();case 7:case"end":return e.stop()}}),e,this)})))}},{key:"closeLoading",value:function(){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.loadingView,!e.t0){e.next=5;break}return e.next=4,this.loadingView.dismiss();case 4:this.loadingView=null;case 5:case"end":return e.stop()}}),e,this)})))}},{key:"CreateMainTopic",value:function(){var e=this.settings.User,t=Date.now();return{id:"",created:t,modified:t,author:e.id,forumid:this.Uerid,title:"",top:0,good:!1,update:0,gua:null,bazi:null,img:null,content:"",frozen:!1,deleted:!1,child:0,view:0}}},{key:"presentToast",value:function(e){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.toastController.create({message:e,duration:2e3});case 2:t.sent.present();case 3:case"end":return t.stop()}}),t,this)})))}},{key:"IsMe",get:function(){return this.Uerid===this.settings.User.id}},{key:"IsAmdin",get:function(){var e=this.settings.User;return!!e&&e.roller>=256}}]),e}();return e.\u0275fac=function(t){return new(t||e)(l.Yb(i.ab),l.Yb(i.Z),l.Yb(i.hb),l.Yb(i.b),l.Yb(c.a),l.Yb(o.a),l.Yb(d.g))},e.\u0275cmp=l.Sb({type:e,selectors:[["app-publicprofil"]],inputs:{Uerid:"Uerid"},decls:28,vars:8,consts:[["color","secondary"],["slot","end"],[3,"click"],["name","log-out"],["slot","start"],[3,"src"],[1,"ion-text-wrap"],[4,"ngFor","ngForOf"],["fill","outline",3,"click",4,"ngIf"],[4,"ngIf"],[3,"innerHtml"],["fill","outline",3,"click"],["slot","end",4,"ngIf"]],template:function(e,t){1&e&&(l.dc(0,"ion-header"),l.dc(1,"ion-toolbar",0),l.dc(2,"ion-title"),l.Jc(3,"\u7b80\u4ecb/\u8d44\u5386"),l.cc(),l.dc(4,"ion-buttons",1),l.dc(5,"ion-button",2),l.lc("click",(function(){return t.onSave()})),l.Zb(6,"ion-icon",3),l.dc(7,"ion-text"),l.Jc(8,"\u5173\u95ed"),l.cc(),l.cc(),l.cc(),l.cc(),l.cc(),l.dc(9,"ion-content"),l.dc(10,"ion-item"),l.dc(11,"ion-thumbnail",4),l.Zb(12,"ion-img",5),l.cc(),l.dc(13,"ion-label",6),l.dc(14,"ion-text"),l.Jc(15),l.cc(),l.Zb(16,"p"),l.Hc(17,f,5,2,"ion-chip",7),l.cc(),l.cc(),l.dc(18,"ion-item"),l.dc(19,"ion-label"),l.dc(20,"ion-text"),l.Jc(21),l.cc(),l.cc(),l.Hc(22,p,2,0,"ion-button",8),l.cc(),l.Hc(23,v,5,1,"ion-item",9),l.dc(24,"ion-item"),l.dc(25,"ion-label"),l.Zb(26,"ion-text",10),l.cc(),l.cc(),l.cc(),l.Hc(27,b,7,0,"ion-footer",9)),2&e&&(l.Nb(12),l.vc("src",t.Avatar),l.Nb(3),l.Kc(t.Name),l.Nb(2),l.vc("ngForOf",t.Rolers),l.Nb(4),l.Lc("\u6027\u522b\uff1a",t.Gender,""),l.Nb(1),l.vc("ngIf",t.Bazi),l.Nb(1),l.vc("ngIf",!t.IsMe),l.Nb(3),l.vc("innerHtml",t.Describe,l.Dc),l.Nb(1),l.vc("ngIf",t.IsAmdin))},directives:[i.s,i.W,i.U,i.i,i.h,i.t,i.S,i.m,i.w,i.T,i.u,i.C,h.i,h.j,i.k,i.e,i.q],styles:[""]}),e}()},PKx9:function(e,t,n){"use strict";var r=n("mrSG"),i=n("LTmD"),c=n("lEof");n("aGhr");var o=function(){function e(){_classCallCheck(this,e),this.topics=[]}return _createClass(e,[{key:"Reset",value:function(){this.topics=[]}},{key:"GetPage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.topics.find((function(n){return n.forumid===e&&t===n.page}));return n?{data:n.items,sum:n.sum}:null}},{key:"SetPage",value:function(e,t,n,r){var i=this.topics.find((function(n){return n.forumid===e&&t===n.page}));i?i.items=n:this.topics.push({forumid:e,page:t,items:n,sum:r})}},{key:"GetTopic",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,c=this.topics[Symbol.iterator]();!(t=(i=c.next()).done);t=!0){var o=i.value.items.find((function(t){return t.id===e}));if(o)return o}}catch(s){n=!0,r=s}finally{try{t||null==c.return||c.return()}finally{if(n)throw r}}return null}},{key:"SetTopic",value:function(e,t){var n=this.GetPage(t,0);n?n.data.insert(0,e):this.SetPage(t,0,[e],1)}},{key:"DeleteTopic",value:function(e,t){if(t);else{var n=!0,r=!1,i=void 0;try{for(var c,o=this.topics[Symbol.iterator]();!(n=(c=o.next()).done);n=!0){var s=c.value;s.items.find((function(t){return t.id===e}))&&(s.items=s.items.filter((function(t){return t.id!==e})))}}catch(a){r=!0,i=a}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}}}},{key:"UpdateTopic",value:function(e){var t=this.GetTopic(e.id);if(t)for(var n in e)t[n]=e[n]}}]),e}(),s=n("Y6BA"),a=(n("0eVs"),n("fXoL"));n.d(t,"a",(function(){return l}));var u,l=((u=function(){function e(t,n){_classCallCheck(this,e),this.settings=t,this.host=n,this.vusers=[],this.currentTopics=[],this.ForumMG=new o}return _createClass(e,[{key:"ForumList",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.ForumMG.Forumlist||!1!==e){t.next=4;break}t.t0=Promise.resolve(this.ForumMG.Forumlist),t.next=7;break;case 4:return t.next=6,this.settings.WaitInit();case 6:t.t0=this.LoadForumList();case 7:return t.abrupt("return",t.t0);case 8:case"end":return t.stop()}}),t,this)})))}},{key:"LoadTopicList",value:function(e,t,n){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function r(){var i,c,o,s,a=this;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i=e||"forum_"+n,i=-2===n?e+"good":i,c=-1===n?n:t,!(o=this.ForumMG.GetPage(i,c))){r.next=5;break}return r.abrupt("return",Promise.resolve(o));case 5:return s={func:"TopicList",forumid:e,params:{filter:{},startColumn:20*t,private:!1}},r.abrupt("return",(-1===n?s.params.filter.top=1:-2===n?s.params.filter.good=!0:-3===n?(s.params.filter.author=this.User.id,s.params.filter.topic=null):-4===n?(s.params.filter.author=this.User.id,s.params.filter.topic=null,s.params.private=!0):-5===n?(s.params.filter.forumid=this.User.id,s.params.filter.topic=null,s.params.private=!0):s.params.filter.top=0,e&&(s.params.filter.forumid=e),this.host.ForumRequest(this.User.id,this.User.password,s).then((function(e){return e&&e.data&&a.ForumMG.SetPage(i,c,e.data,e.sum),e})).catch((function(e){return Promise.reject(e)}))));case 7:case"end":return r.stop()}}),r,this)})))}},{key:"LoadAnswerList",value:function(e,t,n){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",this.host.ForumRequest(this.User.id,this.User.password,{func:"TopicList",forumid:t,params:{filter:{topic:e},sort:"created",startColumn:20*n,direction:1}}).then((function(e){return e})).catch((function(e){return Promise.reject(e)})));case 1:case"end":return r.stop()}}),r,this)})))}},{key:"NewTopic",value:function(e,t){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.host.ForumRequest(this.User.id,this.User.password,{func:"NewTopic",forumid:e,params:t}).then((function(e){return e})).catch((function(e){return Promise.reject(e)})));case 1:case"end":return n.stop()}}),n,this)})))}},{key:"GetTopic",value:function(e,t){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function n(){var i,c=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=this.ForumMG.GetTopic(t),n.abrupt("return",i?Promise.resolve(i):this.host.ForumRequest(this.User.id,this.User.password,{func:"GetTopic",forumid:e||"",params:{topicid:t||"",private:!1}}).then((function(e){return Object(r.b)(c,void 0,void 0,regeneratorRuntime.mark((function t(){var n,r,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e;case 2:return n=t.sent,t.next=5,this.GetUserInfo(n.author);case 5:return r=t.sent,i=(r||s.a).avatar||"",t.abrupt("return",(n.avatar=i.IsNullOrEmpty()?this.settings.Avatar(r.gender):i,n.showImg=!0,n.showGua=!0,n.showBazi=!0,e));case 8:case"end":return t.stop()}}),t,this)})))})).catch((function(e){return Promise.reject(e)})));case 2:case"end":return n.stop()}}),n,this)})))}},{key:"UpdatForum",value:function(e,t){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.host.ForumRequest(this.User.id,this.User.password,{func:"UpdateForum",params:{id:t,data:e}}).then((function(e){return e})).catch((function(e){return console.log("updat failed",e),Promise.reject(e)})));case 1:case"end":return n.stop()}}),n,this)})))}},{key:"UpdateTopic",value:function(e,t,n){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",this.host.ForumRequest(this.User.id,this.User.password,{func:"Update",params:{id:t,private:n,data:e}}).then((function(e){return e})).catch((function(e){return console.log("updat failed",e),Promise.reject(e)})));case 1:case"end":return r.stop()}}),r,this)})))}},{key:"GetUserInfo",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,r=this.VUsers.find((function(t){return t.id===e}));return r?Promise.resolve(r):this.host.ForumRequest(this.User.id,this.User.password,{func:"GetVUser",author:e,roller:n}).then((function(e){return t.VUsers.push(e),e})).catch((function(e){return Promise.reject(e)}))}},{key:"DeleteTopic",value:function(e,t){var n=this;return this.host.ForumRequest(this.User.id,this.User.password,{func:"DeleteTopic",params:{topicid:e}}).then((function(r){return n.ForumMG.DeleteTopic(e,t),r})).catch((function(e){return Promise.reject(e)}))}},{key:"SendMessage",value:function(e){return this.host.ForumRequest(this.User.id,this.User.password,{func:"SendMessage",params:{message:e}}).then((function(e){return e})).catch((function(e){return Promise.reject(e)}))}},{key:"LoadMessages",value:function(e,t){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.host.ForumRequest(this.User.id,this.User.password,{func:"MessageList",params:{pageindex:e,forme:t}}).then((function(e){return e})).catch((function(e){return Promise.reject(e)})));case 1:case"end":return n.stop()}}),n,this)})))}},{key:"DeleteMessage",value:function(e,t){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.host.ForumRequest(this.User.id,this.User.password,{func:"DeleteMessage",params:{msgid:e,todelete:t}}).then((function(e){return e})).catch((function(e){return Promise.reject(e)})));case 1:case"end":return n.stop()}}),n,this)})))}},{key:"HoldPublicMessage",value:function(){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.initial();case 2:return e.abrupt("return",this.host.ForumRequest(this.User.id,this.User.password,{func:"HoldPublicMsg"}).then((function(e){return e})).catch((function(e){return Promise.reject(e)})));case 3:case"end":return e.stop()}}),e,this)})))}},{key:"UpgradUser",value:function(e,t){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.initial();case 2:return n.abrupt("return",this.host.ForumRequest(this.User.id,this.User.password,{func:"UpgradeUser",params:{id:e,data:t}}).then((function(e){return e})).catch((function(e){return Promise.reject(e)})));case 3:case"end":return n.stop()}}),n,this)})))}},{key:"initial",value:function(){return Object(r.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.User,e.t0){e.next=4;break}return e.next=4,this.settings.WaitInit();case 4:return e.abrupt("return",!0);case 5:case"end":return e.stop()}}),e,this)})))}},{key:"LoadForumList",value:function(){var e=this;return this.host.ForumRequest(this.User.id,this.User.password,{func:"ForumList"}).then((function(t){return e.ForumMG.Forumlist=t,t})).catch((function(e){return Promise.reject(e)}))}},{key:"User",get:function(){return this.settings.User||s.a}},{key:"VUsers",get:function(){return this.vusers=this.vusers||[],this.vusers=this.vusers.filter((function(e){return!!e}))||[],this.vusers},set:function(e){this.vusers=e||[]}}]),e}()).\u0275fac=function(e){return new(e||u)(a.hc(i.a),a.hc(c.a))},u.\u0275prov=a.Ub({token:u,factory:u.\u0275fac,providedIn:"root"}),u)},aGhr:function(e,t){}}]);