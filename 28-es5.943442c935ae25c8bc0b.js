function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var c=t[n];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(e,c.key,c)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{AyTO:function(e,t,n){"use strict";n.r(t);var c=n("ofXK"),i=n("3Pt+"),r=n("tyNb"),o=n("c7TG"),s=n("mrSG"),a=n("LTmD"),u=n("lEof"),l=n("PKx9"),d=n("HQI1"),m=n("Y6BA"),f=n("7L00"),h=n("fXoL");function v(e,t){if(1&e){var n=h.ec();h.dc(0,"ion-buttons",12),h.dc(1,"ion-button",2),h.lc("click",(function(){return h.Cc(n),h.oc().onclose(!0)})),h.Jc(2," \u4fdd\u5b58 "),h.cc(),h.cc()}}function p(e,t){if(1&e){var n=h.ec();h.dc(0,"ion-chip",2),h.lc("click",(function(){h.Cc(n);var e=t.$implicit;return h.oc().DeleteAdmin(e)})),h.Jc(1),h.cc()}if(2&e){var c=t.$implicit;h.Nb(1),h.Kc(c)}}function b(e,t){if(1&e){var n=h.ec();h.dc(0,"ion-button",13),h.lc("click",(function(){return h.Cc(n),h.oc().AddAdmin()})),h.Jc(1,"\u6dfb\u52a0"),h.cc()}}function g(e,t){if(1&e&&(h.dc(0,"ion-chip"),h.dc(1,"ion-avatar"),h.Zb(2,"img",14),h.cc(),h.dc(3,"ion-text"),h.Jc(4),h.cc(),h.cc()),2&e){var n=t.$implicit;h.Nb(2),h.vc("src",n.icon,h.Ec),h.Nb(2),h.Kc(n.name)}}function k(e,t){if(1&e){var n=h.ec();h.dc(0,"ion-button",13),h.lc("click",(function(){return h.Cc(n),h.oc().EditRoles()})),h.Jc(1,"\u7f16\u8f91"),h.cc()}}function x(e,t){if(1&e&&(h.dc(0,"ion-item",5),h.dc(1,"ion-label",15),h.Jc(2,"\u8be6\u7ec6\u4ecb\u7ecd"),h.cc(),h.dc(3,"ion-text"),h.Jc(4),h.cc(),h.cc()),2&e){var n=h.oc();h.Nb(4),h.Lc(" ",n.Forum.detail||"\u7248\u4e3b\u5f88\u61d2\uff0c\u6ca1\u6709\u8be6\u7ec6\u7684\u4ecb\u7ecd\u3002"," ")}}function y(e,t){if(1&e){var n=h.ec();h.dc(0,"div",16),h.dc(1,"div",17),h.dc(2,"label"),h.Jc(3,"\u8be6\u7ec6\u4ecb\u7ecd"),h.cc(),h.dc(4,"textarea",18),h.lc("ngModelChange",(function(e){return h.Cc(n),h.oc().Forum.detail=e})),h.cc(),h.cc(),h.cc()}if(2&e){var c=h.oc();h.Nb(4),h.vc("ngModel",c.Forum.detail)}}function w(e,t){if(1&e){var n=h.ec();h.dc(0,"ion-item",5),h.dc(1,"ion-label",15),h.dc(2,"ion-text"),h.Jc(3,"\u6dfb\u52a0\u7279\u8bb8\u7528\u6237\uff0c\u540d\u5b57\u95f4\u7528\u82f1\u6587\u5206\u53f7\u9694\u5f00\uff1a"),h.cc(),h.dc(4,"ion-button",19),h.lc("click",(function(){return h.Cc(n),h.oc().EditMessage()})),h.Jc(5,"\u7fa4\u53d1\u6d88\u606f"),h.cc(),h.cc(),h.cc()}}function C(e,t){if(1&e){var n=h.ec();h.dc(0,"div",16),h.dc(1,"div",17),h.dc(2,"textarea",20),h.lc("ngModelChange",(function(e){return h.Cc(n),h.oc().Users=e})),h.cc(),h.cc(),h.cc()}if(2&e){var c=h.oc();h.Nb(2),h.vc("ngModel",c.Users)}}var F,R=((F=function(){function e(t,n,c,i,r,o){_classCallCheck(this,e),this.toastController=t,this.loadingController=n,this.alertController=c,this.modalCtrl=i,this.forumservice=r,this.settings=o,this.Rolers=[],this.Users=""}return _createClass(e,[{key:"ngOnInit",value:function(){this.Rolers=this.settings.UserRolers(this.Forum.reader||0),this.Users=(this.Forum.user||[]).join(";")}},{key:"DeleteAdmin",value:function(e){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=this.IsAdmin,!t.t0){t.next=5;break}return t.next=4,this.presentConfirm("\u5220\u9664\u7248\u4e3b",null,"\u786e\u5b9a\u5220\u9664\u7528\u6237 [".concat(e,"] \u7684\u7248\u4e3b\u804c\u52a1\u5417\uff1f"));case 4:t.t0=t.sent;case 5:if(t.t1=t.t0,!t.t1){t.next=8;break}this.Forum.admin=this.Forum.admin.filter((function(t){return t!==e}));case 8:case"end":return t.stop()}}),t,this)})))}},{key:"AddAdmin",value:function(){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.presentInput("\u65b0\u7248\u4e3b",null,"\u7528\u6237\u8d26\u6237");case 2:if(!(t=e.sent)){e.next=8;break}return e.next=6,this.forumservice.GetUserInfo(t.name);case 6:(n=e.sent)&&n.id===t.name?this.Forum.admin.push(t.name):this.presentToast("\u627e\u4e0d\u5230\u7528\u6237 [".concat(t.name,"]"),3e3);case 8:case"end":return e.stop()}}),e,this)})))}},{key:"EditRoles",value:function(){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,c,i,r,o,s,a,u,l,d,m;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.Forum.reader||1,n=!1,e.next=4,this.alertController.create({header:"\u63a5\u6536\u8005\u89d2\u8272",inputs:[{name:"register",type:"checkbox",label:"\u6ce8\u518c\u7528\u6237",value:1,checked:(1&t)>0},{name:"vip",type:"checkbox",label:"VIP\u7528\u6237",value:2,checked:(2&t)>0},{name:"huahe",type:"checkbox",label:"\u534e\u9e64\u540c\u95e8",value:4,checked:(4&t)>0},{name:"bbs",type:"checkbox",label:"\u7248\u4e3b",value:8,checked:(8&t)>0},{name:"liuyao",type:"checkbox",label:"\u516d\u723b\u8001\u5e08",value:16,checked:(16&t)>0},{name:"bazi",type:"checkbox",label:"\u547d\u7406\u8001\u5e08",value:32,checked:(32&t)>0},{name:"fengshui",type:"checkbox",label:"\u98ce\u6c34\u8001\u5e08",value:64,checked:(64&t)>0},{name:"supermaster",type:"checkbox",label:"\u5927\u5b97\u5e08",value:128,checked:(128&t)>0},{name:"admin",type:"checkbox",label:"\u7ba1\u7406\u5458",value:256,checked:(256&t)>0}],buttons:[{text:"\u786e\u5b9a",handler:function(){n=!0}},{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary",handler:function(){}}]});case 4:return c=e.sent,e.next=7,c.present();case 7:return e.next=9,c.onWillDismiss();case 9:if(i=e.sent,r=i.data,n){e.next=13;break}return e.abrupt("return");case 13:for(o=0,s=!0,a=!1,u=void 0,e.prev=17,l=r.values[Symbol.iterator]();!(s=(d=l.next()).done);s=!0)m=d.value,o|=m;e.next=25;break;case 21:e.prev=21,e.t0=e.catch(17),a=!0,u=e.t0;case 25:e.prev=25,e.prev=26,s||null==l.return||l.return();case 28:if(e.prev=28,!a){e.next=31;break}throw u;case 31:return e.finish(28);case 32:return e.finish(25);case 33:this.Forum.reader=o,this.Rolers=this.settings.UserRolers(o);case 34:case"end":return e.stop()}}),e,this,[[17,21,25,33],[26,,28,32]])})))}},{key:"EditMessage",value:function(){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,c,i,r,o,s,a,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.Forum.user.length){e.next=2;break}return e.abrupt("return",void this.presentToast("\u8bba\u575b\u6ca1\u6709\u7279\u7ea6\u7528\u6237\u3002\u65e0\u6cd5\u53d1\u9001\u7fa4\u4f53\u4fe1\u606f\u3002",5e3));case 2:return Object(m.c)(),t={id:"",created:Date.now(),valid:0,author:this.settings.User.id,receiver:"\u8bba\u575b[".concat(this.Forum.name,"]\u7684\u4f1a\u5458"),roller:0,readed:!1,private:!0,replyable:!0,title:"\u7fa4\u53d1\u6d88\u606f",content:"\u8bf7\u8f93\u5165\u5185\u5bb9\u3002\u3002\u3002"},e.next=6,this.modalCtrl.create({component:f.a,componentProps:{Message:t,NoSend:!0}});case 6:return n=e.sent,e.next=9,n.present();case 9:return e.next=11,n.onWillDismiss();case 11:if(!1===e.sent.data){e.next=46;break}c=!0,i=!1,r=void 0,e.prev=17,o=this.Forum.user[Symbol.iterator]();case 19:if(c=(s=o.next()).done){e.next=31;break}return a=s.value,e.next=23,this.forumservice.GetUserInfo(a);case 23:return u=e.sent,t.receiver=u.id,e.next=27,this.forumservice.SendMessage(t);case 27:console.log("send message to",t.receiver);case 28:c=!0,e.next=19;break;case 31:e.next=37;break;case 33:e.prev=33,e.t0=e.catch(17),i=!0,r=e.t0;case 37:e.prev=37,e.prev=38,c||null==o.return||o.return();case 40:if(e.prev=40,!i){e.next=43;break}throw r;case 43:return e.finish(40);case 44:return e.finish(37);case 45:this.presentToast("\u60a8\u7684\u7fa4\u53d1\u4fe1\u606f\u5df2\u7ecf\u53d1\u9001\u3002\u3002\u3002",5e3);case 46:case"end":return e.stop()}}),e,this,[[17,33,37,45],[38,,40,44]])})))}},{key:"onclose",value:function(e){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,c=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!1!==e){t.next=4;break}this.modalCtrl.dismiss(!1),t.next=11;break;case 4:return this.Forum.user=this.Users.split(/;|\uff1b|,|\uff0c|:|\uff1a/).filter((function(e){return""!==e})),delete(n=Object(a.b)(this.Forum)).id,delete n._id,t.next=10,this.showLoading();case 10:this.forumservice.UpdatForum(n,this.Forum.id).then((function(){c.presentToast("\u66f4\u65b0\u6210\u529f\uff01",3e3),c.modalCtrl.dismiss(!0)})).catch((function(e){c.presentToast("\u66f4\u65b0\u8bba\u575b\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002",3e3)})).finally((function(){c.closeLoading()}));case 11:case"end":return t.stop()}}),t,this)})))}},{key:"presentConfirm",value:function(e,t,n){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function c(){var i,r;return regeneratorRuntime.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return i=!1,c.next=3,this.alertController.create({header:e||"\u63d0\u793a",subHeader:t||"",message:n,buttons:[{text:"\u786e\u5b9a",handler:function(){i=!0}},{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary",handler:function(){}}]});case 3:return r=c.sent,c.next=6,r.present();case 6:return c.next=8,r.onWillDismiss();case 8:return c.abrupt("return",Promise.resolve(i));case 9:case"end":return c.stop()}}),c,this)})))}},{key:"presentInput",value:function(e,t,n){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function c(){var i,r,o,s;return regeneratorRuntime.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return i=!1,c.next=3,this.alertController.create({header:e||"\u63d0\u793a",subHeader:t||"",inputs:[{name:"name",type:"text",id:"name",value:"",label:n,placeholder:n}],buttons:[{text:"\u786e\u5b9a",handler:function(){i=!0}},{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary",handler:function(){}}]});case 3:return r=c.sent,c.next=6,r.present();case 6:return c.next=8,r.onWillDismiss();case 8:return o=c.sent,s=o.data,c.abrupt("return",Promise.resolve(i?s.values:null));case 11:case"end":return c.stop()}}),c,this)})))}},{key:"presentToast",value:function(e,t){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.toastController.create({message:e,duration:t,color:"secondary",position:"middle"});case 2:n.sent.present();case 3:case"end":return n.stop()}}),n,this)})))}},{key:"showLoading",value:function(){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.loadingView,e.t0){e.next=5;break}return e.next=4,this.loadingController.create({message:"\u4fdd\u5b58\u5230\u8bba\u575b...",duration:6e4});case 4:this.loadingView=e.sent;case 5:return e.next=7,this.loadingView.present();case 7:case"end":return e.stop()}}),e,this)})))}},{key:"closeLoading",value:function(){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.loadingView,!e.t0){e.next=5;break}return e.next=4,this.loadingView.dismiss();case 4:this.loadingView=null;case 5:case"end":return e.stop()}}),e,this)})))}},{key:"IsAdmin",get:function(){return this.settings.User.roller>=256}}]),e}()).\u0275fac=function(e){return new(e||F)(h.Yb(o.hb),h.Yb(o.Z),h.Yb(o.b),h.Yb(o.ab),h.Yb(l.a),h.Yb(a.a))},F.\u0275cmp=h.Sb({type:F,selectors:[["app-forumeditor"]],inputs:{Forum:"Forum"},decls:32,vars:14,consts:[["color","primary"],["slot","start"],[3,"click"],["slot","end",4,"ngIf"],["required","","type","text",3,"readonly","ngModel","ngModelChange"],[1,"ion-text-wrap"],[3,"click",4,"ngFor","ngForOf"],["slot","end","fill","outline",3,"click",4,"ngIf"],[4,"ngFor","ngForOf"],["class","ion-text-wrap",4,"ngIf"],["class","ui attached form",4,"ngIf"],["lines","none"],["slot","end"],["slot","end","fill","outline",3,"click"],[3,"src"],["position","stacked"],[1,"ui","attached","form"],[1,"field"],[2,"margin","5px",3,"ngModel","ngModelChange"],["fill","outline",3,"click"],["tyle","margin: 5px;",3,"ngModel","ngModelChange"]],template:function(e,t){1&e&&(h.dc(0,"ion-header"),h.dc(1,"ion-toolbar",0),h.dc(2,"ion-buttons",1),h.dc(3,"ion-button",2),h.lc("click",(function(){return t.onclose(!1)})),h.Jc(4," \u53d6\u6d88 "),h.cc(),h.cc(),h.dc(5,"ion-title"),h.Jc(6),h.cc(),h.Hc(7,v,3,0,"ion-buttons",3),h.cc(),h.cc(),h.dc(8,"ion-content"),h.dc(9,"ion-item"),h.dc(10,"ion-label"),h.Jc(11,"\u540d\u5b57\uff1a"),h.cc(),h.dc(12,"ion-input",4),h.lc("ngModelChange",(function(e){return t.Forum.name=e})),h.cc(),h.cc(),h.dc(13,"ion-item"),h.dc(14,"ion-label"),h.Jc(15,"\u7b80\u4ecb\uff1a"),h.cc(),h.dc(16,"ion-input",4),h.lc("ngModelChange",(function(e){return t.Forum.describe=e})),h.cc(),h.cc(),h.dc(17,"ion-item",5),h.dc(18,"ion-text"),h.Jc(19,"\u7248\u4e3b\uff1a"),h.cc(),h.Hc(20,p,2,1,"ion-chip",6),h.Hc(21,b,2,0,"ion-button",7),h.cc(),h.dc(22,"ion-item",5),h.dc(23,"ion-text"),h.Jc(24,"\u6743\u9650\uff1a"),h.cc(),h.Hc(25,g,5,2,"ion-chip",8),h.Hc(26,k,2,0,"ion-button",7),h.cc(),h.Hc(27,x,5,1,"ion-item",9),h.Hc(28,y,5,1,"div",10),h.Hc(29,w,6,0,"ion-item",9),h.Hc(30,C,3,1,"div",10),h.Zb(31,"ion-item",11),h.cc()),2&e&&(h.Nb(6),h.Kc(t.Forum.name),h.Nb(1),h.vc("ngIf",t.IsAdmin),h.Nb(5),h.vc("readonly",!t.IsAdmin)("ngModel",t.Forum.name),h.Nb(4),h.vc("readonly",!t.IsAdmin)("ngModel",t.Forum.describe),h.Nb(4),h.vc("ngForOf",t.Forum.admin),h.Nb(1),h.vc("ngIf",t.IsAdmin),h.Nb(4),h.vc("ngForOf",t.Rolers),h.Nb(1),h.vc("ngIf",t.IsAdmin),h.Nb(1),h.vc("ngIf",!t.IsAdmin),h.Nb(1),h.vc("ngIf",t.IsAdmin),h.Nb(1),h.vc("ngIf",t.IsAdmin),h.Nb(1),h.vc("ngIf",t.IsAdmin))},directives:[o.s,o.W,o.i,o.h,o.U,c.j,o.m,o.w,o.C,o.v,o.gb,i.h,i.f,i.g,o.S,c.i,o.k,o.e,i.b],styles:[""]}),F);function I(e,t){if(1&e){var n=h.ec();h.dc(0,"ion-button",9),h.lc("click",(function(e){return h.Cc(n),h.oc(2).personalOption(e)})),h.Zb(1,"ion-icon",10),h.dc(2,"ion-text"),h.Jc(3,"\u6211\u7684"),h.cc(),h.cc()}}function O(e,t){if(1&e&&(h.dc(0,"ion-header"),h.dc(1,"ion-toolbar",5),h.dc(2,"ion-buttons",6),h.Zb(3,"ion-menu-button"),h.cc(),h.dc(4,"ion-title"),h.Jc(5,"\u8ba8\u8bba\u533a\u5217\u8868"),h.cc(),h.dc(6,"ion-buttons",7),h.Hc(7,I,4,0,"ion-button",8),h.cc(),h.cc(),h.cc()),2&e){var n=h.oc();h.Nb(7),h.vc("ngIf",n.HasUser)}}function N(e,t){if(1&e){var n=h.ec();h.dc(0,"ion-item"),h.dc(1,"ion-text"),h.Jc(2,"\u8fde\u63a5\u670d\u52a1\u5668\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u5c1d\u8bd5\u3002"),h.cc(),h.dc(3,"ion-button",11),h.lc("click",(function(){return h.Cc(n),h.oc().Reconnect(!0)})),h.Jc(4,"\u91cd\u65b0\u8fde\u63a5"),h.cc(),h.cc()}}function J(e,t){if(1&e){var n=h.ec();h.dc(0,"ion-button",9),h.lc("click",(function(){h.Cc(n);var e=t.$implicit;return h.oc(2).NaviToForum(null,e.value)})),h.Jc(1),h.cc()}if(2&e){var c=t.$implicit;h.Nb(1),h.Lc(" ",c.name," ")}}function H(e,t){if(1&e&&(h.dc(0,"ion-item",12),h.dc(1,"ion-label"),h.Zb(2,"ion-icon",10),h.dc(3,"ion-text"),h.Jc(4,"\u6211\u7684\uff1a"),h.cc(),h.cc(),h.dc(5,"ion-buttons"),h.Hc(6,J,2,1,"ion-button",13),h.cc(),h.cc()),2&e){var n=h.oc();h.Nb(6),h.vc("ngForOf",n.PersonalActions)}}function j(e,t){1&e&&h.Zb(0,"ion-icon",23)}function A(e,t){if(1&e){var n=h.ec();h.dc(0,"ion-item-sliding",16),h.dc(1,"ion-item",17),h.lc("click",(function(){h.Cc(n);var e=t.$implicit;return h.oc(2).NaviToForum(e.id)})),h.dc(2,"ion-label",18),h.dc(3,"ion-text"),h.Jc(4),h.cc(),h.dc(5,"ion-text",14),h.dc(6,"h6"),h.Jc(7),h.cc(),h.cc(),h.Hc(8,j,1,0,"ion-icon",19),h.dc(9,"ion-text",20),h.Jc(10),h.cc(),h.dc(11,"ion-text",20),h.Jc(12),h.cc(),h.cc(),h.cc(),h.dc(13,"ion-item-options",21),h.dc(14,"ion-item-option",9),h.lc("click",(function(){h.Cc(n);var e=t.$implicit;return h.oc(2).ForumEditor(e.name)})),h.Zb(15,"ion-icon",22),h.cc(),h.cc(),h.cc()}if(2&e){var c=t.$implicit;h.Nb(1),h.vc("detail",!c.block),h.Nb(3),h.Lc(" ",c.name," "),h.Nb(3),h.Kc(c.describe),h.Nb(1),h.vc("ngIf",c.block),h.Nb(2),h.Lc("\u65b0\u8d34\uff1a",c.modified.toChinaStr(),""),h.Nb(2),h.Lc("\u5e16\u6570\uff1a",c.topiccount,"")}}function L(e,t){if(1&e&&(h.dc(0,"ion-item-group"),h.dc(1,"ion-item-divider",14),h.dc(2,"ion-label"),h.Jc(3),h.cc(),h.cc(),h.Hc(4,A,16,6,"ion-item-sliding",15),h.cc()),2&e){var n=t.$implicit;h.Nb(3),h.Kc(n.name),h.Nb(1),h.vc("ngForOf",n.items)}}var S,M=((S=function(){function e(t,n,c,i,r,o,s,a){_classCallCheck(this,e),this.loadingController=t,this.modalCtrl=n,this.alertController=c,this.settings=i,this.forumservice=r,this.host=o,this.popoverCtrl=s,this.router=a,this.forums=[],this.personalActions=[],this.showallforums=!1,this.loadfailed=!1,this.hasuser=!0,this.SortKey="lasttopic",this.selectedPath=""}return _createClass(e,[{key:"ngOnInit",value:function(){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.settings.WaitInit();case 2:this.user=this.settings.User||m.a,this.hasuser=this.settings.HasUser,this.showallforums=!this.hasuser,this.personalActions=[{name:"\u5e16\u5b50",value:"menu/topiclist/forum_me"},{name:"\u6c42\u52a9",value:"menu/topiclist/forum_ticket"},{name:"\u6d88\u606f",value:"menu/messagelist/true"},{name:"\u627e\u4eba",value:"menu/searchuser"}],this.user.roller>=16&&this.personalActions.insert(2,{name:"\u5ba2\u6237\u6c42\u52a9",value:"menu/topiclist/forum_master"}),this.Reconnect(!1);case 8:case"end":return e.stop()}}),e,this)})))}},{key:"doRefresh",value:function(e){this.Reconnect(!0).then((function(){})).catch((function(e){console.log(e)})).finally((function(){e.target.complete()}))}},{key:"Reconnect",value:function(e){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.loadfailed=!1,t.next=3,this.showLoading();case 3:return t.abrupt("return",this.forumservice.ForumList(e).then((function(e){return n.buildForumList(e),n.forumservice.ForumMG.Reset(),!0})).catch((function(e){return console.log("forum reconnect",e),n.loadfailed=!0,!1})).finally((function(){n.closeLoading()})));case 4:case"end":return t.stop()}}),t,this)})))}},{key:"NaviToForum",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.router.navigateByUrl(t=t||"menu/topiclist/".concat(e))}},{key:"ForumEditor",value:function(e){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,c,i,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.forumservice.ForumList();case 2:return t.t0=function(t){return t.name===e},n=t.sent.find(t.t0),t.next=6,this.modalCtrl.create({component:R,componentProps:{Forum:n}});case 6:return c=t.sent,t.next=9,c.present();case 9:return t.next=11,c.onWillDismiss();case 11:i=t.sent,r=i.data,console.log("Forumeditor close"),!0===r&&this.Reconnect(!1);case 14:case"end":return t.stop()}}),t,this)})))}},{key:"Setting",value:function(){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n,c,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=!1,e.next=3,this.alertController.create({header:"\u663e\u793a\u504f\u597d",inputs:[{name:"showimg",type:"checkbox",label:"\u663e\u793a/\u9690\u85cf \u56fe\u7247",value:1,checked:null.showimg},{name:"vip",type:"checkbox",label:"\u663e\u793a/\u9690\u85cf \u5366\u4f8b",value:2,checked:null.showgua},{name:"huahe",type:"checkbox",label:"\u663e\u793a/\u9690\u85cf \u547d\u4f8b",value:3,checked:null.showbazi},{name:"bbs",type:"checkbox",label:"\u8d34\u5185\u663e\u793a\u56fe\u7247",value:4,checked:!null.imgOut},{name:"liuyao",type:"checkbox",label:"\u8d34\u5185\u663e\u793a\u5366\u4f8b",value:5,checked:!null.guaOut},{name:"bazi",type:"checkbox",label:"\u8d34\u5185\u663e\u793a\u547d\u4f8b",value:6,checked:!null.baziOut}],buttons:[{text:"\u786e\u5b9a",handler:function(){t=!0}},{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary",handler:function(){}}]});case 3:return n=e.sent,e.next=6,n.present();case 6:return e.next=8,n.onWillDismiss();case 8:c=e.sent,i=c.data,t&&(i.values.includes(1),i.values.includes(2),i.values.includes(3),i.values.includes(4),i.values.includes(5),i.values.includes(6));case 11:case"end":return e.stop()}}),e,this)})))}},{key:"sortOptions",value:function(e){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,c,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.popoverCtrl.create({component:d.a,event:e,componentProps:{items:[{name:"\u9ed8\u8ba4",value:"id"},{name:"\u65f6\u95f4",value:"lasttopic"}],currentOption:this.SortKey},translucent:!0});case 2:return n=t.sent,t.next=5,n.present();case 5:return t.next=7,n.onDidDismiss();case 7:c=t.sent,((i=c.data)||this.SortKey)!==this.SortKey&&(this.SortKey=i.toString());case 10:case"end":return t.stop()}}),t,this)})))}},{key:"personalOption",value:function(e){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,c,i,r,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.PersonalActions,t.next=3,this.popoverCtrl.create({component:d.a,event:e,translucent:!0,componentProps:{items:n,currentOption:n[0]}});case 3:return c=t.sent,t.next=6,c.present();case 6:return t.next=8,c.onDidDismiss();case 8:i=t.sent,r=i.data,(o=r||"")&&(console.log("navi to action",o),this.router.navigateByUrl(o));case 12:case"end":return t.stop()}}),t,this)})))}},{key:"buildForumList",value:function(e){var t=this;this.initForums(),e.map((function(e){var n=new Date(0===e.lasttopic?Date.now():e.lasttopic),c=e.admin.includes(t.user.id);c=(c=c||e.user.includes(t.user.id))||0===e.reader||(e.reader&t.user.roller)>0;var i={id:e.id,name:e.name,describe:e.describe,modified:n,block:!c,group:e.group,topiccount:e.topiccount};return t.forums.find((function(e){return e.group===i.group})).items.push(i),i}))}},{key:"initForums",value:function(){this.forums=[{group:0,name:"\u6613\u5b66\u533a",items:[]},{group:1,name:"\u7406\u5b66\u533a",items:[]},{group:2,name:"\u85cf\u5b66\u533a",items:[]},{group:10,name:"\u4e8b\u52a1\u533a",items:[]}]}},{key:"showLoading",value:function(){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.loadingView,e.t0){e.next=5;break}return e.next=4,this.loadingController.create({message:"\u6b63\u5728\u83b7\u53d6\u8bba\u575b\u5217\u8868...",duration:6e4});case 4:this.loadingView=e.sent;case 5:return e.next=7,this.loadingView.present();case 7:case"end":return e.stop()}}),e,this)})))}},{key:"closeLoading",value:function(){return Object(s.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.loadingView,!e.t0){e.next=5;break}return e.next=4,this.loadingView.dismiss();case 4:this.loadingView=null;case 5:case"end":return e.stop()}}),e,this)})))}},{key:"Forums",get:function(){return this.forums}},{key:"HasUser",get:function(){return this.hasuser}},{key:"IsWeb",get:function(){return"web"===m.b}},{key:"PersonalActions",get:function(){return this.personalActions}}]),e}()).\u0275fac=function(e){return new(e||S)(h.Yb(o.Z),h.Yb(o.ab),h.Yb(o.b),h.Yb(a.a),h.Yb(l.a),h.Yb(u.a),h.Yb(o.db),h.Yb(r.g))},S.\u0275cmp=h.Sb({type:S,selectors:[["app-forum"]],decls:8,vars:4,consts:[[4,"ngIf"],["slot","fixed",3,"ionRefresh"],["lines","none","class","tybg",4,"ngIf"],[4,"ngFor","ngForOf"],["lines","none"],["color","primary"],["slot","start"],["slot","end"],[3,"click",4,"ngIf"],[3,"click"],["name","person"],["fill","outline",3,"click"],["lines","none",1,"tybg"],[3,"click",4,"ngFor","ngForOf"],["color","medium"],["class","tybg",4,"ngFor","ngForOf"],[1,"tybg"],[1,"tybg",3,"detail","click"],[1,"ion-text-wrap"],["name","ios-lock","style","margin-right: 10px;",4,"ngIf"],["color","medium",1,"ion-margin-end"],["side","start"],["slot","icon-only","name","information-circle"],["name","ios-lock",2,"margin-right","10px"]],template:function(e,t){1&e&&(h.Hc(0,O,8,1,"ion-header",0),h.dc(1,"ion-content"),h.dc(2,"ion-refresher",1),h.lc("ionRefresh",(function(e){return t.doRefresh(e)})),h.Zb(3,"ion-refresher-content"),h.cc(),h.Hc(4,N,5,0,"ion-item",0),h.Hc(5,H,7,1,"ion-item",2),h.Hc(6,L,5,2,"ion-item-group",3),h.Zb(7,"ion-item",4),h.cc()),2&e&&(h.vc("ngIf",!t.IsWeb),h.Nb(4),h.vc("ngIf",t.loadfailed),h.Nb(1),h.vc("ngIf",t.IsWeb),h.Nb(1),h.vc("ngForOf",t.Forums))},directives:[c.j,o.m,o.I,o.J,c.i,o.w,o.s,o.W,o.i,o.F,o.U,o.h,o.t,o.S,o.C,o.y,o.x,o.B,o.A,o.z],styles:[""]}),S),U=n("i/bi");n.d(t,"ForumPageModule",(function(){return Y}));var D,P=[{path:"",component:M}],Y=((D=function e(){_classCallCheck(this,e)}).\u0275mod=h.Wb({type:D}),D.\u0275inj=h.Vb({factory:function(e){return new(e||D)},imports:[[c.b,i.c,o.X,U.e,r.j.forChild(P)]]}),D)},HQI1:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var c=n("c7TG"),i=n("fXoL"),r=n("ofXK");function o(e,t){if(1&e){var n=i.ec();i.dc(0,"ion-item",3),i.lc("click",(function(){i.Cc(n);var e=t.$implicit;return i.oc(2).onSelect(e.value)})),i.dc(1,"ion-text"),i.Jc(2),i.cc(),i.cc()}if(2&e){var c=t.$implicit,r=i.oc(2);i.vc("color",c.value===r.currentOption?"light":""),i.Nb(2),i.Kc(c.name)}}function s(e,t){if(1&e&&(i.dc(0,"div"),i.Hc(1,o,3,2,"ion-item",2),i.cc()),2&e){var n=i.oc();i.Nb(1),i.vc("ngForOf",n.items)}}function a(e,t){if(1&e&&(i.dc(0,"ion-note"),i.Jc(1),i.cc()),2&e){var n=i.oc().$implicit;i.Nb(1),i.Lc(" ",n.name," ")}}function u(e,t){if(1&e&&(i.dc(0,"ion-item",6),i.Hc(1,a,2,1,"ion-note",0),i.dc(2,"ion-label",7),i.dc(3,"small"),i.Zb(4,"ion-text",8),i.cc(),i.cc(),i.cc()),2&e){var n=t.$implicit;i.Nb(1),i.vc("ngIf",n.name),i.Nb(3),i.vc("innerHtml",n.value,i.Dc)}}function l(e,t){if(1&e&&(i.dc(0,"ion-list",4),i.Hc(1,u,5,2,"ion-item",5),i.cc()),2&e){var n=i.oc();i.Nb(1),i.vc("ngForOf",n.items)}}var d=function(){var e=function(){function e(t){_classCallCheck(this,e),this.popoverCtrl=t,this.toselect=!0}return _createClass(e,[{key:"ngOnInit",value:function(){}},{key:"onSelect",value:function(e){this.popoverCtrl.dismiss(e)}}]),e}();return e.\u0275fac=function(t){return new(t||e)(i.Yb(c.db))},e.\u0275cmp=i.Sb({type:e,selectors:[["app-optionpopover"]],inputs:{currentOption:"currentOption",items:"items",toselect:"toselect"},decls:2,vars:2,consts:[[4,"ngIf"],["class","ion-no-padding",4,"ngIf"],["button","",3,"color","click",4,"ngFor","ngForOf"],["button","",3,"color","click"],[1,"ion-no-padding"],["lines","none",4,"ngFor","ngForOf"],["lines","none"],["slot","end",1,"ion-text-wrap"],[3,"innerHtml"]],template:function(e,t){1&e&&(i.Hc(0,s,2,1,"div",0),i.Hc(1,l,2,1,"ion-list",1)),2&e&&(i.vc("ngIf",t.toselect),i.Nb(1),i.vc("ngIf",!t.toselect))},directives:[r.j,r.i,c.w,c.S,c.D,c.C,c.G],styles:[""]}),e}()}}]);