(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{"8PFr":function(e,t,c){"use strict";c.r(t);var o=c("ofXK"),i=c("3Pt+"),n=c("tyNb"),d=c("c7TG"),s=c("mrSG"),r=c("HQI1"),l=c("LvB5"),u=c("SRjL"),h=c("mo90"),a=c("LTmD"),b=(c("0eVs"),c("Y6BA")),f=c("pLZG"),m=c("HULg"),v=c("fXoL");function p(e,t){if(1&e){const e=v.ec();v.dc(0,"ion-header"),v.dc(1,"ion-toolbar"),v.dc(2,"ion-buttons",2),v.Zb(3,"ion-back-button",3,4),v.cc(),v.dc(5,"ion-title"),v.Ic(6,"\u6613\u5b66\u6848\u4f8b"),v.cc(),v.dc(7,"ion-buttons",5),v.dc(8,"ion-button",6),v.lc("click",(function(t){return v.Bc(e),v.oc().sortOptions(t)})),v.Zb(9,"ion-icon",7),v.dc(10,"ion-text"),v.Ic(11,"\u6392\u5e8f"),v.cc(),v.cc(),v.cc(),v.cc(),v.cc()}if(2&e){const e=v.oc();v.Nb(2),v.vc("hidden",e.EditModul),v.Nb(5),v.vc("hidden",e.EditModul)}}function g(e,t){if(1&e){const e=v.ec();v.dc(0,"ion-item"),v.dc(1,"ion-buttons"),v.dc(2,"ion-button",8),v.Ic(3," \u603b\u76ee\u5f55 "),v.cc(),v.dc(4,"ion-button",9),v.lc("click",(function(){return v.Bc(e),v.oc().showPaiguaModal()})),v.Zb(5,"ion-icon",10),v.dc(6,"ion-text"),v.Ic(7,"\u5366\u4f8b"),v.cc(),v.cc(),v.dc(8,"ion-button",9),v.lc("click",(function(){return v.Bc(e),v.oc().showPaibaziModal()})),v.Zb(9,"ion-icon",10),v.dc(10,"ion-text"),v.Ic(11,"\u547d\u4f8b"),v.cc(),v.cc(),v.dc(12,"ion-button",9),v.lc("click",(function(){return v.Bc(e),v.oc().ShowActions()})),v.Zb(13,"ion-icon",11),v.dc(14,"ion-text"),v.Ic(15,"\u64cd\u4f5c"),v.cc(),v.cc(),v.dc(16,"ion-button",9),v.lc("click",(function(){return v.Bc(e),v.oc().CheckAll()})),v.dc(17,"ion-text"),v.Ic(18,"\u5168\u9009"),v.cc(),v.cc(),v.dc(19,"ion-button",6),v.lc("click",(function(){v.Bc(e);const t=v.oc();return t.EditModul=!t.EditModul})),v.Zb(20,"ion-icon",12),v.Ic(21," \u7f16\u8f91 "),v.cc(),v.cc(),v.dc(22,"ion-buttons",5),v.dc(23,"ion-text"),v.Ic(24,"\u6392\u5e8f"),v.cc(),v.dc(25,"ion-segment",13),v.lc("ngModelChange",(function(t){return v.Bc(e),v.oc().SortKey=t}))("ionChange",(function(){return v.Bc(e),v.oc().SortRecord()})),v.dc(26,"ion-segment-button",14),v.Ic(27,"\u8bb0\u5f55\u540d\u79f0"),v.cc(),v.dc(28,"ion-segment-button",15),v.Ic(29,"\u521b\u5efa\u65f6\u95f4"),v.cc(),v.dc(30,"ion-segment-button",16),v.Ic(31,"\u4fee\u6539\u65f6\u95f4"),v.cc(),v.cc(),v.cc(),v.cc()}if(2&e){const e=v.oc();v.Nb(4),v.vc("hidden",e.EditModul),v.Nb(4),v.vc("hidden",e.EditModul),v.Nb(4),v.vc("hidden",!e.EditModul),v.Nb(4),v.vc("hidden",!e.EditModul),v.Nb(6),v.vc("hidden",e.EditModul),v.Nb(3),v.vc("ngModel",e.SortKey)}}function y(e,t){if(1&e){const e=v.ec();v.dc(0,"ion-list-header"),v.dc(1,"ion-searchbar",17),v.lc("ngModelChange",(function(t){return v.Bc(e),v.oc().SearchQuery=t})),v.cc(),v.cc()}if(2&e){const e=v.oc();v.Nb(1),v.vc("ngModel",e.SearchQuery)}}function N(e,t){if(1&e){const e=v.ec();v.dc(0,"ion-item"),v.dc(1,"ion-label"),v.dc(2,"ion-text"),v.Ic(3),v.cc(),v.Zb(4,"br"),v.dc(5,"ion-text"),v.dc(6,"small"),v.Ic(7),v.cc(),v.cc(),v.cc(),v.dc(8,"ion-button",18),v.lc("click",(function(){v.Bc(e);const c=t.$implicit;return v.oc().ShowRecordes(c)})),v.Ic(9),v.Zb(10,"ion-icon",19),v.cc(),v.dc(11,"ion-checkbox",20),v.lc("ngModelChange",(function(c){return v.Bc(e),t.$implicit.isChecked=c})),v.cc(),v.cc()}if(2&e){const e=t.$implicit,c=v.oc();v.Nb(3),v.Jc(e.titel),v.Nb(4),v.Jc(e.time),v.Nb(1),v.vc("hidden",c.EditModul),v.Nb(1),v.Kc(" ",e.type," "),v.Nb(2),v.vc("hidden",!c.EditModul)("ngModel",e.isChecked)}}function C(e,t){if(1&e){const e=v.ec();v.dc(0,"ion-footer"),v.dc(1,"ion-toolbar"),v.dc(2,"ion-buttons",21),v.dc(3,"ion-button",9),v.lc("click",(function(){return v.Bc(e),v.oc().showPaiguaModal()})),v.Zb(4,"ion-icon",10),v.dc(5,"ion-text"),v.Ic(6,"\u5366\u4f8b"),v.cc(),v.cc(),v.dc(7,"ion-button",9),v.lc("click",(function(){return v.Bc(e),v.oc().showPaibaziModal()})),v.Zb(8,"ion-icon",10),v.dc(9,"ion-text"),v.Ic(10,"\u547d\u4f8b"),v.cc(),v.cc(),v.dc(11,"ion-button",9),v.lc("click",(function(){return v.Bc(e),v.oc().ShowActions()})),v.Zb(12,"ion-icon",11),v.dc(13,"ion-text"),v.Ic(14,"\u64cd\u4f5c"),v.cc(),v.cc(),v.dc(15,"ion-button",9),v.lc("click",(function(){return v.Bc(e),v.oc().CheckAll()})),v.dc(16,"ion-text"),v.Ic(17,"\u5168\u9009"),v.cc(),v.cc(),v.cc(),v.dc(18,"ion-buttons",22),v.dc(19,"ion-button",6),v.lc("click",(function(){v.Bc(e);const t=v.oc();return t.EditModul=!t.EditModul})),v.Zb(20,"ion-icon",12),v.Ic(21," \u7f16\u8f91 "),v.cc(),v.cc(),v.cc(),v.cc()}if(2&e){const e=v.oc();v.Nb(3),v.vc("hidden",e.EditModul),v.Nb(4),v.vc("hidden",e.EditModul),v.Nb(4),v.vc("hidden",!e.EditModul),v.Nb(4),v.vc("hidden",!e.EditModul)}}let I=(()=>{class e{constructor(e,t,c,o,i,d,s,r){this.dbservice=e,this.settings=t,this.actionsheetctrl=c,this.alertCtrl=o,this.popoverCtrl=i,this.modalController=d,this.route=s,this.router=r,this.searchQuery="",this.docNodes=[],this.columns=[{prop:"time"},{name:"titel"},{name:"type"}],this.SortKey="created",this.EditModul=!1,this.AllNodes=!1,this.route.params.subscribe(e=>{this.node_id=e.id}),this.router.events.pipe(Object(f.a)(e=>e instanceof n.c)).subscribe(e=>{e.url.match(/\/menu\/recordes\/(?<nodeid>[0-9]+)/i)})}get IsWeb(){return"web"===b.b}get Recordes(){const e=this.SearchQuery.trim();return e?(this.recordes||[]).filter(t=>t.titel.toLowerCase().includes(e)):this.recordes||[]}get SearchQuery(){return this.searchQuery}set SearchQuery(e){this.searchQuery=e}ngOnInit(){return Object(s.b)(this,void 0,void 0,(function*(){this.recordes=[],this.recordesOrigin=[],yield this.dbservice.getNodes().then(e=>("*"===this.node_id?(this.AllNodes=!0,this.docNodes=e.where(e=>32===e.type).select(e=>e.id)):this.docNodes=this.node_id.split("-"),!0)),this.Reload()}))}SortRecord(){this.recordes=this.recordesOrigin.sortByKey(this.SortKey).select(e=>this.Convert(e))}sortOptions(e){return Object(s.b)(this,void 0,void 0,(function*(){const t=yield this.popoverCtrl.create({component:r.a,event:e,componentProps:{items:[{name:"\u76ee\u5f55\u540d\u79f0",value:"titel"},{name:"\u521b\u5efa\u65f6\u95f4",value:"created"},{name:"\u4fee\u6539\u65f6\u95f4",value:"modified"}],currentOption:this.SortKey},translucent:!0});yield t.present();const{data:c}=yield t.onDidDismiss();(c||this.SortKey)!==this.SortKey&&(this.SortKey=c.toString(),this.SortRecord())}))}loadRecordes(e){return this.dbservice.GetRecordes(e).then(e=>{const t=e.select(e=>this.Convert(e));return this.recordesOrigin=this.recordesOrigin.concat(e||[]),t}).catch(t=>{t===[]?console.log(`loadRecordes ${e} not found in local`):console.log(`Err loadRecordes ${e}`,t)})}showPaiguaModal(){return Object(s.b)(this,void 0,void 0,(function*(){const e=yield this.selectNode();if(!e)return;const t=yield this.modalController.create({component:l.a});yield t.present();const{data:c}=yield t.onWillDismiss();if(c.result){const t=c.result;this.dbservice.CreateRecord(e,t.question,8,JSON.stringify(t)).then(e=>{this.recordes.push(this.Convert(e))})}}))}showPaibaziModal(){return Object(s.b)(this,void 0,void 0,(function*(){const e=yield this.selectNode();if(!e)return;const t=yield this.modalController.create({component:u.a});yield t.present();const{data:c}=yield t.onWillDismiss();if(c.result){const t=c.result;this.dbservice.CreateRecord(e,t.person,16,JSON.stringify(t)).then(e=>{this.recordes.push(this.Convert(e))})}}))}showHelp(){return Object(s.b)(this,void 0,void 0,(function*(){const e=yield this.alertCtrl.create({header:"\u5e2e\u52a9",message:"\u5f53\u6848\u4f8b\u6765\u81ea\u591a\u4e2a\u6587\u4ef6\u5939\u7684\u65f6\u5019\uff0c\u65e0\u6cd5\u7f16\u8f91\u3002\u5982\u9700\u7f16\u8f91\uff0c\u8bf7\u8fd4\u56de\u76ee\u5f55\u754c\u9762\uff0c\u6253\u5f00\u4e00\u4e2a\u5355\u4e00\u7684\u6587\u4ef6\u5939\u76ee\u5f55\u3002",buttons:["\u786e\u5b9a"]});yield e.present()}))}CheckAll(){this.checkAll=!this.checkAll,this.recordes.forEach(e=>e.isChecked=this.checkAll)}ShowActions(){return Object(s.b)(this,void 0,void 0,(function*(){if(0===this.recordes.filter(e=>e.isChecked).length){const e=yield this.alertCtrl.create({header:"\u5e2e\u52a9",message:"\u8bf7\u9009\u5b9a\u81f3\u5c11\u4e00\u4f8b\u88ab\u7f16\u8f91\u7684\u6848\u4f8b\u3002",buttons:["\u786e\u5b9a"]});return void(yield e.present())}const e=yield this.actionsheetctrl.create({header:"\u7f16\u8f91",buttons:[{text:"\u5220\u9664",role:"destructive",icon:"trash",handler:()=>{this.DeleteNode()}},{text:"\u8fc1\u79fb\u76ee\u5f55",icon:"arrow-round-back",handler:()=>{this.MoveNode()}},{text:" \u53d6\u6d88",icon:"close",role:"cancel",handler:()=>{}}]});yield e.present()}))}MoveNode(){return Object(s.b)(this,void 0,void 0,(function*(){const e=yield this.modalController.create({component:h.a,componentProps:{Titel:"\u9009\u62e9\u65b0\u76ee\u5f55",SelectDocument:!0,NodeID:this.docNodes.length>1?null:this.docNodes[0]}});yield e.present();const{data:t}=yield e.onWillDismiss();if(t.nodeid&&!t.nodeid.IsNullOrEmpty()){this.EditModul=!1;const e=this.recordes.filter(e=>e.isChecked);for(const c of e)yield this.dbservice.MoveRecord(c.nodeid,t.nodeid,c.id);this.Reload()}}))}DeleteNode(){return Object(s.b)(this,void 0,void 0,(function*(){let e=!1;const t=yield this.alertCtrl.create({header:"\u5220\u9664\u6848\u4f8b",message:"\u786e\u5b9a\u5220\u9664\u9009\u5b9a\u7684\u6848\u4f8b\u5417\uff1f",buttons:[{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary"},{text:"\u786e\u5b9a",handler:()=>{e=!0}}]});if(yield t.present(),yield t.onDidDismiss(),!1===e)return;const c=this.recordes.where(e=>e.isChecked);this.EditModul=!1;for(const o of c)yield this.dbservice.DeleteRecord(o.id,o.nodeid);this.Reload()}))}ShowRecordes(e){this.router.navigateByUrl(`/menu/recordview/${e.nodeid}/${e.id}`)}Reload(){this.recordes=[];for(const e of this.docNodes)this.loadRecordes(e).then(e=>{this.recordes=this.Recordes.concat(e||[])})}Convert(e){return{time:new Date("modified"===this.SortKey?e.modified:e.created).toChinaStr(),titel:e.titel,type:8===e.type?"\u516d\u723b":"\u516b\u5b57",id:e.id,nodeid:e.node,isChecked:!1}}selectNode(){return Object(s.b)(this,void 0,void 0,(function*(){if(1===this.docNodes.length)return Promise.resolve(this.docNodes[0]);let e=!1,t=yield this.dbservice.getNodes();t=t.filter(e=>this.docNodes.includes(e.id));const c=t.map(e=>({name:e.id,type:"radio",label:e.name,value:e.id,checked:!1}));c[0].checked=!0;const o=yield this.alertCtrl.create({header:"\u9009\u62e9\u4e00\u4e2a\u6587\u4ef6\u5939",inputs:c,buttons:[{text:"\u786e\u5b9a",handler:()=>{e=!0}},{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary"}]});yield o.present();const{data:i}=yield o.onWillDismiss();return i.values}))}}return e.\u0275fac=function(t){return new(t||e)(v.Yb(m.a),v.Yb(a.a),v.Yb(d.a),v.Yb(d.b),v.Yb(d.fb),v.Yb(d.cb),v.Yb(n.a),v.Yb(n.g))},e.\u0275cmp=v.Sb({type:e,selectors:[["app-recordes"]],decls:7,vars:5,consts:[[4,"ngIf"],[4,"ngFor","ngForOf"],["slot","start",3,"hidden"],["defaulthref","","text","\u8fd4\u56de"],["rdbackbtn",""],["slot","end",3,"hidden"],[3,"click"],["name","md-funnel"],["routerLink","/menu/nodes","routerDirection","root"],[3,"hidden","click"],["name","add"],["name","build"],["name","md-reorder"],[3,"ngModel","ngModelChange","ionChange"],["value","titel"],["value","created"],["value","modified"],["color","light","showCancelButton","focus","cancelButtonText","\u53d6\u6d88","placeholder","\u641c\u7d22\u95ee\u5ff5/\u540d\u5b57",3,"ngModel","ngModelChange"],["fill","none","color","light",3,"hidden","click"],["name","arrow-dropright"],[3,"hidden","ngModel","ngModelChange"],["slot","start"],["slot","end"]],template:function(e,t){1&e&&(v.Gc(0,p,12,2,"ion-header",0),v.dc(1,"ion-content"),v.dc(2,"ion-list"),v.Gc(3,g,32,6,"ion-item",0),v.Gc(4,y,2,1,"ion-list-header",0),v.Gc(5,N,12,6,"ion-item",1),v.cc(),v.cc(),v.Gc(6,C,22,4,"ion-footer",0)),2&e&&(v.vc("ngIf",!t.IsWeb),v.Nb(3),v.vc("ngIf",t.IsWeb),v.Nb(1),v.vc("ngIf",t.AllNodes),v.Nb(1),v.vc("ngForOf",t.Recordes),v.Nb(1),v.vc("ngIf",!t.IsWeb))},directives:[o.j,d.n,d.E,o.i,d.t,d.Y,d.j,d.f,d.g,d.W,d.i,d.u,d.T,d.x,d.gb,n.h,d.O,d.hb,i.f,i.g,d.P,d.F,d.N,d.ib,d.D,d.k,d.c,d.r],styles:[""]}),e})();c.d(t,"RecordesPageModule",(function(){return k}));const M=[{path:"",component:I}];let k=(()=>{class e{}return e.\u0275mod=v.Wb({type:e}),e.\u0275inj=v.Vb({factory:function(t){return new(t||e)},imports:[[o.b,i.c,d.Z,n.j.forChild(M)]]}),e})()},HQI1:function(e,t,c){"use strict";c.d(t,"a",(function(){return h}));var o=c("c7TG"),i=c("fXoL"),n=c("ofXK");function d(e,t){if(1&e){const e=i.ec();i.dc(0,"ion-item",3),i.lc("click",(function(){i.Bc(e);const c=t.$implicit;return i.oc(2).onSelect(c.value)})),i.dc(1,"ion-text"),i.Ic(2),i.cc(),i.cc()}if(2&e){const e=t.$implicit,c=i.oc(2);i.vc("color",e.value===c.currentOption?"light":""),i.Nb(2),i.Jc(e.name)}}function s(e,t){if(1&e&&(i.dc(0,"div"),i.Gc(1,d,3,2,"ion-item",2),i.cc()),2&e){const e=i.oc();i.Nb(1),i.vc("ngForOf",e.items)}}function r(e,t){if(1&e&&(i.dc(0,"ion-note"),i.Ic(1),i.cc()),2&e){const e=i.oc().$implicit;i.Nb(1),i.Kc(" ",e.name," ")}}function l(e,t){if(1&e&&(i.dc(0,"ion-item",6),i.Gc(1,r,2,1,"ion-note",0),i.dc(2,"ion-label",7),i.dc(3,"small"),i.Zb(4,"ion-text",8),i.cc(),i.cc(),i.cc()),2&e){const e=t.$implicit;i.Nb(1),i.vc("ngIf",e.name),i.Nb(3),i.vc("innerHtml",e.value,i.Cc)}}function u(e,t){if(1&e&&(i.dc(0,"ion-list",4),i.Gc(1,l,5,2,"ion-item",5),i.cc()),2&e){const e=i.oc();i.Nb(1),i.vc("ngForOf",e.items)}}let h=(()=>{class e{constructor(e){this.popoverCtrl=e,this.toselect=!0}ngOnInit(){}onSelect(e){this.popoverCtrl.dismiss(e)}}return e.\u0275fac=function(t){return new(t||e)(i.Yb(o.fb))},e.\u0275cmp=i.Sb({type:e,selectors:[["app-optionpopover"]],inputs:{currentOption:"currentOption",items:"items",toselect:"toselect"},decls:2,vars:2,consts:[[4,"ngIf"],["class","ion-no-padding",4,"ngIf"],["button","",3,"color","click",4,"ngFor","ngForOf"],["button","",3,"color","click"],[1,"ion-no-padding"],["lines","none",4,"ngFor","ngForOf"],["lines","none"],["slot","end",1,"ion-text-wrap"],[3,"innerHtml"]],template:function(e,t){1&e&&(i.Gc(0,s,2,1,"div",0),i.Gc(1,u,2,1,"ion-list",1)),2&e&&(i.vc("ngIf",t.toselect),i.Nb(1),i.vc("ngIf",!t.toselect))},directives:[n.j,n.i,o.x,o.T,o.E,o.D,o.H],styles:[""]}),e})()}}]);