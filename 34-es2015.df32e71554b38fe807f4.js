(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{lotG:function(t,i,e){"use strict";e.r(i);var n=e("ofXK"),o=e("3Pt+"),s=e("tyNb"),c=e("c7TG"),r=e("mrSG"),a=e("LTmD"),d=e("gTpY"),b=e("ylIl"),l=e("HULg"),h=e("+z1p"),u=(e("0eVs"),e("fXoL")),g=e("zioG");let f=(()=>{class t{constructor(t){this.modalCtrl=t,this.Editor=h,this.EditorConfig={toolbar:["heading","|","bold","italic","bulletedList","numberedList","|","link","undo","redo"]}}ngOnInit(){}onSave(){this.modalCtrl.dismiss(this.Content)}onCancel(){this.modalCtrl.dismiss("cancel")}onDelete(){this.modalCtrl.dismiss("delete")}}return t.\u0275fac=function(i){return new(i||t)(u.Wb(c.db))},t.\u0275cmp=u.Qb({type:t,selectors:[["app-recordcontenteditor"]],inputs:{Content:"Content"},decls:23,vars:5,consts:[["color","secondary"],["slot","start"],[3,"click"],["name","close-circle"],["slot","end"],["name","save"],["scrollY","true"],[3,"ngModel","config","editor","ngModelChange"],["fill","clear","color","danger",3,"hidden","click"],["name","trash"]],template:function(t,i){1&t&&(u.Zb(0,"ion-header"),u.Zb(1,"ion-toolbar",0),u.Zb(2,"ion-buttons",1),u.Zb(3,"ion-button",2),u.hc("click",(function(){return i.onCancel()})),u.Xb(4,"ion-icon",3),u.Zb(5,"ion-text"),u.xc(6,"\u53d6\u6d88"),u.Yb(),u.Yb(),u.Yb(),u.Zb(7,"ion-title"),u.xc(8),u.Yb(),u.Zb(9,"ion-buttons",4),u.Zb(10,"ion-button",2),u.hc("click",(function(){return i.onSave()})),u.Xb(11,"ion-icon",5),u.Zb(12,"ion-text"),u.xc(13,"\u4fdd\u5b58"),u.Yb(),u.Yb(),u.Yb(),u.Yb(),u.Yb(),u.Zb(14,"ion-content",6),u.Zb(15,"ckeditor",7),u.hc("ngModelChange",(function(t){return i.Content.text=t})),u.Yb(),u.Yb(),u.Zb(16,"ion-footer"),u.Zb(17,"ion-toolbar"),u.Zb(18,"ion-buttons",4),u.Zb(19,"ion-button",8),u.hc("click",(function(){return i.onDelete()})),u.Xb(20,"ion-icon",9),u.Zb(21,"ion-label"),u.xc(22,"\u5220\u9664"),u.Yb(),u.Yb(),u.Yb(),u.Yb(),u.Yb()),2&t&&(u.Mb(8),u.zc("\u7f16\u8f91\uff1a",i.Content.type,""),u.Mb(7),u.oc("ngModel",i.Content.text)("config",i.EditorConfig)("editor",i.Editor),u.Mb(4),u.oc("hidden",0===i.Content.time))},directives:[c.t,c.Z,c.j,c.i,c.u,c.U,c.X,c.n,g.a,o.c,o.d,c.r,c.D],styles:[""]}),t})(),m=(()=>{class t{transform(t,i){return new Date(t).toChinaStr(i)}}return t.\u0275fac=function(i){return new(i||t)},t.\u0275pipe=u.Vb({name:"chinadate",type:t,pure:!0}),t})();function p(t,i){if(1&t&&u.Xb(0,"app-baziview",18),2&t){const t=u.jc();u.oc("Config",t.Config)("BaziText",t.Bazi)}}function x(t,i){if(1&t&&u.Xb(0,"app-guaview",19),2&t){const t=u.jc();u.oc("Config",t.Config)("GuaText",t.Gua)}}function C(t,i){if(1&t){const t=u.ac();u.Zb(0,"ion-item",20),u.hc("click",(function(){u.rc(t);const e=i.$implicit;return u.jc().EditContent(e)})),u.Zb(1,"ion-note",21),u.xc(2),u.Yb(),u.Zb(3,"ion-label",22),u.Xb(4,"ion-text",23),u.Zb(5,"p"),u.Zb(6,"small"),u.xc(7),u.kc(8,"chinadate"),u.Yb(),u.Yb(),u.Yb(),u.Yb()}if(2&t){const t=i.$implicit;u.Mb(2),u.yc(t.type),u.Mb(2),u.oc("innerHtml",t.text,u.sc),u.Mb(3),u.yc(u.lc(8,3,t.time,!0))}}let v=(()=>{class t{constructor(t,i,e,n,o){this.route=t,this.dbservice=i,this.setting=e,this.alertCtrl=n,this.modalCtrl=o,this.EditModul=!1,this.index=0,this.smallSymbol=!1,this.HiddenCode=!1,this.HiddenTitel="",this.route.params.subscribe(t=>{this.nodeid=t.nodeid,this.recid=t.recid})}ngOnInit(){return Object(r.b)(this,void 0,void 0,(function*(){yield this.setting.WaitInit(),this.guaconfig=Object(a.b)(this.setting.Gua),this.baziconfig=Object(a.b)(this.setting.Bazi),this.content=[],yield this.dbservice.WaitInit(),this.dbservice.GetRecordes(this.nodeid).then(t=>{this.recordes=t,this.updateRecord()}),this.dbservice.getNodes().then(t=>{const i=t.find(t=>t.id===this.nodeid);this.nodename=i.name})}))}get Config(){return this.HasGua?this.guaconfig:this.HasBazi?this.baziconfig:null}get NodeName(){return this.nodename||"\u6848\u4f8b"}get Record(){if(this.recordes){const t=this.recordes.find(t=>t.id===this.recid);return this.index=this.recordes.indexOf(t),t}return null}get Gua(){return this.gua}get Bazi(){return this.bazi}get HasGua(){return!!this.Gua}get HasBazi(){return!!this.Bazi}get Index(){return this.index}get Length(){return(this.recordes||[]).length}get Content(){return this.content||[]}ShowHideCode(){this.HiddenCode=!this.HiddenCode,!0===this.HiddenCode&&(this.guaview?this.HiddenTitel=`${this.guaview.GuaInText} \u95ee: ${this.Record.titel}`:this.baziview&&(this.HiddenTitel=`${this.Record.titel}(${this.baziview.Gender}): ${this.baziview.BaziInText}`))}NextRecord(t){this.index=this.index+t,this.recid=this.recordes[this.Index].id,this.updateRecord()}AddContent(t){return Object(r.b)(this,void 0,void 0,(function*(){this.EditContent({type:t,time:0,text:""})}))}EditContent(t){return Object(r.b)(this,void 0,void 0,(function*(){const i=yield this.modalCtrl.create({component:f,componentProps:{Content:Object(a.b)(t)}});yield i.present();const{data:e}=yield i.onWillDismiss();"cancel"!==e&&("delete"===e?this.content=this.content.filter(i=>i!==t):0===e.time?(e.time=Date.now(),this.content.push(e)):(t.time=Date.now(),t.text=e.text),"cancel"!==e&&(this.Record.content=JSON.stringify(this.content),this.dbservice.SaveRecord(this.Record.id,this.Record.node,{content:JSON.stringify(this.content)})))}))}ChangSymbol(){!1===this.smallSymbol?(this.guaconfig.shensha=4,this.guaconfig.symbol=1,this.baziconfig.shensha=4):(this.guaconfig=Object(a.b)(this.setting.Gua),this.baziconfig=Object(a.b)(this.setting.Bazi)),this.smallSymbol=!this.smallSymbol,this.guaview&&this.guaview.Reflash(this.guaconfig),this.baziview&&this.baziview.Reflash(this.baziconfig)}EidtTitel(){return Object(r.b)(this,void 0,void 0,(function*(){let t=!1;const i=yield this.alertCtrl.create({header:"\u95ee\u5ff5\uff0f\u540d\u5b57",inputs:[{name:"titel",type:"text",id:"titel-id",value:this.Record.titel}],buttons:[{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary"},{text:"\u786e\u5b9a",handler:()=>{t=!0}}]});yield i.present();const{data:e}=yield i.onWillDismiss();if(t){const t=e.values.titel;this.Record.titel=t,this.guaview?(this.gua.question=t,this.Record.arg=JSON.stringify(this.gua),this.guaview.Titel="\u95ee\u5ff5\uff1a"+t):this.baziview&&(this.bazi.person=t,this.Record.arg=JSON.stringify(this.bazi),this.baziview.Person=`${t} (${this.baziview.Gender}\u9020)`),this.dbservice.SaveRecord(this.Record.id,this.Record.node,{titel:t,arg:this.Record.arg})}}))}updateRecord(){const t=this.Record;8===t.type?(this.gua=JSON.parse(t.arg),this.bazi=null):16===t.type&&(this.bazi=JSON.parse(t.arg),this.gua=null),this.content=JSON.parse(t.content||"[]")}}return t.\u0275fac=function(i){return new(i||t)(u.Wb(s.a),u.Wb(l.a),u.Wb(a.a),u.Wb(c.b),u.Wb(c.db))},t.\u0275cmp=u.Qb({type:t,selectors:[["app-recordviewer"]],viewQuery:function(t,i){var e;1&t&&(u.Ac(d.a,!0),u.Ac(b.a,!0)),2&t&&(u.qc(e=u.ic())&&(i.baziview=e.first),u.qc(e=u.ic())&&(i.guaview=e.first))},decls:43,vars:10,consts:[["slot","start",3,"hidden"],["defaulthref","","text","\u8fd4\u56de"],["slot","end"],[3,"click"],["name","md-options"],["name","md-code-working"],[3,"hidden"],[1,"ion-padding"],[3,"Config","BaziText",4,"ngIf"],[3,"Config","GuaText",4,"ngIf"],["lines","inset","detail","","class","ion-text-wrap",3,"click",4,"ngFor","ngForOf"],["size","small","slot","start","fill","clear",3,"disabled","click"],["slot","icon-only","name","ios-arrow-back"],["size","small",3,"click"],["name","add"],["name","md-clipboard"],["size","small","slot","end","fill","clear",3,"disabled","click"],["slot","icon-only","name","ios-arrow-forward"],[3,"Config","BaziText"],[3,"Config","GuaText"],["lines","inset","detail","",1,"ion-text-wrap",3,"click"],["slot","start"],[1,"ion-text-wrap"],[3,"innerHtml"]],template:function(t,i){1&t&&(u.Zb(0,"ion-header"),u.Zb(1,"ion-toolbar"),u.Zb(2,"ion-buttons",0),u.Xb(3,"ion-back-button",1),u.Yb(),u.Zb(4,"ion-title"),u.xc(5),u.Yb(),u.Zb(6,"ion-buttons",2),u.Zb(7,"ion-button",3),u.hc("click",(function(){return i.ChangSymbol()})),u.Xb(8,"ion-icon",4),u.Yb(),u.Zb(9,"ion-button",3),u.hc("click",(function(){return i.ShowHideCode()})),u.Xb(10,"ion-icon",5),u.Yb(),u.Yb(),u.Yb(),u.Yb(),u.Zb(11,"ion-item",6),u.Zb(12,"ion-label"),u.xc(13),u.Yb(),u.Yb(),u.Zb(14,"ion-content",7),u.Zb(15,"div",6),u.wc(16,p,1,2,"app-baziview",8),u.wc(17,x,1,2,"app-guaview",9),u.Yb(),u.Zb(18,"ion-list"),u.wc(19,C,9,6,"ion-item",10),u.Yb(),u.Yb(),u.Zb(20,"ion-footer"),u.Zb(21,"ion-toolbar"),u.Zb(22,"ion-button",11),u.hc("click",(function(){return i.NextRecord(-1)})),u.Xb(23,"ion-icon",12),u.Yb(),u.Zb(24,"ion-buttons"),u.Zb(25,"ion-button",13),u.hc("click",(function(){return i.AddContent("\u80cc\u666f")})),u.Xb(26,"ion-icon",14),u.Zb(27,"ion-text"),u.xc(28,"\u80cc\u666f"),u.Yb(),u.Yb(),u.Zb(29,"ion-button",13),u.hc("click",(function(){return i.AddContent("\u53cd\u9988")})),u.Xb(30,"ion-icon",14),u.Zb(31,"ion-text"),u.xc(32,"\u53cd\u9988"),u.Yb(),u.Yb(),u.Zb(33,"ion-button",13),u.hc("click",(function(){return i.AddContent("\u89e3\u8bfb")})),u.Xb(34,"ion-icon",14),u.Zb(35,"ion-text"),u.xc(36,"\u89e3\u8bfb"),u.Yb(),u.Yb(),u.Zb(37,"ion-button",13),u.hc("click",(function(){return i.EidtTitel()})),u.Xb(38,"ion-icon",15),u.Zb(39,"ion-text"),u.xc(40,"\u95ee\u5ff5"),u.Yb(),u.Yb(),u.Yb(),u.Zb(41,"ion-button",16),u.hc("click",(function(){return i.NextRecord(1)})),u.Xb(42,"ion-icon",17),u.Yb(),u.Yb(),u.Yb()),2&t&&(u.Mb(2),u.oc("hidden",i.EditModul),u.Mb(3),u.yc(i.NodeName),u.Mb(6),u.oc("hidden",!i.HiddenCode),u.Mb(2),u.yc(i.HiddenTitel),u.Mb(2),u.oc("hidden",i.HiddenCode),u.Mb(1),u.oc("ngIf",i.HasBazi),u.Mb(1),u.oc("ngIf",i.HasGua),u.Mb(2),u.oc("ngForOf",i.Content),u.Mb(3),u.oc("disabled",0===i.Index),u.Mb(19),u.oc("disabled",i.Index===i.Length-1))},directives:[c.t,c.Z,c.j,c.f,c.g,c.X,c.i,c.u,c.x,c.D,c.n,n.j,c.E,n.i,c.r,c.U,d.a,b.a,c.J],pipes:[m],styles:[""]}),t})();var w=e("uEAi"),Y=e("n7QD");e.d(i,"RecordviewerPageModule",(function(){return y}));const Z=[{path:"",component:v}];let y=(()=>{class t{}return t.\u0275mod=u.Ub({type:t}),t.\u0275inj=u.Tb({factory:function(i){return new(i||t)},imports:[[w.a,Y.a,g.b,n.b,o.a,c.ab,s.i.forChild(Z)]]}),t})()}}]);