(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{"8PFr":function(e,t,o){"use strict";o.r(t);var i=o("ofXK"),n=o("3Pt+"),c=o("tyNb"),s=o("c7TG"),r=o("mrSG"),d=o("L99X"),l=o("HQI1"),h=o("LvB5"),b=o("SRjL"),a=o("mo90"),u=(o("0eVs"),o("Y6BA"),o("pLZG")),f=o("fXoL");function m(e,t){if(1&e){const e=f.ac();f.Zb(0,"ion-item"),f.Zb(1,"ion-label"),f.xc(2),f.Yb(),f.Zb(3,"ion-note",11),f.xc(4),f.Yb(),f.Zb(5,"ion-text"),f.Zb(6,"small"),f.xc(7),f.Yb(),f.Yb(),f.Zb(8,"ion-button",12),f.hc("click",(function(o){f.rc(e);const i=t.$implicit;return f.jc().ShowRecordes(i)})),f.Xb(9,"ion-icon",13),f.Yb(),f.Zb(10,"ion-checkbox",14),f.hc("ngModelChange",(function(o){return f.rc(e),t.$implicit.isChecked=o})),f.Yb(),f.Yb()}if(2&e){const e=t.$implicit,o=f.jc();f.Mb(2),f.yc(e.titel),f.Mb(2),f.yc(e.type),f.Mb(3),f.yc(e.time),f.Mb(1),f.oc("hidden",o.EditModul),f.Mb(2),f.oc("hidden",!o.EditModul)("ngModel",e.isChecked)}}function p(e,t){if(1&e){const e=f.ac();f.Zb(0,"ion-buttons",15),f.Zb(1,"ion-button",16),f.hc("click",(function(t){return f.rc(e),f.jc().showPaiguaModal()})),f.Xb(2,"ion-icon",17),f.Zb(3,"ion-text"),f.xc(4,"\u5366\u4f8b"),f.Yb(),f.Yb(),f.Zb(5,"ion-button",16),f.hc("click",(function(t){return f.rc(e),f.jc().showPaibaziModal()})),f.Xb(6,"ion-icon",17),f.Zb(7,"ion-text"),f.xc(8,"\u547d\u4f8b"),f.Yb(),f.Yb(),f.Zb(9,"ion-button",16),f.hc("click",(function(t){return f.rc(e),f.jc().ShowActions()})),f.Xb(10,"ion-icon",18),f.Zb(11,"ion-text"),f.xc(12,"\u7f16\u8f91"),f.Yb(),f.Yb(),f.Zb(13,"ion-button",16),f.hc("click",(function(t){return f.rc(e),f.jc().CheckAll()})),f.Zb(14,"ion-text"),f.xc(15,"\u5168\u9009"),f.Yb(),f.Yb(),f.Yb()}if(2&e){const e=f.jc();f.Mb(1),f.oc("hidden",e.EditModul),f.Mb(4),f.oc("hidden",e.EditModul),f.Mb(4),f.oc("hidden",!e.EditModul),f.Mb(4),f.oc("hidden",!e.EditModul)}}function y(e,t){if(1&e){const e=f.ac();f.Zb(0,"ion-buttons",19),f.Zb(1,"ion-button",4),f.hc("click",(function(t){f.rc(e);const o=f.jc();return o.EditModul=!o.EditModul})),f.Xb(2,"ion-icon",20),f.Yb(),f.Yb()}}function v(e,t){if(1&e){const e=f.ac();f.Zb(0,"ion-buttons",19),f.Zb(1,"ion-button",4),f.hc("click",(function(t){return f.rc(e),f.jc().showHelp()})),f.Xb(2,"ion-icon",21),f.Zb(3,"ion-text"),f.xc(4,"\u5e2e\u52a9"),f.Yb(),f.Yb(),f.Yb()}}let g=(()=>{class e{constructor(e,t,o,i,n,s,r){this.dbservice=e,this.actionsheetctrl=t,this.alertCtrl=o,this.popoverCtrl=i,this.modalController=n,this.route=s,this.router=r,this.columns=[{prop:"time"},{name:"titel"},{name:"type"}],this.SortKey="created",this.SortName="\u521b\u5efa\u65e5\u671f",this.EditModul=!1,this.Editable=!0,this.route.params.subscribe(e=>{this.node_id=e.id}),this.router.events.pipe(Object(u.a)(e=>e instanceof c.c)).subscribe(e=>{const t=e.url,o=t.match(/\/menu\/recordes\/(?<nodeid>[0-9]+)/i);o&&console.log("NavigationStart",t,o.groups.nodeid)})}ngOnInit(){return Object(r.b)(this,void 0,void 0,(function*(){this.recordes=[],this.recordesOrigin=[];let e=[];yield this.dbservice.GetAllNodes().then(t=>{"*"===this.node_id?(e=t.where(e=>32===e.type).select(e=>e.id),this.Editable=!1):(e=this.node_id.split("-"),this.Editable=1===e.length);for(const o of e)this.loadRecordes(o).then(e=>{this.recordes=this.Recordes.concat(e||[])})})}))}sortOptions(e){return Object(r.b)(this,void 0,void 0,(function*(){const t=yield this.popoverCtrl.create({component:l.a,event:e,componentProps:{items:[{name:"\u76ee\u5f55\u540d\u79f0",value:"titel"},{name:"\u521b\u5efa\u65f6\u95f4",value:"created"},{name:"\u4fee\u6539\u65f6\u95f4",value:"modified"}],currentOption:this.SortKey},translucent:!0});yield t.present();const{data:o}=yield t.onDidDismiss();if((o||this.SortKey)!==this.SortKey){switch(this.SortKey=o.toString(),this.SortKey){case"titel":this.SortName="\u76ee\u5f55\u540d\u79f0";break;case"created":this.SortName="\u521b\u5efa\u65f6\u95f4";break;case"modified":this.SortName="\u4fee\u6539\u65f6\u95f4";break;default:this.SortName="\u9ed8\u8ba4"}this.recordes=this.recordesOrigin.sortByKey(this.SortKey).select(e=>this.Convert(e))}}))}get Recordes(){return this.recordes||[]}loadRecordes(e){return this.dbservice.GetRecordes(e).then(e=>{const t=e.select(e=>this.Convert(e));return this.recordesOrigin=this.recordesOrigin.concat(e||[]),t}).catch(t=>{t===[]?console.log(`loadRecordes ${e} not found in local`):console.log(`Err loadRecordes ${e}`,t)})}showPaiguaModal(){return Object(r.b)(this,void 0,void 0,(function*(){const e=yield this.modalController.create({component:h.a});yield e.present();const{data:t}=yield e.onWillDismiss();if(t.result){const e=t.result;this.dbservice.SaveRecord(this.node_id,e.question,8,JSON.stringify(e)).then(e=>{this.recordes.push(this.Convert(e))})}}))}showPaibaziModal(){return Object(r.b)(this,void 0,void 0,(function*(){const e=yield this.modalController.create({component:b.a});yield e.present();const{data:t}=yield e.onWillDismiss();if(t.result){const e=t.result;this.dbservice.SaveRecord(this.node_id,e.person,16,JSON.stringify(e)).then(e=>{this.recordes.push(this.Convert(e))})}}))}showHelp(){return Object(r.b)(this,void 0,void 0,(function*(){const e=yield this.alertCtrl.create({header:"\u5e2e\u52a9",message:"\u5f53\u6848\u4f8b\u6765\u81ea\u591a\u4e2a\u6587\u4ef6\u5939\u7684\u65f6\u5019\uff0c\u65e0\u6cd5\u7f16\u8f91\u3002\u5982\u9700\u7f16\u8f91\uff0c\u8bf7\u8fd4\u56de\u76ee\u5f55\u754c\u9762\uff0c\u6253\u5f00\u4e00\u4e2a\u5355\u4e00\u7684\u6587\u4ef6\u5939\u76ee\u5f55\u3002",buttons:["\u786e\u5b9a"]});yield e.present()}))}CheckAll(){this.checkAll=!this.checkAll,this.recordes.forEach(e=>e.isChecked=this.checkAll)}ShowActions(){return Object(r.b)(this,void 0,void 0,(function*(){if(0===this.recordes.filter(e=>e.isChecked).length){const e=yield this.alertCtrl.create({header:"\u5e2e\u52a9",message:"\u8bf7\u9009\u5b9a\u81f3\u5c11\u4e00\u4f8b\u88ab\u7f16\u8f91\u7684\u6848\u4f8b\u3002",buttons:["\u786e\u5b9a"]});return void(yield e.present())}const e=yield this.actionsheetctrl.create({header:"\u7f16\u8f91",buttons:[{text:"\u5220\u9664",role:"destructive",icon:"trash",handler:()=>{this.DeleteNode()}},{text:"\u8fc1\u79fb\u76ee\u5f55",icon:"arrow-round-back",handler:()=>{this.MoveNode()}},{text:" \u53d6\u6d88",icon:"close",role:"cancel",handler:()=>{}}]});yield e.present()}))}MoveNode(){return Object(r.b)(this,void 0,void 0,(function*(){const e=yield this.modalController.create({component:a.a,componentProps:{Titel:"\u9009\u62e9\u65b0\u76ee\u5f55",SelectDocument:!0,NodeID:this.node_id}});yield e.present();const{data:t}=yield e.onWillDismiss();t.nodeid&&!t.nodeid.IsNullOrEmpty()&&(this.EditModul=!1,this.dbservice.MoveRecordes(this.node_id,t.nodeid,this.recordes.filter(e=>e.isChecked).map(e=>e.id)).then(e=>{this.recordesOrigin=e,this.recordes=e.sortByKey(this.SortKey).map(e=>this.Convert(e))}))}))}DeleteNode(){return Object(r.b)(this,void 0,void 0,(function*(){const e=yield this.alertCtrl.create({header:"\u5220\u9664\u6848\u4f8b",message:"\u786e\u5b9a\u5220\u9664\u9009\u5b9a\u7684\u6848\u4f8b\u5417\uff1f",buttons:[{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary"},{text:"\u786e\u5b9a",handler:()=>{const e=this.recordes.where(e=>e.isChecked).map(e=>e.id);console.log("next to delete recordes",e),this.EditModul=!1,this.dbservice.DeleteRecordes(this.node_id,e).then(e=>{this.recordesOrigin=e,this.recordes=e.sortByKey(this.SortKey).select(e=>this.Convert(e))})}}]});yield e.present()}))}ShowRecordes(e){this.router.navigateByUrl(`/menu/recordview/${e.nodeid}/${e.id}`)}Convert(e){return{time:new Date("modified"===this.SortKey?e.modified:e.created).toChinaStr(),titel:e.titel,type:8===e.type?"\u516d\u723b":"\u516b\u5b57",id:e.id,nodeid:e.node,isChecked:!1}}}return e.\u0275fac=function(t){return new(t||e)(f.Wb(d.a),f.Wb(s.a),f.Wb(s.b),f.Wb(s.Z),f.Wb(s.W),f.Wb(c.a),f.Wb(c.g))},e.\u0275cmp=f.Qb({type:e,selectors:[["app-recordes"]],decls:22,vars:8,consts:[["slot","start",3,"hidden"],["defaulthref","","text","\u8fd4\u56de"],["rdbackbtn",""],["slot","end",3,"hidden"],[3,"click"],["name","md-funnel"],[3,"hidden"],["color","light","showCancelButton","focus","cancelButtonText","\u53d6\u6d88","placeholder","\u641c\u7d22\u95ee\u5ff5/\u540d\u5b57"],[4,"ngFor","ngForOf"],["slot","start",4,"ngIf"],["slot","end",4,"ngIf"],["button","","margin-horizontal","3"],["color","light",3,"hidden","click"],["icon-only","","name","ios-arrow-forward"],[3,"hidden","ngModel","ngModelChange"],["slot","start"],[3,"hidden","click"],["name","add"],["name","build"],["slot","end"],["name","md-reorder"],["name","md-help-circle"]],template:function(e,t){1&e&&(f.Zb(0,"ion-header"),f.Zb(1,"ion-toolbar"),f.Zb(2,"ion-buttons",0),f.Xb(3,"ion-back-button",1,2),f.Yb(),f.Zb(5,"ion-title"),f.xc(6,"\u6613\u5b66\u6848\u4f8b"),f.Yb(),f.Zb(7,"ion-buttons",3),f.Zb(8,"ion-button",4),f.hc("click",(function(e){return t.sortOptions(e)})),f.Xb(9,"ion-icon",5),f.Zb(10,"ion-text"),f.xc(11),f.Yb(),f.Yb(),f.Yb(),f.Yb(),f.Yb(),f.Zb(12,"ion-content"),f.Zb(13,"ion-list"),f.Zb(14,"ion-list-header",6),f.Xb(15,"ion-searchbar",7),f.Yb(),f.wc(16,m,11,6,"ion-item",8),f.Yb(),f.Yb(),f.Zb(17,"ion-footer"),f.Zb(18,"ion-toolbar"),f.wc(19,p,16,4,"ion-buttons",9),f.wc(20,y,3,0,"ion-buttons",10),f.wc(21,v,5,0,"ion-buttons",10),f.Yb(),f.Yb()),2&e&&(f.Mb(2),f.oc("hidden",t.EditModul),f.Mb(5),f.oc("hidden",t.EditModul),f.Mb(4),f.yc(t.SortName),f.Mb(3),f.oc("hidden",t.EditModul),f.Mb(2),f.oc("ngForOf",t.Recordes),f.Mb(3),f.oc("ngIf",t.Editable),f.Mb(1),f.oc("ngIf",t.Editable),f.Mb(1),f.oc("ngIf",!t.Editable))},directives:[s.p,s.T,s.i,s.f,s.g,s.R,s.h,s.q,s.O,s.l,s.v,s.w,s.E,s.cb,i.i,s.n,i.j,s.t,s.u,s.A,s.d,s.j,s.c,n.c,n.d],styles:[""]}),e})();o.d(t,"RecordesPageModule",(function(){return Z}));const M=[{path:"",component:g}];let Z=(()=>{class e{}return e.\u0275mod=f.Ub({type:e}),e.\u0275inj=f.Tb({factory:function(t){return new(t||e)},imports:[[i.b,n.a,s.U,c.i.forChild(M)]]}),e})()}}]);