(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{dnR8:function(e,i,t){"use strict";t.r(i);var n=t("ofXK"),c=t("3Pt+"),o=t("tyNb"),s=t("c7TG"),a=t("mrSG"),r=t("PKx9"),d=t("LTmD"),l=t("7L00"),h=t("Y6BA"),u=t("fXoL"),g=t("i/bi");function b(e,i){1&e&&u.Zb(0,"ion-menu-button")}function f(e,i){if(1&e){const e=u.ec();u.dc(0,"ion-header"),u.dc(1,"ion-toolbar",6),u.dc(2,"ion-buttons",7),u.Zb(3,"ion-back-button",8),u.Hc(4,b,1,0,"ion-menu-button",0),u.cc(),u.dc(5,"ion-title"),u.Jc(6,"\u6211\u7684\u6d88\u606f"),u.cc(),u.dc(7,"ion-buttons",9),u.dc(8,"ion-button",10),u.lc("click",(function(){return u.Cc(e),u.oc().ChangeMode()})),u.Jc(9),u.cc(),u.cc(),u.cc(),u.cc()}if(2&e){const e=u.oc();u.Nb(4),u.vc("ngIf",!e.CanNaviBack),u.Nb(5),u.Kc(e.ForMe?"\u6536\u5230\u7684":"\u53d1\u9001\u7684")}}function m(e,i){if(1&e){const e=u.ec();u.dc(0,"ion-item",11),u.dc(1,"ion-buttons",9),u.dc(2,"ion-segment",12),u.lc("ionChange",(function(){return u.Cc(e),u.oc().ChangeMode()})),u.dc(3,"ion-segment-button",13),u.Jc(4,"\u6536\u5230\u7684\u6d88\u606f"),u.cc(),u.dc(5,"ion-segment-button",14),u.Jc(6,"\u53d1\u9001\u7684\u6d88\u606f"),u.cc(),u.cc(),u.cc(),u.cc()}}function p(e,i){if(1&e&&(u.dc(0,"ion-item"),u.dc(1,"ion-label"),u.dc(2,"ion-text"),u.Jc(3),u.cc(),u.cc(),u.cc()),2&e){const e=u.oc();u.Nb(3),u.Kc(e.InfoNoMessage)}}function v(e,i){if(1&e&&(u.dc(0,"ion-text"),u.Jc(1),u.cc()),2&e){const e=u.oc().$implicit;u.Nb(1),u.Lc("\u6765\u81ea\uff1a",e.author,"")}}function M(e,i){if(1&e&&(u.dc(0,"ion-text"),u.Jc(1),u.cc()),2&e){const e=u.oc().$implicit;u.Nb(1),u.Lc("\u53d1\u9001\u7ed9\uff1a",e.receiver,"")}}function y(e,i){if(1&e){const e=u.ec();u.dc(0,"ion-item-sliding",15),u.dc(1,"ion-item"),u.dc(2,"ion-label"),u.dc(3,"ion-text",16),u.Jc(4),u.cc(),u.Zb(5,"br"),u.Hc(6,v,2,1,"ion-text",0),u.Hc(7,M,2,1,"ion-text",0),u.Zb(8,"br"),u.dc(9,"p"),u.dc(10,"small"),u.Jc(11),u.cc(),u.cc(),u.cc(),u.dc(12,"ion-buttons",9),u.dc(13,"ion-button",17),u.lc("click",(function(){u.Cc(e);const t=i.$implicit;return u.oc().ShowMessage(t)})),u.Zb(14,"ion-icon",18),u.cc(),u.cc(),u.cc(),u.dc(15,"ion-item-options",19),u.dc(16,"ion-item-option",20),u.lc("click",(function(){u.Cc(e);const t=i.$implicit;return u.oc().ReplyMessage(t)})),u.Zb(17,"ion-icon",21),u.cc(),u.cc(),u.dc(18,"ion-item-options",22),u.dc(19,"ion-item-option",23),u.lc("click",(function(){u.Cc(e);const t=i.$implicit;return u.oc().DeleteMsg(t)})),u.Zb(20,"ion-icon",24),u.cc(),u.cc(),u.cc()}if(2&e){const e=i.$implicit,t=u.oc();u.vc("disabled",!t.ForMe),u.Nb(3),u.vc("color",e.readed?"medium":"dark"),u.Nb(1),u.Lc("\u6807\u9898\uff1a",e.title,""),u.Nb(2),u.vc("ngIf",t.ForMe),u.Nb(1),u.vc("ngIf",!t.ForMe),u.Nb(4),u.Kc(t.ShowTime(e.created)),u.Nb(2),u.vc("color",e.readed?"medium":"primary"),u.Nb(1),u.vc("name",e.readed?"mail":"mail-unread"),u.Nb(2),u.vc("disabled",!e.replyable)("color",e.replyable?"primary":"medium")}}function N(e,i){if(1&e){const e=u.ec();u.dc(0,"div",25),u.dc(1,"sui-pagination",26),u.lc("pageChange",(function(i){return u.Cc(e),u.oc().PageIndex=i})),u.cc(),u.cc()}if(2&e){const e=u.oc();u.Nb(1),u.vc("collectionSize",e.PageSum)("pageSize",20)("maxSize",e.MaxPageButtons)("hasNavigationLinks",!0)("hasBoundaryLinks",!0)("page",e.PageIndex)}}let C=(()=>{class e{constructor(e,i,t,n,c,o,s){this.loadingController=e,this.modalCtrl=i,this.alertController=t,this.route=n,this.router=c,this.forumservice=o,this.settings=s,this.pageindex=0,this.Messages=[],this.ForMe=!0,this.InfoNoMessage="\u6b63\u5728\u8bfb\u53d6\u60a8\u7684\u6d88\u606f\u3002\u3002\u3002",this.Pages=[0],this.PageSum=0,this.LoadSuccessed=!1,this.CanNaviBack=!0,this.route.params.subscribe(e=>{this.CanNaviBack="true"===e.naviback})}ngOnInit(){return Object(a.b)(this,void 0,void 0,(function*(){if(!this.settings.HasUser)return this.presentAlert("\u65e0\u6cd5\u8bbf\u95ee",null,"\u60a8\u8fd8\u6ca1\u6709\u6ce8\u518c\u8d26\u53f7\uff0c\u65e0\u6cd5\u53d1\u9001\u6d88\u606f\u3002"),void this.router.navigateByUrl("/menu/user");this.PageIndex=0}))}get IsWeb(){return"web"===h.b}get MaxPageButtons(){return this.settings.DeviceWidth>=400?7:2}get PageIndex(){return this.pageindex}set PageIndex(e){this.pageindex=e,this.Reload(e)}ShowTime(e){return new Date(e).toChinaStr(!0)}ShowMessage(e){return Object(a.b)(this,void 0,void 0,(function*(){this.ForMe&&!1===e.readed&&this.forumservice.DeleteMessage(e.id,!1).then(()=>{e.readed=!0});const i=yield this.modalCtrl.create({component:l.a,componentProps:{Message:e,Read:!0}});yield i.present()}))}ChangeMode(){return Object(a.b)(this,void 0,void 0,(function*(){this.ForMe=!this.ForMe,this.Messages=[],this.PageIndex=0}))}DeleteMsg(e){return Object(a.b)(this,void 0,void 0,(function*(){yield this.showLoading(),this.forumservice.DeleteMessage(e.id,!0).then(()=>{this.Messages=this.Messages.filter(i=>i.id!==e.id),0===this.Messages.length&&(this.InfoNoMessage="\u60a8\u6ca1\u6709\u4efb\u4f55\u6d88\u606f\u3002\u3002\u3002")}).finally(()=>{this.closeLoading()})}))}ReplyMessage(e){return Object(a.b)(this,void 0,void 0,(function*(){const i=Object(h.c)(),t=new Date(e.created).toChinaStr(!0),n={id:i,created:Date.now(),valid:0,author:this.settings.User.id,receiver:e.author,roller:0,readed:!1,private:!0,replyable:!0,title:`\u56de\u590d\uff1a${e.title}`,content:`\n\n\u539f\u6d88\u606f\uff1a${t}\n\u539f\u5185\u5bb9\uff1a=======================\n${e.content}`},c=yield this.modalCtrl.create({component:l.a,componentProps:{Message:n}});yield c.present(),yield c.onWillDismiss()}))}doRefresh(e){this.Messages=[],this.Reload(this.PageIndex).finally(()=>{e.target.complete()})}Reload(e){return Object(a.b)(this,void 0,void 0,(function*(){return yield this.showLoading(),this.forumservice.LoadMessages(e,this.ForMe).then(e=>(this.BuildPages(e.sum),this.Messages=e.data||[],0===this.Messages.length&&(this.InfoNoMessage="\u60a8\u6ca1\u6709\u4efb\u4f55\u6d88\u606f"),this.LoadSuccessed=!0,!0)).finally(()=>{this.closeLoading()})}))}showLoading(){return Object(a.b)(this,void 0,void 0,(function*(){this.loadingView||(this.loadingView=yield this.loadingController.create({message:"\u8bfb\u53d6\u6211\u7684\u6d88\u606f...",duration:6e4})),yield this.loadingView.present()}))}closeLoading(){return Object(a.b)(this,void 0,void 0,(function*(){this.loadingView&&(yield this.loadingView.dismiss(),this.loadingView=null)}))}presentAlert(e,i,t){return Object(a.b)(this,void 0,void 0,(function*(){const n=yield this.alertController.create({header:e||"\u9519\u8bef",subHeader:i||"",message:t,buttons:["\u786e\u5b9a"]});yield n.present()}))}BuildPages(e){if(0!==this.PageIndex)return;if(0===e)return void(this.Pages=[0]);this.Pages=[];const i=Math.ceil(e/20);for(let t=0;t<i;t++)this.Pages.push(t)}}return e.\u0275fac=function(i){return new(i||e)(u.Yb(s.bb),u.Yb(s.cb),u.Yb(s.b),u.Yb(o.a),u.Yb(o.g),u.Yb(r.a),u.Yb(d.a))},e.\u0275cmp=u.Sb({type:e,selectors:[["app-messagelist"]],decls:9,vars:5,consts:[[4,"ngIf"],["slot","fixed",3,"ionRefresh"],["ion-no-padding",""],["lines","none",4,"ngIf"],[3,"disabled",4,"ngFor","ngForOf"],["class","ui very basic segment",4,"ngIf"],["color","primary"],["slot","start"],["defaulthref","","text","\u8fd4\u56de"],["slot","end"],[3,"click"],["lines","none"],[3,"ionChange"],["value","true"],["value","false"],[3,"disabled"],[3,"color"],[3,"color","click"],["slot","end",3,"name"],["side","start"],[3,"disabled","color","click"],["slot","icon-only","name","send"],["side","end"],["color","danger",3,"click"],["slot","icon-only","name","trash"],[1,"ui","very","basic","segment"],[1,"ui","right","floated",3,"collectionSize","pageSize","maxSize","hasNavigationLinks","hasBoundaryLinks","page","pageChange"]],template:function(e,i){1&e&&(u.Hc(0,f,10,2,"ion-header",0),u.dc(1,"ion-content"),u.dc(2,"ion-refresher",1),u.lc("ionRefresh",(function(e){return i.doRefresh(e)})),u.Zb(3,"ion-refresher-content"),u.cc(),u.dc(4,"ion-list",2),u.Hc(5,m,7,0,"ion-item",3),u.Hc(6,p,4,1,"ion-item",0),u.Hc(7,y,21,10,"ion-item-sliding",4),u.cc(),u.Hc(8,N,2,6,"div",5),u.cc()),2&e&&(u.vc("ngIf",!i.IsWeb),u.Nb(5),u.vc("ngIf",i.IsWeb),u.Nb(1),u.vc("ngIf",0===i.Messages.length),u.Nb(1),u.vc("ngForOf",i.Messages),u.Nb(1),u.vc("ngIf",i.LoadSuccessed))},directives:[n.j,s.n,s.J,s.K,s.E,n.i,s.t,s.Y,s.j,s.f,s.g,s.W,s.i,s.G,s.x,s.O,s.hb,s.P,s.D,s.T,s.C,s.u,s.B,s.A,g.f],styles:[""]}),e})();t.d(i,"MessagelistPageModule",(function(){return w}));const I=[{path:"",component:C}];let w=(()=>{class e{}return e.\u0275mod=u.Wb({type:e}),e.\u0275inj=u.Vb({factory:function(i){return new(i||e)},imports:[[n.b,c.c,s.Z,g.e,o.j.forChild(I)]]}),e})()}}]);