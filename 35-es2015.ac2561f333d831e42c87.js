(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{lotG:function(t,e,i){"use strict";i.r(e);var n=i("ofXK"),c=i("3Pt+"),o=i("tyNb"),s=i("c7TG"),d=i("mrSG"),r=i("LTmD"),a=i("gTpY"),l=i("ylIl"),u=i("HULg"),h=i("+z1p"),b=(i("0eVs"),i("fXoL")),f=i("zioG");let m=(()=>{class t{constructor(t,e){this.modalCtrl=t,this.alertController=e,this.Editor=h,this.EditorConfig={toolbar:["heading","|","bold","italic","bulletedList","numberedList","|","link","undo","redo"]}}ngOnInit(){}onSave(){this.modalCtrl.dismiss(this.Content)}onCancel(){this.modalCtrl.dismiss("cancel")}onDelete(){return Object(d.b)(this,void 0,void 0,(function*(){(yield this.presentConfirm("\u5220\u9664\u5185\u5bb9",null,"\u786e\u5b9a\u5220\u9664\u6b64\u5185\u5bb9\u5417\uff1f"))&&this.modalCtrl.dismiss("delete")}))}onEditorReady(t){t.ui.getEditableElement().parentElement.insertBefore(t.ui.view.toolbar.element,t.ui.getEditableElement())}presentConfirm(t,e,i){return Object(d.b)(this,void 0,void 0,(function*(){let n=!1;const c=yield this.alertController.create({header:t||"\u63d0\u793a",subHeader:e||"",message:i,buttons:[{text:"\u786e\u5b9a",handler:()=>{n=!0}},{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary",handler:()=>{}}]});return yield c.present(),yield c.onWillDismiss(),Promise.resolve(n)}))}}return t.\u0275fac=function(e){return new(e||t)(b.Zb(s.cb),b.Zb(s.b))},t.\u0275cmp=b.Tb({type:t,selectors:[["app-recordcontenteditor"]],inputs:{Content:"Content"},decls:20,vars:5,consts:[["color","secondary"],["slot","start"],["color","danger",3,"hidden","click"],["name","trash"],["slot","end"],[3,"click"],["name","close-circle"],["name","save"],["scrollY","true"],[3,"ngModel","config","editor","ngModelChange","ready"]],template:function(t,e){1&t&&(b.ec(0,"ion-header"),b.ec(1,"ion-toolbar",0),b.ec(2,"ion-buttons",1),b.ec(3,"ion-button",2),b.mc("click",(function(){return e.onDelete()})),b.ac(4,"ion-icon",3),b.ec(5,"ion-label"),b.Jc(6,"\u5220\u9664"),b.dc(),b.dc(),b.dc(),b.ec(7,"ion-title"),b.Jc(8),b.dc(),b.ec(9,"ion-buttons",4),b.ec(10,"ion-button",5),b.mc("click",(function(){return e.onCancel()})),b.ac(11,"ion-icon",6),b.ec(12,"ion-text"),b.Jc(13,"\u53d6\u6d88"),b.dc(),b.dc(),b.ec(14,"ion-button",5),b.mc("click",(function(){return e.onSave()})),b.ac(15,"ion-icon",7),b.ec(16,"ion-text"),b.Jc(17,"\u4fdd\u5b58"),b.dc(),b.dc(),b.dc(),b.dc(),b.dc(),b.ec(18,"ion-content",8),b.ec(19,"ckeditor",9),b.mc("ngModelChange",(function(t){return e.Content.text=t}))("ready",(function(t){return e.onEditorReady(t)})),b.dc(),b.dc()),2&t&&(b.Nb(3),b.wc("hidden",0===e.Content.time),b.Nb(5),b.Lc("\u7f16\u8f91\uff1a",e.Content.type,""),b.Nb(11),b.wc("ngModel",e.Content.text)("config",e.EditorConfig)("editor",e.Editor))},directives:[s.t,s.Y,s.j,s.i,s.u,s.D,s.W,s.T,s.n,f.a,c.f,c.g],styles:["*[_ngcontent-%COMP%]{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}[contenteditable][_ngcontent-%COMP%], ckeditor[_ngcontent-%COMP%], input[_ngcontent-%COMP%]{-webkit-user-select:text;-moz-user-select:text;-ms-user-select:text;user-select:text}[_nghost-%COMP%]     .ck-editor__editable_inline{min-height:200px}"]}),t})();var g=i("Y6BA"),p=i("i/bi");let C=(()=>{class t{transform(t,e){return new Date(t).toChinaStr(e)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=b.Yb({name:"chinadate",type:t,pure:!0}),t})();function w(t,e){if(1&t){const t=b.fc();b.ec(0,"ion-header"),b.ec(1,"ion-toolbar"),b.ec(2,"ion-buttons",7),b.ac(3,"ion-back-button",8),b.dc(),b.ec(4,"ion-title"),b.Jc(5),b.dc(),b.ec(6,"ion-buttons",9),b.ec(7,"ion-button",10),b.mc("click",(function(){b.Cc(t);const e=b.pc();return e.HiddenCode=!e.HiddenCode})),b.ac(8,"ion-icon",11),b.dc(),b.dc(),b.dc(),b.dc()}if(2&t){const t=b.pc();b.Nb(2),b.wc("hidden",t.EditModul),b.Nb(3),b.Kc(t.NodeName),b.Nb(3),b.wc("name",t.HiddenCode?"arrow-dropup":"arrow-dropdown")}}function v(t,e){if(1&t){const t=b.fc();b.ec(0,"ion-toolbar"),b.ec(1,"ion-buttons",12),b.ec(2,"ion-button",13),b.Jc(3," \u603b\u76ee\u5f55 "),b.dc(),b.ec(4,"ion-button",14),b.mc("click",(function(){return b.Cc(t),b.pc().NextRecord(-1)})),b.ac(5,"ion-icon",15),b.dc(),b.ec(6,"ion-button",16),b.mc("click",(function(){return b.Cc(t),b.pc().AddContent("\u80cc\u666f")})),b.ac(7,"ion-icon",17),b.ec(8,"ion-text"),b.Jc(9,"\u80cc\u666f"),b.dc(),b.dc(),b.ec(10,"ion-button",16),b.mc("click",(function(){return b.Cc(t),b.pc().AddContent("\u53cd\u9988")})),b.ac(11,"ion-icon",17),b.ec(12,"ion-text"),b.Jc(13,"\u53cd\u9988"),b.dc(),b.dc(),b.ec(14,"ion-button",16),b.mc("click",(function(){return b.Cc(t),b.pc().AddContent("\u89e3\u8bfb")})),b.ac(15,"ion-icon",17),b.ec(16,"ion-text"),b.Jc(17,"\u89e3\u8bfb"),b.dc(),b.dc(),b.ec(18,"ion-button",16),b.mc("click",(function(){return b.Cc(t),b.pc().EidtTitel()})),b.ac(19,"ion-icon",18),b.ec(20,"ion-text"),b.Jc(21,"\u95ee\u5ff5"),b.dc(),b.dc(),b.ec(22,"ion-button",19),b.mc("click",(function(){return b.Cc(t),b.pc().NextRecord(1)})),b.ac(23,"ion-icon",20),b.dc(),b.dc(),b.ec(24,"ion-buttons",9),b.ec(25,"ion-button",10),b.mc("click",(function(){b.Cc(t);const e=b.pc();return e.HiddenCode=!e.HiddenCode})),b.ac(26,"ion-icon",11),b.dc(),b.dc(),b.dc()}if(2&t){const t=b.pc();b.Nb(4),b.wc("disabled",0===t.Index),b.Nb(18),b.wc("disabled",t.Index===t.Length-1),b.Nb(4),b.wc("name",t.HiddenCode?"arrow-dropup":"arrow-dropdown")}}function x(t,e){if(1&t&&(b.ec(0,"div",2),b.ec(1,"div",21),b.Jc(2),b.dc(),b.dc()),2&t){const t=b.pc();b.wc("suiCollapse",!t.HiddenCode),b.Nb(2),b.Lc(" ",t.PanName," ")}}function y(t,e){if(1&t&&b.ac(0,"app-baziview",22),2&t){const t=b.pc();b.wc("Config",t.Config)("BaziText",t.Bazi)}}function N(t,e){if(1&t&&b.ac(0,"app-guaview",23),2&t){const t=b.pc();b.wc("Config",t.Config)("GuaText",t.Gua)}}function z(t,e){if(1&t){const t=b.fc();b.ec(0,"ion-item",24),b.mc("click",(function(){b.Cc(t);const i=e.$implicit;return b.pc().EditContent(i)})),b.ec(1,"ion-note",12),b.Jc(2),b.dc(),b.ec(3,"ion-label",25),b.ac(4,"ion-text",26),b.ec(5,"p"),b.ec(6,"small"),b.Jc(7),b.qc(8,"chinadate"),b.dc(),b.dc(),b.dc(),b.dc()}if(2&t){const t=e.$implicit;b.Nb(2),b.Kc(t.type),b.Nb(2),b.wc("innerHtml",t.text,b.Dc),b.Nb(3),b.Kc(b.sc(8,3,t.time,!0))}}function H(t,e){if(1&t){const t=b.fc();b.ec(0,"ion-footer"),b.ec(1,"ion-toolbar"),b.ec(2,"ion-button",14),b.mc("click",(function(){return b.Cc(t),b.pc().NextRecord(-1)})),b.ac(3,"ion-icon",15),b.dc(),b.ec(4,"ion-buttons"),b.ec(5,"ion-button",16),b.mc("click",(function(){return b.Cc(t),b.pc().AddContent("\u80cc\u666f")})),b.ac(6,"ion-icon",17),b.ec(7,"ion-text"),b.Jc(8,"\u80cc\u666f"),b.dc(),b.dc(),b.ec(9,"ion-button",16),b.mc("click",(function(){return b.Cc(t),b.pc().AddContent("\u53cd\u9988")})),b.ac(10,"ion-icon",17),b.ec(11,"ion-text"),b.Jc(12,"\u53cd\u9988"),b.dc(),b.dc(),b.ec(13,"ion-button",16),b.mc("click",(function(){return b.Cc(t),b.pc().AddContent("\u89e3\u8bfb")})),b.ac(14,"ion-icon",17),b.ec(15,"ion-text"),b.Jc(16,"\u89e3\u8bfb"),b.dc(),b.dc(),b.ec(17,"ion-button",16),b.mc("click",(function(){return b.Cc(t),b.pc().EidtTitel()})),b.ac(18,"ion-icon",18),b.ec(19,"ion-text"),b.Jc(20,"\u95ee\u5ff5"),b.dc(),b.dc(),b.dc(),b.ec(21,"ion-button",19),b.mc("click",(function(){return b.Cc(t),b.pc().NextRecord(1)})),b.ac(22,"ion-icon",20),b.dc(),b.dc(),b.dc()}if(2&t){const t=b.pc();b.Nb(2),b.wc("disabled",0===t.Index),b.Nb(19),b.wc("disabled",t.Index===t.Length-1)}}let k=(()=>{class t{constructor(t,e,i,n,c){this.route=t,this.dbservice=e,this.setting=i,this.alertCtrl=n,this.modalCtrl=c,this.EditModul=!1,this.index=0,this.smallSymbol=!1,this.HiddenCode=!1,this.HiddenTitel="",this.PanName="\u76d8\u7b26",this.route.params.subscribe(t=>{this.nodeid=t.nodeid,this.recid=t.recid})}ngOnInit(){return Object(d.b)(this,void 0,void 0,(function*(){yield this.setting.WaitInit(),this.guaconfig=Object(r.b)(this.setting.Gua),this.baziconfig=Object(r.b)(this.setting.Bazi),this.content=[],yield this.dbservice.WaitInit(),this.dbservice.GetRecordes(this.nodeid).then(t=>{this.recordes=t,this.updateRecord()}),this.dbservice.getNodes().then(t=>{const e=t.find(t=>t.id===this.nodeid);this.nodename=e.name}),setTimeout(()=>{this.HasGua?this.PanName="\u5366\u540d\uff1a"+this.guaview.GuaInText:this.HasBazi&&(this.PanName="\u516b\u5b57\uff1a"+this.baziview.BaziInText)},1e3)}))}get IsWeb(){return"web"===g.b}get Config(){return this.HasGua?this.guaconfig:this.HasBazi?this.baziconfig:null}get NodeName(){return this.nodename||"\u6848\u4f8b"}get Record(){if(this.recordes){const t=this.recordes.find(t=>t.id===this.recid);return this.index=this.recordes.indexOf(t),t}return null}get Gua(){return this.gua}get Bazi(){return this.bazi}get HasGua(){return!!this.Gua}get HasBazi(){return!!this.Bazi}get Index(){return this.index}get Length(){return(this.recordes||[]).length}get Content(){return this.content||[]}ShowHideCode(){this.HiddenCode=!this.HiddenCode,!0===this.HiddenCode&&(this.guaview?this.HiddenTitel=`${this.guaview.GuaInText} \u95ee: ${this.Record.titel}`:this.baziview&&(this.HiddenTitel=`${this.Record.titel}(${this.baziview.Gender}): ${this.baziview.BaziInText}`))}NextRecord(t){this.index=this.index+t,this.recid=this.recordes[this.Index].id,this.updateRecord()}AddContent(t){return Object(d.b)(this,void 0,void 0,(function*(){this.EditContent({type:t,time:0,text:""})}))}EditContent(t){return Object(d.b)(this,void 0,void 0,(function*(){const e=yield this.modalCtrl.create({component:m,componentProps:{Content:Object(r.b)(t)}});yield e.present();const{data:i}=yield e.onWillDismiss();"cancel"!==i&&("delete"===i?this.content=this.content.filter(e=>e!==t):0===i.time?(i.time=Date.now(),this.content.push(i)):(t.time=Date.now(),t.text=i.text),"cancel"!==i&&(this.Record.content=JSON.stringify(this.content),this.dbservice.SaveRecord(this.Record.id,this.Record.node,{content:JSON.stringify(this.content)})))}))}EidtTitel(){return Object(d.b)(this,void 0,void 0,(function*(){let t=!1;const e=yield this.alertCtrl.create({header:"\u95ee\u5ff5\uff0f\u540d\u5b57",inputs:[{name:"titel",type:"text",id:"titel-id",value:this.Record.titel}],buttons:[{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary"},{text:"\u786e\u5b9a",handler:()=>{t=!0}}]});yield e.present();const{data:i}=yield e.onWillDismiss();if(t){const t=i.values.titel;this.Record.titel=t,this.guaview?(this.gua.question=t,this.Record.arg=JSON.stringify(this.gua),this.guaview.Titel="\u95ee\u5ff5\uff1a"+t):this.baziview&&(this.bazi.person=t,this.Record.arg=JSON.stringify(this.bazi),this.baziview.Person=`${t} (${this.baziview.Gender}\u9020)`),this.dbservice.SaveRecord(this.Record.id,this.Record.node,{titel:t,arg:this.Record.arg})}}))}updateRecord(){const t=this.Record;8===t.type?(this.gua=JSON.parse(t.arg),this.bazi=null):16===t.type&&(this.bazi=JSON.parse(t.arg),this.gua=null),this.content=JSON.parse(t.content||"[]")}}return t.\u0275fac=function(e){return new(e||t)(b.Zb(o.a),b.Zb(u.a),b.Zb(r.a),b.Zb(s.b),b.Zb(s.cb))},t.\u0275cmp=b.Tb({type:t,selectors:[["app-recordviewer"]],viewQuery:function(t,e){var i;1&t&&(b.Oc(a.a,!0),b.Oc(l.a,!0)),2&t&&(b.yc(i=b.nc())&&(e.baziview=i.first),b.yc(i=b.nc())&&(e.guaview=i.first))},decls:11,vars:8,consts:[[4,"ngIf"],[3,"suiCollapse",4,"ngIf"],[3,"suiCollapse"],[2,"margin-bottom","3px"],[3,"Config","BaziText",4,"ngIf"],[3,"Config","GuaText",4,"ngIf"],["lines","inset","detail","","class","ion-text-wrap",3,"click",4,"ngFor","ngForOf"],["slot","start",3,"hidden"],["defaulthref","","text","\u8fd4\u56de"],["slot","end"],[3,"click"],[3,"name"],["slot","start"],["routerLink","/menu/nodes","routerDirection","root"],["size","small","slot","start","fill","clear",3,"disabled","click"],["slot","icon-only","name","ios-arrow-back"],["size","small",3,"click"],["name","add"],["name","md-clipboard"],["size","small","slot","end","fill","clear",3,"disabled","click"],["slot","icon-only","name","ios-arrow-forward"],[1,"ui","segment",2,"margin-bottom","3px"],[3,"Config","BaziText"],[3,"Config","GuaText"],["lines","inset","detail","",1,"ion-text-wrap",3,"click"],[1,"ion-text-wrap"],[3,"innerHtml"]],template:function(t,e){1&t&&(b.Hc(0,w,9,3,"ion-header",0),b.Hc(1,v,27,3,"ion-toolbar",0),b.ec(2,"ion-content"),b.Hc(3,x,3,2,"div",1),b.ec(4,"div",2),b.ec(5,"div",3),b.Hc(6,y,1,2,"app-baziview",4),b.Hc(7,N,1,2,"app-guaview",5),b.dc(),b.dc(),b.ec(8,"ion-list"),b.Hc(9,z,9,6,"ion-item",6),b.dc(),b.dc(),b.Hc(10,H,23,2,"ion-footer",0)),2&t&&(b.wc("ngIf",!e.IsWeb),b.Nb(1),b.wc("ngIf",e.IsWeb),b.Nb(2),b.wc("ngIf",e.HasGua||e.HasBazi),b.Nb(1),b.wc("suiCollapse",e.HiddenCode),b.Nb(2),b.wc("ngIf",e.HasBazi),b.Nb(1),b.wc("ngIf",e.HasGua),b.Nb(2),b.wc("ngForOf",e.Content),b.Nb(1),b.wc("ngIf",!e.IsWeb))},directives:[n.j,s.n,p.c,s.E,n.i,s.t,s.Y,s.j,s.f,s.g,s.W,s.i,s.u,s.gb,o.h,s.T,a.a,l.a,s.x,s.H,s.D,s.r],pipes:[C],styles:[""]}),t})();var I=i("uEAi"),O=i("n7QD");i.d(e,"RecordviewerPageModule",(function(){return J}));const R=[{path:"",component:k}];let J=(()=>{class t{}return t.\u0275mod=b.Xb({type:t}),t.\u0275inj=b.Wb({factory:function(e){return new(e||t)},imports:[[I.a,O.a,f.b,p.e,n.b,c.c,s.Z,o.j.forChild(R)]]}),t})()}}]);