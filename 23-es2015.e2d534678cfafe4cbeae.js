(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{"+eMj":function(t,e,s){"use strict";s.r(e);var i=s("ofXK"),n=s("3Pt+"),r=s("tyNb"),o=s("c7TG"),a=s("mrSG"),h=s("LTmD"),u=s("PKx9"),c=s("Y6BA"),l=s("HULg"),d=s("lEof"),g=s("fXoL");function p(t,e){if(1&t){const t=g.fc();g.ec(0,"ion-buttons",7),g.ec(1,"ion-button",8),g.mc("click",(function(){g.Ac(t);const e=g.pc();return e.AutoHide=!e.AutoHide})),g.ac(2,"ion-icon",9),g.dc(),g.dc()}}function f(t,e){if(1&t&&(g.ec(0,"ion-menu-toggle"),g.ec(1,"ion-item",10),g.ac(2,"ion-icon",11),g.ec(3,"ion-label"),g.Hc(4),g.dc(),g.dc(),g.dc()),2&t){const t=e.$implicit,s=g.pc();g.Ob("auto-hide",s.AutoHide),g.Nb(1),g.Qb("active-item",s.selectedPath.startsWith(t.url)),g.uc("routerLink",t.url),g.Nb(1),g.uc("name",t.icon),g.Nb(2),g.Jc(" ",t.title," ")}}let m=(()=>{class t{constructor(t,e,s,i,n,r,o){this.router=t,this.platform=e,this.toastController=s,this.forumservice=i,this.host=n,this.nanodb=r,this.settings=o,this.selectedPath="",this.pages=[{title:"\u6392\u76d8",url:"/menu/paipan",icon:"home"},{title:"\u7f57\u76d8",url:"/menu/compass",icon:"compass"},{title:"\u6848\u4f8b",url:"/menu/nodes",icon:"list"},{title:"\u8ba8\u8bba\u533a",url:"/menu/forum",icon:"chatbubbles"},{title:"\u7528\u6237",url:"/menu/user",icon:"person"},{title:"\u8bbe\u7f6e",url:"/menu/setting",icon:"settings"}],this.CanQuit=!1,this.AutoHide=!0,this.platform.width()<768&&(this.AutoHide=!1)}get IsSmallScreen(){return this.settings.IsSmallScreen}ngOnInit(){return Object(a.b)(this,void 0,void 0,(function*(){yield this.settings.WaitInit(),this.platform.platforms(),this.nanodb.initNano(),navigator.app||(this.CanQuit=!0),this.settings.IsDevice||this.settings.IsSmallScreen||(this.AutoHide=!1),this.settings.HasUser&&this.settings.User.id!==c.a.id&&(this.updateAppSetting(),this.forumservice.HoldPublicMessage().then(t=>{t>0&&this.presentToast(`\u60a8\u6709 ${t} \u6761\u672a\u8bfb\u6d88\u606f, \u8bf7\u53ca\u65f6\u67e5\u6536\u3002`,5e3)}),this.pages.insert(3,{title:"\u6211\u7684\u6d88\u606f",url:"/menu/messagelist/false",icon:"chatboxes"}))}))}get HasUser(){return this.settings.HasUser}updateAppSetting(){this.host.GetAppSetting().then(t=>{this.settings.AppConfig.appSetting=t.appSetting,console.log("Get AppSetting",this.settings.AppConfig)}).catch(t=>{console.log("Get AppSetting failed",t)})}closeApp(){navigator.app?navigator.app.exitApp():console.log("platforms",this.platform.platforms(),navigator)}presentToast(t,e){return Object(a.b)(this,void 0,void 0,(function*(){(yield this.toastController.create({message:t,duration:e,color:"secondary",position:"middle"})).present()}))}}return t.\u0275fac=function(e){return new(e||t)(g.Zb(r.g),g.Zb(o.hb),g.Zb(o.mb),g.Zb(u.a),g.Zb(d.a),g.Zb(l.a),g.Zb(h.a))},t.\u0275cmp=g.Tb({type:t,selectors:[["app-menu"]],viewQuery:function(t,e){var s;1&t&&g.Mc(r.j,!0),2&t&&g.wc(s=g.nc())&&(e.outlet=s.first)},decls:14,vars:4,consts:[["contentId","content",3,"disabled"],["contentId","content"],["slot","end",4,"ngIf"],[4,"ngFor","ngForOf"],["tappable","",3,"hidden","click"],["name","exit","slot","start"],["id","content"],["slot","end"],[3,"click"],["name","swap"],["routerDirection","root",3,"routerLink"],["slot","start",3,"name"]],template:function(t,e){1&t&&(g.ec(0,"ion-split-pane",0),g.ec(1,"ion-menu",1),g.ec(2,"ion-header"),g.ec(3,"ion-toolbar"),g.ec(4,"ion-text"),g.Hc(5,"\u534e\u9e64\u6613\u5b66"),g.dc(),g.Fc(6,p,3,0,"ion-buttons",2),g.dc(),g.dc(),g.ec(7,"ion-content"),g.ec(8,"ion-list"),g.Fc(9,f,5,6,"ion-menu-toggle",3),g.ec(10,"ion-item",4),g.mc("click",(function(){return e.closeApp()})),g.ac(11,"ion-icon",5),g.Hc(12," \u9000\u51fa "),g.dc(),g.dc(),g.dc(),g.dc(),g.ac(13,"ion-router-outlet",6),g.dc()),2&t&&(g.uc("disabled",e.AutoHide),g.Nb(6),g.uc("ngIf",!e.IsSmallScreen),g.Nb(3),g.uc("ngForOf",e.pages),g.Nb(1),g.uc("hidden",e.CanQuit))},directives:[o.V,o.G,o.t,o.bb,o.W,i.j,o.n,o.E,i.i,o.x,o.u,o.N,o.j,o.i,o.I,o.jb,r.h,o.D],styles:["ion-menu[_ngcontent-%COMP%]{--max-width:200px}"]}),t})();s.d(e,"MenuPageModule",(function(){return v}));const b=[{path:"",component:m,children:[{path:"paipan",loadChildren:"../paipan/paipan.module#PaipanPageModule"},{path:"recordes/:id",loadChildren:"../recordes/recordes.module#RecordesPageModule"},{path:"nodes",loadChildren:"../nodes/nodes.module#NodesPageModule"},{path:"forum",loadChildren:"../../forum/forum/forum.module#ForumPageModule"},{path:"topiclist/:forumid",loadChildren:"../../forum/topiclist/topiclist.module#TopiclistPageModule"},{path:"topicdetail/:forumid/:topicid",loadChildren:"../../forum/topicviewer/topicviewer.module#TopicviewerPageModule"},{path:"topicpanfu/:arg",loadChildren:"../../forum/panfuviewer/panfuviewer.module#PanfuviewerPageModule"},{path:"messagelist/:naviback",loadChildren:"../../forum/messagelist/messagelist.module#MessagelistPageModule"},{path:"user",loadChildren:"../../user/userprofil/userprofil.module#UserprofilPageModule"},{path:"searchuser",loadChildren:"../../user/searchuser/searchuser.module#SearchuserPageModule"},{path:"setting",loadChildren:"../setting/setting.module#SettingPageModule"},{path:"recordview/:nodeid/:recid",loadChildren:"../recordviewer/recordviewer.module#RecordviewerPageModule"},{path:"compass",loadChildren:"../compass/compass.module#CompassPageModule"}]}];let v=(()=>{class t{}return t.\u0275mod=g.Xb({type:t}),t.\u0275inj=g.Wb({factory:function(e){return new(e||t)},imports:[[i.b,n.c,o.cb,r.i.forChild(b)]]}),t})()},"0eVs":function(t,e){},"2QJI":function(t,e,s){"use strict";s.d(e,"a",(function(){return c})),s.d(e,"c",(function(){return g})),s.d(e,"d",(function(){return p})),s.d(e,"b",(function(){return f}));var i=s("ZtG1");let n=(()=>{class t{constructor(t,e){this.index=t,this.name=e}get Name(){return this.name}get Index(){return this.index}get WuXing(){let t=Math.floor(this.Index/2);return t=(t+2)%5,Object(i.a)(t)}get ChangSheng(){return this.GetChangSheng(null)}get QiYueGan(){let t=this.Index%5*2;return t=(t+2)%10,t}get QiShiGan(){return this.Index%5*2}Ref(e,s=!1){let i=!t.HuahePianCai;s&&(i=!s);const n=this.Index%2==e.Index%2,r=this.WuXing,o=e.WuXing;return r.Ke===o.Index?n?["\u4e03\u6740","\u6740"]:["\u6b63\u5b98","\u5b98"]:r.Sheng===o.Index?n?["\u67ad\u795e","\u67ad"]:["\u6b63\u5370","\u5370"]:o.Ke===r.Index?n!==i?["\u6b63\u8d22","\u8d22"]:["\u504f\u8d22","\u624d"]:o.Sheng===r.Index?n?["\u98df\u795e","\u98df"]:["\u4f24\u5b98","\u4f24"]:n?["\u6bd4\u80a9","\u6bd4"]:["\u52ab\u8d22","\u52ab"]}GetChangSheng(e){let s=t.Shuitugongchangsheng;e&&(s=e);const i=s?t.changshengIndexes_shuitu:t.changshengIndexes;return this.Index%2==0?i[Math.floor(this.Index/2)]:(i[Math.floor((this.Index-1)/2)]+7)%12}}return t.changshengIndexes=[11,2,2,5,8],t.changshengIndexes_shuitu=[11,2,8,5,8],t.Shuitugongchangsheng=!1,t.HuahePianCai=!1,t})();const r=new Array;function o(){10!==r.length&&(r.push(new n(0,"\u7532")),r.push(new n(1,"\u4e59")),r.push(new n(2,"\u4e19")),r.push(new n(3,"\u4e01")),r.push(new n(4,"\u620a")),r.push(new n(5,"\u5df1")),r.push(new n(6,"\u5e9a")),r.push(new n(7,"\u8f9b")),r.push(new n(8,"\u58ec")),r.push(new n(9,"\u7678")))}let a=(()=>{class t{constructor(t,e,s,i=null){this.index=t,this.name=e,this.gans=s,this.gans2=i,i||(this.gans2=this.gans)}get Name(){return this.name}get Index(){return this.index}get WuXing(){switch(this.Index){case 2:case 3:return Object(i.a)("\u6728");case 5:case 6:return Object(i.a)("\u706b");case 8:case 9:return Object(i.a)("\u91d1");case 0:case 11:return Object(i.a)("\u6c34");default:return Object(i.a)("\u571f")}}get CGan(){const t=new Array,e=n.HuahePianCai?this.gans:this.gans2;for(const s of e)t.push(l(s));return t}ChangSheng(t){return this.GetChangSheng(t,void 0)}Ref(t){const e=this.Index%2==t.Index%2,s=this.WuXing,i=t.WuXing;return s.Ke===i.Index?e?["\u4e03\u6740","\u6740"]:["\u6b63\u5b98","\u5b98"]:s.Sheng===i.Index?e?["\u6b63\u5370","\u5370"]:["\u67ad\u795e","\u67ad"]:i.Ke===s.Index?e?["\u6b63\u8d22","\u8d22"]:["\u504f\u8d22","\u624d"]:i.Sheng===s.Index?e?["\u4f24\u5b98","\u4f24"]:["\u98df\u795e","\u98df"]:e?["\u6bd4\u80a9","\u6bd4"]:["\u52ab\u8d22","\u52ab"]}GetChangSheng(e,s){const i=e.GetChangSheng(s),n=e.Index%2==0?1:-1;for(let r=0;r<12;r++)if((i+r*n+12)%12===this.Index)return t.changShengDefs[r];return"Error"}}return t.changShengDefs=["\u957f\u751f","\u6c90\u6d74","\u51a0\u5e26","\u4e34\u5b98","\u5e1d\u65fa","\u8870","\u75c5","\u6b7b","\u5893","\u7edd","\u80ce","\u517b"],t})();const h=new Array;function u(){12!==h.length&&(h.push(new a(0,"\u5b50",[9])),h.push(new a(1,"\u4e11",[9,7,5])),h.push(new a(2,"\u5bc5",[0,2,5],[0,2,4])),h.push(new a(3,"\u536f",[1])),h.push(new a(4,"\u8fb0",[1,4,9])),h.push(new a(5,"\u5df3",[2,4,6])),h.push(new a(6,"\u5348",[3],[3,5])),h.push(new a(7,"\u672a",[1,3,5])),h.push(new a(8,"\u7533",[5,6,8])),h.push(new a(9,"\u9149",[7])),h.push(new a(10,"\u620c",[3,4,7])),h.push(new a(11,"\u4ea5",[0,4,8],[0,8])))}class c{static get ChangSheng(){return n.Shuitugongchangsheng}static set ChangSheng(t){n.Shuitugongchangsheng=t||!1}static get Huahe(){return n.HuahePianCai}static set Huahe(t){n.HuahePianCai=t||!1}}function l(t){if(o(),"string"==typeof t){const e=r.filter(e=>e.Name===t);if(1===e.length)return e[0]}else if("number"==typeof t&&t>=0&&t<=9)return r[t];throw new Error("Parameter Error of Gan: "+t+" is not valiad")}function d(){return o(),r.map(t=>t.Name)}function g(t){if(u(),"string"==typeof t){"\u620d"===t&&(t="\u620c");const e=h.filter(e=>e.Name===t);if(1===e.length)return e[0]}else if("number"==typeof t&&t>=0&&t<=11)return h[t];throw new Error("Parameter Error of Gan: "+t+" is not valiad")}function p(){return u(),h.map(t=>t.Name)}let f=(()=>{class t{constructor(t){if(Array.isArray(t)&&2===t.length)this.Gan=l(t[0]),this.Zhi=g(t[1]);else if("string"==typeof t)this.Gan=2===t.length?l(t.substring(0,1)):null,this.Zhi=g(2===t.length?t.substring(1,2):t.substring(0,1));else if("number"==typeof t&&t>=0&&t<=59){const e=t%12;this.Gan=l(t%10),this.Zhi=g(e)}if(this.Config(n.Shuitugongchangsheng,n.HuahePianCai),null==this.Zhi||void 0===this.Zhi)throw new Error("GanZhi Error: parameter "+t+" is not valid.")}static get GanZhiNames(){const t=d(),e=p(),s=new Array;for(let i=0;i<t.length;i++)for(let n=0;n<e.length;n++)i%2==n%2&&s.push(t[i]+e[n]);return s}get Name(){return this.Gan?this.Gan.Name+this.Zhi.Name:this.Zhi.Name}get Index(){return this.Gan?this.calcIndex(this.Gan.Index,this.Zhi.Index):this.Zhi.Index}get NaYin(){return null==this.Gan?"":t.NaYins[Math.floor(this.Index/2)]}get Shen10Gan(){if(!this.Base)throw new Error("BaseGan is not defined.");return this===this.Base?["\u65e5\u4e3b","\u65e5"]:this.Gan.Ref(this.Base.Gan,this.huahe)}get Shen10Zhi(){if(!this.Base)throw new Error("BaseGan is not defined.");return this.Zhi.Ref(this.Base.Gan)}get ChangSheng(){return this.Base?this.Zhi.GetChangSheng(this.Base.Gan,this.shuitu):""}Config(t,e){this.shuitu=t||!1,this.huahe=e||!1}calcIndex(t,e){let s=(e-t+12)%12/2;return s=(6-s)%6*10,s+t}}return t.NaYins=["\u6d77\u4e2d\u91d1","\u7089\u4e2d\u706b","\u5927\u6797\u6728","\u8def\u65c1\u571f","\u5251\u5cf0\u91d1","\u5c71\u5934\u706b","\u6da7\u4e0b\u6c34","\u57ce\u5899\u571f","\u767d\u8721\u91d1","\u6768\u67f3\u6728","\u6cc9\u4e2d\u6c34","\u5c4b\u4e0a\u571f","\u9739\u96f3\u706b","\u677e\u67cf\u6728","\u957f\u6d41\u6c34","\u6c99\u4e2d\u91d1","\u5c71\u4e0b\u706b","\u5e73\u5730\u6728","\u58c1\u4e0a\u571f","\u91d1\u7b94\u91d1","\u4f5b\u706f\u706b","\u5929\u6cb3\u6c34","\u5927\u9a7f\u571f","\u9497\u948f\u91d1","\u6851\u677e\u6728","\u5927\u6eaa\u6c34","\u6c99\u4e2d\u571f","\u5929\u4e0a\u706b","\u77f3\u69b4\u6728","\u5927\u6d77\u6c34"],t})()},LTmD:function(t,e,s){"use strict";s.d(e,"a",(function(){return u})),s.d(e,"c",(function(){return c})),s.d(e,"b",(function(){return l}));var i=s("FAH8"),n=s("c7TG"),r=(s("0eVs"),s("2QJI")),o=s("2Vo4"),a=s("fXoL"),h=s("e8h1");let u=(()=>{class t{constructor(t,e,s){this.storage=t,this.file=e,this.plateform=s,this.user=null,this.lastsync=0,this.encryp="false",this.dbReady=new o.a(!1),this.dbReady.next(!1),this.ReadSettingFromDB().then(t=>{console.log("Device width",s.width(),s.height())}).finally(()=>{this.dbReady.next(!0)})}get IsDevice(){return this.plateform.is("mobile")&&!this.plateform.is("mobileweb")}get IsSmallScreen(){return this.plateform.width()<768||this.plateform.isPortrait()}get DeviceHeight(){return this.plateform.height()}get DeviceWidth(){return this.plateform.width()}Avatar(t=null){return"female"===(t||"")?"assets/img/user_female.png":"assets/img/user_male.png"}get InitState(){return this.dbReady.asObservable()}get AppConfig(){return this.appconfig||t.default_appconfig}set AppConfig(e){this.appconfig=e,this.storage.set(t.APP_CONFIG,this.appconfig)}get Encryp(){return"true"===this.encryp.toLowerCase()}set Encryp(e){this.encryp=e?"true":"false",this.storage.set(t.USER_ENCRYP,this.encryp)}get Gua(){return this.gua||t.defalt_gua_setting}set Gua(e){this.gua=e||t.defalt_gua_setting,this.storage.set(t.DB_GUA,this.gua)}get Bazi(){return this.bazi||t.default_bazi_setting}set Bazi(e){this.bazi=e||t.default_bazi_setting,r.a.ChangSheng=this.bazi.shuitu,r.a.Huahe=this.bazi.huahecai,this.storage.set(t.DB_BAZI,this.bazi)}get HasUser(){return!!this.User&&!!this.User.id&&""!==this.User.id}get User(){return this.user}set User(e){this.user=e,e?this.storage.set(t.DB_USER,this.user):(this.user=null,this.storage.remove(t.DB_USER))}UserRolers(t=null){const e=[];return(1&(t=t||0))>0&&e.push({name:"\u6ce8\u518c\u7528\u6237",icon:"assets/img/roles/r_register.png",value:1}),(2&t)>0&&e.push({name:"VIP",icon:"assets/img/roles/r_vip.png",value:2}),(4&t)>0&&e.push({name:"\u534e\u9e64\u540c\u95e8",icon:"assets/img/huahe.jpg",value:4}),(8&t)>0&&e.push({name:"\u7248\u4e3b",icon:"assets/img/roles/r_admin.png",value:8}),(16&t)>0&&e.push({name:"\u516d\u723b",icon:"assets/img/roles/r_master.png",value:16}),(64&t)>0&&e.push({name:"\u98ce\u6c34",icon:"assets/img/roles/r_master.png",value:64}),(32&t)>0&&e.push({name:"\u547d\u7406",icon:"assets/img/roles/r_master.png",value:32}),(128&t)>0&&e.push({name:"\u5927\u5b97\u5e08",icon:"assets/img/roles/r_supermaster.png",value:128}),(256&t)>0&&e.push({name:"\u7ba1\u7406\u5458",icon:"assets/img/roles/r_admin.png",value:256}),e}get LastSync(){return this.lastsync}set LastSync(e){this.lastsync=e,this.storage.set(t.DB_LASTSYNC,e)}WaitInit(){return new Promise((t,e)=>{this.InitState.subscribe(e=>{e&&t(!0)})})}ReadSettingFromDB(){const e=this.storage.get(t.APP_CONFIG).then(t=>{this.appconfig=t}).catch(t=>t),s=this.storage.get(t.DB_GUA).then(t=>{this.Gua=t,this.gua.symbol=this.gua.symbol||0}).catch(t=>t),i=this.storage.get(t.DB_BAZI).then(t=>{this.Bazi=t}).catch(t=>t),n=this.storage.get(t.DB_USER).then(t=>{this.user=t||{id:null,created:null,modified:null,lastlogin:null,name:null,password:null,email:null,phone:null,vip:null,roller:null,verified:null}}).catch(t=>t),r=this.storage.get(t.DB_LASTSYNC).then(t=>{this.lastsync=t}).catch(t=>t),o=this.storage.get(t.USER_ENCRYP).then(t=>{this.encryp=t||this.encryp}).catch(t=>t),a=this.storage.get(t.FORUM_SET).then(t=>{this.forum=t}).catch(t=>t);return Promise.all([e,s,i,n,r,o,a]).then(t=>t)}ResetDB(){return this.storage.clear()}ShowData(t){"*"!==t?this.storage.get(t).then(e=>{if(e){const s=function(t){try{return"string"==typeof t?JSON.parse(t):t}catch(e){return null}}(e)||e;console.log(`Show ${t}`,s)}else console.log(`Show ${t}`,e)}).catch(e=>{console.log(`Show ${t} failed`,e)}):this.storage.keys().then(t=>{console.log(t)})}}return t.SAVELOCAL="local",t.SAVEBLOBAL="global",t.GUASYMBOLS=[["\u25fc\ufe0e\u25fb\ufe0e\u25fc\ufe0e","\u25fc\ufe0e\u25fc\ufe0e\u25fc\ufe0e","\u25fc\ufe0e&ensp;\u25fc\ufe0e"],["=","-","="]],t.Product=!1,t.DB_BAZI="bazi_setting",t.DB_GUA="gua_setting",t.DB_USER="userinfo",t.DB_LASTSYNC="lastsync",t.APP_CONFIG="appconfig",t.USER_ENCRYP="encryp",t.FORUM_SET="forum_setting",t.defalt_gua_setting={fontsize:15,shensha:4,shortname:!1,symbol:0},t.default_bazi_setting={fontsize:15,shortname:!0,shuitu:!0,shensha:4,huahecai:!0,yuanju:{cangan:!0,nayin:!0,changshen:!0},shiyun:{cangan:!1,nayin:!1,changshen:!1,shensha:!1}},t.default_forum_setting={showimg:!0,showgua:!1,showbazi:!1,imgOut:!1,guaOut:!1,baziOut:!0},t.default_appconfig={app:{version:"2.0.1",accessToken:"as%3aRdE87!08jR\xf6",serverUrl:"https://1051463780297201.cn-hangzhou.fc.aliyuncs.com/2016-08-15/proxy/huaheservice/sqlquery"},website:"https://maiernte.gitee.io/huahe",document:"https://maiernte.gitee.io/huahedocument"},t.\u0275fac=function(e){return new(e||t)(a.ic(h.b),a.ic(i.a),a.ic(n.hb))},t.\u0275prov=a.Vb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function c(t,e){const s=Object.getOwnPropertyNames(t),i=Object.getOwnPropertyNames(e);if(s.length!==i.length)return!1;for(let n=0;n<s.length;n++){const i=s[n];if("object"!=typeof t[i]){if(t[i]!==e[i])return!1}else if(!1===c(t[i],e[i]))return!1}return!0}function l(t){if(!t)return t;let e;if([Number,String,Boolean].forEach(s=>{t instanceof s&&(e=s(t))}),void 0===e)if("[object Array]"===Object.prototype.toString.call(t))e=[],t.forEach((t,s,i)=>{e[s]=l(t)});else if("object"==typeof t)if(t.nodeType&&"function"==typeof t.cloneNode)e=t.cloneNode(!0);else if(t.prototype)e=t;else if(t instanceof Date)e=new Date(t);else{e={};for(const s in t)e[s]=l(t[s])}else e=t;return e}},PKx9:function(t,e,s){"use strict";var i=s("mrSG"),n=s("LTmD"),r=s("lEof");s("aGhr");class o{constructor(){this.topics=[]}Reset(){this.topics=[]}GetPage(t,e=0){const s=this.topics.find(s=>s.forumid===t&&e===s.page);return s?{data:s.items,sum:s.sum}:null}SetPage(t,e,s,i){const n=this.topics.find(s=>s.forumid===t&&e===s.page);n?n.items=s:this.topics.push({forumid:t,page:e,items:s,sum:i})}GetTopic(t){for(const e of this.topics){const s=e.items.find(e=>e.id===t);if(s)return s}return null}SetTopic(t,e){const s=this.GetPage(e,0);s?s.data.insert(0,t):this.SetPage(e,0,[t],1)}DeleteTopic(t,e){if(e);else for(const s of this.topics)s.items.find(e=>e.id===t)&&(s.items=s.items.filter(e=>e.id!==t))}UpdateTopic(t){const e=this.GetTopic(t.id);if(e)for(let s in t)e[s]=t[s]}}var a=s("Y6BA"),h=(s("0eVs"),s("fXoL"));s.d(e,"a",(function(){return u}));let u=(()=>{class t{constructor(t,e){this.settings=t,this.host=e,this.vusers=[],this.currentTopics=[],this.ForumMG=new o}get User(){return this.settings.User||a.a}get VUsers(){return this.vusers=this.vusers||[],this.vusers=this.vusers.filter(t=>!!t)||[],this.vusers}set VUsers(t){this.vusers=t||[]}ForumList(t=!1){return Object(i.b)(this,void 0,void 0,(function*(){return this.ForumMG.Forumlist&&!1===t?Promise.resolve(this.ForumMG.Forumlist):(yield this.settings.WaitInit(),this.LoadForumList())}))}LoadTopicList(t,e,s){return Object(i.b)(this,void 0,void 0,(function*(){let i=t||"forum_"+s;i=-2===s?t+"good":i;const n=-1===s?s:e,r=this.ForumMG.GetPage(i,n);if(r)return Promise.resolve(r);const o={func:"TopicList",forumid:t,params:{filter:{},startColumn:20*e,private:!1}};return-1===s?o.params.filter.top=1:-2===s?o.params.filter.good=!0:-3===s?(o.params.filter.author=this.User.id,o.params.filter.topic=null):-4===s?(o.params.filter.author=this.User.id,o.params.filter.topic=null,o.params.private=!0):-5===s?(o.params.filter.forumid=this.User.id,o.params.filter.topic=null,o.params.private=!0):o.params.filter.top=0,t&&(o.params.filter.forumid=t),this.host.ForumRequest(this.User.id,this.User.password,o).then(t=>(t&&t.data&&this.ForumMG.SetPage(i,n,t.data,t.sum),t)).catch(t=>Promise.reject(t))}))}LoadAnswerList(t,e,s){return Object(i.b)(this,void 0,void 0,(function*(){return this.host.ForumRequest(this.User.id,this.User.password,{func:"TopicList",forumid:e,params:{filter:{topic:t},sort:"created",startColumn:20*s,direction:1}}).then(t=>t).catch(t=>Promise.reject(t))}))}NewTopic(t,e){return Object(i.b)(this,void 0,void 0,(function*(){return this.host.ForumRequest(this.User.id,this.User.password,{func:"NewTopic",forumid:t,params:e}).then(t=>t).catch(t=>Promise.reject(t))}))}GetTopic(t,e){return Object(i.b)(this,void 0,void 0,(function*(){const s=this.ForumMG.GetTopic(e);return s?Promise.resolve(s):this.host.ForumRequest(this.User.id,this.User.password,{func:"GetTopic",forumid:t||"",params:{topicid:e||"",private:!1}}).then(t=>Object(i.b)(this,void 0,void 0,(function*(){const e=yield t,s=yield this.GetUserInfo(e.author),i=(s||a.a).avatar||"";return e.avatar=i.IsNullOrEmpty()?this.settings.Avatar(s.gender):i,e.showImg=!0,e.showGua=!0,e.showBazi=!0,t}))).catch(t=>Promise.reject(t))}))}UpdatForum(t,e){return Object(i.b)(this,void 0,void 0,(function*(){return this.host.ForumRequest(this.User.id,this.User.password,{func:"UpdateForum",params:{id:e,data:t}}).then(t=>t).catch(t=>(console.log("updat failed",t),Promise.reject(t)))}))}UpdateTopic(t,e,s){return Object(i.b)(this,void 0,void 0,(function*(){return this.host.ForumRequest(this.User.id,this.User.password,{func:"Update",params:{id:e,private:s,data:t}}).then(t=>t).catch(t=>(console.log("updat failed",t),Promise.reject(t)))}))}GetUserInfo(t,e=-1){const s=this.VUsers.find(e=>e.id===t);return s?Promise.resolve(s):this.host.ForumRequest(this.User.id,this.User.password,{func:"GetVUser",author:t,roller:e}).then(t=>(this.VUsers.push(t),t)).catch(t=>Promise.reject(t))}DeleteTopic(t,e){return this.host.ForumRequest(this.User.id,this.User.password,{func:"DeleteTopic",params:{topicid:t}}).then(s=>(this.ForumMG.DeleteTopic(t,e),s)).catch(t=>Promise.reject(t))}SendMessage(t){return this.host.ForumRequest(this.User.id,this.User.password,{func:"SendMessage",params:{message:t}}).then(t=>t).catch(t=>Promise.reject(t))}LoadMessages(t,e){return Object(i.b)(this,void 0,void 0,(function*(){return this.host.ForumRequest(this.User.id,this.User.password,{func:"MessageList",params:{pageindex:t,forme:e}}).then(t=>t).catch(t=>Promise.reject(t))}))}DeleteMessage(t,e){return Object(i.b)(this,void 0,void 0,(function*(){return this.host.ForumRequest(this.User.id,this.User.password,{func:"DeleteMessage",params:{msgid:t,todelete:e}}).then(t=>t).catch(t=>Promise.reject(t))}))}HoldPublicMessage(){return Object(i.b)(this,void 0,void 0,(function*(){return yield this.initial(),this.host.ForumRequest(this.User.id,this.User.password,{func:"HoldPublicMsg"}).then(t=>t).catch(t=>Promise.reject(t))}))}UpgradUser(t,e){return Object(i.b)(this,void 0,void 0,(function*(){return yield this.initial(),this.host.ForumRequest(this.User.id,this.User.password,{func:"UpgradeUser",params:{id:t,data:e}}).then(t=>t).catch(t=>Promise.reject(t))}))}initial(){return Object(i.b)(this,void 0,void 0,(function*(){return this.User||(yield this.settings.WaitInit()),!0}))}LoadForumList(){return this.host.ForumRequest(this.User.id,this.User.password,{func:"ForumList"}).then(t=>(this.ForumMG.Forumlist=t,t)).catch(t=>Promise.reject(t))}}return t.\u0275fac=function(e){return new(e||t)(h.ic(n.a),h.ic(r.a))},t.\u0275prov=h.Vb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},Y6BA:function(t,e,s){"use strict";s.d(e,"a",(function(){return i})),s.d(e,"c",(function(){return n})),s.d(e,"b",(function(){return r})),String.prototype.int2str=function(t,e){let s=this.toString(null==e||void 0===e?2:e);if(s.length>=t)return s;for(;s.length<t;)s="0"+s;return s},String.prototype.parseDate=function(){const t=this.replace(/[\u5e74\u6708\u65e5\u65f6\u5206\u79d2:\uff1a,\uff0c\ \/-]/g,"|").split("|").removeEmpty().select(t=>parseInt(t,10));return new Date(t[0],t[1]-1,t[2],t[3]||0,t[4]||0,t[5]||0)},String.prototype.IsNullOrEmpty=function(){return void 0===this||null==this||""===this},Array.prototype.select=function(t){const e=[];return this.forEach(s=>{e.push(t(s))}),e},Array.prototype.where=function(t){const e=[];return this.forEach(s=>{t(s)&&e.push(s)}),e},Array.prototype.distinct=function(){const t={},e=[];for(let s=0,i=this.length;s<i;++s)t.hasOwnProperty(this[s])||(e.push(this[s]),t[this[s]]=1);return e},Array.prototype.insert=function(t,e){this.splice(t,0,e)},Array.prototype.removeEmpty=function(){return this.filter(t=>!!t&&""!==(t||"").toString())},Array.prototype.sortByKey=function(t){return this.sort((e,s)=>{const i=e[t]||0,n=s[t]||0;return i<n?-1:i>n?1:0})},Date.prototype.toChinaStr=function(t=!1){let e=this.getFullYear()+"\u5e74"+(this.getMonth()+1)+"\u6708"+this.getDate()+"\u65e5";return!0===t&&(e+=" "+this.getHours().toString().int2str(2,10)+"\u65f6",e+=this.getMinutes().toString().int2str(2,10)+"\u5206",e+=this.getSeconds().toString().int2str(2,10)+"\u79d2"),e},Date.prototype.toDatabaseStr=function(){let t=this.getFullYear()+"-"+(this.getMonth()+1).toString().int2str(2,10)+"-"+this.getDate().toString().int2str(2,10);return t+=" "+this.getHours().toString().int2str(2,10)+":",t+=this.getMinutes().toString().int2str(2,10)+":",t+=this.getSeconds().toString().int2str(2,10),t};const i={id:"anonym",created:0,modified:0,lastlogin:0,name:null,password:"",email:null,phone:null,vip:0,verified:0,encryp:"null",roller:0,avatar:"assets/img/user_male.png"};function n(t,e,s){return s.indexOf(t)===e}function r(t=null){const e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)});return t&&"number"==typeof t?e.substring(0,t):e}},ZtG1:function(t,e,s){"use strict";s.d(e,"a",(function(){return r}));class i{constructor(t,e){this.name=t,this.index=e}get Name(){return this.name}get Index(){return this.index}get Ke(){return(this.index+2)%5}get Sheng(){return(this.index+1)%5}Ref(t){return this.Ke==t.Index?["\u5b98\u9b3c","\u5b98"]:this.Sheng==t.Index?["\u7236\u6bcd","\u7236"]:t.Ke==this.index?["\u59bb\u8d22","\u8d22"]:t.Sheng==this.index?["\u5b50\u5b59","\u5b59"]:["\u5144\u5f1f","\u5144"]}}let n=[];function r(t){if("number"==typeof t){if(t>=0&&t<=4)return n[t];throw new RangeError("WuXing index out of range: "+t)}{let e=n.filter(e=>e.Name==t);if(e&&1==e.length)return e[0];throw new RangeError("WuXing name out of range: "+t)}}n.push(new i("\u91d1",0)),n.push(new i("\u6c34",1)),n.push(new i("\u6728",2)),n.push(new i("\u706b",3)),n.push(new i("\u571f",4))},aGhr:function(t,e){}}]);