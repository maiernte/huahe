function _classCallCheck(c,e){if(!(c instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(c,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(c,n.key,n)}}function _createClass(c,e,i){return e&&_defineProperties(c.prototype,e),i&&_defineProperties(c,i),c}(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{J4mY:function(c,e,i){"use strict";i.r(e);var n,t,o=i("ofXK"),r=i("3Pt+"),a=i("tyNb"),s=i("c7TG"),u=i("mrSG"),l=i("LTmD"),d=i("PKx9"),f=i("8/yo"),h=i("Y6BA"),m=i("G6JS"),p=i("fXoL"),v=((n=function(){function c(e){_classCallCheck(this,c),this.modalCtrl=e}return _createClass(c,[{key:"ngOnInit",value:function(){}},{key:"onClose",value:function(){this.modalCtrl.dismiss()}}]),c}()).\u0275fac=function(c){return new(c||n)(p.Yb(s.ab))},n.\u0275cmp=p.Sb({type:n,selectors:[["app-imgmodal"]],inputs:{ImgSrc:"ImgSrc"},decls:7,vars:1,consts:[["vertical","bottom","horizontal","end","slot","fixed",3,"click"],["name","close"],[1,"frame",2,"background-color","black"],[1,"helper"],[3,"src"]],template:function(c,e){1&c&&(p.dc(0,"ion-content"),p.dc(1,"ion-fab",0),p.lc("click",(function(){return e.onClose()})),p.dc(2,"ion-fab-button"),p.Zb(3,"ion-icon",1),p.cc(),p.cc(),p.dc(4,"div",2),p.Zb(5,"span",3),p.Zb(6,"img",4),p.cc(),p.cc()),2&c&&(p.Nb(6),p.vc("src",e.ImgSrc,p.Ec))},directives:[s.m,s.o,s.p,s.t],styles:[".frame[_ngcontent-%COMP%]{height:100%;width:100%;white-space:nowrap;text-align:center;margin:1em 0}.helper[_ngcontent-%COMP%]{display:inline-block;height:100%}.helper[_ngcontent-%COMP%], img[_ngcontent-%COMP%]{vertical-align:middle}img[_ngcontent-%COMP%]{background:#3a6f9a}"]}),n),g=i("i/bi"),b=i("ylIl"),T=i("gTpY"),x=i("jhN1"),k=((t=function(){function c(e){_classCallCheck(this,c),this.sanitizer=e}return _createClass(c,[{key:"transform",value:function(c){return this.sanitizer.bypassSecurityTrustHtml(c)}}]),c}()).\u0275fac=function(c){return new(c||t)(p.Yb(x.b))},t.\u0275pipe=p.Xb({name:"safeHtml",type:t,pure:!0}),t);function C(c,e){if(1&c&&(p.dc(0,"ion-header"),p.dc(1,"ion-toolbar",12),p.dc(2,"ion-buttons",3),p.Zb(3,"ion-back-button",13),p.cc(),p.dc(4,"ion-title"),p.Jc(5),p.cc(),p.dc(6,"ion-buttons",5),p.dc(7,"ion-button",14),p.Zb(8,"ion-icon",15),p.cc(),p.cc(),p.cc(),p.cc()),2&c){var i=p.oc();p.Nb(5),p.Kc(i.Titel)}}function w(c,e){1&c&&(p.dc(0,"ion-text",16),p.Jc(1,"[\u7cbe\u534e]"),p.cc())}function y(c,e){1&c&&(p.dc(0,"ion-text",16),p.Jc(1,"[\u7f6e\u9876]"),p.cc())}function I(c,e){if(1&c){var i=p.ec();p.dc(0,"ion-button",17),p.lc("click",(function(){return p.Cc(i),p.oc().NavBack()})),p.Zb(1,"ion-icon",18),p.cc()}}function N(c,e){if(1&c){var i=p.ec();p.dc(0,"small"),p.dc(1,"ion-text",27),p.lc("click",(function(){return p.Cc(i),p.oc(2).AnswerTopic(null)})),p.Jc(2,"[\u56de\u590d]"),p.cc(),p.cc()}}function S(c,e){if(1&c){var i=p.ec();p.dc(0,"small"),p.dc(1,"ion-text",27),p.lc("click",(function(){p.Cc(i);var c=p.oc(2);return c.EditTopic(c.Topic)})),p.Jc(2,"[\u4fee\u6539]"),p.cc(),p.cc()}}function z(c,e){if(1&c){var i=p.ec();p.dc(0,"small"),p.dc(1,"ion-text",27),p.lc("click",(function(){p.Cc(i);var c=p.oc(2);return c.DeleteTopic(c.Topic.id,!0)})),p.Jc(2,"[\u5220\u9664]"),p.cc(),p.cc()}}function H(c,e){if(1&c){var i=p.ec();p.dc(0,"small"),p.dc(1,"ion-text",27),p.lc("click",(function(){p.Cc(i);var c=p.oc(2);return c.FrozenTopic(c.Topic)})),p.Jc(2,"[\u5c01\u5b58]"),p.cc(),p.cc()}}function O(c,e){if(1&c){var i=p.ec();p.dc(0,"small"),p.dc(1,"ion-text",27),p.lc("click",(function(){p.Cc(i);var c=p.oc(2);return c.ChangeImg(c.Topic,"img")})),p.Jc(2,"[\u56fe\u7247]"),p.cc(),p.cc()}}function A(c,e){if(1&c){var i=p.ec();p.dc(0,"small"),p.dc(1,"ion-text",28),p.lc("click",(function(){return p.Cc(i),p.oc(2).SetTopOrGood("\u7cbe\u534e")})),p.Jc(2,"[\u7cbe\u534e]"),p.cc(),p.cc()}if(2&c){var n=p.oc(2);p.Nb(1),p.vc("color",null!=n.Topic&&n.Topic.good?"primary":"danger")}}function J(c,e){if(1&c){var i=p.ec();p.dc(0,"small"),p.dc(1,"ion-text",29),p.lc("click",(function(){return p.Cc(i),p.oc(2).SetTopOrGood("\u7f6e\u9876")})),p.Jc(2,"[\u7f6e\u9876]"),p.cc(),p.cc()}if(2&c){var n=p.oc(2);p.Nb(1),p.vc("color",null!=n.Topic&&n.Topic.top?"primary":"danger")}}var P=function(c){return{display:c}};function Z(c,e){if(1&c&&(p.dc(0,"sui-accordion",30),p.dc(1,"sui-accordion-panel",31),p.dc(2,"div",32),p.Zb(3,"i",33),p.Jc(4," \u5366\u76d8 "),p.cc(),p.dc(5,"div",34),p.dc(6,"div",35),p.Zb(7,"app-guaview",36),p.cc(),p.cc(),p.cc(),p.cc()),2&c){var i=p.oc(2);p.vc("closeOthers",!1),p.Nb(1),p.vc("isOpen",!1),p.Nb(5),p.vc("ngStyle",p.xc(5,P,i.Align)),p.Nb(1),p.vc("Config",i.GuaConfig)("GuaText",i.Topic.gua)}}function L(c,e){if(1&c&&(p.dc(0,"sui-accordion",30),p.dc(1,"sui-accordion-panel",31),p.dc(2,"div",32),p.Zb(3,"i",33),p.Jc(4," \u547d\u76d8 "),p.cc(),p.dc(5,"div",34),p.dc(6,"div",35),p.Zb(7,"app-baziview",37),p.cc(),p.cc(),p.cc(),p.cc()),2&c){var i=p.oc(2);p.vc("closeOthers",!1),p.Nb(1),p.vc("isOpen",!1),p.Nb(5),p.vc("ngStyle",p.xc(5,P,i.Align)),p.Nb(1),p.vc("Config",i.BaziConfig)("BaziText",i.Topic.bazi)}}var G=function(c){return{"max-height.px":c}};function R(c,e){if(1&c){var i=p.ec();p.dc(0,"ion-item",38),p.lc("click",(function(){p.Cc(i);var c=p.oc(2);return c.ShowImageModal(c.Topic.img)})),p.dc(1,"div",39),p.Zb(2,"img",40),p.cc(),p.cc()}if(2&c){var n=p.oc(2);p.Nb(2),p.vc("src",n.Topic.img,p.Ec)("ngStyle",p.xc(2,G,n.MaxHeight))}}function D(c,e){if(1&c){var i=p.ec();p.dc(0,"div",19),p.dc(1,"ion-item"),p.dc(2,"ion-thumbnail",3),p.Zb(3,"img",20),p.cc(),p.dc(4,"ion-label",21),p.dc(5,"ion-text",22),p.lc("click",(function(){p.Cc(i);var c=p.oc();return c.ShowUserInfo(c.Topic.author)})),p.Jc(6),p.cc(),p.Zb(7,"br"),p.dc(8,"ion-note"),p.dc(9,"small"),p.Jc(10),p.cc(),p.cc(),p.Zb(11,"br"),p.dc(12,"ion-note"),p.dc(13,"small"),p.Jc(14),p.cc(),p.cc(),p.Zb(15,"br"),p.dc(16,"ion-label",21),p.dc(17,"small"),p.dc(18,"ion-text",23),p.Jc(19,"0 \u697c"),p.cc(),p.cc(),p.Hc(20,N,3,0,"small",0),p.Hc(21,S,3,0,"small",0),p.Hc(22,z,3,0,"small",0),p.Hc(23,H,3,0,"small",0),p.Hc(24,O,3,0,"small",0),p.Hc(25,A,3,1,"small",0),p.Hc(26,J,3,1,"small",0),p.cc(),p.cc(),p.cc(),p.Hc(27,Z,8,7,"sui-accordion",24),p.Hc(28,L,8,7,"sui-accordion",24),p.Hc(29,R,3,4,"ion-item",25),p.dc(30,"ion-item"),p.dc(31,"ion-label",21),p.Zb(32,"ion-text",26),p.pc(33,"safeHtml"),p.cc(),p.cc(),p.cc()}if(2&c){var n=p.oc();p.vc("hidden",1!==n.PageIndex),p.Nb(3),p.vc("src",n.Topic.avatar,p.Ec),p.Nb(3),p.Lc("\u4f5c\u8005\uff1a",n.Topic.author,""),p.Nb(4),p.Lc("\u53d1\u5e16\u65f6\u95f4: ",n.DateText(n.Topic.created),""),p.Nb(4),p.Lc("\u4fee\u6539\u65f6\u95f4: ",n.DateText(n.Topic.modified),""),p.Nb(6),p.vc("ngIf",n.CheckAction(n.Topic,"anwser")),p.Nb(1),p.vc("ngIf",n.CheckAction(n.Topic,"modify")),p.Nb(1),p.vc("ngIf",n.CheckAction(n.Topic,"delete")),p.Nb(1),p.vc("ngIf",n.CheckAction(n.Topic,"frozen")),p.Nb(1),p.vc("ngIf",n.Topic.img),p.Nb(1),p.vc("ngIf",n.IsAdmin),p.Nb(1),p.vc("ngIf",n.IsAdmin),p.Nb(1),p.vc("ngIf",n.Topic.gua),p.Nb(1),p.vc("ngIf",n.Topic.bazi),p.Nb(1),p.vc("ngIf",n.ShowMe(n.Topic,"img")),p.Nb(3),p.vc("innerHtml",p.qc(33,16,n.Topic.content),p.Dc)}}function M(c,e){if(1&c){var i=p.ec();p.dc(0,"small"),p.dc(1,"ion-text",27),p.lc("click",(function(){return p.Cc(i),p.oc(2).AnswerTopic(null)})),p.Jc(2,"[\u56de\u590d]"),p.cc(),p.cc()}}function B(c,e){if(1&c){var i=p.ec();p.dc(0,"small"),p.dc(1,"ion-text",27),p.lc("click",(function(){p.Cc(i);var c=p.oc().$implicit;return p.oc().EditTopic(c)})),p.Jc(2,"[\u4fee\u6539]"),p.cc(),p.cc()}}function _(c,e){if(1&c){var i=p.ec();p.dc(0,"small"),p.dc(1,"ion-text",27),p.lc("click",(function(){p.Cc(i);var c=p.oc().$implicit;return p.oc().DeleteTopic(c.id,!0)})),p.Jc(2,"[\u5220\u9664]"),p.cc(),p.cc()}}function U(c,e){if(1&c){var i=p.ec();p.dc(0,"small"),p.dc(1,"ion-text",27),p.lc("click",(function(){p.Cc(i);var c=p.oc().$implicit;return p.oc().FrozenTopic(c)})),p.Jc(2,"[\u5c01\u5b58]"),p.cc(),p.cc()}}function j(c,e){if(1&c){var i=p.ec();p.dc(0,"small"),p.dc(1,"ion-text",27),p.lc("click",(function(){p.Cc(i);var c=p.oc().$implicit;return p.oc().ChangeImg(c,"img")})),p.Jc(2,"[\u56fe\u7247]"),p.cc(),p.cc()}}function E(c,e){if(1&c&&(p.dc(0,"sui-accordion",30),p.dc(1,"sui-accordion-panel",31),p.dc(2,"div",32),p.Zb(3,"i",33),p.Jc(4," \u5366\u76d8 "),p.cc(),p.dc(5,"div",34),p.dc(6,"div",35),p.Zb(7,"app-guaview",36),p.cc(),p.cc(),p.cc(),p.cc()),2&c){var i=p.oc().$implicit,n=p.oc();p.vc("closeOthers",!1),p.Nb(1),p.vc("isOpen",!1),p.Nb(5),p.vc("ngStyle",p.xc(5,P,n.Align)),p.Nb(1),p.vc("Config",n.GuaConfig)("GuaText",i.gua)}}function V(c,e){if(1&c&&(p.dc(0,"sui-accordion",30),p.dc(1,"sui-accordion-panel",31),p.dc(2,"div",32),p.Zb(3,"i",33),p.Jc(4," \u547d\u76d8 "),p.cc(),p.dc(5,"div",34),p.dc(6,"div",35),p.Zb(7,"app-baziview",37),p.cc(),p.cc(),p.cc(),p.cc()),2&c){var i=p.oc().$implicit,n=p.oc();p.vc("closeOthers",!1),p.Nb(1),p.vc("isOpen",!1),p.Nb(5),p.vc("ngStyle",p.xc(5,P,n.Align)),p.Nb(1),p.vc("Config",n.BaziConfig)("BaziText",i.bazi)}}function W(c,e){if(1&c){var i=p.ec();p.dc(0,"ion-item",38),p.lc("click",(function(){p.Cc(i);var c=p.oc().$implicit;return p.oc().ShowImageModal(c.img)})),p.dc(1,"div",39),p.Zb(2,"img",40),p.cc(),p.cc()}if(2&c){var n=p.oc().$implicit,t=p.oc();p.Nb(2),p.vc("src",n.img,p.Ec)("ngStyle",p.xc(2,G,t.MaxHeight))}}function F(c,e){if(1&c){var i=p.ec();p.dc(0,"ion-item"),p.dc(1,"div",41),p.dc(2,"ion-item"),p.dc(3,"ion-thumbnail",3),p.Zb(4,"img",20),p.cc(),p.dc(5,"ion-label",21),p.dc(6,"ion-text",22),p.lc("click",(function(){p.Cc(i);var c=e.$implicit;return p.oc().ShowUserInfo(c.author)})),p.Jc(7),p.cc(),p.Zb(8,"br"),p.dc(9,"ion-note"),p.dc(10,"small"),p.Jc(11),p.cc(),p.cc(),p.Zb(12,"br"),p.dc(13,"ion-note"),p.dc(14,"small"),p.Jc(15),p.cc(),p.cc(),p.Zb(16,"br"),p.dc(17,"ion-label",21),p.dc(18,"small"),p.dc(19,"ion-text",23),p.Jc(20),p.cc(),p.cc(),p.Hc(21,M,3,0,"small",0),p.Hc(22,B,3,0,"small",0),p.Hc(23,_,3,0,"small",0),p.Hc(24,U,3,0,"small",0),p.Hc(25,j,3,0,"small",0),p.cc(),p.cc(),p.cc(),p.Hc(26,E,8,7,"sui-accordion",24),p.Hc(27,V,8,7,"sui-accordion",24),p.Hc(28,W,3,4,"ion-item",25),p.dc(29,"ion-item",42),p.dc(30,"ion-label",21),p.Zb(31,"ion-text",26),p.pc(32,"safeHtml"),p.cc(),p.cc(),p.cc(),p.cc()}if(2&c){var n=e.$implicit,t=e.index,o=p.oc();p.Nb(4),p.vc("src",n.avatar,p.Ec),p.Nb(3),p.Lc("\u4f5c\u8005\uff1a",n.author,""),p.Nb(4),p.Lc("\u53d1\u5e16\u65f6\u95f4: ",o.DateText(n.created),""),p.Nb(4),p.Lc("\u4fee\u6539\u65f6\u95f4: ",o.DateText(n.modified),""),p.Nb(5),p.Lc("",t+1," \u697c"),p.Nb(1),p.vc("ngIf",o.CheckAction(n,"anwser")),p.Nb(1),p.vc("ngIf",o.CheckAction(n,"modify")),p.Nb(1),p.vc("ngIf",o.CheckAction(n,"delete")),p.Nb(1),p.vc("ngIf",o.CheckAction(n,"frozen")),p.Nb(1),p.vc("ngIf",n.img),p.Nb(1),p.vc("ngIf",n.gua),p.Nb(1),p.vc("ngIf",n.bazi),p.Nb(1),p.vc("ngIf",o.ShowMe(n,"img")),p.Nb(3),p.vc("innerHtml",p.qc(32,14,n.content),p.Dc)}}function Y(c,e){if(1&c){var i=p.ec();p.dc(0,"div",43),p.dc(1,"sui-pagination",44),p.lc("pageChange",(function(c){return p.Cc(i),p.oc().PageIndex=c})),p.cc(),p.cc()}if(2&c){var n=p.oc();p.Nb(1),p.vc("collectionSize",n.PageSum)("pageSize",20)("maxSize",n.MaxPageButtons)("hasNavigationLinks",!0)("hasBoundaryLinks",!0)("page",n.PageIndex)}}var $,X=(($=function(){function c(e,i,n,t,o,r,a){var s=this;_classCallCheck(this,c),this.loadingController=e,this.alertController=i,this.settings=n,this.forumservice=t,this.modalCtrl=o,this.route=r,this.router=a,this.pageindex=1,this.cache=[],this.Pages=[0],this.PageSum=0,this.Titel="Topic Titel",this.VTopic=[],this.LoadSuccessed=!1,this.route.params.subscribe((function(c){s.forumid=c.forumid,s.topicid=c.topicid}))}return _createClass(c,[{key:"ngOnInit",value:function(){var c;return Object(u.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var i=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.settings.WaitInit();case 2:if(e.t0=this.forumservice.ForumMG.Forumlist,e.t0){e.next=6;break}return e.next=6,this.forumservice.LoadForumList();case 6:return this.forum=this.forumservice.ForumMG.Forumlist.find((function(c){return c.id===i.forumid})),this.Titel=(null===(c=this.forum)||void 0===c?void 0:c.name)||this.forumid,this.user=this.settings.User||h.a,this.GuaConfig=this.settings.Gua,this.BaziConfig=this.settings.Bazi,e.next=13,this.loadingController.create({message:"\u6b63\u5728\u83b7\u53d6\u8bba\u575b\u5e16\u5b50...",duration:6e4});case 13:return this.loadingView=e.sent,e.next=16,this.forumservice.GetTopic(this.forumid,this.topicid);case 16:this.Topic=e.sent,this.PageIndex=1;case 18:case"end":return e.stop()}}),e,this)})))}},{key:"doRefresh",value:function(c){var e=this;this.cache=[],this.forumservice.GetTopic(this.forumid,this.topicid).then((function(c){return e.Topic=c,e.LoadAnswors(e.PageIndex-1)})).then((function(c){e.LoadSuccessed=c})).catch((function(c){console.log(c)})).finally((function(){c.target.complete()}))}},{key:"LoadAnswors",value:function(c){return Object(u.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var i,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.VTopic=[],i=this.cache.find((function(e){return e.page===c})),e.abrupt("return",i?(this.VTopic=i.items,Promise.resolve(!0)):this.forumservice.LoadAnswerList(this.topicid,this.forumid,c).then((function(e){return e&&Array.isArray(e.data)&&(n.PageSum=0===c?e.sum||0:n.PageSum,n.VTopic=e.data,n.updateUserAvatar()),!0})).catch((function(c){return console.log("LoadAnswors Error",c),!1})));case 3:case"end":return e.stop()}}),e,this)})))}},{key:"DateText",value:function(c){if(!c)return"\u65e0";var e=new Date(c);return e.toChinaStr()+" ".concat(e.getHours(),":").concat(e.getMinutes(),":").concat(e.getSeconds())}},{key:"GetRoles",value:function(c){return c?this.settings.UserRolers(c):[]}},{key:"CheckAction",value:function(c,e){if(!c||!this.HasUser)return!1;var i=!1;return"modify"===e?i=(i=this.user.id===c.author||this.IsAdmin)&&!0!==c.frozen:"delete"===e?i=(i=this.user.id===c.author||this.IsAdmin)&&!0!==c.frozen:"frozen"===e?i=(i=this.user.id===c.author||this.IsAdmin)&&!0!==c.frozen:"anwser"===e&&(i=!0),i&&!(!0===c.deleted)}},{key:"ShowPanfu",value:function(c){this.router.navigate(["menu/topicpanfu/".concat(JSON.stringify(c))])}},{key:"EditTopic",value:function(c){var e;return Object(u.b)(this,void 0,void 0,regeneratorRuntime.mark((function i(){var n,t,o;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return n=void 0!==c.forumid,(t=n?null===(e=this.forum)||void 0===e?void 0:e.name:this.Topic.title)||(t=c.forumid||this.forumid),i.next=5,this.modalCtrl.create({component:f.a,componentProps:{MainTopic:n?c:null,VTopic:n?null:c,forumid:this.forumid,forumname:t,Private:!this.forum}});case 5:return o=i.sent,i.next=8,o.present();case 8:return i.next=10,o.onWillDismiss();case 10:case"end":return i.stop()}}),i,this)})))}},{key:"DeleteTopic",value:function(c,e){return Object(u.b)(this,void 0,void 0,regeneratorRuntime.mark((function i(){var n=this;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:this.presentConfirm("\u5220\u9664",null,"\u786e\u5b9a\u5220\u9664\u6b64\u5e16\u5b50/\u53d1\u8a00\uff1f").then((function(i){return!0===i&&n.forumservice.DeleteTopic(c,e?null:n.Topic.id)})).then((function(c){c&&n.router.navigateByUrl(e?"menu/forum":"menu/topiclist/".concat(n.forumid))}));case 1:case"end":return i.stop()}}),i,this)})))}},{key:"AnswerTopic",value:function(c){return Object(u.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var i,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.CreateTopic(c),e.next=3,this.modalCtrl.create({component:f.a,componentProps:{VTopic:i,forumid:this.forumid,forumname:this.Topic.title}});case 3:return n=e.sent,e.next=6,n.present();case 6:return e.next=8,n.onWillDismiss();case 8:case"end":return e.stop()}}),e,this)})))}},{key:"FrozenTopic",value:function(c){return Object(u.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var i,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=!c,c=c||this.Topic,this.presentConfirm("\u5c01\u5b58",null,"\u5c01\u5b58\u53d1\u8a00\u540e\uff0c\u4e0d\u5141\u8bb8\u518d\u4fee\u6539\u3001\u5220\u9664\u3002\u5168\u697c\u5c01\u5b58\u540e\u4e0d\u5141\u8bb8\u8ddf\u8d34\u3002\u786e\u5b9a\u5c01\u5b58\u5417\uff1f").then((function(e){if(!0===e)return n.forumservice.UpdateTopic({frozen:!0},c.id,!n.forum)})).then((function(e){e&&(c.frozen=!0,c.deleted=!!i||c.deleted)})).catch((function(c){n.presentConfirm("\u64cd\u4f5c\u5931\u8d25",null,"\u5c01\u697c/\u53d1\u8a00\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5\uff0c \u6216\u8005\u5411\u7248\u4e3b\u62a5\u544a\u3002")}));case 2:case"end":return e.stop()}}),e,this)})))}},{key:"SetTopOrGood",value:function(c){return Object(u.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var i,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i={},"\u7cbe\u534e"===c?i.good=!this.Topic.good:"\u7f6e\u9876"===c&&(i.top=(this.Topic.top+1)%2),this.forumservice.UpdateTopic(i,this.Topic.id,!this.forum).then((function(e){e&&("\u7cbe\u534e"===c?n.Topic.good=!n.Topic.good:"\u7f6e\u9876"===c&&(n.Topic.top=(n.Topic.top+1)%2))}));case 2:case"end":return e.stop()}}),e,this)})))}},{key:"ShowUserInfo",value:function(c){return Object(u.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.modalCtrl.create({component:m.a,componentProps:{Uerid:c}});case 2:return i=e.sent,e.next=5,i.present();case 5:return e.next=7,i.onWillDismiss();case 7:case"end":return e.stop()}}),e,this)})))}},{key:"ShowImageModal",value:function(c){return Object(u.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.modalCtrl.create({component:v,componentProps:{ImgSrc:c}});case 2:return i=e.sent,e.next=5,i.present();case 5:return e.next=7,i.onWillDismiss();case 7:case"end":return e.stop()}}),e,this)})))}},{key:"NavBack",value:function(){this.router.navigateByUrl("/menu/topiclist/".concat(this.forumid))}},{key:"ShowMe",value:function(c,e){return"img"===e?c&&c.img&&c.showImg:"gua"===e?c&&c.gua&&c.showgua:"bazi"===e&&c&&c.bazi&&c.showbazi}},{key:"ChangeImg",value:function(c,e){"img"===e?c.showImg=!c.showImg:"gua"===e?c.showGua=!c.showGua:"bazi"===e&&(c.showBazi=!c.showBazi)}},{key:"CreateTopic",value:function(c){var e=Date.now();return{id:"",created:e,modified:e,author:this.user.id,topic:this.Topic.id,gua:null,bazi:null,img:null,content:"",feedback:c||"",frozen:!1}}},{key:"updateUserAvatar",value:function(){var c=this;this.VTopic.forEach((function(e){c.forumservice.GetUserInfo(e.author).then((function(i){var n=(i||h.a).avatar||"";e.avatar=n.IsNullOrEmpty()?c.settings.Avatar(i.gender):n,e.showImg=!0,e.showGua=!0,e.showBazi=!0}))}))}},{key:"presentConfirm",value:function(c,e,i){return Object(u.b)(this,void 0,void 0,regeneratorRuntime.mark((function n(){var t,o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t=!1,n.next=3,this.alertController.create({header:c||"\u63d0\u793a",subHeader:e||"",message:i,buttons:[{text:"\u786e\u5b9a",handler:function(){t=!0}},{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary",handler:function(){}}]});case 3:return o=n.sent,n.next=6,o.present();case 6:return n.next=8,o.onWillDismiss();case 8:return n.abrupt("return",Promise.resolve(t));case 9:case"end":return n.stop()}}),n,this)})))}},{key:"IsWeb",get:function(){return"web"===h.b}},{key:"Align",get:function(){return this.settings.DeviceWidth>500?"inline-block":"inline"}},{key:"HasUser",get:function(){return this.settings.HasUser&&this.user!==h.a}},{key:"MaxPageButtons",get:function(){return this.settings.DeviceWidth>=400?7:2}},{key:"PageIndex",get:function(){return this.pageindex},set:function(c){var e=this;this.VTopic&&this.VTopic.length>0&&(this.cache.find((function(c){return c.page===e.pageindex-1}))||this.cache.push({page:this.pageindex-1,items:this.VTopic})),this.pageindex=c,this.LoadAnswors(c-1).then((function(c){e.LoadSuccessed=c}))}},{key:"MaxHeight",get:function(){return Math.ceil(this.settings.DeviceHeight/2)}},{key:"IsAdmin",get:function(){if(!this.user||!this.forum)return!1;var c=256===this.user.roller;return this.forum&&this.Topic&&(c=c||this.forum.admin.includes(this.user.id)),c}}]),c}()).\u0275fac=function(c){return new(c||$)(p.Yb(s.Z),p.Yb(s.b),p.Yb(l.a),p.Yb(d.a),p.Yb(s.ab),p.Yb(a.a),p.Yb(a.g))},$.\u0275cmp=p.Sb({type:$,selectors:[["app-topicviewer"]],decls:19,vars:9,consts:[[4,"ngIf"],["color","medium"],[1,"ion-no-padding"],["slot","start"],["color","danger",4,"ngIf"],["slot","end"],[3,"click",4,"ngIf"],[3,"disabled","click"],["slot","fixed",3,"ionRefresh"],[3,"hidden",4,"ngIf"],[4,"ngFor","ngForOf"],["class","ui very basic segment",4,"ngIf"],["color","primary"],["defaulthref","","text","\u8fd4\u56de"],["routerLink","/menu/forum"],["icon-only","","name","home"],["color","danger"],[3,"click"],["name","undo"],[3,"hidden"],[3,"src"],[1,"ion-text-wrap"],["color","primary",3,"click"],[1,"ion-margin-end"],[3,"closeOthers",4,"ngIf"],["lines","none",3,"click",4,"ngIf"],["ion-padding-vertical","",2,"margin-bottom","1px",3,"innerHtml"],["color","secondary",1,"ion-margin-end",3,"click"],[1,"ion-margin-end",3,"color","click"],[3,"color","click"],[3,"closeOthers"],[3,"isOpen"],["title",""],[1,"dropdown","icon"],["content","",2,"text-align","center"],[3,"ngStyle"],[3,"Config","GuaText"],[3,"Config","BaziText"],["lines","none",3,"click"],[1,"img-container"],[3,"src","ngStyle"],[2,"padding-bottom","3px"],["lines","none"],[1,"ui","very","basic","segment"],[1,"ui","right","floated",3,"collectionSize","pageSize","maxSize","hasNavigationLinks","hasBoundaryLinks","page","pageChange"]],template:function(c,e){1&c&&(p.Hc(0,C,9,1,"ion-header",0),p.Zb(1,"ion-text",1),p.dc(2,"ion-item-divider",2),p.dc(3,"ion-label",3),p.dc(4,"ion-text"),p.Jc(5),p.cc(),p.Hc(6,w,2,0,"ion-text",4),p.Hc(7,y,2,0,"ion-text",4),p.cc(),p.dc(8,"ion-buttons",5),p.Hc(9,I,2,0,"ion-button",6),p.dc(10,"ion-button",7),p.lc("click",(function(){return e.FrozenTopic(null)})),p.Jc(11,"\u5c01\u697c"),p.cc(),p.cc(),p.cc(),p.dc(12,"ion-content",2),p.dc(13,"ion-refresher",8),p.lc("ionRefresh",(function(c){return e.doRefresh(c)})),p.Zb(14,"ion-refresher-content"),p.cc(),p.Hc(15,D,34,18,"div",9),p.dc(16,"ion-list",2),p.Hc(17,F,33,16,"ion-item",10),p.Hc(18,Y,2,6,"div",11),p.cc(),p.cc()),2&c&&(p.vc("ngIf",!e.IsWeb),p.Nb(5),p.Lc("\u9898\u76ee\uff1a",null==e.Topic?null:e.Topic.title,""),p.Nb(1),p.vc("ngIf",null==e.Topic?null:e.Topic.good),p.Nb(1),p.vc("ngIf",null==e.Topic?null:e.Topic.top),p.Nb(2),p.vc("ngIf",e.IsWeb),p.Nb(1),p.vc("disabled",!e.CheckAction(e.Topic,"frozen")),p.Nb(5),p.vc("ngIf",e.Topic),p.Nb(2),p.vc("ngForOf",e.VTopic),p.Nb(1),p.vc("ngIf",e.LoadSuccessed))},directives:[o.j,s.S,s.x,s.C,s.i,s.h,s.m,s.I,s.J,s.D,o.i,s.s,s.W,s.f,s.g,s.U,s.eb,a.h,s.t,s.w,s.T,s.G,g.a,g.b,o.k,b.a,T.a,g.f],pipes:[k],styles:[".img-container[_ngcontent-%COMP%]{text-align:center;display:block}"]}),$),K=i("CGrG"),q=i("zioG"),Q=i("uEAi"),cc=i("n7QD");i.d(e,"TopicviewerPageModule",(function(){return nc}));var ec,ic=[{path:"",component:X}],nc=((ec=function c(){_classCallCheck(this,c)}).\u0275mod=p.Wb({type:ec}),ec.\u0275inj=p.Vb({factory:function(c){return new(c||ec)},imports:[[Q.a,cc.a,q.b,g.e,o.b,r.c,s.X,K.b,a.j.forChild(ic)]]}),ec)}}]);