(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{"D+SI":function(e,t,n){"use strict";n.r(t);var o=n("ofXK"),c=n("3Pt+"),i=n("tyNb"),s=n("c7TG"),d=n("mrSG"),r=n("HULg"),l=n("LTmD"),a=n("lEof"),u=n("fXoL");let h=(()=>{class e{constructor(e,t){this.modalCtrl=e,this.toastCtrl=t,this.name="",this.nodetype=32,this.edit=!1,this.path=[]}ngOnInit(){}set NodeName(e){this.name=e}get NodeName(){return this.name}get NodeType(){return this.nodetype.toString()}set NodeType(e){this.nodetype=parseInt(e)}get Edit(){return this.edit}set Edit(e){this.edit=!0===e}set Path(e){console.log("path = ",e),this.path=e}get PathT(){return this.path.join(" / ")}onclose(e){return Object(d.b)(this,void 0,void 0,(function*(){if(this.name=(this.name||"").trim(),e&&this.name.IsNullOrEmpty())return void(yield this.toastCtrl.create({message:"\u6587\u4ef6\u5939\u7684\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a",duration:2e3})).present();let t={};e&&(t={name:this.name,type:this.nodetype}),this.modalCtrl.dismiss(t)}))}}return e.\u0275fac=function(t){return new(t||e)(u.Yb(s.cb),u.Yb(s.jb))},e.\u0275cmp=u.Sb({type:e,selectors:[["app-nodeeditor"]],inputs:{NodeName:"NodeName",NodeType:"NodeType",Edit:"Edit",Path:"Path"},decls:44,vars:4,consts:[["color","secondary"],["slot","end"],[3,"click"],["color","medium"],["position","floating"],["placeholder","\u6587\u4ef6\u5939\u6216\u5ba2\u6237\u540d\u79f0",3,"ngModel","ngModelChange"],["position","stacked"],[3,"ngModel","disabled","ngModelChange"],["value","1"],["name","folder"],["value","2"],["name","person"],["value","32","checked",""],["name","document"],[1,"ion-margin-top"]],template:function(e,t){1&e&&(u.dc(0,"ion-header"),u.dc(1,"ion-toolbar",0),u.dc(2,"ion-title"),u.Ic(3,"\u521b\u5efa\u8282\u70b9"),u.cc(),u.dc(4,"ion-buttons",1),u.dc(5,"ion-button",2),u.lc("click",(function(){return t.onclose(!1)})),u.Ic(6," \u53d6\u6d88 "),u.cc(),u.dc(7,"ion-button",2),u.lc("click",(function(){return t.onclose(!0)})),u.Ic(8," \u786e\u5b9a "),u.cc(),u.cc(),u.cc(),u.cc(),u.dc(9,"ion-content"),u.dc(10,"ion-item"),u.dc(11,"ion-text"),u.Ic(12,"\u8def\u5f84\uff1a"),u.cc(),u.dc(13,"ion-text",3),u.Ic(14),u.cc(),u.cc(),u.dc(15,"ion-item"),u.dc(16,"ion-label",4),u.Ic(17,"\u76ee\u5f55\u540d\u79f0"),u.cc(),u.dc(18,"ion-input",5),u.lc("ngModelChange",(function(e){return t.NodeName=e})),u.cc(),u.cc(),u.dc(19,"ion-item"),u.dc(20,"ion-label",6),u.Ic(21,"\u76ee\u5f55\u7c7b\u578b"),u.cc(),u.dc(22,"ion-segment",7),u.lc("ngModelChange",(function(e){return t.NodeType=e})),u.dc(23,"ion-segment-button",8),u.Zb(24,"ion-icon",9),u.dc(25,"ion-text"),u.Ic(26,"\u5f52\u6863\u7bb1"),u.cc(),u.cc(),u.dc(27,"ion-segment-button",10),u.Zb(28,"ion-icon",11),u.dc(29,"ion-text"),u.Ic(30,"\u5ba2\u6237\u5939"),u.cc(),u.cc(),u.dc(31,"ion-segment-button",12),u.Zb(32,"ion-icon",13),u.dc(33,"ion-text"),u.Ic(34,"\u6587\u4ef6\u5939"),u.cc(),u.cc(),u.cc(),u.cc(),u.dc(35,"ion-item",14),u.dc(36,"ion-text",3),u.Ic(37,"\u6587\u4ef6\u5939\uff1a\u53ea\u53ef\u5b58\u653e\u516d\u723b\u548c\u516b\u5b57\u6848\u4f8b\u3002\u6587\u4ef6\u5939\u4e0b\u9762\u4e0d\u80fd\u518d\u5305\u542b\u5f52\u6863\u7bb1\u3001\u5ba2\u6237\u5939\u3001\u6587\u4ef6\u5939\u3002"),u.cc(),u.cc(),u.dc(38,"ion-item",14),u.dc(39,"ion-text",3),u.Ic(40,"\u5f52\u6863\u7bb1\uff1a\u4e0d\u53ef\u5b58\u653e\u6848\u4f8b\uff0c\u4f46\u53ef\u4ee5\u5d4c\u5957\u5305\u542b\u5f52\u6863\u7bb1\u3001\u5ba2\u6237\u5939\u3001\u6587\u4ef6\u5939\u3002"),u.cc(),u.cc(),u.dc(41,"ion-item",14),u.dc(42,"ion-text",3),u.Ic(43,"\u5ba2\u6237\u5939\uff1a\u4e0d\u53ef\u5b58\u653e\u6848\u4f8b\uff0c\u4f46\u53ef\u4ee5\u5d4c\u5957\u5305\u542b\u5f52\u6863\u7bb1\u3001\u5ba2\u6237\u5939\u3001\u6587\u4ef6\u5939\u3002"),u.cc(),u.cc(),u.cc()),2&e&&(u.Nb(14),u.Jc(t.PathT),u.Nb(4),u.vc("ngModel",t.NodeName),u.Nb(4),u.vc("ngModel",t.NodeType)("disabled",t.Edit))},directives:[s.t,s.Y,s.W,s.j,s.i,s.n,s.x,s.T,s.D,s.w,s.ib,c.f,c.g,s.O,s.hb,s.P,s.u],styles:[""]}),e})();var b=n("HQI1"),p=n("mo90");function m(e,t){1&e&&(u.dc(0,"div",6),u.Zb(1,"ion-spinner",7),u.cc())}function f(e,t){if(1&e&&u.Zb(0,"ion-icon",8),2&e){const e=u.oc().$implicit;u.vc("name",1===e.statue?"md-checkmark":"md-close")}}function y(e,t){if(1&e&&(u.dc(0,"ion-item"),u.dc(1,"ion-text",3),u.Ic(2),u.cc(),u.dc(3,"ion-text"),u.Ic(4),u.cc(),u.Gc(5,m,2,0,"div",4),u.Gc(6,f,1,1,"ion-icon",5),u.cc()),2&e){const e=t.$implicit;u.Nb(2),u.Jc(e.type),u.Nb(2),u.Jc(e.path),u.Nb(1),u.vc("ngIf",0===e.statue),u.Nb(1),u.vc("ngIf",0!==e.statue)}}const N=n("NFKh");let v=(()=>{class e{constructor(e,t,n,o,c){this.modalCtrl=e,this.alertController=t,this.dbservice=n,this.settings=o,this.host=c,this.Items=[],this.changed=!1,this.encrypKey="",this.usingencry=!1,this.Finished=!1}ngOnInit(){this.user=this.settings.User,this.encrypKey=this.user.encryp,this.usingencry=!0===this.settings.Encryp,console.log("encrypKey",this.encrypKey,this.settings.Encryp),this.SyncNodes(this.user.id,this.user.password)}SyncNodes(e,t){return Object(d.b)(this,void 0,void 0,(function*(){const e={type:"\u8fde\u63a5 => :",path:"\u6b63\u5728\u94fe\u63a5\u4e91\u670d\u52a1\u5668\u3002\u3002\u3002",statue:0,id:null};this.Items.push(e);const t=yield this.LoadTreeFromCloud().catch(()=>(e.statue=-1,[]));if(!Array.isArray(t))return console.log(t),void this.modalCtrl.dismiss();if(-1===e.statue)return e.path="\u65e0\u6cd5\u94fe\u63a5\u5230\u670d\u52a1\u5668\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002",void(this.Finished=!0);e.statue=1;let n=!1,o=!1;const c=yield this.dbservice.getNodesAlle();console.log("nl",c),console.log("nc",t);for(const s of t){const e=c.find(e=>e.id===s.id);(!e||s.version>e.version)&&(n=!0,yield this.DownloadNode(e,s)),e&&e.version>s.version&&(o=!0,yield this.UploadNode(e))}const i=t.map(e=>e.id);for(const s of c)i.includes(s.id)||(o=!0,yield this.UploadNode(s));!1===o&&!1===n?this.Items.push({type:"",path:"\u6ca1\u6709\u53ef\u66f4\u65b0\u7684\u6570\u636e\uff0c\u5df2\u7ecf\u4fdd\u5b58\u540c\u6b65\uff01",statue:1,id:""}):o&&(yield this.UploadNodes()),this.Finished=!0}))}DownloadNode(e,t){return Object(d.b)(this,void 0,void 0,(function*(){const n={type:"\u4e0b\u8f7d => :",path:t.name,statue:0,id:t.id};if(this.Items.push(n),e&&e.dirty){const e=yield this.presentConfirm("\u51b2\u7a81",t.name,"\u4e91\u7aef\u6570\u636e\u4e0e\u672c\u5730\u6570\u636e\u5b58\u5728\u51b2\u7a81\uff0c\u8bf7\u9009\u62e9\u4fdd\u7559\u672c\u5730\u8bb0\u5f55\u6216\u8005\u6216\u8005\u66f4\u65b0\u672c\u5730\u8bb0\u5f55\u3002\u4e0d\u786e\u5b9a\u7684\u8bdd\u8bf7\u505c\u6b62\u672c\u6b21\u540c\u6b65\u3002");if(1!==e)return e}try{if(32===t.type&&t.size>=0){const e=yield this.host.LoadRecord(this.user.id,this.user.password,t.id);if(e&&e.id===t.id){let t=e.content;!0===e.encryp&&(t=this.DecrypData(e.content)),Array.isArray(t)||console.log(e,t.toString());for(const e of t)yield this.dbservice.UpdateObj(this.dbservice.Tables.Record,null,e)}}else 32===t.type&&t.size<0&&this.dbservice.DeleteNode(t.id);const o=e?e.id:null;return yield this.dbservice.UpdateObj(this.dbservice.Tables.Node,o,t),n.statue=1,1}catch(o){return console.log(o),this.presentAlert("\u7f51\u7edc\u51fa\u9519",null,"\u540c\u6b65\u6570\u636e\u65f6\u51fa\u73b0\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002"),n.statue=-1,-1}}))}UploadNode(e){return Object(d.b)(this,void 0,void 0,(function*(){const t={type:"\u4e0a\u4f20 => :",path:e.name,statue:0,id:e.id};this.Items.push(t);try{if(32===e.type&&e.size>=0){const t=yield this.dbservice.GetRecordes(e.id),n={id:e.id,modified:Date.now(),version:e.version,encryp:!1,content:t};this.usingencry&&(n.content=N.AES.encrypt(JSON.stringify(t),this.encrypKey).toString(),n.encryp=!0),yield this.host.UploadRecord(this.user.id,this.user.password,n)}else 32===e.type&&e.size<0&&(yield this.host.DeleteRecord(this.user.id,this.user.password,e.id));return this.dbservice.UpdateObj(this.dbservice.Tables.Node,e.id,{dirty:!1}),t.statue=1,1}catch(n){return this.presentAlert("\u7f51\u7edc\u51fa\u9519",null,"\u540c\u6b65\u6570\u636e\u65f6\u51fa\u73b0\u9519\u8bef\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5\u3002"),t.statue=-1,-1}}))}DecrypData(e){try{const t=N.AES.decrypt(e,this.encrypKey).toString(N.enc.Utf8);return JSON.parse(t)}catch(t){throw this.presentAlert("\u89e3\u5bc6\u51fa\u9519",null,"\u65e0\u6cd5\u89e3\u5bc6\u4e91\u7aef\u6848\u4f8b\u6587\u4ef6\u3002\u6587\u4ef6\u5df2\u635f\u574f\u6216\u52a0\u5bc6\u53e3\u4ee4\u4e0d\u6b63\u786e\u3002"),new Error("\u6587\u4ef6\u5df2\u635f\u574f\uff0c\u6216\u52a0\u5bc6\u53e3\u4ee4\u4e0d\u6b63\u786e\uff0c\u65e0\u6cd5\u6253\u5f00\u6587\u4ef6\u3002")}}LoadTreeFromCloud(){const e=this.settings.User;return this.host.GetBookTree(e.id,e.password).then(t=>t&&t.id===e.id?!0===t.encryp?this.DecrypData(t.content):t.content:Promise.reject("\u670d\u52a1\u5668\u6587\u4ef6\u51fa\u9519\u3002")).catch(e=>Promise.reject(e))}UploadNodes(){return Object(d.b)(this,void 0,void 0,(function*(){const e={type:"\u4e0a\u4f20 => :",path:"\u76ee\u5f55\u7ed3\u6784",statue:0,id:null};this.Items.push(e);const t=this.settings.User,n=yield this.dbservice.getNodesAlle();n.forEach(e=>e.dirty=!1);const o={id:t.id,modified:Date.now(),version:0,encryp:!1,content:n};return this.usingencry&&(o.content=N.AES.encrypt(JSON.stringify(n),this.encrypKey).toString(),o.encryp=!0),this.host.SaveBookTree(t.id,t.password,o).then(()=>(e.statue=1,!0)).catch(t=>(e.statue=-1,!1))}))}Stop(){this.modalCtrl.dismiss(this.changed)}presentAlert(e,t,n){return Object(d.b)(this,void 0,void 0,(function*(){const o=yield this.alertController.create({header:e||"\u9519\u8bef",subHeader:t||"",message:n,buttons:["\u786e\u5b9a"]});yield o.present()}))}presentConfirm(e,t,n){return Object(d.b)(this,void 0,void 0,(function*(){let o=-1;const c=yield this.alertController.create({header:e||"\u63d0\u793a",subHeader:t||"",message:n,buttons:[{text:"\u66f4\u65b0",handler:()=>{o=1}},{text:" \u4fdd\u7559",handler:()=>{o=0}},{text:"\u505c\u6b62",role:"cancel",cssClass:"secondary",handler:()=>{}}]});return yield c.present(),yield c.onWillDismiss(),Promise.resolve(o)}))}}return e.\u0275fac=function(t){return new(t||e)(u.Yb(s.cb),u.Yb(s.b),u.Yb(r.a),u.Yb(l.a),u.Yb(a.a))},e.\u0275cmp=u.Sb({type:e,selectors:[["app-syncindicator"]],inputs:{Items:"Items"},decls:11,vars:2,consts:[["color","secondary"],[4,"ngFor","ngForOf"],["slot","end",3,"disabled","click"],["color","medium"],["class","spin","slot","end",4,"ngIf"],["slot","end",3,"name",4,"ngIf"],["slot","end",1,"spin"],["name","bubbles"],["slot","end",3,"name"]],template:function(e,t){1&e&&(u.dc(0,"ion-header"),u.dc(1,"ion-toolbar",0),u.dc(2,"ion-title"),u.Ic(3,"\u540c\u6b65\u6570\u636e\u5230\u670d\u52a1\u5668"),u.cc(),u.cc(),u.cc(),u.dc(4,"ion-content"),u.dc(5,"ion-list"),u.Gc(6,y,7,4,"ion-item",1),u.cc(),u.cc(),u.dc(7,"ion-footer"),u.dc(8,"ion-toolbar"),u.dc(9,"ion-button",2),u.lc("click",(function(){return t.Stop()})),u.Ic(10,"\u786e\u5b9a"),u.cc(),u.cc(),u.cc()),2&e&&(u.Nb(6),u.vc("ngForOf",t.Items),u.Nb(3),u.vc("disabled",!t.Finished))},directives:[s.t,s.Y,s.W,s.n,s.E,o.i,s.r,s.i,s.x,s.T,o.j,s.S,s.u],styles:[""]}),e})();var g=n("xPBH"),I=n("Y6BA"),S=n("vBXD");function O(e,t){if(1&e){const e=u.ec();u.dc(0,"ion-header"),u.dc(1,"ion-toolbar",2),u.dc(2,"ion-buttons",3),u.Zb(3,"ion-menu-button"),u.cc(),u.dc(4,"ion-title"),u.Ic(5,"\u6848\u4f8b\u76ee\u5f55"),u.cc(),u.dc(6,"ion-buttons",4),u.dc(7,"ion-button",5),u.lc("click",(function(){return u.Bc(e),u.oc().SyncCloud()})),u.Zb(8,"ion-icon",6),u.cc(),u.dc(9,"ion-button",7),u.lc("click",(function(t){return u.Bc(e),u.oc().sortOptions(t)})),u.Zb(10,"ion-icon",8),u.dc(11,"ion-text"),u.Ic(12),u.cc(),u.cc(),u.cc(),u.cc(),u.cc()}if(2&e){const e=u.oc();u.Nb(7),u.vc("disabled",!e.HasUser),u.Nb(5),u.Jc(e.SortName)}}function C(e,t){if(1&e){const e=u.ec();u.dc(0,"ion-item"),u.dc(1,"ion-buttons"),u.dc(2,"ion-button",9),u.lc("click",(function(){return u.Bc(e),u.oc().SyncCloud()})),u.Zb(3,"ion-icon",10),u.Ic(4," \u4e91\u540c\u6b65 "),u.cc(),u.dc(5,"ion-button",7),u.lc("click",(function(){return u.Bc(e),u.oc().onNodeAdd(null)})),u.Zb(6,"ion-icon",11),u.dc(7,"ion-text"),u.Ic(8,"\u65b0\u5efa"),u.cc(),u.cc(),u.dc(9,"ion-button",7),u.lc("click",(function(){return u.Bc(e),u.oc().ShowRecordes(null)})),u.Zb(10,"ion-icon",12),u.dc(11,"ion-text"),u.Ic(12,"\u5168\u90e8"),u.cc(),u.cc(),u.dc(13,"ion-button",5),u.lc("click",(function(){return u.Bc(e),u.oc().ShowActions()})),u.Zb(14,"ion-icon",13),u.dc(15,"ion-text"),u.Ic(16,"\u7f16\u8f91"),u.cc(),u.cc(),u.dc(17,"ion-button",14),u.lc("click",(function(){return u.Bc(e),u.oc().CleanData()})),u.Zb(18,"ion-icon",15),u.Ic(19," \u6e05\u7a7a "),u.cc(),u.cc(),u.dc(20,"ion-buttons",4),u.dc(21,"ion-segment",16),u.lc("ngModelChange",(function(t){return u.Bc(e),u.oc().SortKey=t}))("ionChange",(function(){return u.Bc(e),u.oc().Reload()})),u.dc(22,"ion-segment-button",17),u.Ic(23,"\u540d\u79f0"),u.cc(),u.dc(24,"ion-segment-button",18),u.Ic(25,"\u521b\u5efa\u65f6\u95f4"),u.cc(),u.dc(26,"ion-segment-button",19),u.Ic(27,"\u4fee\u6539\u65f6\u95f4"),u.cc(),u.cc(),u.cc(),u.cc()}if(2&e){const e=u.oc();u.Nb(2),u.vc("disabled",!e.HasUser),u.Nb(11),u.vc("disabled",!e.SelectedNode),u.Nb(8),u.vc("ngModel",e.SortKey)}}function D(e,t){if(1&e){const e=u.ec();u.dc(0,"ion-footer"),u.dc(1,"ion-toolbar"),u.dc(2,"ion-buttons",3),u.dc(3,"ion-button",7),u.lc("click",(function(){return u.Bc(e),u.oc().onNodeAdd(null)})),u.Zb(4,"ion-icon",11),u.dc(5,"ion-text"),u.Ic(6,"\u65b0\u5efa"),u.cc(),u.cc(),u.dc(7,"ion-button",5),u.lc("click",(function(){u.Bc(e);const t=u.oc();return t.ShowRecordes(t.SelectedNode)})),u.Zb(8,"ion-icon",12),u.dc(9,"ion-text"),u.Ic(10,"\u6253\u5f00"),u.cc(),u.cc(),u.dc(11,"ion-button",5),u.lc("click",(function(){return u.Bc(e),u.oc().ShowActions()})),u.Zb(12,"ion-icon",13),u.dc(13,"ion-text"),u.Ic(14,"\u7f16\u8f91"),u.cc(),u.cc(),u.dc(15,"ion-button",14),u.lc("click",(function(){return u.Bc(e),u.oc().CleanData()})),u.Zb(16,"ion-icon",15),u.Ic(17," \u6e05\u7a7a "),u.cc(),u.cc(),u.dc(18,"ion-buttons",4),u.dc(19,"ion-button",7),u.lc("click",(function(){return u.Bc(e),u.oc().ShowRecordes(null)})),u.Zb(20,"ion-icon",12),u.dc(21,"ion-text"),u.Ic(22,"\u5168\u90e8"),u.cc(),u.cc(),u.cc(),u.cc(),u.cc()}if(2&e){const e=u.oc();u.Nb(7),u.vc("disabled",!e.SelectedNode),u.Nb(4),u.vc("disabled",!e.SelectedNode)}}let w=(()=>{class e{constructor(e,t,n,o,c,i,s,d,r){this.dbservice=e,this.settings=t,this.host=n,this.actionsheetctrl=o,this.alertCtrl=c,this.popoverCtrl=i,this.modalController=s,this.route=d,this.router=r,this.selectedtNodeId=15,this.SortKey="created",this.SortName="\u521b\u5efa\u65e5\u671f",this.HasUser=!1,this.spinner=!1}ngOnInit(){return Object(d.b)(this,void 0,void 0,(function*(){yield this.settings.WaitInit(),yield this.Reload(),this.HasUser=this.settings.HasUser,this.user=this.settings.User||I.a}))}get IsWeb(){return"web"===I.b}get OpenEnable(){return!!this.SelectedNode&&32===this.SelectedNode.Type}Reload(){return this.dbservice.getNodes().then(e=>(this.Nodes=this.buildNodeTree(e,null),!0)).catch(e=>!1)}onNodeSelecte(e){this.SelectedNode&&(this.SelectedNode.IsSelected=!1),this.SelectedNode=e,this.SelectedNode.IsSelected=!0}sortOptions(e){return Object(d.b)(this,void 0,void 0,(function*(){const t=yield this.popoverCtrl.create({component:b.a,event:e,componentProps:{items:[{name:"\u76ee\u5f55\u540d\u79f0",value:"name"},{name:"\u521b\u5efa\u65f6\u95f4",value:"created"},{name:"\u4fee\u6539\u65f6\u95f4",value:"modified"}],currentOption:this.SortKey},translucent:!0});yield t.present();const{data:n}=yield t.onDidDismiss();if((n||this.SortKey)!==this.SortKey){switch(this.SortKey=n.toString(),this.SortKey){case"name":this.SortName="\u76ee\u5f55\u540d\u79f0";break;case"created":this.SortName="\u521b\u5efa\u65f6\u95f4";break;case"modified":this.SortName="\u4fee\u6539\u65f6\u95f4";break;default:this.SortName="\u9ed8\u8ba4"}this.Reload()}}))}onNodeOpen(e){this.ShowRecordes(e)}onNodeAdd(e){return Object(d.b)(this,void 0,void 0,(function*(){const t=yield this.modalController.create({component:h,componentProps:{NodeName:null,NodeType:1,Edit:!1,Path:g.a.getNodePath(null,e?e.ID:null,this.Nodes)}});yield t.present();const{data:n}=yield t.onWillDismiss();n.name&&!n.name.IsNullOrEmpty()&&(n.parent=e?e.ID:"",this.dbservice.CreateNode(n.parent,n.name,n.type).then(t=>{const n=new g.a(t.type,t.name,t.id);e?e.Sub.push(n):this.Nodes.push(n)}))}))}EditNode(){return Object(d.b)(this,void 0,void 0,(function*(){const e=g.a.getNodePath(null,this.SelectedNode.ID,this.Nodes),t=yield this.modalController.create({component:h,componentProps:{NodeName:this.SelectedNode.Title,NodeType:this.SelectedNode.Type,Edit:!0,Path:e}});yield t.present();const{data:n}=yield t.onWillDismiss();n.name&&!n.name.IsNullOrEmpty()&&this.dbservice.ChangeNode(this.SelectedNode.ID,n.name).then(e=>{this.SelectedNode.Title=n.name})}))}DeleteNode(){return Object(d.b)(this,void 0,void 0,(function*(){console.log("try delete ",this.SelectedNode);let e=!1;const t=g.a.getNodePath(null,this.SelectedNode?this.SelectedNode.ID:null,this.Nodes),n=yield this.alertCtrl.create({header:`${t.join("/")}`,subHeader:`\u5220\u9664 "${this.SelectedNode.Title}"`,message:"\u6b64\u76ee\u5f55\u4ee5\u53ca\u5176\u5305\u542b\u7684\u5b50\u76ee\u5f55\u548c\u76ee\u5f55\u5185\u7684\u6848\u4f8b\u5c06\u4f1a\u88ab\u5220\u9664\u3002\u786e\u5b9a\u6267\u884c\u5220\u9664\u64cd\u4f5c\u5417\uff1f",buttons:[{text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary"},{text:"\u786e\u5b9a",handler:()=>Object(d.b)(this,void 0,void 0,(function*(){e=!0}))}]});if(yield n.present(),yield n.onDidDismiss(),e){const e=[];this.SelectedNode.SubNodesId(e),console.log(".... to delete",e);for(const t of e)yield this.dbservice.DeleteNode(t).catch(e=>{console.log("delete node err",e),this.presentAlert("\u51fa\u9519",null,"\u4e0d\u597d\u610f\u601d\uff0c\u51fa\u4e86\u70b9\u5c0f\u95ee\u9898\u3002\u8bf7\u518d\u6b21\u6267\u884c\u4e00\u6b21\u5220\u9664\u64cd\u4f5c\u3002")});console.log("reload nodes ...."),this.Reload()}}))}MoveNode(){return Object(d.b)(this,void 0,void 0,(function*(){g.a.getNodePath(null,this.SelectedNode?this.SelectedNode.ID:null,this.Nodes);const e=yield this.modalController.create({component:p.a,componentProps:{Titel:"\u9009\u62e9\u65b0\u76ee\u5f55",SelectDocument:!1,NodeID:this.SelectedNode.ID}});yield e.present();const{data:t}=yield e.onWillDismiss();t.nodeid&&!t.nodeid.IsNullOrEmpty()&&this.dbservice.ChangeNode(this.SelectedNode.ID,null,"root"===t.nodeid?"":t.nodeid).then(e=>this.Reload())}))}ShowRecordes(e){if(e){const t=[];this.findDocumentNode(e,t),this.router.navigateByUrl(`/menu/recordes/${t.join("-")}`)}else this.router.navigateByUrl("/menu/recordes/*")}ShowActions(){return Object(d.b)(this,void 0,void 0,(function*(){const e=yield this.actionsheetctrl.create({header:`\u7f16\u8f91\uff1a${this.SelectedNode.Title}`,buttons:[{text:"\u5220\u9664",role:"destructive",icon:"trash",handler:()=>{this.DeleteNode()}},{text:"\u4fee\u6539",icon:"create",handler:()=>{this.EditNode()}},{text:"\u8fc1\u79fb\u76ee\u5f55",icon:"arrow-round-back",handler:()=>{this.MoveNode()}},{text:" \u53d6\u6d88",icon:"close",role:"cancel",handler:()=>{}}]});yield e.present()}))}SyncCloud(){return Object(d.b)(this,void 0,void 0,(function*(){const e=yield this.modalController.create({component:v});yield e.present(),yield e.onWillDismiss(),yield this.Reload()}))}CleanData(){return Object(d.b)(this,void 0,void 0,(function*(){(yield this.presentAlert("\u6e05\u7a7a","\u672c\u5730\u6848\u4f8b","\u672c\u5730\u6848\u4f8b\u4f1a\u88ab\u6e05\u7a7a\u3002\u8bf7\u786e\u4fdd\u5df2\u7ecf\u5bfc\u51fa\uff0c\u6216\u8005\u4fdd\u5b58\u5230\u4e91\u7aef\u3002",!0))&&(yield this.dbservice.CleanDB(this.user.id),yield this.dbservice.initNano(),this.Nodes=[])}))}buildNodeTree(e,t){let n=[];return(t||"").IsNullOrEmpty(),t=null!=t?t:"",n=e.where(e=>(e.parent||"")===t).sortByKey(this.SortKey).select(e=>{const t=new g.a(e.type,e.name,e.id);return t.Version=e.version?e.version:0,t}),n.forEach(t=>{t.Sub=this.buildNodeTree(e,t.ID)}),n}findDocumentNode(e,t){if(32!==e.Type)for(const n of e.Sub||[])this.findDocumentNode(n,t);else t.push(e.ID)}findTreeNode(e,t){const n=(e||[]).find(e=>e.ID===t);if(n)return n;for(const o of e){const e=this.findTreeNode(o.Sub,t);if(e)return e}return null}presentAlert(e,t,n,o=!1){return Object(d.b)(this,void 0,void 0,(function*(){let c=!1;const i=[{text:"\u786e\u5b9a",handler:()=>{c=!0}}];o&&i.push({text:"\u53d6\u6d88",role:"cancel",cssClass:"secondary",handler:()=>{}});const s=yield this.alertCtrl.create({header:e||"\u9519\u8bef",subHeader:t||"",message:n,buttons:i});return yield s.present(),yield s.onWillDismiss(),Promise.resolve(c)}))}}return e.\u0275fac=function(t){return new(t||e)(u.Yb(r.a),u.Yb(l.a),u.Yb(a.a),u.Yb(s.a),u.Yb(s.b),u.Yb(s.fb),u.Yb(s.cb),u.Yb(i.a),u.Yb(i.g))},e.\u0275cmp=u.Sb({type:e,selectors:[["app-nodes"]],decls:5,vars:4,consts:[[4,"ngIf"],[3,"nodes","nodeOpen","nodeSelected","nodeAdd"],["color","primary"],["slot","start"],["slot","end"],["size","small",3,"disabled","click"],["slot","icon-only","name","cloud-upload"],["size","small",3,"click"],["name","md-funnel"],[3,"disabled","click"],["name","cloud-upload"],["name","add"],["name","book"],["name","build"],[3,"click"],["name","trash"],[3,"ngModel","ngModelChange","ionChange"],["value","name"],["value","modified"],["value","created"]],template:function(e,t){1&e&&(u.Gc(0,O,13,2,"ion-header",0),u.dc(1,"ion-content"),u.Gc(2,C,28,3,"ion-item",0),u.dc(3,"app-tree-node",1),u.lc("nodeOpen",(function(e){return t.onNodeOpen(e)}))("nodeSelected",(function(e){return t.onNodeSelecte(e)}))("nodeAdd",(function(e){return t.onNodeAdd(e)})),u.cc(),u.cc(),u.Gc(4,D,23,2,"ion-footer",0)),2&e&&(u.vc("ngIf",!t.IsWeb),u.Nb(2),u.vc("ngIf",t.IsWeb),u.Nb(1),u.vc("nodes",t.Nodes),u.Nb(1),u.vc("ngIf",!t.IsWeb))},directives:[o.j,s.n,S.a,s.t,s.Y,s.j,s.G,s.W,s.i,s.u,s.T,s.x,s.O,s.hb,c.f,c.g,s.P,s.r],styles:[".spin[_ngcontent-%COMP%]{position:fixed;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}ion-spinner[_ngcontent-%COMP%]{width:50px;height:50px;stroke:#444;fill:#222}"]}),e})();n("yLV6");let x=(()=>{let e=class{};return e.\u0275mod=u.Wb({type:e}),e.\u0275inj=u.Vb({factory:function(t){return new(t||e)},imports:[[o.b]]}),e})();n.d(t,"NodesPageModule",(function(){return T}));const k=[{path:"",component:w}];let T=(()=>{class e{}return e.\u0275mod=u.Wb({type:e}),e.\u0275inj=u.Vb({factory:function(t){return new(t||e)},imports:[[o.b,c.c,s.Z,x,i.j.forChild(k)]]}),e})()},HQI1:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var o=n("c7TG"),c=n("fXoL"),i=n("ofXK");function s(e,t){if(1&e){const e=c.ec();c.dc(0,"ion-item",3),c.lc("click",(function(){c.Bc(e);const n=t.$implicit;return c.oc(2).onSelect(n.value)})),c.dc(1,"ion-text"),c.Ic(2),c.cc(),c.cc()}if(2&e){const e=t.$implicit,n=c.oc(2);c.vc("color",e.value===n.currentOption?"light":""),c.Nb(2),c.Jc(e.name)}}function d(e,t){if(1&e&&(c.dc(0,"div"),c.Gc(1,s,3,2,"ion-item",2),c.cc()),2&e){const e=c.oc();c.Nb(1),c.vc("ngForOf",e.items)}}function r(e,t){if(1&e&&(c.dc(0,"ion-note"),c.Ic(1),c.cc()),2&e){const e=c.oc().$implicit;c.Nb(1),c.Kc(" ",e.name," ")}}function l(e,t){if(1&e&&(c.dc(0,"ion-item",6),c.Gc(1,r,2,1,"ion-note",0),c.dc(2,"ion-label",7),c.dc(3,"small"),c.Zb(4,"ion-text",8),c.cc(),c.cc(),c.cc()),2&e){const e=t.$implicit;c.Nb(1),c.vc("ngIf",e.name),c.Nb(3),c.vc("innerHtml",e.value,c.Cc)}}function a(e,t){if(1&e&&(c.dc(0,"ion-list",4),c.Gc(1,l,5,2,"ion-item",5),c.cc()),2&e){const e=c.oc();c.Nb(1),c.vc("ngForOf",e.items)}}let u=(()=>{class e{constructor(e){this.popoverCtrl=e,this.toselect=!0}ngOnInit(){}onSelect(e){this.popoverCtrl.dismiss(e)}}return e.\u0275fac=function(t){return new(t||e)(c.Yb(o.fb))},e.\u0275cmp=c.Sb({type:e,selectors:[["app-optionpopover"]],inputs:{currentOption:"currentOption",items:"items",toselect:"toselect"},decls:2,vars:2,consts:[[4,"ngIf"],["class","ion-no-padding",4,"ngIf"],["button","",3,"color","click",4,"ngFor","ngForOf"],["button","",3,"color","click"],[1,"ion-no-padding"],["lines","none",4,"ngFor","ngForOf"],["lines","none"],["slot","end",1,"ion-text-wrap"],[3,"innerHtml"]],template:function(e,t){1&e&&(c.Gc(0,d,2,1,"div",0),c.Gc(1,a,2,1,"ion-list",1)),2&e&&(c.vc("ngIf",t.toselect),c.Nb(1),c.vc("ngIf",!t.toselect))},directives:[i.j,i.i,o.x,o.T,o.E,o.D,o.H],styles:[""]}),e})()}}]);