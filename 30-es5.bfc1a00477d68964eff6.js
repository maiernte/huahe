function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{HQI1:function(t,e,n){"use strict";n.d(e,"a",(function(){return f}));var i=n("c7TG"),c=n("fXoL"),o=n("ofXK");function r(t,e){if(1&t){var n=c.ec();c.dc(0,"ion-item",3),c.lc("click",(function(){c.Cc(n);var t=e.$implicit;return c.oc(2).onSelect(t.value)})),c.dc(1,"ion-text"),c.Jc(2),c.cc(),c.cc()}if(2&t){var i=e.$implicit,o=c.oc(2);c.vc("color",i.value===o.currentOption?"light":""),c.Nb(2),c.Kc(i.name)}}function a(t,e){if(1&t&&(c.dc(0,"div"),c.Hc(1,r,3,2,"ion-item",2),c.cc()),2&t){var n=c.oc();c.Nb(1),c.vc("ngForOf",n.items)}}function s(t,e){if(1&t&&(c.dc(0,"ion-note"),c.Jc(1),c.cc()),2&t){var n=c.oc().$implicit;c.Nb(1),c.Lc(" ",n.name," ")}}function u(t,e){if(1&t&&(c.dc(0,"ion-item",6),c.Hc(1,s,2,1,"ion-note",0),c.dc(2,"ion-label",7),c.dc(3,"small"),c.Zb(4,"ion-text",8),c.cc(),c.cc(),c.cc()),2&t){var n=e.$implicit;c.Nb(1),c.vc("ngIf",n.name),c.Nb(3),c.vc("innerHtml",n.value,c.Dc)}}function l(t,e){if(1&t&&(c.dc(0,"ion-list",4),c.Hc(1,u,5,2,"ion-item",5),c.cc()),2&t){var n=c.oc();c.Nb(1),c.vc("ngForOf",n.items)}}var f=function(){var t=function(){function t(e){_classCallCheck(this,t),this.popoverCtrl=e,this.toselect=!0}return _createClass(t,[{key:"ngOnInit",value:function(){}},{key:"onSelect",value:function(t){this.popoverCtrl.dismiss(t)}}]),t}();return t.\u0275fac=function(e){return new(e||t)(c.Yb(i.fb))},t.\u0275cmp=c.Sb({type:t,selectors:[["app-optionpopover"]],inputs:{currentOption:"currentOption",items:"items",toselect:"toselect"},decls:2,vars:2,consts:[[4,"ngIf"],["class","ion-no-padding",4,"ngIf"],["button","",3,"color","click",4,"ngFor","ngForOf"],["button","",3,"color","click"],[1,"ion-no-padding"],["lines","none",4,"ngFor","ngForOf"],["lines","none"],["slot","end",1,"ion-text-wrap"],[3,"innerHtml"]],template:function(t,e){1&t&&(c.Hc(0,a,2,1,"div",0),c.Hc(1,l,2,1,"ion-list",1)),2&t&&(c.vc("ngIf",e.toselect),c.Nb(1),c.vc("ngIf",!e.toselect))},directives:[o.j,o.i,i.x,i.T,i.E,i.D,i.H],styles:[""]}),t}()},qNzN:function(t,e,n){"use strict";n.r(e);var i=n("ofXK"),c=n("3Pt+"),o=n("tyNb"),r=n("c7TG"),a=n("mrSG"),s=n("LTmD"),u=n("lEof"),l=n("PKx9"),f=n("HQI1"),d=n("8/yo"),h=n("G6JS"),v=n("Y6BA"),m=n("fXoL"),p=n("i/bi");function g(t,e){if(1&t){var n=m.ec();m.dc(0,"ion-buttons",10),m.dc(1,"ion-button",11),m.lc("click",(function(){return m.Cc(n),m.oc(2).EditTopic(null)})),m.Zb(2,"ion-icon",12),m.dc(3,"ion-text"),m.Jc(4,"\u65b0\u8d34"),m.cc(),m.cc(),m.cc()}}function b(t,e){if(1&t&&(m.dc(0,"ion-header"),m.dc(1,"ion-toolbar",6),m.dc(2,"ion-buttons",7),m.Zb(3,"ion-back-button",8),m.cc(),m.dc(4,"ion-title"),m.Jc(5),m.cc(),m.Hc(6,g,5,0,"ion-buttons",9),m.cc(),m.cc()),2&t){var n=m.oc();m.Nb(5),m.Lc(": ",n.Titel," :"),m.Nb(1),m.vc("ngIf",n.PageType>=-2&&n.HasUser)}}function T(t,e){if(1&t){var n=m.ec();m.dc(0,"ion-button",20),m.lc("click",(function(){return m.Cc(n),m.oc(2).JinghuaTopics(-2,!0)})),m.Jc(1," [\u7cbe\u534e] "),m.cc()}}function k(t,e){if(1&t){var n=m.ec();m.dc(0,"ion-button",14),m.lc("click",(function(){return m.Cc(n),m.oc(2).JinghuaTopics(0,!0)})),m.Jc(1," [\u9996\u9875] "),m.cc()}}function y(t,e){if(1&t){var n=m.ec();m.dc(0,"ion-item-divider",13),m.dc(1,"ion-label",7),m.dc(2,"ion-text"),m.Jc(3,"\u7248\u4e3b\uff1a"),m.cc(),m.cc(),m.dc(4,"ion-buttons",7),m.dc(5,"ion-button",14),m.lc("click",(function(){m.Cc(n);var t=m.oc();return t.ShowUserInfo(t.Admin)})),m.Jc(6),m.cc(),m.cc(),m.dc(7,"ion-buttons",10),m.dc(8,"ion-button",15),m.Zb(9,"ion-icon",16),m.Jc(10," \u9996\u9875 "),m.cc(),m.dc(11,"ion-button",17),m.lc("click",(function(){return m.Cc(n),m.oc().EditTopic(null)})),m.Zb(12,"ion-icon",12),m.dc(13,"ion-text"),m.Jc(14,"[+\u65b0\u8d34]"),m.cc(),m.cc(),m.Hc(15,T,2,0,"ion-button",18),m.Hc(16,k,2,0,"ion-button",19),m.cc(),m.cc()}if(2&t){var i=m.oc();m.Nb(6),m.Kc(i.Admin),m.Nb(9),m.vc("ngIf",0===i.PageType),m.Nb(1),m.vc("ngIf",-2===i.PageType)}}function x(t,e){if(1&t){var n=m.ec();m.dc(0,"ion-item",21),m.lc("click",(function(){m.Cc(n);var t=e.$implicit;return m.oc().Navi2Topic(t)})),m.dc(1,"ion-thumbnail",7),m.Zb(2,"img",22),m.cc(),m.dc(3,"ion-label",23),m.dc(4,"ion-text"),m.Jc(5),m.cc(),m.dc(6,"ion-text",24),m.Jc(7,"[\u7f6e\u9876]"),m.cc(),m.Zb(8,"br"),m.dc(9,"ion-note"),m.Jc(10),m.cc(),m.Zb(11,"br"),m.dc(12,"ion-note"),m.dc(13,"small"),m.Jc(14),m.cc(),m.cc(),m.Zb(15,"br"),m.dc(16,"ion-note"),m.dc(17,"small"),m.Jc(18),m.cc(),m.cc(),m.Zb(19,"br"),m.dc(20,"ion-note"),m.dc(21,"small"),m.Jc(22),m.cc(),m.cc(),m.dc(23,"ion-note"),m.dc(24,"small"),m.Jc(25),m.cc(),m.cc(),m.cc(),m.cc()}if(2&t){var i=e.$implicit,c=m.oc();m.Nb(2),m.vc("src",i.avatar,m.Ec),m.Nb(3),m.Kc(i.title),m.Nb(5),m.Lc("\u4f5c\u8005\uff1a[",i.author,"]"),m.Nb(4),m.Lc("\u53d1\u5e16\u65f6\u95f4: ",c.DateText(i.created),""),m.Nb(4),m.Lc("\u56de\u5e16\u65f6\u95f4: ",c.DateText(i.update),""),m.Nb(4),m.Lc("\u56de\u5e16\u6570\u91cf: ",i.child,""),m.Nb(3),m.Lc("\u6d4f\u89c8\u6570\u91cf: ",i.view,"")}}function w(t,e){1&t&&(m.dc(0,"ion-text",24),m.Jc(1,"[\u7cbe\u534e]"),m.cc())}function C(t,e){if(1&t){var n=m.ec();m.dc(0,"ion-item",21),m.lc("click",(function(){m.Cc(n);var t=e.$implicit;return m.oc().Navi2Topic(t)})),m.dc(1,"ion-thumbnail",7),m.Zb(2,"img",22),m.cc(),m.dc(3,"ion-label",23),m.dc(4,"ion-text"),m.Jc(5),m.cc(),m.Hc(6,w,2,0,"ion-text",25),m.Zb(7,"br"),m.dc(8,"ion-note"),m.Jc(9),m.cc(),m.Zb(10,"br"),m.dc(11,"ion-note"),m.dc(12,"small"),m.Jc(13),m.cc(),m.cc(),m.Zb(14,"br"),m.dc(15,"ion-note"),m.dc(16,"small"),m.Jc(17),m.cc(),m.cc(),m.Zb(18,"br"),m.dc(19,"ion-note"),m.dc(20,"small"),m.Jc(21),m.cc(),m.cc(),m.dc(22,"ion-note"),m.dc(23,"small"),m.Jc(24),m.cc(),m.cc(),m.cc(),m.cc()}if(2&t){var i=e.$implicit,c=m.oc();m.Nb(2),m.vc("src",i.avatar,m.Ec),m.Nb(3),m.Kc(i.title),m.Nb(1),m.vc("ngIf",i.good),m.Nb(3),m.Lc("\u4f5c\u8005\uff1a[",i.author,"]"),m.Nb(4),m.Lc("\u53d1\u5e16\u65f6\u95f4: ",c.DateText(i.created),""),m.Nb(4),m.Lc("\u56de\u5e16\u65f6\u95f4: ",c.DateText(i.update),""),m.Nb(4),m.Lc("\u56de\u5e16\u6570\u91cf: ",i.child,""),m.Nb(3),m.Lc("\u6d4f\u89c8\u6570\u91cf: ",i.view,"")}}function N(t,e){if(1&t){var n=m.ec();m.dc(0,"div",26),m.dc(1,"sui-pagination",27),m.lc("pageChange",(function(t){return m.Cc(n),m.oc().PageIndex=t})),m.cc(),m.cc()}if(2&t){var i=m.oc();m.Nb(1),m.vc("collectionSize",i.PageSum)("pageSize",20)("maxSize",i.MaxPageButtons)("hasNavigationLinks",!0)("hasBoundaryLinks",!0)("page",i.PageIndex)}}var I,P=((I=function(){function t(e,n,i,c,o,r,a,s){var u=this;_classCallCheck(this,t),this.loadingController=e,this.settings=n,this.forumservice=i,this.host=c,this.popoverCtrl=o,this.modalCtrl=r,this.route=a,this.router=s,this.pageindex=0,this.cache=[],this.loadfailed=!0,this.Titel="\u8bba\u575b",this.SortKey="lasttopic",this.Pages=[0],this.PageType=0,this.PageSum=0,this.Topics=[],this.TTopics=[],this.route.params.subscribe((function(t){u.forumid=t.forumid}))}return _createClass(t,[{key:"ngOnInit",value:function(){return Object(a.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.settings.WaitInit();case 2:return t.next=4,this.loadingController.create({message:"\u6b63\u5728\u83b7\u53d6\u8bba\u575b\u5e16\u5b50...",duration:6e4});case 4:this.loadingView=t.sent,this.user=this.settings.User||v.a,"forum_me"===this.forumid?(this.Titel="\u6211\u7684\u5e16\u5b50",this.PageType=-3):"forum_ticket"===this.forumid?(this.Titel="\u6211\u7684\u6c42\u52a9",this.PageType=-4):"forum_master"===this.forumid?(this.Titel="\u5411\u6211\u7684\u53d1\u95ee",this.PageType=-5):this.PageType=0,this.PageIndex=0;case 8:case"end":return t.stop()}}),t,this)})))}},{key:"DateText",value:function(t){if(!t)return"\u65e0";var e=new Date(t);return e.toChinaStr()+" ".concat(e.getHours(),":").concat(e.getMinutes(),":").concat(e.getSeconds())}},{key:"doRefresh",value:function(t){var e=this;this.Reconnect().then((function(t){e.loadfailed=!t})).catch((function(t){console.log(t)})).finally((function(){t.target.complete()}))}},{key:"Reconnect",value:function(){return Object(a.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var e=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.showLoading();case 2:return t.abrupt("return",this.forumservice.ForumList().then((function(t){return e.forum=t.find((function(t){return t.id===e.forumid})),e.Titel=e.forum.name,e.admin=e.forum.admin.join("\u3001"),e.forumservice.LoadTopicList(e.forum.id,e.PageIndex,0)})).then((function(t){return e.PageSum=t.sum,e.Topics=t.data,e.Topics.forEach((function(t){return t.avatar=e.DefaultAvatar})),e.updateUserAvatar(e.Topics),e.forumservice.LoadTopicList(e.forum.id,0,-1)})).then((function(t){return e.TTopics=t.data,e.TTopics.forEach((function(t){return t.avatar=e.DefaultAvatar})),e.updateUserAvatar(e.TTopics),!0})).catch((function(t){return!1})).finally((function(){e.closeLoading()})));case 3:case"end":return t.stop()}}),t,this)})))}},{key:"JinghuaTopics",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Object(a.b)(this,void 0,void 0,regeneratorRuntime.mark((function n(){var i=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e&&(this.pageindex=0,this.PageType=t),!(t<0)){n.next=7;break}return n.next=4,this.showLoading();case 4:this.forumservice.LoadTopicList(t<-2?null:this.forumid,this.PageIndex,t).then((function(t){i.PageSum=t.sum,i.Topics=t.data,i.Topics.forEach((function(t){return t.avatar=i.DefaultAvatar})),i.updateUserAvatar(i.Topics),i.loadfailed=!1})).finally((function(){i.closeLoading()})),n.next=8;break;case 7:this.Reconnect();case 8:case"end":return n.stop()}}),n,this)})))}},{key:"Navi2Topic",value:function(t){var e=t.forumid;e="forum_ticket"===this.forumid?"\u6c42\u52a9\uff1a"+e:e,e="forum_master"===this.forumid?"\u89e3\u7b54\u5ba2\u6237":e,this.router.navigateByUrl("menu/topicdetail/".concat(e,"/").concat(t.id))}},{key:"updateUserAvatar",value:function(t){var e=this;t.forEach((function(t){t.avatar&&t.avatar!==e.DefaultAvatar||e.forumservice.GetUserInfo(t.author).then((function(n){var i=(n||v.a).avatar||"";t.avatar=i.IsNullOrEmpty()?e.settings.Avatar(n.gender):i,t.showImg=!0,t.showGua=!0,t.showBazi=!0}))}))}},{key:"sortOptions",value:function(t){return Object(a.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n,i,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.popoverCtrl.create({component:f.a,event:t,componentProps:{items:[{name:"\u521b\u5efa\u65f6\u95f4",value:"created"},{name:"\u4fee\u6539\u65f6\u95f4",value:"modified"}],currentOption:this.SortKey},translucent:!0});case 2:return n=e.sent,e.next=5,n.present();case 5:return e.next=7,n.onDidDismiss();case 7:i=e.sent,((c=i.data)||this.SortKey)!==this.SortKey&&(this.SortKey=c.toString());case 10:case"end":return e.stop()}}),e,this)})))}},{key:"EditTopic",value:function(t){return Object(a.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n,i,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.modalCtrl.create({component:d.a,componentProps:{MainTopic:t||this.CreateMainTopic(),forumid:this.forumid,forumname:this.forum.name}});case 2:return n=e.sent,e.next=5,n.present();case 5:return e.next=7,n.onWillDismiss();case 7:i=e.sent,(c=i.data)&&this.AddToLocal(c);case 10:case"end":return e.stop()}}),e,this)})))}},{key:"ShowUserInfo",value:function(t){return Object(a.b)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.modalCtrl.create({component:h.a,componentProps:{Uerid:t}});case 2:return n=e.sent,e.next=5,n.present();case 5:return e.next=7,n.onWillDismiss();case 7:case"end":return e.stop()}}),e,this)})))}},{key:"GoPage",value:function(t){console.log("change page",t)}},{key:"AddToLocal",value:function(t){t.avatar=this.settings.User.avatar,t.forumid===this.forumid&&this.forumservice.ForumMG.SetTopic(t,t.forumid)}},{key:"CreateMainTopic",value:function(){var t=this.settings.User,e=Date.now();return{id:"",created:e,modified:e,author:t.id,forumid:this.forumid,title:"",top:0,good:!1,update:0,gua:null,bazi:null,img:null,content:"",frozen:!1,deleted:!1,child:0,view:0}}},{key:"showLoading",value:function(){return Object(a.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=this.loadingView,t.t0){t.next=5;break}return t.next=4,this.loadingController.create({message:"\u6b63\u5728\u83b7\u53d6\u8bba\u575b\u5e16\u5b50...",duration:6e4});case 4:this.loadingView=t.sent;case 5:return t.next=7,this.loadingView.present();case 7:case"end":return t.stop()}}),t,this)})))}},{key:"closeLoading",value:function(){return Object(a.b)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=this.loadingView,!t.t0){t.next=5;break}return t.next=4,this.loadingView.dismiss();case 4:this.loadingView=null;case 5:case"end":return t.stop()}}),t,this)})))}},{key:"SearchCache",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.cache.find((function(e){return e.forum===t}));return n?e?n.TT:n.T:null}},{key:"SaveCache",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this.cache.find((function(e){return e.forum===t}));i||(i={forum:t,TT:null,T:null},this.cache.push(i)),n?i.TT=e||[]:i.T=e||[]}},{key:"CleanCache",value:function(t){if(t){var e=this.cache.find((function(e){return e.forum===t}));e&&(e.T=null,e.TT=null)}else this.cache=[]}},{key:"IsWeb",get:function(){return"web"===v.b}},{key:"HasUser",get:function(){return this.settings.HasUser&&this.user!==v.a}},{key:"MaxPageButtons",get:function(){return this.settings.DeviceWidth>=400?7:2}},{key:"DefaultAvatar",get:function(){return this.settings.Avatar()}},{key:"PageIndex",get:function(){return this.pageindex},set:function(t){var e=this;this.pageindex=t,0!==this.PageType?this.JinghuaTopics(this.PageType):this.Reconnect().then((function(t){e.loadfailed=!t}))}},{key:"Admin",get:function(){return this.admin}}]),t}()).\u0275fac=function(t){return new(t||I)(m.Yb(r.bb),m.Yb(s.a),m.Yb(l.a),m.Yb(u.a),m.Yb(r.fb),m.Yb(r.cb),m.Yb(o.a),m.Yb(o.g))},I.\u0275cmp=m.Sb({type:I,selectors:[["app-topiclist"]],decls:9,vars:5,consts:[[4,"ngIf"],["slot","fixed",3,"ionRefresh"],["ion-no-padding",""],["ion-no-padding","","slot","fixed",4,"ngIf"],["detail","",3,"click",4,"ngFor","ngForOf"],["class","ui very basic segment",4,"ngIf"],["color","primary"],["slot","start"],["defaulthref","","text","\u8fd4\u56de"],["slot","end",4,"ngIf"],["slot","end"],["size","small",3,"click"],["slot","icon-only","name","add"],["ion-no-padding","","slot","fixed"],["color","primary",3,"click"],["routerLink","/menu/forum"],["name","home"],[3,"click"],["color","danger",3,"click",4,"ngIf"],["color","primary",3,"click",4,"ngIf"],["color","danger",3,"click"],["detail","",3,"click"],[3,"src"],[1,"ion-text-wrap"],["color","danger"],["color","danger",4,"ngIf"],[1,"ui","very","basic","segment"],[1,"ui","right","floated",3,"collectionSize","pageSize","maxSize","hasNavigationLinks","hasBoundaryLinks","page","pageChange"]],template:function(t,e){1&t&&(m.Hc(0,b,7,2,"ion-header",0),m.dc(1,"ion-content"),m.dc(2,"ion-refresher",1),m.lc("ionRefresh",(function(t){return e.doRefresh(t)})),m.Zb(3,"ion-refresher-content"),m.cc(),m.dc(4,"ion-list",2),m.Hc(5,y,17,3,"ion-item-divider",3),m.Hc(6,x,26,7,"ion-item",4),m.Hc(7,C,25,8,"ion-item",4),m.Hc(8,N,2,6,"div",5),m.cc(),m.cc()),2&t&&(m.vc("ngIf",!e.IsWeb),m.Nb(5),m.vc("ngIf",e.PageType>=-2),m.Nb(1),m.vc("ngForOf",e.TTopics),m.Nb(1),m.vc("ngForOf",e.Topics),m.Nb(1),m.vc("ngIf",!e.loadfailed))},directives:[i.j,r.n,r.J,r.K,r.E,i.i,r.t,r.Y,r.j,r.f,r.g,r.W,r.i,r.u,r.T,r.y,r.D,r.gb,o.h,r.x,r.V,r.H,p.f],styles:[""]}),I),L=n("Gfuc"),J=n("9UMr");n.d(e,"TopiclistPageModule",(function(){return O}));var S,H=[{path:"",component:P}],O=((S=function t(){_classCallCheck(this,t)}).\u0275mod=m.Wb({type:S}),S.\u0275inj=m.Vb({factory:function(t){return new(t||S)},imports:[[L.a,J.a,i.b,p.e,c.c,r.Z,o.j.forChild(H)]]}),S)}}]);